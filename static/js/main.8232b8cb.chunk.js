(this["webpackJsonpft-lockup-contract-frontend"]=this["webpackJsonpft-lockup-contract-frontend"]||[]).push([[0],{194:function(e,t){},204:function(e,t){},257:function(e,t,n){},258:function(e,t,n){"use strict";n.r(t);var a=n(57),c=n(44),r=n(26),o=n(8),s=n(15),l=n.n(s),i=n(0),u=n(56),d=n(17),j=n(38),h="ft-lockup.demo000.ft-lockup.testnet";var b=function(){var e=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_CONTRACT_NAME:"ft-lockup.demo000.ft-lockup.testnet"}).REACT_APP_ENVIRONMENT||"development";switch(e){case"production":case"mainnet":return{networkId:"mainnet",nodeUrl:"https://rpc.mainnet.near.org",contractName:h,walletUrl:"https://wallet.near.org",helperUrl:"https://helper.mainnet.near.org",explorerUrl:"https://explorer.mainnet.near.org"};case"development":case"testnet":return{networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",contractName:h,walletUrl:"https://wallet.testnet.near.org",helperUrl:"https://helper.testnet.near.org",explorerUrl:"https://explorer.testnet.near.org"};case"betanet":return{networkId:"betanet",nodeUrl:"https://rpc.betanet.near.org",contractName:h,walletUrl:"https://wallet.betanet.near.org",helperUrl:"https://helper.betanet.near.org",explorerUrl:"https://explorer.betanet.near.org"};case"local":return{explorerUrl:"",helperUrl:"",networkId:"local",nodeUrl:"http://localhost:3030",walletUrl:"http://localhost:4000/wallet",contractName:h};case"test":case"ci":return{explorerUrl:"",helperUrl:"",walletUrl:"",networkId:"shared-test",nodeUrl:"https://rpc.ci-testnet.near.org",contractName:h};case"ci-betanet":return{explorerUrl:"",helperUrl:"",walletUrl:"",networkId:"shared-test-staging",nodeUrl:"https://rpc.ci-betanet.near.org",contractName:h};default:throw Error("Unconfigured environment '".concat(e,"'. Can be configured in src/config.js."))}}(),p=n(51),x=n(52),O=function(){function e(t){Object(p.a)(this,e),this.near=void 0,this.contract=void 0,this.walletConnection=void 0,this.tokenContract=void 0,this.near=t,this.walletConnection=new j.WalletConnection(t,b.contractName),this.contract=new j.Contract(this.walletConnection.account(),b.contractName,{viewMethods:["get_lockups_paged","get_token_account_id","get_deposit_whitelist"],changeMethods:[]}),this.tokenContract=null}return Object(x.a)(e,[{key:"setTokenContract",value:function(e){console.log("account to token = ",this.walletConnection.account()),this.tokenContract=new j.Contract(this.walletConnection.account(),e,{viewMethods:[],changeMethods:["ft_transfer_call"]}),console.log("tokenContract = ",this.tokenContract)}},{key:"getTokenContract",value:function(){return this.tokenContract}},{key:"getContract",value:function(){return this.contract}},{key:"getTokenAccountId",value:function(){return this.contract.get_token_account_id()}},{key:"loadAllLockups",value:function(){return this.contract.get_lockups_paged().then((function(e){return e.map((function(e){var t=Object(o.a)(e,2),n=t[0],a=t[1];return Object.assign(a,{id:n})}))}))}},{key:"signIn",value:function(){var e=window.location.href;this.walletConnection.requestSignIn(b.contractName,void 0,e)}},{key:"signOut",value:function(){this.walletConnection.signOut()}},{key:"get_account_id",value:function(){return this.walletConnection.getAccountId()}},{key:"account",value:function(){var e=Object(r.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.near.account(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get_balance",value:function(){var e=Object(r.a)(l.a.mark((function e(t){var n,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.account(t);case 2:return n=e.sent,a=null,e.prev=4,e.next=7,n.getAccountBalance();case 7:c=e.sent,r=c.total,a=parseFloat(j.utils.format.formatNearAmount(r||"0")),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),console.error("Account not exist");case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}var r}),e,this,[[4,11]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),f=O,m=function(){var e=Object(r.a)(l.a.mark((function e(t,n){var a,c,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.query({request_type:"view_access_key_list",account_id:n,finality:"optimistic"});case 2:if(c=e.sent,null!==(a=c.keys)&&void 0!==a&&a.length){e.next=5;break}return e.abrupt("return",{});case 5:if(null!==(r=c.keys.filter((function(e){var t,n;return"string"===typeof(null===e||void 0===e||null===(t=e.access_key)||void 0===t?void 0:t.permission)&&"FullAccess"===(null===e||void 0===e||null===(n=e.access_key)||void 0===n?void 0:n.permission)})))&&void 0!==r&&r.length){e.next=8;break}return e.abrupt("return",{});case 8:return e.abrupt("return",r[0]);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),v=function(){var e=Object(r.a)(l.a.mark((function e(){var t,n,a,o,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new j.keyStores.BrowserLocalStorageKeyStore,e.next=3,j.connect(Object(c.a)({headers:{},keyStore:t},b));case 3:return n=e.sent,a=new f(n),e.next=7,a.getContract().get_deposit_whitelist();case 7:if(e.t0=e.sent,e.t0){e.next=10;break}e.t0=[];case 10:if(o=e.t0,s=n.connection.provider,null!==o&&void 0!==o&&o.length){e.next=14;break}throw Error("Zero lockup owners");case 14:return e.next=16,Promise.all(o.map(function(){var e=Object(r.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(s,t);case 2:n=e.sent,console.log("ffak = ",n),localStorage.setItem("".concat(b.contractName,"_wallet_auth_key"),JSON.stringify({accountId:t,allKeys:[n.public_key]}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 16:console.log("ownerAccountIds = ",o);case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),g={importWhitelistedAccountsFullAccessKeys:v},k=Object(i.createContext)(null),w=function(){var e=Object(r.a)(l.a.mark((function e(){var t,n,a,r,o,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.importWhitelistedAccountsFullAccessKeys();case 2:return t=new j.keyStores.BrowserLocalStorageKeyStore,e.next=5,j.connect(Object(c.a)({headers:{},keyStore:t},b));case 5:return n=e.sent,a=new f(n),r=new j.WalletConnection(n,b.contractName),o=r.getAccountId(),e.next=11,a.getTokenAccountId();case 11:return s=e.sent,a.setTokenContract(s),e.abrupt("return",{config:b,api:a,signedIn:!!o,signedAccountId:o});case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=n(1);function y(e){var t=e.lockups,n=e.token_account_id;return Object(_.jsxs)("div",{className:"container",children:[Object(_.jsx)("h1",{children:"About Page"}),Object(_.jsx)("pre",{children:"\n          This page should render all useful info about contract,\n          at least ft-lockup name, token name, contract ft balance,\n\n          ft-lockup account id: ".concat(b.contractName,"\n          token account id: ").concat(n,"\n\n          Total number of lockups: ").concat(t.length,"\n        ")})]})}var C=n(329),N=n(166),A=n(324),I=n(325),S=n(319),T=n(320),U=n(326),E=n(321),D=n(322),F=n(323),P=n(156),L=n.n(P),K=n(157),M=n.n(K),B=n(46),R=n.n(B);R.a.DP=40;var W=function(e){return new Date(1e3*e).toLocaleDateString("en-US")},q=function(e){return Math.floor(e/1e5)},J=function(e,t){return new Date(null===e||void 0===e?void 0:e.setFullYear(((null===e||void 0===e?void 0:e.getFullYear())||0)+t)).getTime()/1e3};function z(e){var t=e.row,n=Object(i.useState)(!1),a=Object(o.a)(n,2),c=a[0],r=a[1];return Object(_.jsxs)(_.Fragment,{children:[Object(_.jsxs)(S.a,{className:c?"expanded exp-row":"exp-row",sx:{"& > *":{borderBottom:"unset"}},children:[Object(_.jsx)(T.a,{children:Object(_.jsx)(E.a,{"aria-label":"expand row",size:"small",onClick:function(){return r(!c)},children:c?Object(_.jsx)(L.a,{}):Object(_.jsx)(M.a,{})})}),Object(_.jsx)(T.a,{align:"left",children:t.id}),Object(_.jsx)(T.a,{align:"left",children:Object(_.jsx)(u.b,{to:"/lockups/".concat(t.account_id),children:t.account_id})}),Object(_.jsx)(T.a,{align:"right",children:W(t.schedule[0].timestamp)}),Object(_.jsx)(T.a,{align:"right",children:W(t.schedule[t.schedule.length-1].timestamp)}),Object(_.jsxs)(T.a,{align:"right",children:[q(t.total_balance),"\xa0TOKEN"]}),Object(_.jsx)(T.a,{align:"center",children:Object(_.jsxs)("div",{className:"progress-bar",children:[Object(_.jsx)("div",{style:{width:"".concat(t.claimed_balance/t.total_balance*100,"%")},className:"claimed",children:Object(_.jsx)("span",{children:q(t.claimed_balance)})}),Object(_.jsx)("div",{style:{width:"".concat(t.unclaimed_balance/t.total_balance*100,"%")},className:"available",children:Object(_.jsx)("span",{children:t.unclaimed_balance/t.total_balance>.2&&q(t.unclaimed_balance)})}),Object(_.jsx)("div",{style:{width:"".concat((t.total_balance-t.claimed_balance-t.unclaimed_balance)/t.total_balance*100,"%")},className:"vested",children:Object(_.jsx)("span",{children:(t.total_balance-t.claimed_balance-t.unclaimed_balance)/t.total_balance>.2&&q(t.total_balance-t.claimed_balance-t.unclaimed_balance)})}),Object(_.jsx)("div",{style:{width:"".concat(100*(t.total_balance-t.total_balance),"%")},className:"unvested",children:"\xa0"})]})})]}),Object(_.jsx)(S.a,{sx:{background:"#F4FAFF"},children:Object(_.jsx)(T.a,{style:{padding:0},colSpan:7,children:Object(_.jsx)(D.a,{in:c,timeout:"auto",unmountOnExit:!0,children:Object(_.jsx)(F.a,{sx:{padding:2},children:Object(_.jsxs)("div",{className:"inner-table_wrapper",children:[Object(_.jsx)("h5",{children:"Lockup schedule"}),Object(_.jsxs)(A.a,{className:"inner-table",size:"small","aria-label":"purchases",children:[Object(_.jsx)(I.a,{children:Object(_.jsxs)(S.a,{children:[Object(_.jsx)(T.a,{children:"DATE"}),Object(_.jsx)(T.a,{children:"AMOUNT"})]})}),Object(_.jsx)(U.a,{children:t.schedule.map((function(e){return Object(_.jsxs)(S.a,{children:[Object(_.jsx)(T.a,{component:"th",scope:"row",children:W(e.timestamp)}),Object(_.jsxs)(T.a,{children:[q(e.balance),"\xa0TOKEN"]})]},e.timestamp)}))})]})]})})})})})]})}var H=n(307),V=n(311),Y=n(327),Z=n(316),G=n(328),Q=n(318),X=n(315),$=n(159),ee=n(314),te=function(){function e(t,n,a,c,r,o){Object(p.a)(this,e),this.lockupContractId=void 0,this.tokenContract=void 0,this.schedule=void 0,this.lockupTotalAmount=void 0,this.userAccountId=void 0,this.claimedBalance=void 0,this.tokenContract=t,this.schedule=n,this.lockupContractId=a,this.userAccountId=c,this.lockupTotalAmount=r,this.claimedBalance=o}return Object(x.a)(e,[{key:"call",value:function(){var e=Object(r.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={account_id:this.userAccountId,schedule:this.schedule,claimed_balance:this.claimedBalance},n={receiver_id:this.lockupContractId,amount:this.lockupTotalAmount,msg:JSON.stringify(t)},e.next=4,this.tokenContract.ft_transfer_call(n,3e14,1);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),ne=te;function ae(){var e=Object(i.useContext)(k).near,t=Object(i.useState)(!1),n=Object(o.a)(t,2),a=n[0],s=n[1],u=Object(i.useState)(null),d=Object(o.a)(u,2),j=d[0],h=d[1],b=function(){return s(!1)},p=function(){var t=Object(r.a)(l.a.mark((function t(n){var a,c,r,o,s,i,u,d,h,b,p;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),c=null===e||void 0===e||null===(a=e.api)||void 0===a?void 0:a.getTokenContract()){t.next=4;break}throw new Error("token contract is not initialized!");case 4:r=n.target.elements,o=r.account,s=r.amount,console.log(o.value,s.value),i=(null===e||void 0===e?void 0:e.api.getContract().contractId)||"","0",u=o.value||"alice.demo000.ft-lockup.testnet",d=s.value||"9000000",h=((null===j||void 0===j?void 0:j.getTime())||0)/1e3,b=[{timestamp:h,balance:"0"},{timestamp:J(j,1)-1,balance:"0"},{timestamp:J(j,1),balance:(d/4).toString()},{timestamp:J(j,4),balance:d}],p=new ne(c,b,i,u,d,"0"),console.log(p),p.call();case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(_.jsxs)("div",{children:[Object(_.jsx)("button",{className:"button",type:"button",onClick:function(){return s(!0)},children:"Create Lockup"}),Object(_.jsx)(H.a,{open:a,maxWidth:"xs",onClose:b,children:Object(_.jsxs)("form",{className:"form_offer",onSubmit:p,children:[Object(_.jsx)(V.a,{children:"Create Lockup"}),Object(_.jsxs)(Y.a,{children:[Object(_.jsx)(Z.a,{margin:"normal",id:"account",label:"Account Id",type:"text",sx:{width:"75%"},variant:"standard"}),Object(_.jsx)(Z.a,{margin:"normal",id:"amount",label:"Amount",type:"text",variant:"standard",sx:{width:"50%"}}),Object(_.jsx)("br",{}),Object(_.jsx)($.a,{dateAdapter:X.a,children:Object(_.jsx)(ee.a,{label:"Start date",value:j,onChange:function(e){h(e)},renderInput:function(e){return Object(_.jsx)(Z.a,Object(c.a)({margin:"normal",sx:{width:"50%"},variant:"standard"},e))}})})]}),Object(_.jsxs)(G.a,{children:[Object(_.jsx)(Q.a,{onClick:b,children:"Cancel"}),Object(_.jsx)(Q.a,{type:"submit",children:"Create"})]})]})})]})}function ce(e){var t=e.lockups,n=Array.from(new Set(t.map((function(e){return e.account_id}))));return console.log("unique users",n),Object(_.jsxs)("div",{className:"container",children:[Object(_.jsx)(C.a,{sx:{boxShadow:"unset"},component:N.a,children:Object(_.jsxs)(A.a,{className:"main-table","aria-label":"collapsible table",children:[Object(_.jsx)(I.a,{className:"table-head",children:Object(_.jsxs)(S.a,{children:[Object(_.jsx)(T.a,{}),Object(_.jsx)(T.a,{align:"left",children:"ID"}),Object(_.jsx)(T.a,{align:"left",children:"Account ID"}),Object(_.jsx)(T.a,{align:"right",children:"Start\xa0date"}),Object(_.jsx)(T.a,{align:"right",children:"End\xa0date"}),Object(_.jsx)(T.a,{align:"right",children:"Total\xa0amount"}),Object(_.jsx)(T.a,{align:"center",children:"Progress"})]})}),Object(_.jsx)(U.a,{children:t.map((function(e){return Object(_.jsx)(z,{row:e},e.id)}))})]})}),Object(_.jsx)(ae,{})]})}function re(e){var t=e.lockups,n=Object(d.g)().userId,a=t.filter((function(e){return e.account_id===n}));return console.log("user lockups",n,a),Object(_.jsx)("div",{className:"container",children:Object(_.jsx)(C.a,{sx:{boxShadow:"unset"},component:N.a,children:Object(_.jsxs)(A.a,{className:"main-table","aria-label":"collapsible table",children:[Object(_.jsx)(I.a,{className:"table-head",children:Object(_.jsxs)(S.a,{children:[Object(_.jsx)(T.a,{}),Object(_.jsx)(T.a,{align:"left",children:"ID"}),Object(_.jsx)(T.a,{align:"left",children:"Account ID"}),Object(_.jsx)(T.a,{align:"right",children:"Start\xa0date"}),Object(_.jsx)(T.a,{align:"right",children:"End\xa0date"}),Object(_.jsx)(T.a,{align:"right",children:"Total\xa0amount"}),Object(_.jsx)(T.a,{align:"center",children:"Progress"})]})}),Object(_.jsx)(U.a,{children:a.map((function(e){return Object(_.jsx)(z,{row:e},e.id)}))})]})})})}function oe(){return Object(_.jsx)("div",{className:"header",children:Object(_.jsx)("div",{className:"container",children:Object(_.jsxs)("div",{className:"nav",children:[Object(_.jsx)(u.b,{className:"nav-link",to:"/lockups",children:"Lockups"}),Object(_.jsx)(u.b,{className:"nav-link",to:"/about",children:"About"})]})})})}function se(){var e=Object(i.useContext)(k).near,t=Object(i.useState)({}),n=Object(o.a)(t,2),a=n[0],c=n[1],s=Object(i.useState)(null),j=Object(o.a)(s,2),h=j[0],b=j[1];if(Object(i.useEffect)((function(){var t=!0;if(e){var n=function(){var n=Object(r.a)(l.a.mark((function n(){var a;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.api.loadAllLockups();case 2:if(a=n.sent,t){n.next=5;break}return n.abrupt("return");case 5:c({lockups:a,name:"name"});case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();n()}return function(){t=!1}}),[e]),Object(i.useEffect)((function(){return e&&b(e.api.getTokenContract().contractId),function(){}}),[e]),0===Object.keys(a).length)return null;var p=a.lockups;return Object(_.jsxs)(u.a,{children:[Object(_.jsx)(oe,{}),Object(_.jsxs)(d.c,{children:[Object(_.jsx)(d.a,{path:"/about",element:Object(_.jsx)(y,{lockups:p,token_account_id:h})}),Object(_.jsx)(d.a,{path:"/lockups",element:Object(_.jsx)(ce,{lockups:p})}),Object(_.jsx)(d.a,{path:"/lockups/:userId",element:Object(_.jsx)(re,{lockups:p})})]})]})}n(257);function le(){var e=Object(i.useState)(null),t=Object(o.a)(e,2),n=t[0],a=t[1];Object(i.useEffect)((function(){function e(){return(e=Object(r.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w();case 2:t=e.sent,a(t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var s=Object(i.useMemo)((function(){return{near:n,signIn:function(){var e;null===n||void 0===n||null===(e=n.api)||void 0===e||e.signIn()},signOut:function(){n&&(n.api.signOut(),a(Object(c.a)(Object(c.a)({},n),{},{signedIn:!1,signedAccountId:null})))}}}),[n]);return Object(_.jsx)(i.StrictMode,{children:Object(_.jsx)(k.Provider,{value:s,children:Object(_.jsx)(se,{})})})}Object(a.render)(Object(_.jsx)(le,{}),document.getElementById("root"))}},[[258,1,2]]]);
//# sourceMappingURL=main.8232b8cb.chunk.js.map