(this["webpackJsonpft-lockup-contract-frontend"]=this["webpackJsonpft-lockup-contract-frontend"]||[]).push([[0],{207:function(e,t){},217:function(e,t){},270:function(e,t,n){},271:function(e,t,n){"use strict";n.r(t);var a=n(61),r=n(50),c=n(18),i=n(7),s=n(14),o=n.n(s),l=n(1),u=n(17),d=n(27),j=n(31),b=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_CONTRACT_NAME||"ft-lockup.demo002.ft-lockup.testnet";var h=function(){var e=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_ENVIRONMENT||"development";switch(e){case"production":case"mainnet":return{networkId:"mainnet",nodeUrl:"https://rpc.mainnet.near.org",contractName:b,walletUrl:"https://wallet.near.org",helperUrl:"https://helper.mainnet.near.org",explorerUrl:"https://explorer.mainnet.near.org"};case"development":case"testnet":return{networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",contractName:b,walletUrl:"https://wallet.testnet.near.org",helperUrl:"https://helper.testnet.near.org",explorerUrl:"https://explorer.testnet.near.org"};case"betanet":return{networkId:"betanet",nodeUrl:"https://rpc.betanet.near.org",contractName:b,walletUrl:"https://wallet.betanet.near.org",helperUrl:"https://helper.betanet.near.org",explorerUrl:"https://explorer.betanet.near.org"};case"local":return{explorerUrl:"",helperUrl:"",networkId:"local",nodeUrl:"http://localhost:3030",walletUrl:"http://localhost:4000/wallet",contractName:b};case"test":case"ci":return{explorerUrl:"",helperUrl:"",walletUrl:"",networkId:"shared-test",nodeUrl:"https://rpc.ci-testnet.near.org",contractName:b};case"ci-betanet":return{explorerUrl:"",helperUrl:"",walletUrl:"",networkId:"shared-test-staging",nodeUrl:"https://rpc.ci-betanet.near.org",contractName:b};default:throw Error("Unconfigured environment '".concat(e,"'. Can be configured in src/config.js."))}}(),p=n(52),f=n.n(p),m=3e14;f.a.DP=40;var x=function(e){return new Date(1e3*e).toLocaleDateString("en-US")},O=function(e,t){return f()(e||"0").div(Math.pow(10,t)).toFixed(2)},g=function(e,t){return new Date(null===e||void 0===e?void 0:e.setFullYear(((null===e||void 0===e?void 0:e.getFullYear())||0)+t)).getTime()/1e3},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"dump",t=Object.keys(localStorage).map((function(e){return[e,localStorage.getItem(e)]}));localStorage.setItem(e,JSON.stringify(t))},k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"dump",t=localStorage.getItem(e);if(t){var n=JSON.parse(t);localStorage.clear(),n.forEach((function(e){return localStorage.setItem(e[0],e[1])}))}},_=n(47),w=n(48),y=["get_draft_group","get_draft_groups_paged","get_drafts","get_lockups_paged","get_token_account_id","get_deposit_whitelist"],C=["create_draft","create_drafts","create_draft_group","terminate"],N=function(){function e(t){Object(_.a)(this,e),this.near=void 0,this.contract=void 0,this.walletConnection=void 0,this.near=t,this.walletConnection=new j.WalletConnection(t,t.config.contractName),this.contract=new j.Contract(this.walletConnection.account(),this.near.config.contractName,{viewMethods:y,changeMethods:C})}return Object(w.a)(e,[{key:"getDraftGroupsAll",value:function(){var e=Object(c.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.get_draft_groups_paged();case 2:return t=e.sent,e.abrupt("return",t.map((function(e){var t=Object(i.a)(e,2),n=t[0],a=t[1];return Object.assign(a,{id:n})})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDraftGroup",value:function(){var e=Object(c.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.get_draft_group({index:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDrafts",value:function(){var e=Object(c.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.get_drafts({indices:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createDraftGroup",value:function(){var e=Object(c.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.create_draft_group();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createDraft",value:function(){var e=Object(c.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.create_draft({draft:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createDrafts",value:function(){var e=Object(c.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.create_drafts({drafts:t},"200000000000000");case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"terminate",value:function(){var e=Object(c.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.contract.terminate({lockup_index:t},m);case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),Error("Cannot terminate lockup more than once");case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getNear",value:function(){return this.near}},{key:"getContract",value:function(){return this.contract}},{key:"getTokenAccountId",value:function(){return this.contract.get_token_account_id()}},{key:"getDepositWhitelist",value:function(){return this.contract.get_deposit_whitelist()}},{key:"loadAllLockups",value:function(){return this.contract.get_lockups_paged().then((function(e){return e.map((function(e){var t=Object(i.a)(e,2),n=t[0],a=t[1];return Object.assign(a,{id:n})}))}))}},{key:"signIn",value:function(){var e="".concat(window.location.href);this.walletConnection.requestSignIn(this.near.config.contractName,void 0,e)}},{key:"signOut",value:function(){this.walletConnection.signOut(),this.near.config.keyStore.clear()}},{key:"get_account_id",value:function(){return this.walletConnection.getAccountId()}},{key:"account",value:function(){var e=Object(c.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.near.account(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get_balance",value:function(){var e=Object(c.a)(o.a.mark((function e(t){var n,a,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.account(t);case 2:return n=e.sent,a=null,e.prev=4,e.next=7,n.getAccountBalance();case 7:r=e.sent,c=r.total,a=parseFloat(j.utils.format.formatNearAmount(c||"0")),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),console.error("Account not exist");case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}var c}),e,this,[[4,11]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),S=N,I=function(){var e=Object(c.a)(o.a.mark((function e(t,n){var a,r,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.query({request_type:"view_access_key_list",account_id:n,finality:"optimistic"});case 2:if(r=e.sent,null!==(a=r.keys)&&void 0!==a&&a.length){e.next=5;break}throw Error("None of access keys was founded");case 5:if(null!==(c=r.keys.filter((function(e){var t,n;return"string"===typeof(null===e||void 0===e||null===(t=e.access_key)||void 0===t?void 0:t.permission)&&"FullAccess"===(null===e||void 0===e||null===(n=e.access_key)||void 0===n?void 0:n.permission)})))&&void 0!==c&&c.length){e.next=8;break}throw Error("None of full access keys was founded");case 8:return e.abrupt("return",c[0]);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),E=I,A=[""],T=["claim"],D=function(){function e(t){Object(_.a)(this,e),this.near=void 0,this.near=t}return Object(w.a)(e,[{key:"claim",value:function(){var e=Object(c.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v(),e.next=3,this.setWalletAndContractWithAuth(t);case 3:return e.next=5,this.buildContract().claim({},m);case 5:this.near.config.keyStore.clean();case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setWalletAndContractWithAuth",value:function(){var e=Object(c.a)(o.a.mark((function e(t){var n,a,r=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:this.near.config.contractName,e.next=3,E(this.near.connection.provider,t);case 3:a=e.sent,localStorage.setItem("".concat(n,"_wallet_auth_key"),JSON.stringify({accountId:t,allKeys:[a.public_key]}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"buildContract",value:function(){return new j.Contract(new j.WalletConnection(this.near,this.near.config.contractName).account(),this.near.config.contractName,{viewMethods:A,changeMethods:T})}}]),e}(),U=D,F=n(165),M=["msg"],W=3e14,P=["ft_metadata"],L=["ft_transfer_call"],R=function(){function e(t,n){Object(_.a)(this,e),this.contract=void 0,this.contract=new j.Contract(t.account(),n,{viewMethods:P,changeMethods:L})}return Object(w.a)(e,[{key:"getContract",value:function(){return this.contract}},{key:"ftTransferCall",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=e.msg,c=Object(F.a)(e,M);this.contract.ft_transfer_call(Object(r.a)({msg:JSON.stringify(a)},c),t,n)}},{key:"ftMetadata",value:function(){return this.contract.ft_metadata({})}}]),e}(),G=R,K=Object(l.createContext)(null),H=function(){var e=Object(c.a)(o.a.mark((function e(){var t,n,a,c,i,s,l,u,d,b,p,f;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.getItem("dump")&&k(),t=new j.keyStores.BrowserLocalStorageKeyStore,e.next=4,j.connect(Object(r.a)({headers:{},keyStore:t},h));case 4:return n=e.sent,a=new S(n),c=new j.keyStores.InMemoryKeyStore,e.next=9,j.connect(Object(r.a)({headers:{},keyStore:c},h));case 9:return i=e.sent,s=new U(i),l=new j.WalletConnection(n,h.contractName),u=l.getAccountId(),e.next=15,a.getTokenAccountId();case 15:return d=e.sent,e.next=18,a.getDepositWhitelist();case 18:return b=e.sent,p=b.includes(u),f=new G(l,d),e.abrupt("return",{config:h,api:a,noLoginApi:s,signedIn:!!u,isAdmin:p,signedAccountId:u,tokenApi:f});case 22:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=n(0);function J(e){var t=e.lockups,n=e.token_account_id;return Object(B.jsxs)("div",{className:"container",children:[Object(B.jsx)("h1",{children:"About Page"}),Object(B.jsx)("pre",{children:"\n          This page should render all useful info about contract,\n          at least ft-lockup name, token name, contract ft balance,\n\n          ft-lockup account id: ".concat(h.contractName,"\n          token account id: ").concat(n,"\n\n          Total number of lockups: ").concat(t.length,"\n        ")})]})}var Y=n(320),z=n(341),q=n(342),V=n(337),$=n(338),Z=n(343),Q=n(339),X=n(340),ee=n(110),te=n.n(ee),ne=n(111),ae=n.n(ne);function re(e){var t=Object(l.useState)(!1),n=Object(i.a)(t,2),a=n[0],r=n[1],c=e.row,s=e.token,o=Object(l.useContext)(K).near;if(!o)return null;var u=o.signedIn;return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsxs)(V.a,{className:a?"expanded exp-row":"exp-row",sx:{"& > *":{borderBottom:"unset"}},children:[Object(B.jsx)($.a,{children:Object(B.jsx)(Q.a,{"aria-label":"expand row",size:"small",onClick:function(){return r(!a)},children:a?Object(B.jsx)(te.a,{}):Object(B.jsx)(ae.a,{})})}),Object(B.jsx)($.a,{align:"left",children:c.id}),Object(B.jsx)($.a,{align:"left",children:Object(B.jsx)(d.b,{to:u?"/admin/lockups/".concat(c.account_id):"/lockups/".concat(c.account_id),children:c.account_id})}),Object(B.jsx)($.a,{align:"right",children:x(c.schedule[0].timestamp)}),Object(B.jsx)($.a,{align:"right",children:x(c.schedule[c.schedule.length-1].timestamp)}),Object(B.jsxs)($.a,{align:"right",children:[O(c.total_balance,s.decimals),"\xa0",s.symbol]}),Object(B.jsx)($.a,{align:"center",children:Object(B.jsxs)("div",{className:"progress-bar",children:[Object(B.jsx)("div",{style:{width:"".concat(c.claimed_balance/c.total_balance*100,"%")},className:"claimed",children:Object(B.jsx)("span",{children:O(c.claimed_balance,s.decimals)})}),Object(B.jsx)("div",{style:{width:"".concat(c.unclaimed_balance/c.total_balance*100,"%")},className:"available",children:Object(B.jsx)("span",{children:O(c.unclaimed_balance,s.decimals)})}),Object(B.jsx)("div",{style:{width:"".concat((c.total_balance-c.claimed_balance-c.unclaimed_balance)/c.total_balance*100,"%")},className:"vested",children:Object(B.jsx)("span",{children:(c.total_balance-c.claimed_balance-c.unclaimed_balance)/c.total_balance>.2&&O(c.total_balance-c.claimed_balance-c.unclaimed_balance,s.decimals)})}),Object(B.jsx)("div",{style:{width:"".concat(100*(c.total_balance-c.total_balance),"%")},className:"unvested",children:"\xa0"})]})})]}),Object(B.jsx)(V.a,{sx:{background:"#F4FAFF"},children:Object(B.jsx)($.a,{style:{padding:0},colSpan:7,children:Object(B.jsx)(X.a,{in:a,timeout:"auto",unmountOnExit:!0,children:Object(B.jsx)("div",{className:"lockup-row",children:Object(B.jsxs)("div",{className:"inner-table_wrapper",children:[Object(B.jsx)("h5",{children:"Lockup schedule"}),Object(B.jsxs)(z.a,{className:"inner-table",size:"small","aria-label":"purchases",children:[Object(B.jsx)(q.a,{children:Object(B.jsxs)(V.a,{children:[Object(B.jsx)($.a,{children:"DATE"}),Object(B.jsx)($.a,{children:"AMOUNT"})]})}),Object(B.jsx)(Z.a,{children:c.schedule.map((function(e){return Object(B.jsxs)(V.a,{children:[Object(B.jsx)($.a,{component:"th",scope:"row",children:x(e.timestamp)}),Object(B.jsxs)($.a,{children:[O(e.balance,s.decimals),"\xa0",s.symbol]})]},e.timestamp)}))})]})]})})})})})]})}function ce(e){var t=e.lockups,n=e.token;return Object(B.jsxs)(z.a,{className:"main-table","aria-label":"collapsible table",children:[Object(B.jsx)(q.a,{className:"table-head",children:Object(B.jsxs)(V.a,{children:[Object(B.jsx)($.a,{}),Object(B.jsx)($.a,{align:"left",children:"ID"}),Object(B.jsx)($.a,{align:"left",children:"Account ID"}),Object(B.jsx)($.a,{align:"right",children:"Start\xa0date"}),Object(B.jsx)($.a,{align:"right",children:"End\xa0date"}),Object(B.jsx)($.a,{align:"right",children:"Total\xa0amount"}),Object(B.jsx)($.a,{align:"center",children:"Progress"})]})}),Object(B.jsx)(Z.a,{children:t.map((function(e){return Object(B.jsx)(re,{row:e,token:n},e.id)}))})]})}var ie=n(168),se=n(169),oe=n(28),le=n.n(oe);le.a.prototype.toJSON=function(){return this.toString()};var ue=function(e){var t=e.trim().split("\n");if(t.length<=1)return[];var n=t.map((function(e){return e.split("\t").map((function(e){return e.trim()}))})),a=Object(se.a)(n),r=a[0];return a.slice(1).map((function(e){return Object.fromEntries(r.map((function(t,n){return[t,e[n]||""]})))}))},de=function(e){var t=Object(ie.a)(/^P(((((\d+)Y)?((\d+)M)?((\d+)D)?)(T((\d+)H)?((\d+)M)?((\d+)S)?)?)|((\d+)W)?)$/,{year:5,month:7,day:9,hour:12,minute:14,second:16,week:18}),n=e.match(t);if(!n)throw new Error("invalid duration");var a=n&&n.groups||{};return{year:parseInt(a.year,10)||0,month:parseInt(a.month,10)||0,week:parseInt(a.week,10)||0,day:parseInt(a.day,10)||0,hour:parseInt(a.hour,10)||0,minute:parseInt(a.minute,10)||0,second:parseInt(a.second,10)||0}},je=function(e){var t=e.split("|");if(4!==t.length)throw new Error("invalid human friendly schedule, expected 4 parts");var n=Object(i.a)(t,4),a=n[0],r=n[1],c=n[2],s=n[3],o=function(e){if(!e.match(/\d\d\d\d-\d\d-\d\dT\d\d:\d\d:\d\dZ/))throw new Error("invalid timestamp");var t=new Date(e);if(Number.isNaN(t.getTime()))throw new Error("invalid timestamp");return t}(a),l=de(r),u=function(e){var t=e.split(":");if(2!==t.length)throw new Error("expected 2 parts");var n=Object(i.a)(t,2),a=n[0],r=n[1],c=de(a),s=parseInt(r,10);if(s<0||s>100)throw new Error("invalid cliff percentage");return{duration:c,percentage:s}}(c),d=de(s);return{timestampStart:o,durationTotal:l,durationCliff:u.duration,percentageCliff:u.percentage,releaseEvery:d}},be=function(e){var t=function(e){var t=!0;if(e.length<2&&(t=!1),e.length>64&&(t=!1),e.match(/^[a-z0-9._-]+$/)||(t=!1),t)return e;throw new Error("invalid near account id")}(e.account_id),n=function(e){if(e.match(/^[0-9]+$/))return e;throw new Error("invalid token amount")}(e.amount),a=je(e.lockup_schedule),r=""===e.vesting_schedule?null:je(e.vesting_schedule),c=null;if(null===r){if(""!==e.terminator_id)throw new Error("expected empty terminator_id for empty vesting_schedule");c=null}else{if(""===e.terminator_id)throw new Error("expected present terminator_id for present vesting_schedule");c=e.terminator_id}return{account_id:t,amount:n,lockup_schedule:a,vesting_schedule:r,terminator_id:c}},he=function(e,t,n){var a=Math.floor(n);return new Date(Date.UTC(e.getUTCFullYear()+t.year*a,e.getUTCMonth()+t.month*a,e.getUTCDate()+(7*t.week+t.day)*a,e.getUTCHours()+t.hour*a,e.getUTCMinutes()+t.minute*a,e.getUTCSeconds()+t.second*a))},pe=function(e){return Math.floor(new Date(e).getTime()/1e3)},fe=function(e,t,n){if(!(n>=0&&n===Math.floor(n)))throw new Error("invalid token decimals");var a=new le.a(10).pow(new le.a(n)),r=e.timestampStart,c=he(r,e.durationCliff,1),i=he(c,de("PT1S"),-1),s=he(r,e.durationTotal,1),o=new le.a(t).mul(a).clone(),l=new le.a(o).muln(e.percentageCliff).divn(100).clone();if(l.gt(o))throw new Error("error: cliffAmount > totalAmount");if(c>s)throw new Error("error: timestampCliff > timestampFinish");if(c<r)throw new Error("error: timestampPreCliff < timestampStart");var u={timestamp:pe(r),balance:new le.a("0")},d={timestamp:pe(i),balance:new le.a("0")},j={timestamp:pe(c),balance:l},b={timestamp:pe(s),balance:o},h=[];return h.unshift(b),j.timestamp<b.timestamp&&h.unshift(j),h.unshift(d),u.timestamp<d.timestamp&&h.unshift(u),h},me=function(e,t){return ue(e).map((function(e){return function(e,t){var n,a,r=be(e);return r.vesting_schedule&&r.terminator_id?(a=fe(r.vesting_schedule,r.amount,t),n={terminator_id:r.terminator_id,vesting_schedule:{Schedule:a}}):n=null,{account_id:r.account_id,schedule:fe(r.lockup_schedule,r.amount,t),claimed_balance:new le.a(0),termination_config:n}}(e,t)}))};var xe=function(e){var t=e.token,n=Object(l.useContext)(K).near,a=Object(l.useState)([]),r=Object(i.a)(a,2),s=r[0],d=r[1],j=Object(l.useState)([]),b=Object(i.a)(j,2),h=b[0],p=b[1],f=function(e){console.log(e),p((function(t){return t.concat([e])}))};console.log(d);var m=Object(u.g)(),x=function(){var e=Object(c.a)(o.a.mark((function e(){var t,a,r,c,i,l,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw new Error("near is null");case 2:return p([]),f("import started"),e.next=6,n.api.createDraftGroup();case 6:t=e.sent,a="created draft group id: ".concat(t),f(a),r=100,c=0;case 11:if(!(c<s.length)){e.next=29;break}return i=s.slice(c,c+r),f("adding drafts from (".concat(c,", ").concat(c+i.length,")")),l=i.map((function(e){return{draft_group_id:t,lockup:e}})),e.prev=15,e.next=18,n.api.createDrafts(l);case 18:u=e.sent,f("created drafts for from (".concat(c,", ").concat(c+i.length,"): ").concat(u)),e.next=26;break;case 22:throw e.prev=22,e.t0=e.catch(15),f("ERROR: ".concat(e.t0)),e.t0;case 26:c+=r,e.next=11;break;case 29:f("import finished"),m("/admin/draft_groups/".concat(t));case 31:case"end":return e.stop()}}),e,null,[[15,22]])})));return function(){return e.apply(this,arguments)}}();return Object(B.jsxs)("div",{className:"container",children:[Object(B.jsx)("h3",{children:"Import Draft Group"}),Object(B.jsx)("div",{children:Object(B.jsx)(Y.a,{style:{width:"100%"},id:"spreadsheet-input",placeholder:"Excel input",maxRows:5,onChange:function(e){try{console.log(t);var n=e.target.value,a=me(n,t.decimals);d(a)}catch(r){r instanceof Error&&console.log(r)}}})}),Object(B.jsx)(ce,{lockups:s,token:t}),Object(B.jsx)("br",{}),Object(B.jsx)("div",{children:Object(B.jsx)("button",{className:"button fullWidth noMargin",onClick:x,type:"button",children:"Import"})}),Object(B.jsx)("br",{}),Object(B.jsx)("pre",{id:"import-log",children:h.join("\n")})]})};function Oe(e){var t=e.token,n=parseInt(Object(u.h)().draftGroupId||"",10),a=Object(l.useContext)(K).near,r=Object(l.useState)(null),s=Object(i.a)(r,2),d=s[0],j=s[1],b=Object(l.useState)([]),h=Object(i.a)(b,2),p=h[0],f=h[1];return console.log(t),console.log(d),console.log(j),Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(j(null),console.log("fetchDraftGroup called"),a){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,a.api.getDraftGroup(n);case 6:t=e.sent,console.log(t),j(t);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[a,n]),Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f([]),console.log("fetchDrafts called"),a){e.next=4;break}return e.abrupt("return");case 4:if(d){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,a.api.getDrafts(d.draft_indices);case 8:t=e.sent,console.log(t),f(t.map((function(e){return Object.assign(e[1].lockup,{id:e[0]})})));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[a,d]),d?Object(B.jsxs)("div",{className:"container",children:[Object(B.jsxs)("h1",{children:["Draft group"," ",n]}),Object(B.jsxs)("div",{children:["Total amount:",O(d.total_amount,t.decimals)]}),Object(B.jsxs)("div",{children:["Funded:",d.funded?"YES":"NO"]}),Object(B.jsx)("h3",{children:"Drafts"}),Object(B.jsx)(ce,{lockups:p,token:t})]}):null}function ge(e){var t=e.token,n=Object(l.useContext)(K).near,a=Object(l.useState)([]),r=Object(i.a)(a,2),s=r[0],u=r[1];return Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u([]),console.log("fetchDraftGroup called"),n){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,n.api.getDraftGroupsAll();case 6:t=e.sent,console.log(t),u(t);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[n]),Object(B.jsxs)("div",{className:"container",children:[Object(B.jsx)("h1",{children:"All draft groups"}),Object(B.jsxs)("div",{children:["Total count:",s.length]}),Object(B.jsxs)(z.a,{className:"main-table","aria-label":"collapsible table",children:[Object(B.jsx)(q.a,{className:"table-head",children:Object(B.jsxs)(V.a,{children:[Object(B.jsx)($.a,{align:"left",children:"ID"}),Object(B.jsx)($.a,{align:"center",children:"Funded"}),Object(B.jsx)($.a,{align:"right",children:"Number\xa0of\xa0lockups"}),Object(B.jsx)($.a,{align:"right",children:"Total\xa0amount"})]})}),Object(B.jsx)(Z.a,{children:s.map((function(e){return Object(B.jsxs)(V.a,{children:[Object(B.jsx)($.a,{align:"left",children:Object(B.jsx)(d.b,{to:"/admin/draft_groups/".concat(e.id),children:e.id})}),Object(B.jsx)($.a,{align:"center",children:e.funded?"Yes":"No"}),Object(B.jsx)($.a,{align:"right",children:e.draft_indices.length}),Object(B.jsx)($.a,{align:"right",children:O(e.total_amount,t.decimals)})]})}))})]}),Object(B.jsx)("br",{}),Object(B.jsx)(d.b,{to:"/admin/import_draft_group",children:Object(B.jsx)("button",{className:"button",type:"button",children:"ImportDraftGroup"})})]})}var ve=n(350),ke=n(179),_e=n(321),we=n(325),ye=n(344),Ce=n(332),Ne=n(348),Se=n(347),Ie=n(331),Ee=n(335),Ae=n(349),Te=n(171),De=n.n(Te),Ue=n(330),Fe=n(172),Me=n(329);function We(e){var t=e.token,n=Object(l.useContext)(K).near,a=Object(l.useState)(!1),s=Object(i.a)(a,2),u=s[0],d=s[1],j=Object(l.useState)(null),b=Object(i.a)(j,2),h=b[0],p=b[1],f=Object(l.useState)("4_year"),m=Object(i.a)(f,2),x=m[0],O=m[1],v=function(){return d(!1)},k=function(){var e=Object(c.a)(o.a.mark((function e(a){var r,c,i,s,l,u,d,j;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw Error("Cannot access token api");case 2:a.preventDefault(),r=a.target.elements,c=r.account,i=r.amount,console.log(c.value,i.value),s=(null===n||void 0===n?void 0:n.api.getContract().contractId)||"","0",l=c.value,u=i.value*Math.pow(10,t.decimals),d=((null===h||void 0===h?void 0:h.getTime())||0)/1e3,j=function(e,t,n,a){return{"4_year":[{timestamp:e,balance:"0"},{timestamp:g(t,1)-1,balance:"0"},{timestamp:g(t,1),balance:(n/4).toString()},{timestamp:g(t,4),balance:n.toString()}],"4_year_vested":[{timestamp:e,balance:"0"},{timestamp:g(t,1)-1,balance:"0"},{timestamp:g(t,1),balance:(n/4).toString()},{timestamp:g(t,4),balance:n.toString()}]}[a]},n.tokenApi.ftTransferCall({receiver_id:s,amount:u.toString(),msg:{account_id:l,schedule:j(d,h,u,x),vesting_schedule:"4_year_vested"===x?j(d,h,u,x):null,claimed_balance:"0"}});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(B.jsxs)("div",{children:[Object(B.jsx)("button",{className:"button",type:"button",onClick:function(){return d(!0)},children:"Create Lockup"}),Object(B.jsx)(_e.a,{open:u,sx:{padding:2},maxWidth:"xs",onClose:v,children:Object(B.jsxs)("form",{className:"form-submit",onSubmit:k,children:[Object(B.jsxs)(we.a,{children:["Create Lockup",Object(B.jsx)(Q.a,{"aria-label":"close",onClick:v,sx:{position:"absolute",right:8,top:8},children:Object(B.jsx)(De.a,{})})]}),Object(B.jsxs)(ye.a,{sx:{maxWidth:"320px"},children:[Object(B.jsx)(Ce.a,{margin:"normal",id:"account",label:"Account Id",type:"text",fullWidth:!0,variant:"standard"}),Object(B.jsx)(Ce.a,{margin:"normal",id:"amount",label:"Amount",type:"number",variant:"standard",InputProps:{endAdornment:Object(B.jsx)(Ne.a,{position:"end",children:t.symbol})},fullWidth:!0}),Object(B.jsx)("br",{}),Object(B.jsx)(Se.a,{fullWidth:!0,sx:{marginTop:"20px"},children:Object(B.jsxs)(Ie.a,{id:"schedule-select",value:x,label:"Schedule",onChange:function(e){O(e.target.value)},variant:"standard",fullWidth:!0,children:[Object(B.jsx)(Ee.a,{value:"4_year",children:"4 year lockup with 25% cliff in 1 year"}),Object(B.jsx)(Ee.a,{value:"4_year_vested",children:"4 year lockup with 25% cliff in 1 year (VESTED)"})]})}),Object(B.jsx)(Fe.a,{dateAdapter:Ue.a,children:Object(B.jsx)(Me.a,{label:"Start date",value:h,onChange:function(e){p(e)},renderInput:function(e){return Object(B.jsx)(Ce.a,Object(r.a)({margin:"normal",fullWidth:!0,variant:"standard"},e))}})})]}),Object(B.jsx)(Ae.a,{sx:{padding:"14px 24px 24px"},children:Object(B.jsx)("button",{className:"button fullWidth noMargin",type:"submit",children:"Create"})})]})})]})}var Pe=function(e){var t=Object(l.useContext)(K).near,n=e.lockupIndex,a=e.config;if(!t)throw Error("Cannot access lockup api");var r=t.signedAccountId;if(void 0===n)throw Error("Cannot terminate lockup without lockupIndex");return console.log(a),Object(B.jsx)("button",{className:"button red fullWidth",disabled:!a||a.terminator_id!==r,type:"button",onClick:function(){t.api.terminate(n)},children:"Terminate"})};function Le(e){var t=Object(l.useState)(!1),n=Object(i.a)(t,2),a=n[0],r=n[1],c=e.row,s=e.token,o=e.adminControls,u=Object(l.useContext)(K).near;if(!u)return null;var j=u.signedIn,b=u.isAdmin;return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsxs)(V.a,{className:a?"expanded exp-row":"exp-row",sx:{"& > *":{borderBottom:"unset"}},children:[Object(B.jsx)($.a,{children:Object(B.jsx)(Q.a,{"aria-label":"expand row",size:"small",onClick:function(){return r(!a)},children:a?Object(B.jsx)(te.a,{}):Object(B.jsx)(ae.a,{})})}),Object(B.jsx)($.a,{align:"left",children:c.id}),Object(B.jsx)($.a,{align:"left",children:Object(B.jsx)(d.b,{to:"".concat(c.account_id),children:c.account_id})}),Object(B.jsx)($.a,{align:"right",children:x(c.schedule[0].timestamp)}),Object(B.jsx)($.a,{align:"right",children:x(c.schedule[c.schedule.length-1].timestamp)}),Object(B.jsxs)($.a,{align:"right",children:[O(c.total_balance,s.decimals),"\xa0",s.symbol]}),Object(B.jsx)($.a,{align:"center",children:Object(B.jsxs)("div",{className:"progress-bar",children:[Object(B.jsx)("div",{style:{width:"".concat(c.claimed_balance/c.total_balance*100,"%")},className:"claimed",children:Object(B.jsx)("span",{children:O(c.claimed_balance,s.decimals)})}),Object(B.jsx)("div",{style:{width:"".concat(c.unclaimed_balance/c.total_balance*100,"%")},className:"available",children:Object(B.jsx)("span",{children:O(c.unclaimed_balance,s.decimals)})}),Object(B.jsx)("div",{style:{width:"".concat((c.total_balance-c.claimed_balance-c.unclaimed_balance)/c.total_balance*100,"%")},className:"vested",children:Object(B.jsx)("span",{children:(c.total_balance-c.claimed_balance-c.unclaimed_balance)/c.total_balance>.2&&O(c.total_balance-c.claimed_balance-c.unclaimed_balance,s.decimals)})}),Object(B.jsx)("div",{style:{width:"".concat(100*(c.total_balance-c.total_balance),"%")},className:"unvested",children:"\xa0"})]})})]}),Object(B.jsx)(V.a,{sx:{background:"#F4FAFF"},children:Object(B.jsx)($.a,{style:{padding:0},colSpan:7,children:Object(B.jsx)(X.a,{in:a,timeout:"auto",unmountOnExit:!0,children:Object(B.jsxs)("div",{className:"lockup-row",children:[Object(B.jsxs)("div",{className:"inner-table_wrapper",children:[Object(B.jsx)("h5",{children:"Lockup schedule"}),Object(B.jsxs)(z.a,{className:"inner-table",size:"small","aria-label":"purchases",children:[Object(B.jsx)(q.a,{children:Object(B.jsxs)(V.a,{children:[Object(B.jsx)($.a,{children:"DATE"}),Object(B.jsx)($.a,{children:"AMOUNT"})]})}),Object(B.jsx)(Z.a,{children:c.schedule.map((function(e){return Object(B.jsxs)(V.a,{children:[Object(B.jsx)($.a,{component:"th",scope:"row",children:x(e.timestamp)}),Object(B.jsxs)($.a,{children:[O(e.balance,s.decimals),"\xa0",s.symbol]})]},e.timestamp)}))})]})]}),j&&b&&o&&Object(B.jsx)("div",{className:"terminate",children:Object(B.jsx)(Pe,{lockupIndex:c.id,config:c.termination_config})})]})})})})]})}function Re(e){var t=e.lockups,n=e.token,a=e.adminControls;return Object(B.jsxs)(z.a,{className:"main-table","aria-label":"collapsible table",children:[Object(B.jsx)(q.a,{className:"table-head",children:Object(B.jsxs)(V.a,{children:[Object(B.jsx)($.a,{}),Object(B.jsx)($.a,{align:"left",children:"ID"}),Object(B.jsx)($.a,{align:"left",children:"Account ID"}),Object(B.jsx)($.a,{align:"right",children:"Start\xa0date"}),Object(B.jsx)($.a,{align:"right",children:"End\xa0date"}),Object(B.jsx)($.a,{align:"right",children:"Total\xa0amount"}),Object(B.jsx)($.a,{align:"center",children:"Progress"})]})}),Object(B.jsx)(Z.a,{children:t.map((function(e){return Object(B.jsx)(Le,{row:e,token:n,adminControls:a},e.id)}))})]})}function Ge(e){var t=e.lockups,n=e.token,a=e.adminControls,r=Array.from(new Set(t.map((function(e){return e.account_id}))));console.log("unique users",r);var c=Object(l.useContext)(K).near;if(!c)return null;var i=c.signedIn,s=c.isAdmin;return Object(B.jsxs)("div",{className:"container",children:[Object(B.jsx)(ve.a,{sx:{boxShadow:"unset",margin:"0 0 20px"},component:ke.a,children:Object(B.jsx)(Re,{lockups:t,token:n,adminControls:a})}),i&&a&&s&&Object(B.jsx)(We,{token:n})]})}var Ke=function(e){var t=Object(l.useContext)(K).near,n=e.accountId,a=e.token,r=e.total;if(!t)throw Error("Cannot access lockup api");if(!n)throw Error("Undefined account cannot claim");return Object(B.jsxs)("div",{className:"claim-wrapper",children:[Object(B.jsx)("h5",{children:"Total available"}),Object(B.jsxs)("div",{className:"claim-amount",children:[r,Object(B.jsx)("span",{children:a.symbol})]}),Object(B.jsx)("button",{className:"button",type:"button",onClick:function(){t.noLoginApi.claim(n)},children:"Claim All"})]})};function He(e){var t=e.lockups,n=e.token,a=e.adminControls,r=Object(u.h)().userId,c=t.filter((function(e){return e.account_id===r})),i=c.reduce((function(e,t){return e+parseFloat(t.unclaimed_balance)}),0);return console.log("user lockups",r,c),Object(B.jsxs)("div",{className:"container",children:[!a&&Object(B.jsx)(Ke,{accountId:r,token:n,total:O(i,n.decimals)}),Object(B.jsx)(ve.a,{sx:{boxShadow:"unset"},component:ke.a,children:Object(B.jsxs)(z.a,{className:"main-table","aria-label":"collapsible table",children:[Object(B.jsx)(q.a,{className:"table-head",children:Object(B.jsxs)(V.a,{children:[Object(B.jsx)($.a,{}),Object(B.jsx)($.a,{align:"left",children:"ID"}),Object(B.jsx)($.a,{align:"left",children:"Account ID"}),Object(B.jsx)($.a,{align:"right",children:"Start\xa0date"}),Object(B.jsx)($.a,{align:"right",children:"End\xa0date"}),Object(B.jsx)($.a,{align:"right",children:"Total\xa0amount"}),Object(B.jsx)($.a,{align:"center",children:"Progress"})]})}),Object(B.jsx)(Z.a,{children:c.map((function(e){return Object(B.jsx)(Le,{row:e,token:n,adminControls:a},e.id)}))})]})})]})}var Be=n(351);function Je(e){var t=e.adminControls,n=Object(l.useContext)(K),a=n.near,r=n.signOut;if(!a)return null;var c=a.signedIn,i=a.signedAccountId,s=a.isAdmin;return Object(B.jsx)("div",{className:"header",children:Object(B.jsx)("div",{className:"container",children:Object(B.jsxs)(Be.a,{sx:{display:"flex"},children:[Object(B.jsxs)("div",{className:"nav",children:[Object(B.jsx)(d.b,{className:"nav-link",to:t&&s?"/admin/lockups":"/lockups",children:"Lockups"}),Object(B.jsx)(d.b,{className:"nav-link",to:"/about",children:"About"}),t&&Object(B.jsx)(d.b,{className:"nav-link",to:"/admin/draft_groups",children:"Draft Groups"})]}),t&&c&&Object(B.jsxs)(Be.a,{sx:{marginTop:"23px"},children:[Object(B.jsxs)("span",{children:[i," "]}),Object(B.jsx)("button",{className:"button",type:"button",onClick:r,children:"Log out"})]})]})})})}var Ye=n(333);function ze(e){var t=e.children;return Object(B.jsx)("div",{className:"container login",children:t})}var qe=function(){var e=Object(l.useContext)(K),t=e.near,n=e.signIn;if(!t)return null;var a=t.signedIn,r=t.isAdmin;return Object(B.jsxs)(ze,{children:[a&&!r&&Object(B.jsx)(Ye.a,{sx:{margin:2,width:"500px"},severity:"error",children:"You are not admin"}),!a&&Object(B.jsx)("button",{className:"button",type:"button",onClick:n,children:"Sign In"}),a&&r&&Object(B.jsx)(u.a,{to:"lockups",replace:!0})]})};function Ve(e){var t=e.children,n=Object(u.f)(),a=Object(l.useContext)(K).near;if(!a)return null;var r=a.signedIn,c=a.isAdmin;return r&&c?t:Object(B.jsx)(u.a,{to:"/admin",state:{from:n},replace:!0})}function $e(e){var t=e.lockups,n=e.token,a=e.contractId;return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(Je,{adminControls:!1}),Object(B.jsxs)(u.d,{children:[Object(B.jsx)(u.b,{path:"/",element:Object(B.jsx)(u.a,{replace:!0,to:"/lockups"})}),Object(B.jsx)(u.b,{path:"/about",element:Object(B.jsx)(J,{lockups:t,token_account_id:a})}),Object(B.jsx)(u.b,{path:"/lockups",element:Object(B.jsx)(Ge,{lockups:t,token:n,adminControls:!1})}),Object(B.jsx)(u.b,{path:"/lockups/:userId",element:Object(B.jsx)(He,{lockups:t,token:n,adminControls:!1})})]})]})}function Ze(e){var t=e.lockups,n=e.token;return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(Je,{adminControls:!0}),Object(B.jsxs)(u.d,{children:[Object(B.jsx)(u.b,{path:"/",element:Object(B.jsx)(qe,{})}),Object(B.jsx)(u.b,{path:"/lockups",element:Object(B.jsx)(Ve,{children:Object(B.jsx)(Ge,{lockups:t,token:n,adminControls:!0})})}),Object(B.jsx)(u.b,{path:"/lockups/:userId",element:Object(B.jsx)(Ve,{children:Object(B.jsx)(He,{lockups:t,token:n,adminControls:!0})})}),Object(B.jsx)(u.b,{path:"/draft_groups",element:Object(B.jsx)(Ve,{children:Object(B.jsx)(ge,{token:n})})}),Object(B.jsx)(u.b,{path:"/draft_groups/:draftGroupId",element:Object(B.jsx)(Ve,{children:Object(B.jsx)(Oe,{token:n})})}),Object(B.jsx)(u.b,{path:"/import_draft_group",element:Object(B.jsx)(Ve,{children:Object(B.jsx)(xe,{token:n})})})]})]})}function Qe(){var e=Object(l.useContext)(K).near,t=Object(l.useState)({}),n=Object(i.a)(t,2),a=n[0],r=n[1],s=Object(l.useState)(null),j=Object(i.a)(s,2),b=j[0],h=j[1],p=Object(l.useState)({decimals:0,icon:null,name:"",reference:null,reference_hash:null,spec:"",symbol:""}),f=Object(i.a)(p,2),m=f[0],x=f[1];if(Object(l.useEffect)((function(){var t=!0;if(e){var n=function(){var n=Object(c.a)(o.a.mark((function n(){var a,c;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.api.loadAllLockups();case 2:return a=n.sent,n.next=5,e.tokenApi.ftMetadata();case 5:if(c=n.sent,t){n.next=8;break}return n.abrupt("return");case 8:x(c),r({lockups:a,name:"name"});case 10:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();n()}return function(){t=!1}}),[e]),Object(l.useEffect)((function(){return e&&e.tokenApi&&h(e.tokenApi.getContract().contractId),function(){}}),[e]),0===Object.keys(a).length)return null;var O=a.lockups;return Object(B.jsx)(d.a,{children:Object(B.jsxs)(u.d,{children:[Object(B.jsx)(u.b,{path:"/*",element:Object(B.jsx)($e,{lockups:O,token:m,contractId:b})}),Object(B.jsx)(u.b,{path:"/admin/*",element:Object(B.jsx)(Ze,{lockups:O,token:m})})]})})}n(270);function Xe(){var e=Object(l.useState)(null),t=Object(i.a)(e,2),n=t[0],a=t[1];Object(l.useEffect)((function(){function e(){return(e=Object(c.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H();case 2:t=e.sent,a(t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var s=Object(l.useMemo)((function(){return{near:n,signIn:function(){var e;null===n||void 0===n||null===(e=n.api)||void 0===e||e.signIn()},signOut:function(){n&&(n.api.signOut(),a(Object(r.a)(Object(r.a)({},n),{},{signedIn:!1,signedAccountId:null})))}}}),[n]);return Object(B.jsx)(l.StrictMode,{children:Object(B.jsx)(K.Provider,{value:s,children:Object(B.jsx)(Qe,{})})})}Object(a.render)(Object(B.jsx)(Xe,{}),document.getElementById("root"))}},[[271,1,2]]]);
//# sourceMappingURL=main.c5a4fdb9.chunk.js.map