(this["webpackJsonpft-lockup-contract-frontend"]=this["webpackJsonpft-lockup-contract-frontend"]||[]).push([[0],{249:function(e,t){},259:function(e,t){},312:function(e,t,n){},316:function(e,t,n){},317:function(e,t,n){},318:function(e,t,n){"use strict";n.r(t);var a=n(64),r=n(23),c=n(15),o=n(12),s=n(7),i=n.n(s),l=n(2),u=n(33),d=n(422),p=n(128),b=n.n(p),h=n(26),j=n(20);var f=function(e,t){var n=Object(l.useState)((function(){return function(e,t){var n=localStorage.getItem(e);return n?JSON.parse(n):t}(e,t)})),a=Object(o.a)(n,2),r=a[0],c=a[1];return Object(l.useEffect)((function(){localStorage.setItem(e,JSON.stringify(r))}),[e,r]),[r,c]},m=n(17),x=n.n(m),O="factory012.ft-lockup.testnet",g=function(){var e=window.location.hash.split("/")[1];return"new_lockup_contract"===e?O:e}();console.log(g);var v=function(){var e=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_DEFAULT_CONTRACT_NAME:"example.factory012.ft-lockup.testnet",REACT_APP_FACTORY_CONTRACT_NAME:"factory012.ft-lockup.testnet",REACT_APP_CONTRACT_NAME:"startup0.factory0.ft-lockup.testnet"}).REACT_APP_ENVIRONMENT||"development";switch(e){case"production":case"mainnet":return{networkId:"mainnet",nodeUrl:"https://rpc.mainnet.near.org",contractName:g,walletUrl:"https://wallet.near.org",helperUrl:"https://helper.mainnet.near.org",explorerUrl:"https://explorer.mainnet.near.org",factoryContractName:O};case"development":case"testnet":return{networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",contractName:g,walletUrl:"https://wallet.testnet.near.org",helperUrl:"https://helper.testnet.near.org",explorerUrl:"https://explorer.testnet.near.org",factoryContractName:O};case"betanet":return{networkId:"betanet",nodeUrl:"https://rpc.betanet.near.org",contractName:g,walletUrl:"https://wallet.betanet.near.org",helperUrl:"https://helper.betanet.near.org",explorerUrl:"https://explorer.betanet.near.org",factoryContractName:O};case"local":return{explorerUrl:"",helperUrl:"",networkId:"local",nodeUrl:"http://localhost:3030",walletUrl:"http://localhost:4000/wallet",contractName:g,factoryContractName:O};case"test":case"ci":return{explorerUrl:"",helperUrl:"",walletUrl:"",networkId:"shared-test",nodeUrl:"https://rpc.ci-testnet.near.org",contractName:g,factoryContractName:O};case"ci-betanet":return{explorerUrl:"",helperUrl:"",walletUrl:"",networkId:"shared-test-staging",nodeUrl:"https://rpc.ci-betanet.near.org",contractName:g,factoryContractName:O};default:throw Error("Unconfigured environment '".concat(e,"'. Can be configured in src/config.js."))}}(),k=3e14;x.a.DP=40,x.a.PE=40;var w=function(e){var t="".concat(function(e){var t=new Date(1e3*e),n=function(e,t){return e.toString().padStart(t,"0")},a=n(t.getUTCFullYear(),4),r=n(t.getUTCMonth()+1,2),c=n(t.getUTCDate(),2);return"".concat(a,"-").concat(r,"-").concat(c)}(e)," ").concat(function(e){var t=new Date(1e3*e),n=function(e,t){return e.toString().padStart(t,"0")},a=n(t.getUTCHours(),2),r=n(t.getUTCMinutes(),2),c=n(t.getUTCSeconds(),2);return"".concat(a,":").concat(r,":").concat(c)}(e));return t},y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2?arguments[2]:void 0;return x.a.DP=40,x()(e||"0").div(Math.pow(10,24)).toFixed(0===t?void 0:t,n)},C=function(e,t){return new x.a(e).div(Math.pow(10,t)).toFixed(2,x.a.roundDown)},_=function(e,t){return new Date(new Date(e).setUTCFullYear(e.getUTCFullYear()+t)).getTime()/1e3},N=function(e){var t=864e5;return new Date(Math.floor(e.getTime()/t)*t)},S=function(e,t){return new Date(e.getTime()+864e5*t)},T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"dump",t=Object.keys(localStorage).map((function(e){return[e,localStorage.getItem(e)]}));localStorage.setItem(e,JSON.stringify(t))},A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"dump",t=localStorage.getItem(e);if(t){var n=JSON.parse(t);localStorage.clear(),n.forEach((function(e){return localStorage.setItem(e[0],e[1])}))}},D=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return e.length>24?"".concat(e.slice(0,t),"...").concat(e.slice(-n)):e},I=function(e){return"".concat(v.explorerUrl,"/transactions/").concat(e)},E=n(31),U=n(55),F=n(56),M=["get_draft_group","get_draft_groups_paged","get_drafts","get_lockups_paged","get_token_account_id","get_deposit_whitelist","get_draft_operators_whitelist"],P=["create_draft","create_drafts","create_draft_group","convert_draft","convert_drafts","terminate","discard_draft_group","delete_drafts"],L=function(){function e(t){Object(U.a)(this,e),this.near=void 0,this.contract=void 0,this.walletConnection=void 0,this.near=t,this.walletConnection=new E.WalletConnection(t,t.config.contractName),this.contract=new E.Contract(this.walletConnection.account(),this.near.config.contractName,{viewMethods:M,changeMethods:P})}return Object(F.a)(e,[{key:"getDraftGroupsAll",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.get_draft_groups_paged();case 2:return t=e.sent,e.abrupt("return",t.map((function(e){var t=Object(o.a)(e,2),n=t[0],a=t[1];return Object.assign(a,{id:n})})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDraftGroup",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.get_draft_group({index:t});case 2:return(n=e.sent)&&(n.id=t),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDrafts",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.get_drafts({indices:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createDraftGroup",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.create_draft_group();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createDraft",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.create_draft({draft:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createDrafts",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.create_drafts({args:{drafts:t},gas:"300000000000000"});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"convertDrafts",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.convert_drafts({args:{draft_ids:t},gas:"300000000000000"});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"discardDraftGroup",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.discard_draft_group({args:{draft_group_id:t}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteDrafts",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.delete_drafts({args:{draft_ids:t}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"terminate",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.contract.terminate({args:{lockup_index:t,termination_timestamp:n},gas:k,amount:1});case 3:return a=e.sent,e.abrupt("return",a);case 7:throw e.prev=7,e.t0=e.catch(0),console.log(e.t0),Error("Cannot terminate lockup");case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNear",value:function(){return this.near}},{key:"getWalletConnection",value:function(){return this.walletConnection}},{key:"getContract",value:function(){return this.contract}},{key:"getTokenAccountId",value:function(){return this.contract.get_token_account_id()}},{key:"getDepositWhitelist",value:function(){return this.contract.get_deposit_whitelist()}},{key:"getDraftOperatorsWhitelist",value:function(){return this.contract.get_draft_operators_whitelist()}},{key:"loadAllLockups",value:function(){return this.contract.get_lockups_paged().then((function(e){return e.map((function(e){var t=Object(o.a)(e,2),n=t[0],a=t[1];return Object.assign(a,{id:n})}))}))}},{key:"signIn",value:function(){var e="".concat(window.location.href),t="lockup_contract_none"!==this.near.config.contractName?this.near.config.contractName:this.near.config.factoryContractName;this.walletConnection.requestSignIn(t,void 0,e)}},{key:"signOut",value:function(){this.walletConnection.signOut(),this.near.config.keyStore.clear()}},{key:"get_account_id",value:function(){return this.walletConnection.getAccountId()}},{key:"account",value:function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.near.account(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get_balance",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n,a,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.account(t);case 2:return n=e.sent,a=null,e.prev=4,e.next=7,n.getAccountBalance();case 7:r=e.sent,c=r.total,a=parseFloat(E.utils.format.formatNearAmount(c||"0")),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),console.error("Account not exist");case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}var c}),e,this,[[4,11]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),R=L,B=n(194),W=n(39),z=n.n(W),G=function(){var e=Object(B.a)(z.a.mark((function e(t,n){var a,r,c;return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.query({request_type:"view_access_key_list",account_id:n,finality:"optimistic"});case 2:if(r=e.sent,null!==(a=r.keys)&&void 0!==a&&a.length){e.next=5;break}throw Error("None of access keys was founded");case 5:if(null!==(c=r.keys.filter((function(e){var t,n;return"string"===typeof(null===e||void 0===e||null===(t=e.access_key)||void 0===t?void 0:t.permission)&&"FullAccess"===(null===e||void 0===e||null===(n=e.access_key)||void 0===n?void 0:n.permission)})))&&void 0!==c&&c.length){e.next=8;break}throw Error("None of full access keys was founded");case 8:return e.abrupt("return",c[0]);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),V=G,H=[""],q=["claim"],Y=function(){function e(t){Object(U.a)(this,e),this.near=void 0,this.near=t}return Object(F.a)(e,[{key:"claim",value:function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T(),e.next=3,this.setWalletAndContractWithAuth(t);case 3:return e.next=5,this.buildContract().claim({},k);case 5:this.near.config.keyStore.clean();case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"claimSpecificLockups",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T(),e.next=3,this.setWalletAndContractWithAuth(t);case 3:return e.next=5,this.buildContract().claim({amounts:n.map((function(e){return[e,null]}))},k);case 5:this.near.config.keyStore.clean();case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setWalletAndContractWithAuth",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n,a,r=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:this.near.config.contractName,e.next=3,V(this.near.connection.provider,t);case 3:a=e.sent,localStorage.setItem("".concat(n,"_wallet_auth_key"),JSON.stringify({accountId:t,allKeys:[a.public_key]}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"buildContract",value:function(){return new E.Contract(new E.WalletConnection(this.near,this.near.config.contractName).account(),this.near.config.contractName,{viewMethods:H,changeMethods:q})}}]),e}(),J=Y,K=[""],$=["storage_deposit"],X=function(){function e(t){Object(U.a)(this,e),this.near=void 0,this.near=t}return Object(F.a)(e,[{key:"storageDeposit",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n,a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T(),e.next=3,this.setWalletAndContractWithAuth(n);case 3:return e.next=5,this.buildContract(t).storage_deposit({args:{account_id:n},gas:k,amount:a});case 5:this.near.config.keyStore.clean();case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"setWalletAndContractWithAuth",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n,a,r=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:this.near.config.contractName,e.next=3,V(this.near.connection.provider,t);case 3:a=e.sent,localStorage.setItem("".concat(n,"_wallet_auth_key"),JSON.stringify({accountId:t,allKeys:[a.public_key]}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"buildContract",value:function(e){return new E.Contract(new E.WalletConnection(this.near,this.near.config.contractName).account(),e,{viewMethods:K,changeMethods:$})}}]),e}(),Z=X,Q=n(208),ee=["msg"],te=3e14,ne=["ft_metadata","storage_balance_of","storage_balance_bounds"],ae=["ft_transfer_call","storage_deposit"],re=function(){function e(t,n){Object(U.a)(this,e),this.contract=void 0,this.contract=new E.Contract(t.account(),n,{viewMethods:ne,changeMethods:ae})}return Object(F.a)(e,[{key:"getContract",value:function(){return this.contract}},{key:"createLockup",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n,a,r,c){var o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ftTransferCall({receiver_id:t,amount:n.toString(),msg:{account_id:a,schedule:r,vesting_schedule:c?{Schedule:c}:null}});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r,c){return e.apply(this,arguments)}}()},{key:"fundDraftGroup",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n,a){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ftTransferCall({receiver_id:t,amount:a,msg:{draft_group_id:n,try_convert:true}});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"ftTransferCall",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n,a,c,o,s=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:te,a=s.length>2&&void 0!==s[2]?s[2]:1,c=t.msg,o=Object(Q.a)(t,ee),e.next=5,this.contract.ft_transfer_call(Object(r.a)({msg:JSON.stringify(c)},o),n,a);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"storageDeposit",value:function(e,t){return this.contract.storage_deposit({args:{account_id:e},gas:te,amount:t})}},{key:"ftMetadata",value:function(){return this.contract.ft_metadata({})}},{key:"storageBalanceOf",value:function(e){return this.contract.storage_balance_of({account_id:e})}},{key:"storageBalanceBounds",value:function(){return this.contract.storage_balance_bounds()}}]),e}(),ce=re,oe=new x.a(10).mul(new x.a(10).pow(24)).toString(),se=["create"],ie=function(){function e(t,n){Object(U.a)(this,e),this.contract=void 0,this.contract=new E.Contract(t.account(),n,{viewMethods:[],changeMethods:se})}return Object(F.a)(e,[{key:"getContract",value:function(){return this.contract}},{key:"create",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n,a,r,c){var o,s,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={token_account_id:n,deposit_whitelist:a,draft_operators_whitelist:r},s=JSON.stringify(o),e.next=4,this.contract.create({args:{name:t,init_function:"new",init_args:s},callbackUrl:c,gas:3e14,amount:oe});case 4:return l=e.sent,console.log(l),e.abrupt("return",l);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r,c){return e.apply(this,arguments)}}()}]),e}(),le=ie,ue=n(25),de=["call:AddProposal","*:AddProposal"],pe=["get_policy"],be=function(){function e(t,n){Object(U.a)(this,e),this.contract=void 0,this.contract=new E.Contract(t.account(),n,{viewMethods:pe,changeMethods:[]})}return Object(F.a)(e,[{key:"getContract",value:function(){return this.contract}},{key:"getCouncilMembers",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t,n,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.get_policy();case 2:if(t=e.sent,0!==(n=t.roles.filter((function(e){var t,n;return(null===e||void 0===e||null===(t=e.permissions)||void 0===t?void 0:t.includes(de[0]))||(null===e||void 0===e||null===(n=e.permissions)||void 0===n?void 0:n.includes(de[1]))}))).length){e.next=6;break}return e.abrupt("return",[]);case 6:return a=n.map((function(e){var t;return null===e||void 0===e||null===(t=e.kind)||void 0===t?void 0:t.Group})),e.abrupt("return",a.flat().filter((function(e){return e})));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),he=be,je=function(e,t,n,a,r,c,o,s,i,l){var u={details:a,smartContractAddress:r,methodName:c,json:o,actionsGas:s,gas:l,deposit:i};return"".concat("https://testnet.app.astrodao.com","/dao/").concat(e,"/proposals?action=").concat(t,"&variant=").concat(n,"&params=").concat(JSON.stringify(u))},fe=function(e,t,n,a,r,c,o){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"300";return je(e,"create_proposal","ProposeCustomFunctionCall",t,n,a,r,c,o,s)},me=function(){var e=Object(c.a)(i.a.mark((function e(t,n){var a,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=new he(t,n),e.next=4,a.getCouncilMembers();case 4:return r=e.sent,e.abrupt("return",Object(ue.a)({},n,r));case 8:return e.prev=8,e.t0=e.catch(0),console.log("isDAO ERROR:",e.t0),e.abrupt("return",void 0);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),xe=function(e,t,n,a,r,c){var o=encodeURIComponent(e),s={receiver_id:t,amount:a,msg:JSON.stringify({draft_group_id:r,try_convert:true})};return fe(c,o,n,"ft_transfer_call",s,"100","0.000000000000000000000001")},Oe=function(e,t,n,a,r){var c=encodeURIComponent(e);return fe(r,c,t,"terminate",{lockup_index:n,termination_timestamp:a},"100","0.000000000000000000000001")},ge=Object(l.createContext)(null),ve=function(){var e=Object(c.a)(i.a.mark((function e(){var t,n,a,c,o,s,l,u,d,p,b,h,j,f,m,x,O,g,k,w,y,C,_,N,S,T;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.getItem("dump")&&A(),t=window.location.hash.split("/")[1]||"",["","terms","privacy","about","new_lockup_contract"].some((function(e){return t===e}))&&(t="lockup_contract_none"),n=Object(r.a)(Object(r.a)({},v),{},{contractName:t}),a=new E.keyStores.BrowserLocalStorageKeyStore,e.next=7,E.connect(Object(r.a)({headers:{},keyStore:a},n));case 7:return c=e.sent,o=new R(c),s=new E.keyStores.InMemoryKeyStore,e.next=12,E.connect(Object(r.a)({headers:{},keyStore:s},n));case 12:return l=e.sent,u=new J(l),d=new Z(l),p=new E.WalletConnection(c,n.contractName),b=p.getAccountId(),h="lockup_contract_not_found",j=!1,f=!1,m=[],x=[],O=[],g=!1,e.prev=24,e.next=27,o.getTokenAccountId();case 27:return h=e.sent,e.next=30,o.getDepositWhitelist();case 30:return m=e.sent,e.next=33,o.getDraftOperatorsWhitelist();case 33:return x=e.sent,console.log("depositWhitelist",m),j=m.includes(b),console.log("isAdmin",j),f=x.includes(b),console.log("isDraftOperator",f),k=me,console.log(k),e.next=43,Promise.all(m.map((function(e){return me(p,e)})));case 43:w=e.sent.filter((function(e){return!!e})),console.log(w),(null===(y=w.filter((function(e){return Object.values(e).pop().includes(b)})))||void 0===y?void 0:y.length)>0&&(O=y.map((function(e){return Object.keys(e).pop()||""}))),console.log("userDaosCouncils",y),console.log("councilMembers",w),console.log("daos",O),e.next=57;break;case 52:e.prev=52,e.t0=e.catch(24),console.log(e.t0),"AccountDoesNotExist"===e.t0.type?console.log("contract not found"):console.log("UNKNOWN ERROR: ".concat(e.t0));case 57:return C=new ce(p,h),_=!1,e.prev=59,e.next=62,C.storageBalanceOf(t);case 62:N=e.sent,g=!0,_=null!==N&&!0,console.log(_),e.next=71;break;case 68:e.prev=68,e.t1=e.catch(59),console.log(e.t1);case 71:return S=new le(p,n.factoryContractName),T=new E.providers.JsonRpcProvider(n.nodeUrl),e.abrupt("return",{config:n,api:o,tokenContractId:h,noLoginApi:u,tokenApi:C,factoryApi:S,currentUser:{signedIn:!!b,isAdmin:j,isDraftOperator:f,isCouncilMember:O.length>0,signedAccountId:b,daos:O},noLoginTokenApi:d,rpcProvider:T,isContractFtStoragePaid:_,lockupContractId:t,lockupContractFound:g,lockupContractNone:"lockup_contract_none"===t,near:c,suggestConvertDialog:{open:!1,setOpen:function(){return null}}});case 74:case"end":return e.stop()}}),e,null,[[24,52],[59,68]])})));return function(){return e.apply(this,arguments)}}(),ke=n(414),we={restoreOnUnmount:!1};var ye="undefined"!==typeof document?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:we;Object(l.useEffect)((function(){var n=document.title;return document.title!==e&&(document.title=e),t&&t.restoreOnUnmount?function(){document.title=n}:function(){}}))}:function(){},Ce=n(1);function _e(){return ye("About | FT Lockup",{restoreOnUnmount:!0}),Object(Ce.jsxs)("div",{className:"root",children:[Object(Ce.jsx)("div",{className:"header",children:Object(Ce.jsx)("div",{className:"container",children:Object(Ce.jsx)(ke.a,{sx:{display:"flex"},children:Object(Ce.jsx)(j.b,{className:"logo",to:"/",children:"LOCKUPS"})})})}),Object(Ce.jsxs)("div",{className:"container",children:[Object(Ce.jsx)("h1",{children:"Fungible Token Lockup"}),Object(Ce.jsx)("h2",{children:"Purpose"}),Object(Ce.jsxs)("div",{children:[Object(Ce.jsx)("p",{children:"Community Lockup is dApp implementing locking and vesting of any arbitrary fungible token on NEAR in the generally known sense of these words."}),Object(Ce.jsx)("p",{children:"Lockup is a gradual release of tokens according to a specified schedule. After release tokens are in full control of the beneficiary."}),Object(Ce.jsx)("p",{children:"Vesting is a gradual allocation of tokens to the beneficiary according to a specified schedule, provided certain conditions are met (for example, beneficiary keeps working for the payer)."}),Object(Ce.jsx)("p",{children:"Vested tokens are NOT immediately available to the beneficiary, however they WILL be available to the beneficiary according to the lockup schedule. Vested tokens are GUARANTEED to be received at some point in the future, while unvested token amount may be withdrawn by the payer if the lockup agreement is terminated."})]}),Object(Ce.jsx)("h2",{children:"Users"}),Object(Ce.jsxs)("div",{children:[Object(Ce.jsx)("p",{children:"There are two roles in the app: payer (also called admin), most commonly the employer, and beneficiaries, most commonly the employees. There is also an implicit \u201canyone\u201d role."}),Object(Ce.jsxs)("ul",{children:[Object(Ce.jsx)("li",{children:"All users (\u201canyone\u201d) are able to view ALL lockup information stored in the blockchain for any existing lockup contract. They are also able to create new lockup contract and become admin for that new lockup contract."}),Object(Ce.jsx)("li",{children:"Beneficiary users have ability to claim unlocked tokens dedicated to them"}),Object(Ce.jsx)("li",{children:"Admin users can create new lockups (one by one or via excel import) and terminate existing lockups that can be terminated"}),Object(Ce.jsx)("li",{children:"Draft operators can create draft groups, drafts, delete draft groups, drafts."})]})]}),Object(Ce.jsx)("h2",{children:"Lockups"}),Object(Ce.jsxs)("div",{children:[Object(Ce.jsx)("p",{children:"Each lockup has the following fields:"}),Object(Ce.jsxs)("ul",{children:[Object(Ce.jsx)("li",{children:"Account ID: NEAR account id that will receive the tokens"}),Object(Ce.jsx)("li",{children:"Schedule: the lockup schedule, according to which the tokens are released. Is represented by a monotonous piecewise linear function . Where x is the time axis and y is the amount of unlocked tokens at any specific moment."}),Object(Ce.jsx)("li",{children:"Vesting schedule: optional. According to this schedule tokens are vested, i. e. allocated to the beneficiary irrevocably. Operator is able to terminate the lockup at any effective moment in the future. If this happens, then the lockup schedule is capped at the total vested amount at the effective moment of termination."}),Object(Ce.jsx)("li",{children:"Payer id: optional. account id that paid for the specific lockup. Only recorded for terminatable lockups. If the lockup is terminated - unvested tokens will be returned back to the payer upon termination."}),Object(Ce.jsx)("li",{children:"Claimed balance: already claimed balance for the lockup. Used for tracking claim progress."})]})]}),Object(Ce.jsx)("h2",{children:"Lockup and vesting logic"}),Object(Ce.jsxs)("div",{children:[Object(Ce.jsx)("img",{src:"https://bafkreiaghj56tpqi5qzivzzue7kudpp5amyhbxqzgjakydp6anprtbxxu4.ipfs.nftstorage.link/",alt:"Lockup and vesting schedule"}),Object(Ce.jsx)("p",{children:"Consider the following lockup with a four year duration."}),Object(Ce.jsx)("p",{children:"The vesting schedule is blue. One year cliff, then 1 / 4 is vested, then vesting is linear till the end (4 years mark)."}),Object(Ce.jsx)("p",{children:"The lockup schedule is green. Two years cliff with zero amount. Then two years of linear lockup till full amount"}),Object(Ce.jsx)("p",{children:"Consider the termination happening at the 2.6 years mark."}),Object(Ce.jsx)("p",{children:"First, we find the vested amount for this timestamp. It is 0.65."}),Object(Ce.jsx)("p",{children:"After that we trim the lockup schedule at that amount."}),Object(Ce.jsx)("p",{children:"In this case, the intersection is at 3.3 year mark."}),Object(Ce.jsx)("p",{children:"The trimmed lockup schedule capped by the horizontal red line at 0.65 of the amount."})]})]})]})}var Ne=n(390),Se=n(402),Te=n(415),Ae=n(416),De=n(417),Ie=n(418),Ee=n(419),Ue=n(408),Fe=n(413),Me=n(129),Pe=n.n(Me),Le=n(130),Re=n.n(Le),Be=n(107),We=n.n(Be),ze=n(106);function Ge(e){var t=e.unixSeconds,n=new Date(1e3*t),a=function(e,t){return e.toString().padStart(t,"0")},r=a(n.getUTCFullYear(),4),c=a(n.getUTCMonth()+1,2),o=a(n.getUTCDate(),2),s=a(n.getUTCHours(),2),i=a(n.getUTCMinutes(),2),l=a(n.getUTCSeconds(),2),u="".concat(r,"-").concat(c,"-").concat(o),d="".concat(r,"-").concat(c,"-").concat(o," ").concat(s,":").concat(i,":").concat(l," UTC");return Object(Ce.jsx)("span",{className:"nowrap timestamp-display",title:d,children:u})}var Ve=n(29),He=n(204);n(312);function qe(e){var t=e.data,n=e.xMax,a=e.yMax,r=Math.min.apply(Math,[t.unlocked[0][0]].concat(Object(Ve.a)(t.vested[0][0]&&[t.vested[0][0]]&&[])));console.log("xMin",r/1e3),console.log("xMax",n),console.log("withOffset",n&&n+.03*(n-r/1e3));var c=n&&1e3*(r/1e3-.03*(n-r/1e3)),o=n&&1e3*(n+.03*(n-r/1e3));console.log("computedMin",c),console.log("computedMax",o);var s=function(e){return new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(parseFloat(e))},i={useUTC:!0,title:[{text:"Schedule timestamps are in UTC",top:"10px",left:"7px",textStyle:{fontWeight:"700",fontFamily:'"Roboto","Helvetica","Arial",sans-serif',fontSize:"14px",color:"#242F57",opacity:1}}],tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{bottom:"3%",selectedMode:!1,icon:"circle"},grid:{top:"50px",left:"12px",right:"12px",bottom:"15%",containLabel:!0},xAxis:[{type:"time",boundaryGap:["3%","3%"],splitNumber:10,min:c,max:o}],yAxis:[{type:"value",max:a}],series:[{tooltip:{valueFormatter:s},showSymbol:!1,name:"Vested",type:"line",color:"#0069D1",areaStyle:{opacity:1},markLine:{data:[[{xAxis:new Date,yAxis:0},{xAxis:new Date,yAxis:a||"max"}]],lineStyle:{type:"dashed",color:"#FF594E"},symbol:"none"},emphasis:{disabled:!0},data:t.vested},{tooltip:{valueFormatter:s},showSymbol:!1,name:"Unlocked",type:"line",color:"#00B988",areaStyle:{opacity:1},emphasis:{disabled:!0},data:t.unlocked},{tooltip:{valueFormatter:s},showSymbol:!1,name:"Claimed",type:"line",color:"#E9AF1C",areaStyle:{opacity:1},emphasis:{disabled:!0},data:t.claimed}]};return Object(Ce.jsx)(He.a,{option:i,style:{borderRadius:10}})}function Ye(e){var t=e.url,n=e.size;return Object(Ce.jsx)("img",{style:{height:n,width:n,verticalAlign:"middle"},src:t,alt:"Token Icon"})}function Je(e){var t=e.token,n=e.amount;return Object(Ce.jsxs)("span",{className:"nowrap",title:n,children:[C(n,t.decimals)," ",t.symbol," ",Object(Ce.jsx)(Ye,{url:t.icon||"",size:32})]})}function Ke(e){var t=e.unixSeconds,n=new Date(1e3*t),a=function(e,t){return e.toString().padStart(t,"0")},r=a(n.getUTCFullYear(),4),c=a(n.getUTCMonth()+1,2),o=a(n.getUTCDate(),2),s=a(n.getUTCHours(),2),i=a(n.getUTCMinutes(),2),l=a(n.getUTCSeconds(),2),u="".concat(r,"-").concat(c,"-").concat(o," ").concat(s,":").concat(i,":").concat(l," UTC");return Object(Ce.jsx)("span",{className:"nowrap timestamp-display",title:u,children:u})}function $e(e){var t=e.schedule,n=e.title,a=e.token;return Object(Ce.jsxs)("div",{className:"inner-table_wrapper",children:[Object(Ce.jsx)("h5",{children:n}),Object(Ce.jsxs)(Te.a,{className:"inner-table",size:"small","aria-label":"purchases",children:[Object(Ce.jsx)(Ae.a,{children:Object(Ce.jsxs)(De.a,{children:[Object(Ce.jsx)(Ie.a,{children:"DATE (UTC)"}),Object(Ce.jsx)(Ie.a,{align:"right",children:"CUMULATIVE AMOUNT"})]})}),Object(Ce.jsx)(Ee.a,{children:t.map((function(e){return Object(Ce.jsxs)(De.a,{children:[Object(Ce.jsx)(Ie.a,{scope:"row",children:Object(Ce.jsx)("div",{className:"nowrap",children:Object(Ce.jsx)(Ke,{unixSeconds:e.timestamp})})}),Object(Ce.jsx)(Ie.a,{align:"right",children:Object(Ce.jsx)(Je,{amount:e.balance,token:a})})]},e.timestamp)}))})]})]})}qe.defaultProps={xMax:null,yMax:null};var Xe=function(e,t,n){return{timestamp:n,balance:function(e,t,n,a,r){if(n<=e)throw new Error("invalid range");if(r<e||r>=n)throw new Error("xM out of bound");return new m.Big(t).add(new m.Big(a).sub(new m.Big(t)).mul(new m.Big(r.toString()).sub(new m.Big(e.toString()))).div(new m.Big(n.toString()).sub(new m.Big(e.toString())))).toFixed(0,m.Big.roundDown)}(e.timestamp,e.balance,t.timestamp,t.balance,n)}},Ze=function(e,t,n){return{timestamp:function(e,t,n,a,r){if(n<=e)throw new Error("invalid range");if(new m.Big(r).lt(new m.Big(t))||new m.Big(r).gte(a))throw new Error("yM out of bound");var c=new m.Big(e).add(new m.Big(n).sub(new m.Big(e)).mul(new m.Big(r.toString()).sub(new m.Big(t.toString()))).div(new m.Big(a.toString()).sub(new m.Big(t.toString()))));return parseInt(c.toFixed(0,m.Big.roundUp),10)}(e.timestamp,e.balance,t.timestamp,t.balance,n),balance:n}},Qe=function(e,t){if(0===e.length)throw new Error("empty schedule");if(t<e[0].timestamp)return{timestamp:t,balance:e[0].balance};if(t>=e[e.length-1].timestamp)return{timestamp:t,balance:e[e.length-1].balance};for(var n=0;n<e.length-1;n++)if(!(e[n+1].timestamp<=t))return Xe(e[n],e[n+1],t);throw new Error("unreachable")},et=function(e){if(0===e.length)throw new Error("schedules is empty");var t=Array.from(new Set(e.flat().map((function(e){return e.timestamp})).sort((function(e,t){return e-t})))),n=[];return t.forEach((function(t){for(var a=new m.Big(0),r=0;r<e.length;r++){var c=new m.Big(Qe(e[r],t).balance);a=a.plus(c)}n.push({timestamp:t,balance:a.toString()})})),n},tt=function(e,t,n){if(0===e.length)throw new Error("empty schedule");if(new m.Big(t).eq(new m.Big("0")))return[e[0],{timestamp:Math.max(e[0].timestamp+1,n),balance:e[0].balance}];if(new m.Big(t).gte(new m.Big(e[e.length-1].balance)))return e.slice(0,e.length);for(var a=[],r=0;r<e.length-1;r+=1){if(a.push(e[r]),new m.Big(t).lt(new m.Big(e[r+1].balance))){var c=Ze(e[r],e[r+1],t);return a.push(c),a}if(new m.Big(t).eq(new m.Big(e[r+1].balance)))return a.push(e[r+1]),a}throw new Error("unreachable")},nt=function(e,t){var n,a,r,c=e.schedule[e.schedule.length-1].balance,o=e.claimed_balance||"0",s=new m.Big(Qe(e.schedule,t).balance).sub(new m.Big(o)).toFixed(),i=null,l=(null===(n=e.vesting_schedule)||void 0===n?void 0:n.Schedule)||(null===(a=e.termination_config)||void 0===a||null===(r=a.vesting_schedule)||void 0===r?void 0:r.Schedule);i=l?Qe(l,t).balance:e.schedule[e.schedule.length-1].balance;var u=new m.Big(i).sub(new m.Big(o)).sub(new m.Big(s)).toString(),d=new m.Big(c).sub(new m.Big(i)).toString();return console.log(c,o,s,u,d),{claimed:o,unclaimed:s,vested:u,unvested:d,total:c}},at=function(e,t){var n=e.map((function(e){return e.timestamp}));return Array.from(new Set([].concat(Object(Ve.a)(n),Object(Ve.a)(t)))).sort().map((function(t){return Qe(e,t)}))},rt=function(e,t){var n,a=new Date;console.log("chartData([".concat(e.length,"]): start ").concat(a));var r=Array.from(e.map((function(e){return e.schedule}))),c=Math.round((new Date).getTime()/1e3),o=e.map((function(e){return e.schedule[0].timestamp})),s=e.map((function(e){var t,n;return null===e||void 0===e||null===(t=e.termination_config)||void 0===t||null===(n=t.vesting_schedule[0])||void 0===n?void 0:n.timestamp})).filter((function(e){return e})),i=Math.min.apply(Math,Object(Ve.a)(o).concat(Object(Ve.a)(s),[c])),l=Array.from(e.map((function(e){var t,n,a,r,c,o=(null===e||void 0===e||null===(t=e.termination_config)||void 0===t||null===(n=t.vesting_schedule)||void 0===n?void 0:n.Schedule)||(null===e||void 0===e||null===(a=e.vesting_schedule)||void 0===a?void 0:a.Schedule);return o||(o||(r=i,c=e.schedule[e.schedule.length-1].balance,[{timestamp:r-1,balance:"0"},{timestamp:r,balance:c}]))}))),u=et(l),d=et(r);u.length>0&&(u[u.length-1].timestamp<d[d.length-1].timestamp&&u.push(d[d.length-1]),u[u.length-1].timestamp>d[d.length-1].timestamp&&d.push(u[u.length-1]));var p=function(e,t){return e.map((function(e){return[1e3*e.timestamp,C(e.balance,t)]}))},b=e.map((function(e){return e.claimed_balance||"0"})).reduce((function(e,t){return new m.Big(e).add(new m.Big(t)).toFixed()}),"0"),h=tt(d,b,0);(null===(n=h[h.length-1])||void 0===n?void 0:n.timestamp)!==d[d.length-1].timestamp&&h.push({timestamp:d[d.length-1].timestamp,balance:h[h.length-1].balance});for(var j=[d,u,h].flatMap((function(e){return e.map((function(e){return e.timestamp}))})),f=Math.min.apply(Math,Object(Ve.a)(j)),x=Math.max.apply(Math,Object(Ve.a)(j)),O=[],g=86400*((f-1)/86400+1);g<x;g+=86400)O.push(g);var v=[].concat(Object(Ve.a)(j),O);h=at(h,v),d=at(d,v),u=at(u,v);var k=new Date;return console.log("chartData([".concat(e.length,"]): finish ").concat(a," duration ").concat((k.getTime()-a.getTime())/1e3)),{unlocked:e.length?p(d,t):[],vested:e.length?p(u,t):[],claimed:e.length?p(h,t):[]}},ct=n(399),ot=n(214),st=n(420),it=n(421),lt=Object(ct.a)((function(){return{root:{"@media (min-width:600px)":{width:"410px !important",maxWidth:"410px !important",minHeight:"120px !important"},boxShadow:"1px 7px 20px 0px rgba(0,0,0, 0.3) !important",borderRadius:"12px"},simpleRoot:{"@media (min-width:600px)":{width:"410px !important",maxWidth:"410px !important"},boxShadow:"1px 7px 20px 0px rgba(0,0,0, 0.3) !important",borderRadius:"12px"},card:{width:"100%",padding:"24px",boxShadow:"none",borderRadius:"12px"},simpleCard:{width:"100%",padding:"12px 24px",boxShadow:"none",borderRadius:"12px"},actionRoot:{padding:0,marginBottom:"8px",justifyContent:"space-between"},simplaActionRoot:{padding:0},typography1:{color:"rgba(0, 185, 136, 1)",fontWeight:700,fontSize:"16px"},icons:{marginLeft:"auto"},expand:{padding:0,transition:"all .2s"},collapse:{padding:"8px",backgroundColor:"#F4F7FC",boxShadow:"none",borderRadius:"8px"}}})),ut=Object(l.forwardRef)((function(e,t){var n=lt(),a=Object(u.c)().closeSnackbar,r=Object(l.useCallback)((function(){a(e.id)}),[e.id,a]);return Object(Ce.jsx)(u.a,{ref:t,className:e.body?n.root:n.simpleRoot,children:Object(Ce.jsxs)(st.a,{className:e.body?n.card:n.simpleCard,children:[Object(Ce.jsxs)(it.a,{classes:{root:e.body?n.actionRoot:n.simplaActionRoot},children:[e.header&&e.header(ct.a),Object(Ce.jsx)("div",{className:n.icons,children:Object(Ce.jsx)(d.a,{className:n.expand,onClick:r,children:Object(Ce.jsx)(b.a,{})})})]}),e.body&&Object(Ce.jsx)(ot.a,{className:n.collapse,children:e.body(ct.a)})]})})})),dt={vertical:"top",horizontal:"right"},pt=function(e,t,n,a){return e("",Object(r.a)({anchorOrigin:dt,content:function(e){return Object(Ce.jsx)(ut,{id:e,body:t,header:n})}},a))},bt=n(325),ht={body:function(e){return function(t){var n=t((function(){return{typography:{fontSize:"12px"}}}))();return Object(Ce.jsx)(bt.a,{className:n.typography,children:e})}},header:function(e){return function(t){var n=t((function(){return{typography:{color:"rgba(0, 185, 136, 1)",fontWeight:700,fontSize:"16px"}}}))();return Object(Ce.jsx)(bt.a,{variant:"subtitle2",className:n.typography,children:e})}}};function jt(e){var t,n=Object(h.f)(),a=e.opened,r=e.pageIndex,c=e.row,s=e.token,i=e.adminControls,p=e.progressShow,b=Object(l.useState)(a),f=Object(o.a)(b,2),m=f[0],x=f[1],O=Object(u.c)().enqueueSnackbar,g=Object(l.useContext)(ge).near,v=Object(l.useState)(Math.floor((new Date).getTime()/1e3)),k=Object(o.a)(v,2),w=k[0];k[1];if(!g)return null;if(c instanceof Error)return Object(Ce.jsx)(De.a,{children:Object(Ce.jsx)(Ie.a,{style:{padding:0},colSpan:8,children:Object(Ce.jsxs)("div",{className:"row-error",children:["row ",r,": ",c.message]})})});var y=null===c||void 0===c||null===(t=c.vesting_schedule)||void 0===t?void 0:t.Schedule,_=n.pathname.split("/")[1],N=n.pathname.split("/").pop()===c.id.toString(),S=n.pathname.split("/").includes("drafts"),T=n.pathname.split("/").includes("import_draft_group"),A=nt(c,w);return Object(Ce.jsxs)(Ce.Fragment,{children:[Object(Ce.jsxs)(De.a,{className:m?"expanded exp-row ".concat(a?"opened":""):"exp-row",children:[Object(Ce.jsx)(Ie.a,{children:Object(Ce.jsx)(d.a,{"aria-label":"expand row",size:"small",onClick:function(){return x(!m)},children:m?Object(Ce.jsx)(Pe.a,{}):Object(Ce.jsx)(Re.a,{})})}),Object(Ce.jsxs)(Ie.a,{align:"left",children:[N&&S||T?c.id:Object(Ce.jsx)(j.b,{to:i?"/".concat(_,"/admin/drafts/").concat(c.id):"/".concat(_,"/drafts/").concat(c.id),children:c.id}),!T&&Object(Ce.jsx)(ze.CopyToClipboard,{text:"".concat(window.location.origin,"/#/").concat(_,"/drafts/").concat(c.id),onCopy:function(){return pt(O,null,ht.header("Copied"),{autoHideDuration:1e3})},children:Object(Ce.jsx)(d.a,{"aria-label":"copy link",children:Object(Ce.jsx)(We.a,{})})})]}),Object(Ce.jsx)(Ie.a,{align:"left",children:D(c.account_id)}),Object(Ce.jsx)(Ie.a,{align:"right",children:Object(Ce.jsx)(Ge,{unixSeconds:c.schedule[0].timestamp})}),Object(Ce.jsx)(Ie.a,{align:"right",children:Object(Ce.jsx)(Ge,{unixSeconds:c.schedule[c.schedule.length-1].timestamp})}),Object(Ce.jsx)(Ie.a,{align:"right",children:Object(Ce.jsx)(Je,{amount:A.total,token:s})}),p&&Object(Ce.jsx)(Ie.a,{align:"center",children:Object(Ce.jsx)(Ue.a,{title:Object(Ce.jsxs)("div",{className:"progress-bar__tooltip",children:[Object(Ce.jsxs)("span",{className:"nowrap",children:[Object(Ce.jsx)("i",{className:"claimed",children:"\xa0"}),Object(Ce.jsx)("b",{children:C(A.claimed,s.decimals)})," ","Claimed"]}),Object(Ce.jsxs)("span",{className:"nowrap",children:[Object(Ce.jsx)("i",{className:"available",children:"\xa0"}),Object(Ce.jsx)("b",{children:C(A.unclaimed,s.decimals)})," ","Available"]}),Object(Ce.jsxs)("span",{className:"nowrap",children:[Object(Ce.jsx)("i",{className:"vested",children:"\xa0"}),Object(Ce.jsx)("b",{children:C(A.vested,s.decimals)})," ","Vested"]}),Object(Ce.jsxs)("span",{className:"nowrap",children:[Object(Ce.jsx)("i",{className:"unvested",children:"\xa0"}),Object(Ce.jsx)("b",{children:C(A.unvested,s.decimals)})," ","Unvested"]})]}),placement:"top",arrow:!0,children:Object(Ce.jsx)("div",{className:"progress-bar-outer",children:Object(Ce.jsxs)("div",{className:"progress-bar",children:[Object(Ce.jsx)("div",{style:{width:"".concat(parseFloat(A.claimed)/parseFloat(A.total)*100,"%")},className:"claimed",children:"\xa0"}),Object(Ce.jsx)("div",{style:{width:"".concat(parseFloat(A.unclaimed)/parseFloat(A.total)*100,"%")},className:"available",children:"\xa0"}),Object(Ce.jsx)("div",{style:{width:"".concat(parseFloat(A.vested)/parseFloat(A.total)*100,"%")},className:"vested",children:"\xa0"}),Object(Ce.jsx)("div",{style:{width:"".concat(parseFloat(A.unvested)/parseFloat(A.total)*100,"%")},className:"unvested",children:"\xa0"})]})})})})]}),Object(Ce.jsx)(De.a,{className:a?"expanded opened":"expanded",children:Object(Ce.jsx)(Ie.a,{style:{padding:0},colSpan:8,children:Object(Ce.jsx)(Fe.a,{in:m,timeout:"auto",unmountOnExit:!0,children:Object(Ce.jsxs)("div",{className:"lockup-row",children:[Object(Ce.jsx)($e,{schedule:c.schedule,title:"Lockup schedule",token:s}),y&&Object(Ce.jsx)($e,{schedule:y,title:"Vesting schedule",token:s}),Object(Ce.jsx)("div",{className:"lockup-row-column chart",children:Object(Ce.jsx)("div",{style:{height:300},children:Object(Ce.jsx)(qe,{data:rt([c],s.decimals)})})})]})})})})]})}function ft(e){var t=e.lockups,n=e.token,a=e.adminControls,r=e.progressShow;return Object(Ce.jsxs)(Te.a,{className:"main-table","aria-label":"collapsible table",children:[Object(Ce.jsx)(Ae.a,{className:"table-head",children:t.length>0&&Object(Ce.jsxs)(De.a,{children:[Object(Ce.jsx)(Ie.a,{}),Object(Ce.jsx)(Ie.a,{align:"left",children:Object(Ce.jsx)("span",{className:"nowrap",children:"ID"})}),Object(Ce.jsx)(Ie.a,{align:"left",children:Object(Ce.jsx)("span",{className:"nowrap",children:"Account ID"})}),Object(Ce.jsx)(Ie.a,{align:"right",children:Object(Ce.jsx)("span",{className:"nowrap",children:"Start date (UTC)"})}),Object(Ce.jsx)(Ie.a,{align:"right",children:Object(Ce.jsx)("span",{className:"nowrap",children:"End date (UTC)"})}),Object(Ce.jsx)(Ie.a,{align:"right",children:Object(Ce.jsx)("span",{className:"nowrap",children:"Total amount"})}),r&&Object(Ce.jsx)(Ie.a,{align:"center",children:"Progress"})]})}),Object(Ce.jsx)(Ee.a,{children:t.map((function(e,t){return Object(Ce.jsx)(jt,{pageIndex:t+1,row:e,token:n,adminControls:a,progressShow:r,opened:!1},e.id)}))})]})}var mt=n(207),xt=n(199),Ot=n(40),gt=n.n(Ot);gt.a.prototype.toJSON=function(){return this.toString()};var vt=function(e,t){try{return t()}catch(n){if(!(n instanceof Error))throw new Error("unreachable");throw n.message="".concat(e,": ").concat(n.message),n}},kt=function(e){var t=e.trim().split("\n");if(t.length<=1)return[];var n=t.map((function(e){return e.split("\t").map((function(e){return e.trim()}))})),a=Object(xt.a)(n),r=a[0];return a.slice(1).map((function(e){return Object.fromEntries(r.map((function(t,n){return[t,e[n]||""]})))}))},wt=function(e){var t=Object(mt.a)(/^P(((((\d+)Y)?((\d+)M)?((\d+)D)?)(T((\d+)H)?((\d+)M)?((\d+)S)?)?)|((\d+)W)?)$/,{year:5,month:7,day:9,hour:12,minute:14,second:16,week:18}),n=e.match(t);if(!n)throw new Error("invalid duration");var a=n&&n.groups||{};return{year:parseInt(a.year,10)||0,month:parseInt(a.month,10)||0,week:parseInt(a.week,10)||0,day:parseInt(a.day,10)||0,hour:parseInt(a.hour,10)||0,minute:parseInt(a.minute,10)||0,second:parseInt(a.second,10)||0}},yt=function(e){var t=e.split(":");if(2!==t.length)throw new Error("expected 2 parts");var n=Object(o.a)(t,2),a=n[0],r=n[1],c=wt(a),s=vt("percentage",(function(){return function(e){if(!e.match(/^\d+$/))throw new Error("invalid cliff percentage");var t=parseInt(e,10);if(t<0||t>100)throw new Error("invalid cliff percentage");return t}(r)}));return{duration:c,percentage:s}},Ct=function(e){var t=e.split("|");if(4!==t.length)throw new Error("invalid human friendly schedule, expected 4 parts");var n=Object(o.a)(t,4),a=n[0],r=n[1],c=n[2],s=n[3],i=vt("start timestamp",(function(){return function(e){if(!e.match(/\d\d\d\d-\d\d-\d\dT\d\d:\d\d:\d\dZ/))throw new Error("invalid timestamp");var t=new Date(e);if(Number.isNaN(t.getTime()))throw new Error("invalid timestamp");return t}(a)})),l=vt("duration",(function(){return wt(r)})),u=vt("cliff",(function(){return yt(c)})),d=vt("release every",(function(){return wt(s)}));return{timestampStart:i,durationTotal:l,durationCliff:u.duration,percentageCliff:u.percentage,releaseEvery:d}},_t=function(e){var t=["account_id","amount","lockup_schedule","vesting_schedule"];if(Object.keys(e).forEach((function(e){if(!t.includes(e))throw new Error("unknown column '".concat(e,"'"))})),!e.account_id)throw new Error("column 'account_id' not found");var n=function(e){var t=!0;if(e.length<2&&(t=!1),e.length>64&&(t=!1),e.match(/^[a-z0-9._-]+$/)||(t=!1),t)return e;throw new Error("invalid near account id")}(e.account_id);if(!e.amount)throw new Error("column 'amount' not found");var a=function(e){if(e.match(/^[0-9]+(\.[0-9]+)?$/))return e;throw new Error("invalid token amount")}(e.amount);if(!e.lockup_schedule)throw new Error("column 'lockup_schedule' not found");var r=vt("lockup schedule",(function(){return Ct(e.lockup_schedule)})),c=null;return e.vesting_schedule&&(c=vt("vesting schedule",(function(){return Ct(e.vesting_schedule)}))),{account_id:n,amount:a,lockup_schedule:r,vesting_schedule:c}},Nt=function(e,t,n){var a=Math.floor(n);return new Date(Date.UTC(e.getUTCFullYear()+t.year*a,e.getUTCMonth()+t.month*a,e.getUTCDate()+(7*t.week+t.day)*a,e.getUTCHours()+t.hour*a,e.getUTCMinutes()+t.minute*a,e.getUTCSeconds()+t.second*a))},St=function(e){return Math.floor(new Date(e).getTime()/1e3)},Tt=function(e,t,n){if(!(n>=0&&n===Math.floor(n)))throw new Error("invalid token decimals");var a=new x.a(10).pow(n),r=e.timestampStart,c=Nt(r,e.durationCliff,1),o=Nt(c,wt("PT1S"),-1),s=Nt(r,e.durationTotal,1),i=new gt.a(new x.a(t).mul(a).round(0,x.a.roundDown).toString()),l=new gt.a(i).muln(e.percentageCliff).divn(100).clone();if(l.gt(i))throw new Error("error: cliffAmount > totalAmount");if(c>s)throw new Error("error: timestampCliff > timestampFinish");if(c<r)throw new Error("error: timestampPreCliff < timestampStart");var u=e.releaseEvery,d=c,p=Nt(c,u,1);if(St(p)<=St(d))throw new Error("invalid releaseEvery, zero duration");if(St(p)-St(d)===1){var b={timestamp:St(r),balance:new gt.a("0").toString()},h={timestamp:St(o),balance:new gt.a("0").toString()},j={timestamp:St(c),balance:l.toString()},f={timestamp:St(s),balance:i.toString()},m=[];return m.unshift(f),j.timestamp<f.timestamp&&m.unshift(j),m.unshift(h),b.timestamp<h.timestamp&&m.unshift(b),m}for(var O=[],g=null,v=0;v<500;v+=1){if((g=Nt(c,u,v))>=s){g=s,O.push(g);break}if(O.push(g),O.length>=500)throw new Error("too many checkpoints for schedule")}var k=i.sub(l).divn(O.length-1),w=O.flatMap((function(e,t){if(1===O.length)return[{timestamp:St(s),balance:i.toString()}];if(0===t)return[{timestamp:St(e),balance:l.toString()}];var n=t===O.length-1?i:l.add(k.muln(t)).toString();return[{timestamp:St(e)-1,balance:l.add(k.muln(t-1)).toString()},{timestamp:St(e),balance:n.toString()}]})),y=[],C={timestamp:St(r),balance:new gt.a("0").toString()},_={timestamp:St(o),balance:new gt.a("0").toString()};return y.unshift(_),C.timestamp<_.timestamp&&y.unshift(C),y.concat(w)},At=function(e,t,n){var a=_t(e),r=Tt(a.lockup_schedule,a.amount,t),c=null;if(a.vesting_schedule){var o=Tt(a.vesting_schedule,a.amount,t);!function(e,t){var n=function(e){return"".concat(w(e)," UTC")};e.forEach((function(e){var a=e.timestamp,r=e.balance,c=Qe(t,a).balance;if(!new m.Big(r).lte(new m.Big(c)))throw new Error("The lockup schedule is ahead of the termination schedule at ".concat(n(a)," (").concat(a,")"))})),t.forEach((function(t){var a=t.timestamp,r=Qe(e,a).balance,c=t.balance;if(!new m.Big(r).lte(new m.Big(c)))throw new Error("The lockup schedule is ahead of the termination schedule at ".concat(n(a)," (").concat(a,")"))}))}(r,o),c={Schedule:o}}return{id:n,account_id:a.account_id,schedule:r,vesting_schedule:c}};function Dt(e){var t=e.token,n=e.amount;return Object(Ce.jsxs)("div",{className:"token-info",title:n,children:[Object(Ce.jsxs)("div",{className:"token-amount",children:[C(n,t.decimals)," ",t.symbol]}),Object(Ce.jsx)(Ye,{url:t.icon||"",size:32})]})}var It=n(409),Et={body:function(e){return function(t){var n=t((function(){return{button:{padding:"0px 4px",textTransform:"none",fontSize:"12px"}}}))();return Object(Ce.jsx)(It.a,{size:"small",className:n.button,onClick:function(t){t.preventDefault(),window.open(e,"_blank")},children:"See transaction"})}},header:function(e){return function(t){var n=t((function(){return{typography:{color:"rgba(255, 89, 78, 1)",fontWeight:700,fontSize:"16px"}}}))();return Object(Ce.jsx)(bt.a,{variant:"subtitle2",className:n.typography,children:e})}}},Ut={autoHideDuration:6e4},Ft=function(e,t){return new x.a(e).div(new x.a(10).pow(t)).round(2,x.a.roundDown)},Mt=function(e,t,n,a){if(t&&"0"!==t){var r=Ft(t,a.decimals);return pt(e,ht.body("Claimed ".concat(r," ").concat(a.symbol)),ht.header("Success"),Ut)}return pt(e,Et.body("".concat(I(n))),Et.header("Claim failed"))},Pt=function(e,t,n,a,r){if(t){var c=parseFloat(y(t.total,9)).toString();return pt(e,ht.body("Successfully paid ".concat(c,"NEAR for ").concat(r,"'s storage of ").concat(a.symbol)),ht.header("Success"),Ut)}return pt(e,Et.body("".concat(I(n))),Et.header("Payment for deposit storage failed"))},Lt=function(e,t,n,a,r){if(t&&r.schedule[r.schedule.length-1].balance===t){var c=Ft(t,a.decimals);return pt(e,ht.body("".concat(r.account_id," now has a lockup of ").concat(c," ").concat(a.symbol)),ht.header("Lockup created"),Ut)}return pt(e,Et.body("".concat(I(n))),Et.header("Lockup creation failed"))},Rt=function(e,t,n,a,r){if(t&&"0"!==t){var c=Ft(t,a.decimals);return pt(e,ht.body("Draft group ".concat(r.draft_group_id," funded with amount ").concat(c," ").concat(a.symbol)),ht.header("Draft group funded"),Ut)}return pt(e,Et.body("".concat(I(n))),Et.header("Draft group fund failed"))},Bt=function(e,t,n,a,r){if(t){var c=Ft(t,a.decimals);return pt(e,ht.body("Lockup #".concat(r," was terminated. Unvested amount: ").concat(c," ").concat(a.symbol)),ht.header("Lockup terminated"),Ut)}return pt(e,Et.body("".concat(I(n))),Et.header("Lockup termination failed"))},Wt=function(e,t){t.positive&&pt(e,ht.body(t.positive),ht.header("Success"),Ut),t.negative&&pt(e,ht.body(t.negative),Et.header("Failure"))},zt=function(e,t){t.positive&&pt(e,ht.body(t.positive),ht.header("Success"),Ut),t.negative&&pt(e,ht.body(t.negative),Et.header("Failure"))};var Gt=function(e){var t=e.token,n=e.adminControls;ye("Import draft group | FT Lockup",{restoreOnUnmount:!0});var a=Object(h.f)(),r=Object(l.useContext)(ge).near,s=Object(l.useState)([]),d=Object(o.a)(s,2),p=d[0],b=d[1],j=Object(l.useState)([]),f=Object(o.a)(j,2),m=f[0],O=f[1],g=Object(l.useState)(!1),v=Object(o.a)(g,2),k=v[0],w=v[1],y=Object(h.g)(),C=Object(u.c)().enqueueSnackbar,_=function(){var e=Object(c.a)(i.a.mark((function e(t,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n();case 3:return a=e.sent,e.abrupt("return",a);case 7:if(e.prev=7,e.t0=e.catch(0),e.t0 instanceof Error){e.next=11;break}throw new Error("unreachable");case 11:throw pt(C,ht.body("".concat(t," failed: ").concat(e.t0.message)),Et.header("Drafts creation failed")),e.t0;case 13:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),N=function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.delegateYield(i.a.mark((function e(){var t,n,o,s,l,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}throw new Error("near is null");case 2:return w(!0),e.next=5,_("Check accounts",Object(c.a)(i.a.mark((function e(){var t,n,a,c,o,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Array.from(new Set(p.filter((function(e){return!(e instanceof Error)})).map((function(e){return e.account_id})))),n=0;case 2:if(!(n<t.length)){e.next=22;break}if((a=t[n]).match(/^[0-9a-f]{64}$/)){e.next=19;break}return e.prev=5,e.next=8,r.near.account(a);case 8:return e.next=10,e.sent.getAccountBalance();case 10:c=e.sent,o=c.total,console.log("".concat(a," balance: ").concat(o)),e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(5),s="Account ID ".concat(a," does not exist"),new Error(s);case 19:n+=1,e.next=2;break;case 22:console.log("all accounts exist"),pt(C,ht.body("Checked account existence: all accounts exist"),ht.header("Success"),Ut);case 24:case"end":return e.stop()}}),e,null,[[5,15]])}))));case 5:return e.next=7,_("Create draft group",Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.api.createDraftGroup();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))));case 7:t=e.sent,pt(C,ht.body("Created draft group id: ".concat(t)),ht.header("Draft group created"),Ut),n=20,o=i.a.mark((function e(a){var o,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=p.slice(a,a+n),s=o.map((function(e){return{draft_group_id:t,lockup_create:e}})),e.next=4,_("Create drafts",Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.api.createDrafts(s);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))));case 4:case"end":return e.stop()}}),e)})),s=0;case 12:if(!(s<p.length)){e.next=17;break}return e.delegateYield(o(s),"t0",14);case 14:s+=n,e.next=12;break;case 17:pt(C,ht.body("Created ".concat(p.length," draft").concat(p.length>1?"s":"",".")),ht.header("Success"),Ut),l=a.pathname.split("/")[1],u="/".concat(l,"/admin/draft_groups/").concat(t),y(u);case 21:case"end":return e.stop()}}),e)}))(),"t0",2);case 2:e.next=7;break;case 4:e.prev=4,e.t1=e.catch(0),w(!1);case 7:case"end":return e.stop()}}),e,null,[[0,4]])})));return function(){return e.apply(this,arguments)}}();return Object(Ce.jsx)("div",{className:"main",children:Object(Ce.jsxs)("div",{className:"container",children:[Object(Ce.jsx)("h1",{children:"Import Draft Group"}),Object(Ce.jsxs)("div",{className:"import-draft-group-wrapper",children:[Object(Ce.jsx)("div",{className:"draft-group-preview-inner",children:Object(Ce.jsxs)("div",{className:"draft-group-preview-info",style:{display:"flex"},children:[Object(Ce.jsxs)("h5",{children:[Object(Ce.jsx)("span",{className:"new-draft-count-text",children:"New draft group with ".concat(p.length," lockup").concat(1!==p.length?"s":"")})," ",m.length>0&&Object(Ce.jsx)("span",{className:"parse-error-label",children:"".concat(m.length," parse error").concat(m.length>1?"s":"")})]}),Object(Ce.jsx)(Dt,{amount:function(e){var t=e.filter((function(e){return!(e instanceof Error)})).map((function(e){return e})).map((function(e){return(t=e).schedule[t.schedule.length-1].balance;var t})),n=new x.a("0");return t.forEach((function(e){n=n.add(new x.a(e))})),n.toString()}(p),token:t})]})}),Object(Ce.jsxs)("p",{className:"standard-text-style",children:["Copy lockups from a spreadsheet editor and paste into the area below. See"," ",Object(Ce.jsx)("a",{href:"".concat("","/lockup_import_example.xlsx"),children:"example and format specifications"}),"."]}),Object(Ce.jsx)(Ne.a,{className:"import-draft-group-textarea",id:"spreadsheet-input",placeholder:"Excel input",minRows:3,maxRows:5,onChange:function(e){try{var n;if(null===r||void 0===r||null===(n=r.currentUser)||void 0===n||!n.signedAccountId)throw new Error("expected present signedAccountId");console.log(t);var a=e.target.value,c=(s=a,i=t.decimals,kt(s).map((function(e,t){try{return At(e,i,t+1)}catch(n){if(n instanceof Error)return n;throw new Error("unreachable")}}))),o=c.filter((function(e){return e instanceof Error})).map((function(e){return e}));b(c),O(o)}catch(l){l instanceof Error&&(b([]),O([l]),console.log(l))}var s,i}})]}),Object(Ce.jsx)(ft,{lockups:p,token:t,adminControls:n,progressShow:!0}),Object(Ce.jsx)(Se.a,{disabled:!(p.length>=1&&0===m.length&&!k),onClick:N,loading:k,type:"button",className:"button",children:"Import"})]})})},Vt=n(403);var Ht=function(e){var t=Object(l.useContext)(ge).near,n=e.draftGroupIndex,a=e.amount;if(!t)throw Error("Cannot access lockup api");return Object(Ce.jsx)("button",{className:"button",type:"button",onClick:function(){t.tokenApi.fundDraftGroup(t.api.getContract().contractId,n,a)},children:"Fund"})},qt=n(394),Yt=n(395),Jt=n(426),Kt=n(427),$t=n(63),Xt=n.n($t),Zt=n(400),Qt=n(406),en=n(405),tn=n(407);var nn=function(e){var t=e.selectedAddress,n=e.setSelectedAddress,a=Object(l.useContext)(ge).near;if(!a)throw Error("Cannot access lockup api");var r=a.currentUser.daos;r.length>0&&(""===t||!r.includes(t))&&n(r[0]);var c=function(e){n(e.target.value)};return r.length>0?Object(Ce.jsxs)("div",{children:[Object(Ce.jsx)(Qt.a,{children:"Select DAO contract address"}),Object(Ce.jsx)(Zt.a,{required:!0,sx:{marginBottom:3,width:1},value:t,onChange:c,children:r.map((function(e){return Object(Ce.jsx)(en.a,{value:e,children:e})}))})]}):Object(Ce.jsx)(tn.a,{required:!0,variant:"outlined",size:"small",sx:{margin:"24px 0",width:"100%"},id:"outlined-helperText",label:"DAO contract address",onChange:c})};var an=function(e){var t=e.proposalDescription,n=e.setProposalDescription;return Object(Ce.jsx)(tn.a,{sx:{width:1},id:"outlined-multiline-static",label:"Proposal description",multiline:!0,minRows:5,onChange:function(e){n(e.target.value)},defaultValue:t})};var rn=function(e){var t=Object(l.useContext)(ge).near,n=e.draftGroupIndex,a=e.amount,r=e.token,c=C(a,r.decimals),s="Fund draft group ".concat(n," with amount ").concat(c,". Draft group link: ").concat(window.location.href.replace(/\/admin/,"")),i=Object(l.useState)(s),u=Object(o.a)(i,2),p=u[0],b=u[1],h=Object(l.useState)(""),j=Object(o.a)(h,2),f=j[0],m=j[1],x=Object(l.useState)(!1),O=Object(o.a)(x,2),g=O[0],v=O[1],k=function(){return v(!1)};if(!t)throw Error("Cannot access lockup api");return Object(Ce.jsxs)(Ce.Fragment,{children:[Object(Ce.jsx)("button",{className:"button",type:"button",onClick:function(){return v(!0)},children:"Fund with DAO"}),Object(Ce.jsx)(qt.a,{open:g,sx:{padding:1,minWidth:1},onClose:k,children:Object(Ce.jsxs)("form",{className:"form-submit",onSubmit:function(){var e,r=xe(p,t.api.getContract().contractId,t.tokenApi.getContract().contractId,a,n,f);null===(e=window.open(r,"_blank"))||void 0===e||e.focus()},children:[Object(Ce.jsxs)(Yt.a,{children:["Fund with DAO",Object(Ce.jsx)(d.a,{"aria-label":"close",onClick:k,sx:{position:"absolute",right:8,top:8},children:Object(Ce.jsx)(Xt.a,{})})]}),Object(Ce.jsxs)(Jt.a,{style:{minWidth:"320px",paddingTop:"1.25em"},children:[Object(Ce.jsx)(nn,{selectedAddress:f,setSelectedAddress:m}),Object(Ce.jsx)(an,{proposalDescription:p,setProposalDescription:b})]}),Object(Ce.jsx)(Kt.a,{sx:{padding:"14px 24px 24px"},children:Object(Ce.jsx)("button",{className:"button fullWidth noMargin",type:"submit",children:"Fund"})})]})})]})};var cn=function(e){var t=e.draftGroupId,n=e.draftIds,a=e.disabled,r=Object(l.useContext)(ge).near,s=Object(u.c)().enqueueSnackbar,d=Object(h.g)(),p=Object(h.f)(),b=Object(l.useState)(!1),j=Object(o.a)(b,2),f=j[0],m=j[1],x=function(){var e=Object(c.a)(i.a.mark((function e(t,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n();case 3:return a=e.sent,e.abrupt("return",a);case 7:throw e.prev=7,e.t0=e.catch(0),pt(s,ht.body("".concat(t," failed with error: '").concat(e.t0,"'")),Et.header("Error")),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}();if(!r)throw Error("Cannot access lockup api");return Object(Ce.jsx)(Se.a,{className:"button compact red",type:"button",variant:"contained",onClick:function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var a,o,l,u,b,h,j,f;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}throw new Error("near is null");case 2:return m(!0),a={},e.prev=4,e.next=7,r.api.discardDraftGroup(t);case 7:a.positive="Discarded draft group ".concat(t),e.next=22;break;case 10:if(e.prev=10,e.t0=e.catch(4),!(e.t0 instanceof Error)){e.next=21;break}if(console.log("ERROR: ".concat(e.t0)),(o=e.t0.message).includes("cannot discard, draft group already discarded")){e.next=19;break}return a.negative="Failed to discard draft group ".concat(t,": ").concat(o),m(!1),e.abrupt("return");case 19:e.next=22;break;case 21:throw new Error("unreachable");case 22:return e.prev=22,zt(s,a),e.finish(22);case 25:l={},e.prev=26,u=100,b=i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.slice(t,t+u),e.next=3,x("Delete drafts",Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.api.deleteDrafts(a);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e)})),h=0;case 30:if(!(h<n.length)){e.next=35;break}return e.delegateYield(b(h),"t1",32);case 32:h+=u,e.next=30;break;case 35:l.positive="Deleted draft group ".concat(t),j=p.pathname.split("/")[1],d("/".concat(j,"/admin/draft_groups")),window.location.reload(),e.next=51;break;case 41:if(e.prev=41,e.t2=e.catch(26),!(e.t2 instanceof Error)){e.next=50;break}console.log("ERROR: ".concat(e.t2)),f=e.t2.message,l.negative="Failed to discard draft group ".concat(t,": ").concat(f),m(!1),e.next=51;break;case 50:throw new Error("unreachable");case 51:return e.prev=51,Wt(s,l),e.finish(51);case 54:case"end":return e.stop()}}),e,null,[[4,10,22,25],[26,41,51,54]])})));return function(){return e.apply(this,arguments)}}();e()},loading:f,disabled:a||f,children:"Delete"})};function on(e){var t=e.token,n=e.adminControls,a=Object(h.f)(),r=Object(u.c)().enqueueSnackbar,s=parseInt(Object(h.h)().draftGroupId||"",10),d=Object(l.useContext)(ge).near,p=Object(l.useState)(null),b=Object(o.a)(p,2),f=b[0],m=b[1],x=Object(l.useState)([]),O=Object(o.a)(x,2),g=O[0],v=O[1],k=Object(l.useState)(!1),w=Object(o.a)(k,2),y=w[0],C=w[1],_=Object(l.useState)("pending"),N=Object(o.a)(_,2),S=N[0],T=N[1];ye("Draft Group ".concat(s," | FT Lockup"),{restoreOnUnmount:!0}),Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t,n,a,r,c,o,l,u,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(T("pending"),console.log("fetchIsConverted: ".concat(s," ","pending")),d){e.next=4;break}return e.abrupt("return");case 4:if(t=new URLSearchParams(window.location.search),n=t.get("transactionHashes")){e.next=10;break}return T("unknown"),console.log("fetchIsConverted: ".concat(s," ","unknown")),e.abrupt("return");case 10:return a=n.split(",")[0],console.log("txHash",a),e.next=14,d.rpcProvider.txStatus(a,"sender.testnet");case 14:r=e.sent,console.log(r),c=r.transaction.actions[0].FunctionCall.method_name,o=r.status.SuccessValue,l=JSON.parse(atob(r.transaction.actions[0].FunctionCall.args)),u=l.msg&&JSON.parse(l.msg),p=u&&u.draft_group_id,console.log(c,o,l,u,p),"ft_transfer_call"===c&&void 0!==p&&p===s?(T("converted"),console.log("fetchIsConverted: ".concat(s," ","converted"))):(T("unknown"),console.log("fetchIsConverted: ".concat(s," ","unknown")));case 24:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[d,s]),Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m(null),console.log("fetchDraftGroup called: ".concat(s," ").concat(S)),d){e.next=4;break}return e.abrupt("return");case 4:if(console.log(S),"pending"!==S){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,d.api.getDraftGroup(s);case 9:t=e.sent,m(t||"not_found");case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[d,s,S]),Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v([]),console.log("fetchDrafts called"),d){e.next=4;break}return e.abrupt("return");case 4:if(f&&"not_found"!==f){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,d.api.getDrafts(f.draft_indices);case 8:t=e.sent,v(t.map((function(e){return Object.assign(e[1].lockup_create,{id:e[0]})})));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[d,f]);var A=Object(h.g)(),D=function(){var e=Object(c.a)(i.a.mark((function e(t,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n();case 3:return a=e.sent,e.abrupt("return",a);case 7:throw e.prev=7,e.t0=e.catch(0),pt(r,ht.body("".concat(t," failed with error: '").concat(e.t0,"'")),Et.header("Error")),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}();if(!f)return null;if("not_found"===f){var I=a.pathname.split("/")[1];return Object(Ce.jsxs)("div",{className:"container",children:[Object(Ce.jsx)("h1",{children:"converted"===S?"Success! Draft group ".concat(s," have been converted!"):"Draft group ".concat(s," have been converted or deleted.")}),Object(Ce.jsxs)("div",{children:[Object(Ce.jsx)("br",{}),"Check"," ",Object(Ce.jsx)(j.b,{to:"/".concat(I).concat(n?"/admin":"","/lockups"),children:"lockups"})," ","to find converted lockups or"," ",Object(Ce.jsx)(j.b,{to:"/".concat(I).concat(n?"/admin":"","/draft_groups"),children:"draft groups"})," ","to see all existing draft groups."]})]})}if(!d)return null;var E=d.currentUser.isAdmin;return Object(Ce.jsxs)("div",{className:"container",children:[Object(Ce.jsxs)("h1",{children:["Draft Group"," ",s]}),Object(Ce.jsxs)("div",{className:"draft-group-preview-wrapper draft-group-preview-inner",children:[Object(Ce.jsxs)("div",{className:"draft-group-preview-info",style:{display:"flex"},children:[Object(Ce.jsxs)("h5",{children:["Draft group ".concat(s)," ",f.discarded&&Object(Ce.jsx)("span",{className:"discarded-marker",children:"DISCARDED"})]}),Object(Ce.jsx)(Dt,{token:t,amount:f.total_amount})]}),!f.funded&&n&&Object(Ce.jsxs)("div",{className:"draft-group-fund-button-wrapper",children:[!f.discarded&&E&&Object(Ce.jsx)(Ht,{draftGroupIndex:s,amount:f.total_amount}),!f.discarded&&Object(Ce.jsx)(rn,{draftGroupIndex:s,amount:f.total_amount,token:t}),Object(Ce.jsx)(cn,{draftGroupId:f.id,draftIds:f.draft_indices,disabled:f.funded})]}),f.funded&&f.draft_indices.length>0&&n&&Object(Ce.jsx)("div",{className:"draft-group-fund-button-wrapper",children:Object(Ce.jsx)(Se.a,{className:"button",type:"button",onClick:function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t,n,o,l,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d){e.next=2;break}throw new Error("near is null");case 2:e.prev=2,C(!0),t=f.draft_indices,n=100,o=i.a.mark((function e(a){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.slice(a,a+n),e.next=3,D("Convert drafts",Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.api.convertDrafts(r);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e)})),l=0;case 8:if(!(l<t.length)){e.next=13;break}return e.delegateYield(o(l),"t0",10);case 10:l+=n,e.next=8;break;case 13:pt(r,ht.body("Converted drafts for draft group ".concat(s)),ht.header("Success"),Ut),u=a.pathname.split("/")[1],A("/".concat(u,"/admin/lockups")),window.location.reload(),e.next=22;break;case 19:e.prev=19,e.t1=e.catch(2),console.log("ERROR: ".concat(e.t1));case 22:return e.prev=22,C(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[2,19,22,25]])})));return function(){return e.apply(this,arguments)}}();e()},loading:y,variant:"contained",color:"success",children:"Convert"})}),f.funded&&0===f.draft_indices.length&&Object(Ce.jsx)("div",{style:{marginTop:20},children:Object(Ce.jsx)(Vt.a,{severity:"success",children:"Draft Group converted"})})]}),(!f.funded||f.draft_indices.length>0)&&Object(Ce.jsx)(ft,{lockups:g,token:t,adminControls:n,progressShow:!0})]})}var sn=n(428);function ln(e){var t=e.open,n=e.setOpen,a=e.draftGroup,r=Object(l.useContext)(ge).near,s=Object(l.useState)(!1),p=Object(o.a)(s,2),b=p[0],j=p[1],f=Object(u.c)().enqueueSnackbar,m=Object(h.g)(),x=Object(h.f)();console.log(a),console.log(b,j);var O=function(){var e=Object(c.a)(i.a.mark((function e(t,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n();case 3:return a=e.sent,e.abrupt("return",a);case 7:throw e.prev=7,e.t0=e.catch(0),pt(f,ht.body("".concat(t," failed with error: '").concat(e.t0,"'")),Et.header("Error")),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),g=function(){var e=Object(c.a)(i.a.mark((function e(){var t,n,o,s,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==r&&void 0!==r&&r.api){e.next=2;break}return e.abrupt("return");case 2:e.prev=2,j(!0),t=a.draft_indices,n=100,o=i.a.mark((function e(a){var o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.slice(a,a+n),e.next=3,O("Convert drafts",Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.api.convertDrafts(o);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e)})),s=0;case 8:if(!(s<t.length)){e.next=13;break}return e.delegateYield(o(s),"t0",10);case 10:s+=n,e.next=8;break;case 13:pt(f,ht.body("Converted drafts for draft group ".concat(a.id)),ht.header("Success"),Ut),l=x.pathname.split("/")[1],m("/".concat(l,"/admin/lockups")),window.location.reload(),e.next=22;break;case 19:e.prev=19,e.t1=e.catch(2),console.log("ERROR: ".concat(e.t1));case 22:return e.prev=22,j(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[2,19,22,25]])})));return function(){return e.apply(this,arguments)}}();console.log(g);var v=function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g();case 2:n(!1);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()},k=function(){n(!1)};if(!r)return null;return Object(Ce.jsx)("div",{children:a&&Object(Ce.jsxs)(qt.a,{open:r.currentUser.signedIn&&t&&a,onClose:k,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(Ce.jsxs)(Yt.a,{id:"alert-dialog-title",children:["Convert draft group?",Object(Ce.jsx)(d.a,{"aria-label":"close",onClick:k,sx:{position:"absolute",right:8,top:8},children:Object(Ce.jsx)(Xt.a,{})})]}),Object(Ce.jsx)(Jt.a,{children:Object(Ce.jsxs)(sn.a,{id:"alert-dialog-description",children:["Draft group"," ",a.id," ","has been funded, but not converted yet. In order to use the lockups from this group, it's necessary to convert them. Convert the draft group now?"]})}),Object(Ce.jsxs)(Kt.a,{children:[Object(Ce.jsx)(It.a,{onClick:k,color:"error",children:"Cancel"}),Object(Ce.jsx)(Se.a,{className:"button",type:"button",onClick:v,loading:b,variant:"contained",color:"success",children:"Convert"})]})]})||null})}var un=Object(l.createContext)({open:!1,setOpen:function(){return null}});function dn(e){var t=e.token,n=e.adminControls;ye("Draft Groups | FT Lockup",{restoreOnUnmount:!0});var a=Object(h.f)(),r=Object(l.useContext)(ge).near,s=Object(l.useState)([]),u=Object(o.a)(s,2),d=u[0],p=u[1];Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p([]),console.log("fetchDraftGroup called"),r){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,r.api.getDraftGroupsAll();case 6:t=e.sent,p(t);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[r]);var b=a.pathname.split("/")[1],f="/".concat(b,"/admin/import_draft_group"),m=d.sort((function(e,t){return e.id-t.id})).reverse().find((function(e){return e.funded})),x=Object(l.useContext)(un);return Object(Ce.jsx)("div",{className:"main",children:Object(Ce.jsxs)("div",{className:"container",children:[Object(Ce.jsx)("h1",{children:"All draft groups"}),Object(Ce.jsx)(ln,{open:n&&x.open,setOpen:x.setOpen,draftGroup:m}),0===d.length&&Object(Ce.jsx)("div",{children:"There are no draft groups yet."}),0!==d.length&&Object(Ce.jsxs)(Te.a,{className:"main-table","aria-label":"collapsible table",children:[Object(Ce.jsx)(Ae.a,{className:"table-head",children:Object(Ce.jsxs)(De.a,{children:[Object(Ce.jsx)(Ie.a,{align:"center",children:"ID"}),Object(Ce.jsx)(Ie.a,{align:"center",children:"Funded"}),Object(Ce.jsx)(Ie.a,{align:"center",children:"Number\xa0of\xa0lockups"}),Object(Ce.jsx)(Ie.a,{align:"right",children:"Total\xa0amount"}),n&&Object(Ce.jsx)(Ie.a,{align:"right",width:"0%",children:"Delete"})]})}),Object(Ce.jsx)(Ee.a,{children:d.map((function(e){return Object(Ce.jsxs)(De.a,{children:[Object(Ce.jsx)(Ie.a,{align:"center",children:Object(Ce.jsx)(j.b,{to:"/".concat(b,"/").concat(n?"admin/":"","draft_groups/").concat(e.id),children:e.id})}),Object(Ce.jsx)(Ie.a,{align:"center",children:e.funded?"Yes":"No"}),Object(Ce.jsx)(Ie.a,{align:"center",children:e.draft_indices.length}),Object(Ce.jsxs)(Ie.a,{align:"right",children:[C(e.total_amount,t.decimals),"\xa0",t.symbol,"\xa0",Object(Ce.jsx)(Ye,{url:t.icon||"",size:32})]}),n&&Object(Ce.jsx)(Ie.a,{align:"right",children:!e.funded&&Object(Ce.jsx)(cn,{draftGroupId:e.id,draftIds:e.draft_indices,disabled:e.funded})})]},e.id)}))})]}),n&&Object(Ce.jsx)(j.b,{to:f,children:Object(Ce.jsx)("button",{className:"button",type:"button",children:"Import Draft Group"})})]})})}var pn=n(200),bn=n.n(pn),hn=n(201),jn=n.n(hn);function fn(e){var t=e.data,n=e.onChange,a=e.accountIdCheck,r=e.accountStatuses,c=[{accountName:""}],s=Object(l.useState)((function(){return t.length>0?t.map((function(e){return{accountName:e}})):c})),i=Object(o.a)(s,2),u=i[0],p=i[1],b=function(){var e=[].concat(Object(Ve.a)(u),[{accountName:""}]);p(e),n(e)},h=function(e,t){var r=t.target,c=r.name,o=r.value,s=Object(Ve.a)(u);s[e][c]=o,p(s),a(o),n(s)};return Object(Ce.jsx)("div",{className:"add-remove-input",children:u.map((function(e,t){var a=e.accountName,c=t;return Object(Ce.jsxs)("div",{className:"form-group",children:[Object(Ce.jsx)("input",{type:"text",onChange:function(e){return h(t,e)},value:a,name:"accountName",className:"form-control"}),0===c?Object(Ce.jsx)(d.a,{"aria-label":"add new item",onClick:b,children:Object(Ce.jsx)(bn.a,{})}):Object(Ce.jsx)(d.a,{"aria-label":"remove item",onClick:function(){return function(e){var t=Object(Ve.a)(u);t.splice(e,1),p(t),n(t)}(c)},children:Object(Ce.jsx)(jn.a,{})}),Object(Ce.jsxs)("div",{className:"form-row_error",children:[a&&"not_found"===r[a]&&Object(Ce.jsx)("span",{className:"red",children:"Account does not exist"}),"pending"===r[a]&&Object(Ce.jsx)("span",{className:"gray",children:"Checking..."})]})]},c)}))})}function mn(){ye("Create Lockup Contract | FT Lockup",{restoreOnUnmount:!0});var e=Object(u.c)().enqueueSnackbar,t=Object(l.useContext)(ge),n=t.near,a=t.signIn,s=t.reSignIn,d=f("new_lockup_contract:shouldClearState",!1),p=Object(o.a)(d,2),b=p[0],h=p[1],m=f("new_lockup_contract:tokenAccountId",""),x=Object(o.a)(m,2),g=x[0],v=x[1],k=f("new_lockup_contract:name",""),w=Object(o.a)(k,2),y=w[0],C=w[1],_=f("new_lockup_contract:lockupOperators",[]),N=Object(o.a)(_,2),S=N[0],T=N[1],A=f("new_lockup_contract:draftOperators",[]),D=Object(o.a)(A,2),I=D[0],E=D[1],U="pending",F="found",M="not_found",P=/^[a-z0-9_-]*$/,L="".concat(y,".").concat(O),R=Object(l.useState)({"":M}),B=Object(o.a)(R,2),W=B[0],z=B[1],G=Object(l.useCallback)(function(){var e=Object(c.a)(i.a.mark((function e(t){var a,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:if(console.log("accountStatuses",W),!W[t]){e.next=5;break}return e.abrupt("return");case 5:if(!t.match(/^[0-9a-f]{64}$/)){e.next=8;break}return z((function(e){return console.log("."),Object(r.a)(Object(r.a)({},e),{},Object(ue.a)({},t,F))})),e.abrupt("return");case 8:return z((function(e){return console.log("... pending"),Object(r.a)(Object(r.a)({},e),{},Object(ue.a)({},t,U))})),e.prev=9,e.next=12,n.near.account(t);case 12:return e.next=14,e.sent.getAccountBalance();case 14:a=e.sent,c=a.total,console.log(c),z((function(e){return console.log("...found"),Object(r.a)(Object(r.a)({},e),{},Object(ue.a)({},t,F))})),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(9),console.log(e.t0),z((function(e){return console.log("...not found"),Object(r.a)(Object(r.a)({},e),{},Object(ue.a)({},t,M))}));case 24:console.log("accountStatuses",W);case 25:case"end":return e.stop()}}),e,null,[[9,20]])})));return function(t){return e.apply(this,arguments)}}(),[W,z,n]),V=function(){var e=Object(c.a)(i.a.mark((function e(t){var a,r,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw new Error("unreachable");case 2:if(!t.match(/^[0-9a-f]{64}$/)){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,n.near.account(t);case 7:return e.next=9,e.sent.getAccountBalance();case 9:a=e.sent,r=a.total,console.log("".concat(t," balance: ").concat(r)),e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(4),c='Account ID "'.concat(t,'" does not exist'),new Error(c);case 18:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(t){return e.apply(this,arguments)}}();if(Object(l.useEffect)((function(){b&&(h(!1),v(""),C(""),T([]),E([]))}),[]),Object(l.useEffect)((function(){for(var e=Array.from(new Set([].concat(Object(Ve.a)(S),Object(Ve.a)(I),[g,L]))),t=0;t<e.length;t+=1){var n=e[t];G(n)}}),[n]),!n)return null;var H=S.filter((function(e){return W[e]===M})),q=I.filter((function(e){return W[e]===M}));return Object(Ce.jsxs)("div",{children:[Object(Ce.jsx)("div",{className:"header",children:Object(Ce.jsx)("div",{className:"container",children:Object(Ce.jsxs)(ke.a,{sx:{display:"flex"},children:[Object(Ce.jsx)(j.b,{className:"logo",to:"/",children:"LOCKUPS"}),Object(Ce.jsx)("div",{className:"nav",children:Object(Ce.jsx)(j.b,{className:"nav-link",to:"/",children:"Home"})})]})})}),Object(Ce.jsxs)("div",{className:"container new-lockup-contract",children:[Object(Ce.jsx)("h2",{children:"Create Lockup Contract for your Fungible Tokens"}),Object(Ce.jsx)("form",{className:"form-submit",onSubmit:function(t){t.preventDefault();var a=function(){var a=Object(c.a)(i.a.mark((function a(){var r,c,o,s,l,u;return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,null!==n&&void 0!==n&&null!==(r=n.currentUser)&&void 0!==r&&r.signedAccountId){a.next=3;break}throw new Error("expected signedAccountId to be present");case 3:c=Array.from(new Set([].concat(Object(Ve.a)(S),Object(Ve.a)(I),[g]))),o=0;case 5:if(!(o<c.length)){a.next=12;break}return s=c[o],a.next=9,V(s);case 9:o+=1,a.next=5;break;case 12:if(l=t.target.elements.lockup_subaccount_id.value,0!==S.length){a.next=15;break}throw new Error("empty lockup operators");case 15:if(0!==g.length){a.next=17;break}throw new Error("empty tokenAccountId");case 17:if(0!==l.length){a.next=19;break}throw new Error("empty lockupSubaccountId");case 19:return a.next=21,n.factoryApi.create(l,g,S,I,"".concat(window.location.origin+window.location.pathname,"#/").concat(l,".").concat(O,"/admin/lockups"));case 21:return u=a.sent,console.log(u),a.abrupt("return",u);case 26:return a.prev=26,a.t0=a.catch(0),console.log(a.t0),pt(e,ht.body(a.t0.toString()),Et.header("Error")),a.abrupt("return",null);case 31:case"end":return a.stop()}}),a,null,[[0,26]])})));return function(){return a.apply(this,arguments)}}();a()},children:Object(Ce.jsxs)("div",{className:"form-wrapper",children:[Object(Ce.jsxs)("p",{children:["On this page you can deploy your own copy of lockup contract. Read more"," ",Object(Ce.jsx)(j.b,{to:"/about",children:"here"}),"."]}),Object(Ce.jsxs)("div",{className:"form-row",children:[Object(Ce.jsx)("div",{className:"form-row_title",children:"Contract creator: "}),Object(Ce.jsx)("div",{className:"form-row_group",children:n.currentUser.signedAccountId?Object(Ce.jsxs)(Ce.Fragment,{children:[Object(Ce.jsx)("strong",{children:n.currentUser.signedAccountId}),Object(Ce.jsx)("button",{className:"button",type:"button",onClick:s,children:"Login as someone else"})]}):Object(Ce.jsx)("button",{className:"button",type:"button",onClick:a,children:"Login"})})]}),Object(Ce.jsxs)("div",{className:"form-row",children:[Object(Ce.jsx)("div",{className:"form-row_title",children:"Lockup operators: "}),Object(Ce.jsxs)("div",{className:"form-row_group",children:[Object(Ce.jsx)(fn,{data:S,onChange:function(e){var t=e.filter((function(e){return e.accountName.length>0})).map((function(e){return e.accountName}));T(t)},accountIdCheck:G,accountStatuses:W}),Object(Ce.jsx)("div",{className:"form-row_error",children:0===S.length&&Object(Ce.jsx)("span",{className:"red",children:"Required"})})]})]}),Object(Ce.jsxs)("div",{className:"form-row",children:[Object(Ce.jsx)("div",{className:"form-row_title",children:"Draft operators: "}),Object(Ce.jsx)("div",{className:"form-row_group",children:Object(Ce.jsx)(fn,{data:I,onChange:function(e){var t=e.filter((function(e){return e.accountName.length>0})).map((function(e){return e.accountName}));E(t)},accountIdCheck:G,accountStatuses:W})})]}),Object(Ce.jsxs)("div",{className:"form-row",children:[Object(Ce.jsx)("div",{className:"form-row_title",children:"Fungible token contract address: "}),Object(Ce.jsxs)("div",{className:"form-row_group",children:[Object(Ce.jsx)("input",{type:"text",id:"token_account_id",value:g,onChange:function(e){var t=e.target.value;v(t),G(t)}}),Object(Ce.jsxs)("div",{className:"form-row_error",children:[g&&W[g]===M&&Object(Ce.jsx)("span",{className:"red",children:"Account does not exist"}),!g&&Object(Ce.jsx)("span",{className:"red",children:"Required"}),W[g]===U&&Object(Ce.jsx)("span",{className:"gray",children:"Checking..."})]})]})]}),Object(Ce.jsxs)("div",{className:"form-row",children:[Object(Ce.jsx)("div",{className:"form-row_title",children:"New Lockup Subaccount Name: "}),Object(Ce.jsxs)("div",{className:"form-row_group",children:[Object(Ce.jsx)("input",{type:"text",id:"lockup_subaccount_id",value:y,onChange:function(e){var t=e.target.value;C(t),G("".concat(t,".").concat(O))}}),Object(Ce.jsxs)("div",{className:"form-row_error",children:[null===y.match(P)&&Object(Ce.jsx)("span",{className:"red",children:"Invalid characters, allowed a-z 0-9, _, -."}),null!==y.match(P)&&Object(Ce.jsxs)(Ce.Fragment,{children:[y&&W[L]===F&&Object(Ce.jsx)("span",{className:"red",children:"Account already exists"}),y&&W[L]===U&&Object(Ce.jsx)("span",{className:"gray",children:"Checking..."}),y&&W[L]===M&&Object(Ce.jsx)("span",{className:"green",children:"Account is available"}),!y&&Object(Ce.jsx)("span",{className:"red",children:"Required"})]})]})]})]}),Object(Ce.jsx)("button",{className:"button submit",type:"submit",disabled:!(n.currentUser.signedAccountId&&W[g]===F&&S.length>0&&0===H.length&&0===q.length&&y&&W[L]===M&&y.match(P)),children:"Deploy Contract"})]})})]})]})}var xn=n(431),On=n(425),gn=n(429),vn=n(396),kn=n(202),wn=n(397);function yn(e){var t=e.value,n=e.setValue,a=e.label,c=e.minTime,o=e.disabled,s=6e4*(new Date).getTimezoneOffset();return Object(Ce.jsx)(wn.a,{disabled:o,label:a,value:t&&new Date(t.getTime()+s),minDateTime:c&&new Date(c.getTime()+s),onChange:function(e){n(e&&new Date(e.getTime()-s))},ampm:!1,renderInput:function(e){return Object(Ce.jsx)(tn.a,Object(r.a)(Object(r.a)({sx:{margin:"0"},margin:"normal",fullWidth:!0,variant:"outlined",size:"small"},e),{},{inputProps:Object(r.a)(Object(r.a)({},e.inputProps),{},{placeholder:"YYYY-MM-DD hh:mm:ss UTC"})}))},inputFormat:"yyyy-MM-dd HH:mm:ss 'UTC'"})}function Cn(e){var t=e.token,n=Object(l.useContext)(ge).near,a=Object(l.useState)(!1),s=Object(o.a)(a,2),u=s[0],p=s[1],b=Object(l.useState)(null),h=Object(o.a)(b,2),j=h[0],f=h[1],m=Object(l.useState)("4_year"),O=Object(o.a)(m,2),g=O[0],v=O[1],k=function(){return p(!1)},w=Object(l.useState)(""),y=Object(o.a)(w,2),C=y[0],T=y[1],A=Object(l.useState)({"":"error"}),D=Object(o.a)(A,2),I=D[0],E=D[1],U=Object(l.useState)(""),F=Object(o.a)(U,2),M=F[0],P=F[1],L=function(){var e=Object(c.a)(i.a.mark((function e(a){var r,c,s,l,u,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw Error("Cannot access token api");case 2:if(n.currentUser.signedAccountId){e.next=4;break}throw new Error("signedAccountId requred to set lockup terminator");case 4:if(j){e.next=6;break}throw Error("Start date not set");case 6:a.preventDefault(),console.log(M),r=(null===n||void 0===n?void 0:n.api.getContract().contractId)||"",c=new x.a(M).mul(new x.a(10).pow(t.decimals)).round(0,x.a.roundDown).toString(),s=function(e,t,n){var a=new gt.a(t),r={"4y_cliff_1y_25":[{timestamp:_(e,0),balance:"0"},{timestamp:_(e,1)-1,balance:"0"},{timestamp:_(e,1),balance:a.divn(4).toString()},{timestamp:_(e,4),balance:a.toString()}]};return{"4_year":[r["4y_cliff_1y_25"],null],"4_year_vested":[r["4y_cliff_1y_25"],r["4y_cliff_1y_25"]]}[n]}(j,c,g),l=Object(o.a)(s,2),u=l[0],d=l[1],n.tokenApi.createLockup(r,c.toString(),C,u,d);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),R=!Number.isNaN(parseFloat(M));return Object(Ce.jsxs)(Ce.Fragment,{children:[Object(Ce.jsx)("button",{className:"button",type:"button",onClick:function(){var e=S(N(new Date),1);console.log("setStartDate",null===e||void 0===e?void 0:e.getTime()),f(e),p(!0)},children:"Create Lockup"}),Object(Ce.jsx)(qt.a,{open:u,sx:{padding:2},maxWidth:"md",onClose:k,children:Object(Ce.jsxs)("form",{className:"form-submit",children:[Object(Ce.jsxs)(Yt.a,{children:["Create Lockup",Object(Ce.jsx)(d.a,{"aria-label":"close",onClick:k,sx:{position:"absolute",right:8,top:8},children:Object(Ce.jsx)(Xt.a,{})})]}),Object(Ce.jsxs)(Jt.a,{sx:{maxWidth:"320px"},children:[Object(Ce.jsx)(On.a,{fullWidth:!0,sx:{height:"70px"},children:Object(Ce.jsx)(tn.a,{margin:"normal",id:"account",label:"Account Id",type:"text",fullWidth:!0,variant:"outlined",size:"small",value:C,onChange:function(e){return function(e){var t=function(){var t=Object(c.a)(i.a.mark((function t(){var a,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:if(console.log("accountStatuses",I),T(e),!I[e]){t.next=6;break}return t.abrupt("return");case 6:if(!e.match(/^[0-9a-f]{64}$/)){t.next=9;break}return E((function(t){return console.log("."),Object(r.a)(Object(r.a)({},t),{},Object(ue.a)({},e,"success"))})),t.abrupt("return");case 9:return E((function(t){return console.log("."),Object(r.a)(Object(r.a)({},t),{},Object(ue.a)({},e,"pending"))})),t.prev=10,t.next=13,n.near.account(e);case 13:return t.next=15,t.sent.getAccountBalance();case 15:a=t.sent,c=a.total,console.log(c),E((function(t){return console.log("."),Object(r.a)(Object(r.a)({},t),{},Object(ue.a)({},e,"success"))})),t.next=25;break;case 21:t.prev=21,t.t0=t.catch(10),console.log(t.t0),E((function(t){return console.log("."),Object(r.a)(Object(r.a)({},t),{},Object(ue.a)({},e,"error"))}));case 25:console.log("accountStatuses",I);case 26:case"end":return t.stop()}}),t,null,[[10,21]])})));return function(){return t.apply(this,arguments)}}();t()}(e.target.value)},error:!!C&&"error"===I[C],helperText:!!C&&"error"===I[C]&&"Account does not exist"})}),Object(Ce.jsx)(On.a,{fullWidth:!0,sx:{marginTop:"20px"},children:Object(Ce.jsx)(tn.a,{margin:"normal",id:"amount",label:"Amount",type:"number",variant:"outlined",size:"small",InputProps:{endAdornment:Object(Ce.jsx)(gn.a,{position:"end",children:t.symbol})},fullWidth:!0,onChange:function(e){var t=function(){var t=Object(c.a)(i.a.mark((function t(){var a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:a=e.target.value,P(a);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()},sx:{margin:0}})}),Object(Ce.jsxs)(On.a,{fullWidth:!0,sx:{marginTop:"30px"},children:[Object(Ce.jsx)(Qt.a,{id:"test-select-label",children:"Schedule"}),Object(Ce.jsxs)(Zt.a,{id:"schedule-select",value:g,label:"Schedule",onChange:function(e){v(e.target.value)},fullWidth:!0,variant:"outlined",size:"small",children:[Object(Ce.jsx)(en.a,{value:"4_year",children:"4 year lockup with 25% cliff in 1 year"}),Object(Ce.jsx)(en.a,{value:"4_year_vested",children:"4 year lockup with 25% cliff in 1 year (VESTED)"})]})]}),Object(Ce.jsx)(On.a,{fullWidth:!0,sx:{marginTop:"30px",marginBottom:0},children:Object(Ce.jsx)(kn.a,{dateAdapter:vn.a,sx:{marginBottom:0},children:Object(Ce.jsx)(yn,{value:j,setValue:function(e){console.log("setStartDate",null===e||void 0===e?void 0:e.getTime()),f(e)},label:"Start date and time",minTime:null,disabled:!1})})})]}),Object(Ce.jsx)(Kt.a,{sx:{padding:"14px 24px 24px"},children:Object(Ce.jsx)("button",{disabled:!j||"error"===I[C]||!R,className:"button fullWidth noMargin",type:"button",onClick:L,children:"Create"})})]})})]})}var _n=n(411),Nn=n(430),Sn=n(401);function Tn(e){var t=e.currentState,n=e.schedule,a=e.vestingSchedule,r=e.handlers,c=e.dialog,s=e.token,i=e.lockup;console.log(n);var u=Object(l.useState)(c.dateTimePicker.currentState.value?"with_timestamp":"now"),p=Object(o.a)(u,2),b=p[0],h=p[1],j=Math.max(n[n.length-1].timestamp,n[n.length-1].timestamp),f=(c.dateTimePicker.currentState.value&&!Number.isNaN(c.dateTimePicker.currentState.value.getTime())?new Date(Math.max(c.dateTimePicker.currentState.value.getTime(),(new Date).getTime())):new Date).getTime()/1e3,m=Qe(a,f).balance,x=tt(i.schedule,m,0),O=function(e,t){if(0===e.length)throw new Error("empty schedule");if(t<=e[0].timestamp)return[e[0],{timestamp:e[0].timestamp+1,balance:e[0].balance}];if(t>=e[e.length-1].timestamp)return e.slice(0,e.length);for(var n=[],a=0;a<e.length-1;a+=1){if(n.push(e[a]),t<e[a+1].timestamp){var r=Xe(e[a],e[a+1],t);return n.push(r),n}if(t===e[a+1].timestamp)return n.push(e[a+1]),n}throw new Error("unreachable")}(a,f),g=Math.max(parseFloat(a[a.length-1].balance),parseFloat(a[a.length-1].balance))/Math.pow(10,s.decimals),v={schedule:x,termination_config:{vesting_schedule:{Schedule:O}},claimed_balance:i.claimed_balance};return Object(Ce.jsx)(qt.a,{open:t.value,sx:{padding:2},maxWidth:"md",onClose:r.onClose,children:Object(Ce.jsxs)("form",{className:"form-submit",children:[Object(Ce.jsxs)(Yt.a,{children:["Terminate Lockup",Object(Ce.jsx)(d.a,{"aria-label":"close",onClick:r.onClose,sx:{position:"absolute",right:8,top:8},children:Object(Ce.jsx)(Xt.a,{})})]}),Object(Ce.jsxs)(Jt.a,{sx:{minWidth:"720px"},children:[Object(Ce.jsx)("div",{style:{height:300},children:Object(Ce.jsx)(qe,{data:rt([v],s.decimals),xMax:j,yMax:g})}),Object(Ce.jsxs)("div",{className:"vested-amount-info",children:[Object(Ce.jsxs)("div",{style:{lineHeight:"30px"},children:["Vested amount","now"===b?" (approximate)":"",":"]}),Object(Ce.jsx)("div",{children:Object(Ce.jsx)(Je,{amount:m,token:s})})]}),Object(Ce.jsx)(On.a,{children:Object(Ce.jsxs)(_n.a,{"aria-labelledby":"demo-radio-buttons-group-label",defaultValue:"female",name:"radio-buttons-group",value:b,onChange:function(e,t){h(t),"with_timestamp"===t?c.dateTimePicker.currentState.setValue(S(N(new Date),1)):c.dateTimePicker.currentState.setValue(null)},children:[Object(Ce.jsx)(Nn.a,{value:"now",control:Object(Ce.jsx)(Sn.a,{}),label:"now"}),Object(Ce.jsx)(Nn.a,{value:"with_timestamp",control:Object(Ce.jsx)(Sn.a,{}),label:"at specific timestamp"})]})}),Object(Ce.jsx)(On.a,{fullWidth:!0,sx:{marginTop:"24px"},children:Object(Ce.jsx)(kn.a,{dateAdapter:vn.a,children:c.dateTimePicker&&Object(Ce.jsx)(yn,{value:c.dateTimePicker.currentState.value,setValue:function(e){c.dateTimePicker.currentState.setValue(e)},label:"Custom termination date and time",minTime:new Date,disabled:!("with_timestamp"===b)})})}),(null===c||void 0===c?void 0:c.daoSelector)&&Object(Ce.jsx)(nn,{selectedAddress:c.daoSelector.currentState.value,setSelectedAddress:c.daoSelector.currentState.setValue}),(null===c||void 0===c?void 0:c.daoProposalDescription)&&Object(Ce.jsx)(an,{proposalDescription:c.daoProposalDescription.currentState.value,setProposalDescription:c.daoProposalDescription.currentState.setValue}),Object(Ce.jsx)("span",{style:{minHeight:"40px"}}),Object(Ce.jsx)("button",{className:"button red fullWidth",style:{marginTop:"20px"},type:"button",onClick:r.onSubmit,disabled:"with_timestamp"===b&&(!c.dateTimePicker.currentState.value||Number.isNaN(c.dateTimePicker.currentState.value.getTime())||c.dateTimePicker.currentState.value.getTime()<=(new Date).getTime()),children:"Terminate"})]})]})})}var An=function(e){var t,n,a,s,u=Object(l.useContext)(ge).near,d=e.adminControls,p=e.lockupIndex,b=e.config,h=e.token,j=e.buttonText,f=e.lockup,m=Object(l.useState)(null),x=Object(o.a)(m,2),O=x[0],g=x[1],v=Object(l.useState)(!1),k=Object(o.a)(v,2),w=k[0],y=k[1];if(!u)throw Error("Cannot access lockup api");if(void 0===p)throw Error("Cannot terminate lockup without lockupIndex");var C=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=O?O.getTime()/1e3:null,e.next=3,u.api.terminate(p,t);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=d&&b;if(null===f||void 0===f||null===(t=f.termination_config)||void 0===t||null===(n=t.vesting_schedule)||void 0===n||!n.Schedule)return console.log("lockup doesnt have termination config"),null;var T={currentState:{value:w,setValue:y},schedule:f.schedule,vestingSchedule:null===f||void 0===f||null===(a=f.termination_config)||void 0===a||null===(s=a.vesting_schedule)||void 0===s?void 0:s.Schedule,handlers:{onClose:function(){return y(!1)},onSubmit:C},dialog:{dateTimePicker:{currentState:{value:O,setValue:function(e){console.log("setDate",null===e||void 0===e?void 0:e.getTime()),g(e)}}}},token:h,lockup:f};return Object(Ce.jsxs)(Ce.Fragment,{children:[_&&Object(Ce.jsx)("button",{className:"button",type:"button",onClick:function(){var e=S(N(new Date),1);return console.log("setDate",null===e||void 0===e?void 0:e.getTime()),g(e),y(!0)},children:j}),w&&Object(Ce.jsx)(Tn,Object(r.a)({},T))]})};var Dn=function(e){var t,n,a,c,s=Object(l.useContext)(ge).near,i=e.accountId,u=e.adminControls,d=e.lockupIndex,p=e.config,b=e.token,j=e.buttonText,f=e.lockup,m=Object(l.useState)(null),x=Object(o.a)(m,2),O=x[0],g=x[1],v=Object(l.useState)(!1),k=Object(o.a)(v,2),w=k[0],y=k[1],C=Object(h.f)().pathname.split("/")[1],_="/".concat(C,"/lockups/").concat(i,"/").concat(d),N=new URL(window.location.href);N.hash="#".concat(_);var S="Terminate lockup ".concat(d,". Lockup link: ").concat(N.toString()),T=Object(l.useState)(S),A=Object(o.a)(T,2),D=A[0],I=A[1],E=Object(l.useState)((null===p||void 0===p?void 0:p.beneficiary_id)||""),U=Object(o.a)(E,2),F=U[0],M=U[1];if(!s)throw Error("Cannot access lockup api");if(void 0===d)throw Error("Cannot terminate lockup without lockupIndex");var P=u&&p;if(null===f||void 0===f||null===(t=f.termination_config)||void 0===t||null===(n=t.vesting_schedule)||void 0===n||!n.Schedule)return console.log("lockup doesnt have termination config"),null;var L={currentState:{value:w,setValue:y},schedule:f.schedule,vestingSchedule:null===f||void 0===f||null===(a=f.termination_config)||void 0===a||null===(c=a.vesting_schedule)||void 0===c?void 0:c.Schedule,handlers:{onClose:function(){return y(!1)},onSubmit:function(){var e,t=Oe(D,s.api.getContract().contractId,d,O?O.getTime()/1e3:null,F);null===(e=window.open(t,"_blank"))||void 0===e||e.focus()}},dialog:{dateTimePicker:{currentState:{value:O,setValue:g}},daoSelector:{currentState:{value:F,setValue:M}},daoProposalDescription:{currentState:{value:D,setValue:I}}},token:b,lockup:f};return Object(Ce.jsxs)("div",{children:[Object(Ce.jsx)("button",{className:"button",disabled:!P,type:"button",onClick:function(){return y(!0)},style:{marginTop:0},children:j}),w&&Object(Ce.jsx)(Tn,Object(r.a)({},L))]})};function In(e){var t,n,a,r,c=e.opened,s=e.adminControls,i=e.row,p=e.token,b=Object(h.f)().pathname.split("/")[1],f=Object(l.useState)(!1),m=Object(o.a)(f,2),x=m[0],O=m[1],g=Object(u.c)().enqueueSnackbar,v=Object(l.useContext)(ge).near,k=Object(l.useState)(Math.floor((new Date).getTime()/1e3)),w=Object(o.a)(k,2),y=w[0],_=(w[1],Object(l.useState)(!1)),N=Object(o.a)(_,2),S=N[0],T=N[1];if(Object(l.useEffect)((function(){O(c),T(c)}),[c]),!v)return null;var A,I,E=v.currentUser.isAdmin,U=null===i||void 0===i||null===(t=i.termination_config)||void 0===t||null===(n=t.vesting_schedule)||void 0===n?void 0:n.Schedule,F=window.location.href.split("/").pop()===i.account_id,M=window.location.href.split("/").pop()===i.id.toString(),P=nt(i,y),L="".concat(C(P.claimed,p.decimals)),R="".concat(C(P.unclaimed,p.decimals)),B="".concat(C(P.vested,p.decimals)),W="".concat(C(P.unvested,p.decimals));null!==(a=i.termination_config)&&void 0!==a&&a.beneficiary_id?A="Unvested amount will return to ".concat(null===(I=i.termination_config)||void 0===I?void 0:I.beneficiary_id):A="This lockup cannot be terminated";var z,G=null===i||void 0===i||null===(r=i.termination_config)||void 0===r?void 0:r.beneficiary_id;return Object(Ce.jsxs)(Ce.Fragment,{children:[Object(Ce.jsxs)(De.a,{className:x?"expanded exp-row ".concat(c?"opened":""):"exp-row",children:[Object(Ce.jsx)(Ie.a,{children:Object(Ce.jsx)(d.a,{"aria-label":"expand row",size:"small",onClick:function(){O(!x),T(!0)},children:x?Object(Ce.jsx)(Pe.a,{}):Object(Ce.jsx)(Re.a,{})})}),Object(Ce.jsxs)(Ie.a,{align:"left",children:[M?i.id:Object(Ce.jsx)(j.b,{to:"/".concat(b).concat(s?"/admin":"","/lockups/").concat(i.account_id,"/").concat(i.id),children:i.id}),!M&&Object(Ce.jsx)(ze.CopyToClipboard,{text:"".concat(window.location.origin,"/#/").concat(b,"/lockups/").concat(i.account_id,"/").concat(i.id),onCopy:function(){return pt(g,null,ht.header("Copied"),{autoHideDuration:1e3})},children:Object(Ce.jsx)(d.a,{"aria-label":"copy link",children:Object(Ce.jsx)(We.a,{})})})]}),Object(Ce.jsxs)(Ie.a,{align:"left",children:[F?D(i.account_id):Object(Ce.jsx)(j.b,{to:"/".concat(b).concat(s?"/admin":"","/lockups/").concat(i.account_id),children:D(i.account_id)}),!F&&Object(Ce.jsx)(ze.CopyToClipboard,{text:"".concat(window.location.origin,"/#/").concat(b,"/lockups/").concat(i.account_id),onCopy:function(){return pt(g,null,ht.header("Copied"),{autoHideDuration:1e3})},children:Object(Ce.jsx)(d.a,{"aria-label":"copy link",children:Object(Ce.jsx)(We.a,{})})})]}),Object(Ce.jsx)(Ie.a,{align:"right",children:Object(Ce.jsx)(Ge,{unixSeconds:i.schedule[0].timestamp})}),Object(Ce.jsx)(Ie.a,{align:"right",children:Object(Ce.jsx)(Ge,{unixSeconds:i.schedule[i.schedule.length-1].timestamp})}),Object(Ce.jsx)(Ie.a,{align:"center",children:U?"Yes":"No"}),Object(Ce.jsx)(Ie.a,{align:"right",children:Object(Ce.jsx)(Je,{amount:i.total_balance,token:p})}),Object(Ce.jsx)(Ie.a,{align:"center",children:Object(Ce.jsx)(Ue.a,{title:Object(Ce.jsxs)("div",{className:"progress-bar__tooltip",children:[Object(Ce.jsxs)("span",{className:"nowrap",children:[Object(Ce.jsx)("i",{className:"claimed",children:"\xa0"}),Object(Ce.jsx)("b",{children:L})," ","Claimed"]}),Object(Ce.jsxs)("span",{className:"nowrap",children:[Object(Ce.jsx)("i",{className:"available",children:"\xa0"}),Object(Ce.jsx)("b",{children:R})," ","Available"]}),Object(Ce.jsxs)("span",{className:"nowrap",children:[Object(Ce.jsx)("i",{className:"vested",children:"\xa0"}),Object(Ce.jsx)("b",{children:B})," ","Vested"]}),Object(Ce.jsxs)("span",{className:"nowrap",children:[Object(Ce.jsx)("i",{className:"unvested",children:"\xa0"}),Object(Ce.jsx)("b",{children:W})," ","Unvested"]})]}),placement:"top",arrow:!0,children:Object(Ce.jsx)("div",{className:"progress-bar-outer",children:Object(Ce.jsxs)("div",{className:"progress-bar",children:[Object(Ce.jsx)("div",{style:{width:"".concat("0"===P.total?"100":parseFloat(P.claimed)/parseFloat(P.total)*100,"%")},className:"claimed",children:"\xa0"}),Object(Ce.jsx)("div",{style:{width:"".concat("0"===P.total?"0":parseFloat(P.unclaimed)/parseFloat(i.total_balance)*100,"%")},className:"available",children:"\xa0"}),Object(Ce.jsx)("div",{style:{width:"".concat("0"===P.total?"0":parseFloat(P.vested)/parseFloat(i.total_balance)*100,"%")},className:"vested",children:"\xa0"}),Object(Ce.jsx)("div",{style:{width:"".concat("0"===P.total?"0":parseFloat(P.unvested)/parseFloat(i.total_balance)*100,"%")},className:"unvested",children:"\xa0"})]})})})})]}),Object(Ce.jsx)(De.a,{className:c?"expanded opened":"expanded",children:Object(Ce.jsx)(Ie.a,{style:{padding:0},colSpan:8,children:Object(Ce.jsx)(Fe.a,{in:x,timeout:"auto",unmountOnExit:!0,children:S&&Object(Ce.jsxs)("div",{className:"lockup-row",children:[Object(Ce.jsx)($e,{schedule:i.schedule,title:"Lockup schedule",token:p}),U&&Object(Ce.jsx)($e,{schedule:U,title:"Vesting schedule",token:p}),Object(Ce.jsxs)("div",{className:"lockup-row-column chart",children:[Object(Ce.jsx)("div",{style:{height:300},children:Object(Ce.jsx)(qe,{data:rt([i],p.decimals)})}),s&&Object(Ce.jsxs)("div",{className:"terminate",children:[Object(Ce.jsx)("span",{className:"fine-print",children:A}),G&&(z=G,s?Object(Ce.jsxs)(Ce.Fragment,{children:[Object(Ce.jsx)("div",{children:E&&Object(Ce.jsx)(An,{token:p,adminControls:s,lockupIndex:i.id,config:i.termination_config,buttonText:z?"Terminate":"No termination config",lockup:i})}),Object(Ce.jsx)("div",{children:Object(Ce.jsx)(Dn,{accountId:i.account_id,token:p,adminControls:s,lockupIndex:i.id,config:i.termination_config,buttonText:z?"Terminate with Dao":"No termination config",lockup:i})})]}):null)]})]})]})})})})]})}function En(e){var t=e.lockups,n=e.token,a=e.adminControls;return Object(Ce.jsxs)(Te.a,{className:"main-table","aria-label":"collapsible table",children:[Object(Ce.jsx)(Ae.a,{className:"table-head",children:Object(Ce.jsxs)(De.a,{children:[Object(Ce.jsx)(Ie.a,{}),Object(Ce.jsx)(Ie.a,{align:"left",children:Object(Ce.jsx)("span",{className:"nowrap",children:"ID"})}),Object(Ce.jsx)(Ie.a,{align:"left",children:Object(Ce.jsx)("span",{className:"nowrap",children:"Account ID"})}),Object(Ce.jsx)(Ie.a,{align:"right",children:Object(Ce.jsx)("span",{className:"nowrap",children:"Start date (UTC)"})}),Object(Ce.jsx)(Ie.a,{align:"right",children:Object(Ce.jsx)("span",{className:"nowrap",children:"End date (UTC)"})}),Object(Ce.jsx)(Ie.a,{align:"center",children:Object(Ce.jsx)("span",{className:"nowrap",children:"Terminatable"})}),Object(Ce.jsx)(Ie.a,{align:"right",children:Object(Ce.jsx)("span",{className:"nowrap",children:"Total amount"})}),Object(Ce.jsx)(Ie.a,{align:"center",children:Object(Ce.jsx)("span",{className:"nowrap",children:"Progress"})})]})}),Object(Ce.jsx)(Ee.a,{children:t.map((function(e){return Object(Ce.jsx)(In,{row:e,token:n,adminControls:a,opened:!1},e.id)}))})]})}function Un(e){var t=e.tokenContractId,n=e.favouriteAccounts,a=e.uniqueUsers,r=e.onSave;console.log("unique users",a);var c=Object(l.useRef)(null),o=function(e){return e.replaceAll(" ","").split(",")},s=function(){var e,n=function(e){return JSON.stringify({favouriteAccounts:e})};if(null===c||void 0===c||null===(e=c.current)||void 0===e||!e.value)return localStorage.setItem(t,n([])),void r([]);var a=o(c.current.value);r(a),localStorage.setItem(t,n(a))};return Object(Ce.jsx)("div",{style:{display:"flex",marginBottom:"2em"},children:Object(Ce.jsx)(tn.a,{inputProps:{sx:{margin:0}},size:"small",sx:{width:1,padding:0,margin:0},id:"outlined-helperText",label:"My accounts",placeholder:"Comma separated list of your near accounts",defaultValue:n.join(", "),inputRef:c,onKeyPress:function(e){return"Enter"===e.key&&s()},onChange:function(e){var t=e.target.value,a=o(t).filter((function(e){return e.match(/.*(\.)(near|testnet)$/)}));n.toString()!==a.toString()&&s()}})})}function Fn(e){var t,n=e.lockups,a=e.token,r=e.adminControls;ye("Lockups | FT Lockup",{restoreOnUnmount:!0});var c=Array.from(new Set(n.map((function(e){return e.account_id})))),s=Object(l.useContext)(ge).near,i=s.currentUser,u=i.signedIn,d=i.isAdmin,p=localStorage.getItem(a.contractId),b=p?null===(t=JSON.parse(p))||void 0===t?void 0:t.favouriteAccounts:[],h=Object(l.useState)(b),f=Object(o.a)(h,2),m=f[0],x=f[1],O=n.filter((function(e){return m.includes(e.account_id)})),g=function(e){return e.length>0?Object(Ce.jsxs)(Ce.Fragment,{children:[Object(Ce.jsx)(qe,{data:rt(e,a.decimals)}),u&&r&&d&&Object(Ce.jsx)(Cn,{token:a}),Object(Ce.jsx)(xn.a,{sx:{boxShadow:"unset",margin:"0 0 20px"},children:Object(Ce.jsx)(En,{lockups:e,token:a,adminControls:r})})]}):Object(Ce.jsxs)("div",{children:[r&&Object(Ce.jsxs)("div",{children:["There are no lockups yet."," ",d?"Create single lockup or create a batch of lockups via":"Create a batch of lockups via"," ",Object(Ce.jsx)(j.b,{to:"/".concat(s.lockupContractId,"/admin/import_draft_group"),children:"draft groups"}),"."]}),u&&r&&d&&Object(Ce.jsx)(Cn,{token:a})]})};return r?Object(Ce.jsx)("div",{className:"main",children:Object(Ce.jsxs)("div",{className:"container",children:[Object(Ce.jsx)("h1",{children:"Lockups"}),g(n)]})}):Object(Ce.jsx)("div",{className:"main",children:Object(Ce.jsxs)("div",{className:"container",children:[Object(Ce.jsx)("h1",{children:"Lockups"}),Object(Ce.jsx)(Un,{tokenContractId:a.contractId,favouriteAccounts:m,uniqueUsers:c,onSave:x}),g(O)]})})}function Mn(e){var t=e.message,n=e.isOpen,a=e.closeFn,r=e.callback;return Object(Ce.jsxs)(qt.a,{open:n,sx:{padding:2},maxWidth:"md",onClose:a,children:[Object(Ce.jsxs)(Yt.a,{children:["Confirmation",Object(Ce.jsx)(d.a,{"aria-label":"close",sx:{position:"absolute",right:8,top:8},onClick:a,children:Object(Ce.jsx)(Xt.a,{})})]}),Object(Ce.jsx)(Jt.a,{sx:{minWidth:"320px"},children:Object(Ce.jsx)("div",{children:t})}),Object(Ce.jsxs)(Kt.a,{sx:{padding:"14px 24px 24px"},children:[Object(Ce.jsx)("button",{className:"button red",type:"button",onClick:a,children:"Cancel"}),Object(Ce.jsx)("button",{className:"button",type:"button",onClick:function(){a(),r()},children:"Confirm"})]})]})}var Pn=function(e){var t=Object(l.useContext)(ge).near,n=e.accountId,a=e.token,r=e.lockups,s=r.reduce((function(e,t){return new m.Big(e).add(t.unclaimed_balance)}),"0").toFixed(),u=Object(l.useState)(!1),d=Object(o.a)(u,2),p=d[0],b=d[1],h=Object(l.useState)((function(){return null})),j=Object(o.a)(h,2),f=j[0],x=j[1];if(!t)throw Error("Cannot access lockup api");if(!n)throw Error("Undefined account cannot claim");var O="\n    Your account doesn't have storage deposit on the token contract. You will be redirected to pay for the storage, after that you will be able to claim your tokens.\n  ".trim();return Object(Ce.jsxs)("div",{className:"claim-wrapper",children:[Object(Ce.jsxs)("div",{className:"claim-preview-info",children:[Object(Ce.jsx)("h5",{children:"Total available"}),Object(Ce.jsx)(Dt,{token:a,amount:s})]}),Object(Ce.jsxs)("div",{className:"claim-button-wrapper",children:[Object(Ce.jsxs)("button",{className:"button",type:"button",onClick:function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var a,c,o,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(t.tokenApi){e.next=4;break}return e.abrupt("return");case 4:if(t.noLoginTokenApi){e.next=6;break}return e.abrupt("return");case 6:if(t.tokenContractId){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,t.tokenApi.storageBalanceOf(n);case 10:if(a=e.sent,!(null!==a&&!0)){e.next=16;break}t.noLoginApi.claimSpecificLockups(n,r.map((function(e){return e.id}))),e.next=23;break;case 16:return e.next=18,t.tokenApi.storageBalanceBounds();case 18:c=e.sent,o=c.max,s=function(){t.noLoginTokenApi.storageDeposit(t.tokenContractId,n,o)},x((function(){return s})),b(!0);case 23:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()},children:["Claim",r.length>1?" all":""]}),Object(Ce.jsx)(Mn,{message:O,isOpen:p,closeFn:function(){return b(!1)},callback:f})]})]})};function Ln(e){var t=e.lockups,n=e.token,a=e.adminControls,r=Object(h.h)(),c=r.userId,o=r.id;ye("Lockup".concat(o?" #".concat(o):"s"," for ").concat(c," | FT Lockup"),{restoreOnUnmount:!0});var s=t.filter((function(e){return o?e.id.toString()===o:e.account_id===c||e.id.toString()===c}));return console.log("user lockups",c,s),Object(Ce.jsx)("div",{className:"main",children:Object(Ce.jsxs)("div",{className:"container",children:[Object(Ce.jsxs)("h1",{children:[s.length>1&&"All"," ","Lockup",o?" ".concat(o):"s"," ","for"," ",c&&D(c,12,12)]}),!a&&Object(Ce.jsx)(Pn,{accountId:c,token:n,lockups:s}),s.length>1&&Object(Ce.jsx)(qe,{data:rt(s,n.decimals)}),Object(Ce.jsx)(xn.a,{sx:{boxShadow:"unset"},children:Object(Ce.jsxs)(Te.a,{className:"main-table","aria-label":"collapsible table",children:[Object(Ce.jsx)(Ae.a,{className:"table-head",children:Object(Ce.jsxs)(De.a,{children:[Object(Ce.jsx)(Ie.a,{}),Object(Ce.jsx)(Ie.a,{align:"left",children:"ID"}),Object(Ce.jsx)(Ie.a,{align:"left",children:"Account ID"}),Object(Ce.jsx)(Ie.a,{align:"right",children:"Start date (UTC)"}),Object(Ce.jsx)(Ie.a,{align:"right",children:"End date (UTC)"}),Object(Ce.jsx)(Ie.a,{align:"right",children:"Terminatable"}),Object(Ce.jsx)(Ie.a,{align:"right",children:"Total amount"}),Object(Ce.jsx)(Ie.a,{align:"center",children:"Progress"})]})}),Object(Ce.jsx)(Ee.a,{children:s.map((function(e){return Object(Ce.jsx)(In,{row:e,token:n,adminControls:a,opened:1===s.length},e.id)}))})]})})]})})}function Rn(e){var t=e.adminControls,n=Object(h.f)(),a=n.pathname.split("/")[1],r=Object(l.useContext)(ge),c=r.near,o=r.signOut;if(Object(l.useEffect)((function(){return console.log(n.pathname),function(){}}),[n]),!c)return null;var s=c.currentUser,i=s.signedIn,u=s.signedAccountId,d=s.isAdmin,p=s.isDraftOperator,b=s.isCouncilMember,f=t&&(d||b||p);return Object(Ce.jsx)("div",{className:"header",children:Object(Ce.jsx)("div",{className:"container",children:Object(Ce.jsxs)(ke.a,{sx:{display:"flex"},children:[Object(Ce.jsx)(j.b,{className:"logo",to:"/",children:"LOCKUPS"}),Object(Ce.jsxs)("div",{className:"nav",children:[Object(Ce.jsx)(j.c,{className:"nav-link",to:"/".concat(a,f?"/admin/lockups":"/lockups"),children:"Lockups"}),Object(Ce.jsx)(j.c,{className:"nav-link",to:"/".concat(a,f?"/admin/draft_groups":"/draft_groups"),children:"Lockup Drafts"})]}),t&&i&&Object(Ce.jsxs)(ke.a,{sx:{marginTop:"23px"},children:[Object(Ce.jsx)("span",{className:"account-name",children:u}),Object(Ce.jsx)("button",{className:"button",type:"button",onClick:o,children:"Log out"})]})]})})})}function Bn(e){var t=e.children;return Object(Ce.jsx)("div",{className:"container",children:Object(Ce.jsxs)("div",{className:"login",children:[Object(Ce.jsx)("h2",{children:"To start using app, please sign in"}),t]})})}var Wn=function(){var e=Object(l.useContext)(ge),t=e.near,n=e.signIn;if(!t)return null;var a=t.currentUser,r=a.signedIn,c=a.isAdmin,o=a.isCouncilMember,s=a.isDraftOperator,i=r&&!(c||o||s),u=r&&(c||o||s);return Object(Ce.jsxs)(Bn,{children:[i&&Object(Ce.jsx)(Vt.a,{severity:"error",children:"You are not admin"}),!r&&Object(Ce.jsx)("button",{className:"button",type:"button",onClick:n,children:"Sign In"}),u&&Object(Ce.jsx)(h.a,{to:"lockups",replace:!0})]})};function zn(){var e=Object(l.useContext)(ge).near;return Object(Ce.jsx)("div",{children:Object(Ce.jsxs)("div",{style:{maxWidth:480,margin:"auto",paddingTop:20,textAlign:"center"},children:[Object(Ce.jsx)("h2",{children:"Please pay for fungible token storage"}),Object(Ce.jsx)("p",{children:"Please pay for the account storage in fungible token contract. This is necessary to allow lockup contract to hold locked fungible token funds. This is a one time payment for the lockup contract. Additionally, all users claiming lockups will have to pay for the storage for their account too."}),Object(Ce.jsx)("button",{className:"button",type:"button",onClick:function(){var t=function(){var t=Object(c.a)(i.a.mark((function t(){var n,a,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(e.tokenApi){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,e.tokenApi.storageBalanceBounds();case 6:return n=t.sent,a=n.max,console.log(a),t.next=11,e.tokenApi.storageDeposit(e.lockupContractId,a);case 11:r=t.sent,console.log(r);case 13:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()},children:"Pay"})]})})}function Gn(e){var t=e.children,n=Object(h.f)(),a=Object(l.useContext)(ge).near;if(!a)return null;var r=a.currentUser,c=r.signedIn,o=r.isAdmin,s=r.isCouncilMember,i=r.isDraftOperator,u=n.pathname,d=n.pathname.split("/")[1],p=n.pathname.split(d)[1].includes("/draft");return c&&(o||s||i)?a.isContractFtStoragePaid?t:Object(Ce.jsx)("div",{className:"container",children:Object(Ce.jsx)(zn,{})}):p?Object(Ce.jsx)(h.a,{to:u.replace(/\/admin/,""),replace:!0}):Object(Ce.jsx)(h.a,{to:"/".concat(d,"/admin"),replace:!0})}var Vn=n(137),Hn=n.n(Vn);function qn(){ye("Welcome | FT Lockup",{restoreOnUnmount:!0});var e=Object(l.useState)("example.factory012.ft-lockup.testnet"),t=Object(o.a)(e,2),n=t[0],a=t[1],r=Object(l.useState)(""),c=Object(o.a)(r,2),s=c[0],i=c[1],u=Object(h.g)(),d=function(){if(!n||n.length<5)i("length should be more than 5 symbols");else if(n.match(/^(([a-z\d]+[-_])*[a-z\d]+\.)*([a-z\d]+[-_])*[a-z\d]+\.(testnet|near)$/)){i("");var e="/".concat(n,"/lockups");u(e),window.location.reload()}else i("address should be for NEAR network")};return Object(Ce.jsxs)("div",{className:"root",children:[Object(Ce.jsx)("div",{className:"header",children:Object(Ce.jsx)("div",{className:"container",children:Object(Ce.jsx)(ke.a,{sx:{display:"flex"},children:Object(Ce.jsx)(j.b,{className:"logo",to:"/",children:"LOCKUPS"})})})}),Object(Ce.jsx)("div",{className:"main",children:Object(Ce.jsxs)("div",{className:"container home",children:[Object(Ce.jsx)("h2",{children:"Manage token vesting on NEAR"}),Object(Ce.jsx)("h5",{children:"Create new lockup contract to be used by startup"}),Object(Ce.jsx)(j.b,{to:"/new_lockup_contract",className:"button link-button",children:"Create Lockup Contract"}),Object(Ce.jsx)("div",{className:"line"}),Object(Ce.jsxs)("div",{className:"search-container",children:[Object(Ce.jsx)(tn.a,{variant:"outlined",value:n,onChange:function(e){a(e.target.value),i("")},onKeyPress:function(e){"Enter"===e.key&&d()},className:"input large",placeholder:"Enter existing Lockup contract address",InputProps:{startAdornment:Object(Ce.jsx)(gn.a,{position:"start",children:Object(Ce.jsx)(Hn.a,{})})},error:!!s,helperText:s}),Object(Ce.jsx)("button",{className:"button",onClick:d,"aria-label":"open",type:"button",children:"Search"})]})]})})]})}function Yn(){ye("Not Found | FT Lockup",{restoreOnUnmount:!0});var e=Object(h.f)(),t=Object(h.g)(),n=e.pathname.split("/")[1],a=Object(l.useState)(n),r=Object(o.a)(a,2),c=r[0],s=r[1],i=Object(l.useState)(""),u=Object(o.a)(i,2),d=u[0],p=u[1],b=function(){if(!c||c.length<5)p("length should be more than 5 symbols");else if(c.match(/^(([a-z\d]+[-_])*[a-z\d]+\.)*([a-z\d]+[-_])*[a-z\d]+\.(testnet|near)$/)){p("");var e="/".concat(c,"/lockups");t(e),window.location.reload()}else p("address should be for NEAR network")};return Object(Ce.jsxs)("div",{className:"root",children:[Object(Ce.jsx)("div",{className:"header",children:Object(Ce.jsx)("div",{className:"container",children:Object(Ce.jsx)(ke.a,{sx:{display:"flex"},children:Object(Ce.jsx)(j.b,{className:"logo",to:"/",children:"LOCKUPS"})})})}),Object(Ce.jsxs)("div",{className:"container not_found",children:[Object(Ce.jsxs)("div",{className:"search-container",children:[Object(Ce.jsx)(tn.a,{variant:"outlined",value:c,onChange:function(e){s(e.target.value),p("")},onKeyPress:function(e){"Enter"===e.key&&b()},className:"input fullWidth",placeholder:"Enter existing Lockup contract address",InputProps:{startAdornment:Object(Ce.jsx)(gn.a,{position:"start",children:Object(Ce.jsx)(Hn.a,{})})},error:!!d,helperText:d}),Object(Ce.jsx)("button",{className:"button large",onClick:b,"aria-label":"open",type:"button",children:"Search"})]}),Object(Ce.jsxs)("div",{className:"block",children:[Object(Ce.jsxs)("p",{className:"right_part",children:["Contract"," ",Object(Ce.jsx)("span",{className:"red",children:n})," ","not found or is not correctly configured."]}),Object(Ce.jsx)("div",{className:"left_part",children:Object(Ce.jsx)(j.b,{to:"/new_lockup_contract",className:"button link-button",children:"Create Lockup Contract"})})]})]})]})}n(316);function Jn(){var e=Object(h.f)(),t=e.pathname,n=e.pathname.includes("admin"),a=e.pathname.replace(/\/*$/,""),r=!["","/terms","/privacy","/about","/new_lockup_contract"].some((function(e){return a===e})),c=t.indexOf("/",1),o=Object(l.useContext)(ge).near;return Object(Ce.jsx)("div",{className:"footer",children:Object(Ce.jsx)("div",{className:"container",children:Object(Ce.jsx)(ke.a,{sx:{display:"flex"},children:Object(Ce.jsxs)("div",{className:"nav",children:[Object(Ce.jsx)(j.b,{className:"nav-link",to:"/about",children:"About"}),Object(Ce.jsx)(j.b,{className:"nav-link",to:"/terms",children:"Terms"}),Object(Ce.jsx)(j.b,{className:"nav-link",to:"/privacy",children:"Privacy"}),r&&function(){if(!o)return null;var e="".concat(t.substring(0,c),"/admin").concat(t.substring(c,t.length));return!t.substring(c,t.length).startsWith("/draft_groups")&&!t.substring(c,t.length).startsWith("/drafts")||o.currentUser.isAdmin||o.currentUser.isCouncilMember||o.currentUser.isDraftOperator||(e="".concat(t.substring(0,c),"/admin")),n?Object(Ce.jsx)(j.b,{className:"nav-link",to:t.replace(/\/admin/,""),children:"User view"}):Object(Ce.jsx)(j.b,{className:"nav-link",to:e,children:"Admin view"})}()]})})})})}function Kn(e){var t=e.token,n=e.adminControls,a=parseInt(Object(h.h)().draftId||"",10),r=Object(l.useContext)(ge).near,s=Object(l.useState)(),u=Object(o.a)(s,2),d=u[0],p=u[1];ye("Draft ".concat(a," | FT Lockup"),{restoreOnUnmount:!0}),Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("fetchDraft called"),r){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,r.api.getDrafts([a]);case 5:t=e.sent,n=t.map((function(e){return Object.assign(e[1].lockup_create,{id:e[0]})})),p(n[0]);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[r,a]),console.log(d);return Object(Ce.jsxs)("div",{className:"container",children:[Object(Ce.jsxs)("h1",{children:["Draft"," ",a]}),d&&Object(Ce.jsxs)(Te.a,{className:"main-table","aria-label":"collapsible table",children:[Object(Ce.jsx)(Ae.a,{className:"table-head",children:Object(Ce.jsxs)(De.a,{children:[Object(Ce.jsx)(Ie.a,{}),Object(Ce.jsx)(Ie.a,{align:"left",children:"ID"}),Object(Ce.jsx)(Ie.a,{align:"left",children:"Account ID"}),Object(Ce.jsx)(Ie.a,{align:"right",children:"Start date (UTC)"}),Object(Ce.jsx)(Ie.a,{align:"right",children:"End date (UTC)"}),Object(Ce.jsx)(Ie.a,{align:"right",children:"Total amount"}),Object(Ce.jsx)(Ie.a,{align:"center",children:"Progress"})]})}),Object(Ce.jsx)(Ee.a,{children:Object(Ce.jsx)(jt,{pageIndex:-1,row:d,token:t,adminControls:n,progressShow:true,opened:!!a})})]})]})}function $n(){return ye("Terms | FT Lockup",{restoreOnUnmount:!0}),Object(Ce.jsxs)("div",{className:"root",children:[Object(Ce.jsx)("div",{className:"header",children:Object(Ce.jsx)("div",{className:"container",children:Object(Ce.jsx)(ke.a,{sx:{display:"flex"},children:Object(Ce.jsx)(j.b,{className:"logo",to:"/",children:"LOCKUPS"})})})}),Object(Ce.jsx)("div",{className:"main",children:Object(Ce.jsx)("div",{className:"container",children:Object(Ce.jsx)("h1",{children:"Terms"})})})]})}function Xn(){return ye("Privacy | FT Lockup",{restoreOnUnmount:!0}),Object(Ce.jsxs)("div",{className:"root",children:[Object(Ce.jsx)("div",{className:"header",children:Object(Ce.jsx)("div",{className:"container",children:Object(Ce.jsx)(ke.a,{sx:{display:"flex"},children:Object(Ce.jsx)(j.b,{className:"logo",to:"/",children:"LOCKUPS"})})})}),Object(Ce.jsx)("div",{className:"main",children:Object(Ce.jsx)("div",{className:"container",children:Object(Ce.jsx)("h1",{children:"Privacy"})})})]})}Jn.defaultProps={showSwitch:!0};var Zn={body:function(e){return function(t){var n=t((function(){return{typography:{fontSize:"12px"}}}))();return Object(Ce.jsx)(bt.a,{className:n.typography,children:e})}},header:function(e){return function(t){var n=t((function(){return{typography:{color:"#E9AF1C",fontWeight:700,fontSize:"16px"}}}))();return Object(Ce.jsx)(bt.a,{variant:"subtitle2",className:n.typography,children:e})}}},Qn=function(e){var t=new URLSearchParams(e).get("transactionHashes");if(!t)return null;var n=t.split(",")[0];return console.log("txHash",n),n},ea=function(){var e=Object(c.a)(i.a.mark((function e(t,n,a){var r,o,s,l,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(){var e=Object(c.a)(i.a.mark((function e(){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.txStatus(a,n);case 3:return r=e.sent,e.abrupt("return",r);case 7:return e.prev=7,e.t0=e.catch(0),console.log("Transaction fetch error",{error:e.t0}),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),e.next=3,r();case 3:if(o=e.sent){e.next=6;break}return e.abrupt("return",null);case 6:return s=o.transaction.actions[0].FunctionCall.method_name,l=JSON.parse(atob(o.transaction.actions[0].FunctionCall.args)),u=o.status.SuccessValue,e.abrupt("return",{origin:o,method:{name:s,args:l,result:u||null}});case 10:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}();function ta(e){var t=e.lockups,n=e.token,a=e.contractId,c=e.near,s=f("new_lockup_contract:shouldClearState",!0),i=Object(o.a)(s,2),u=(i[0],i[1]);return Object(l.useEffect)((function(){u(!0)}),[]),t?Object(Ce.jsxs)(Ce.Fragment,{children:[Object(Ce.jsx)(Rn,{adminControls:!1}),Object(Ce.jsxs)(h.d,{children:[Object(Ce.jsx)(h.b,{path:"/",element:Object(Ce.jsx)(h.a,{replace:!0,to:"lockups"})}),Object(Ce.jsx)(h.b,{path:"/lockups",element:a&&c&&Object(Ce.jsx)(Fn,{lockups:t,token:Object(r.a)(Object(r.a)({},n),{},{contractId:a}),adminControls:!1})}),Object(Ce.jsx)(h.b,{path:"/lockups/:userId",element:Object(Ce.jsx)(Ln,{lockups:t,token:n,adminControls:!1})}),Object(Ce.jsx)(h.b,{path:"/lockups/:userId/:id",element:Object(Ce.jsx)(Ln,{lockups:t,token:n,adminControls:!1})}),Object(Ce.jsx)(h.b,{path:"/draft_groups",element:Object(Ce.jsx)(dn,{token:n,adminControls:!1})}),Object(Ce.jsx)(h.b,{path:"/draft_groups/:draftGroupId",element:Object(Ce.jsx)(on,{token:n,adminControls:!1})}),Object(Ce.jsx)(h.b,{path:"/drafts/:draftId",element:Object(Ce.jsx)(Kn,{token:n,adminControls:!1})}),Object(Ce.jsx)(h.b,{path:"*",element:Object(Ce.jsx)(Yn,{})})]})]}):null}function na(e){var t=e.lockups,n=e.token,a=e.tokenContractId,c=e.near,s=f("new_lockup_contract:shouldClearState",!0),i=Object(o.a)(s,2),u=(i[0],i[1]);if(Object(l.useEffect)((function(){u(!0)}),[]),!t)return null;var d=a&&c;return Object(Ce.jsxs)(Ce.Fragment,{children:[Object(Ce.jsx)(Rn,{adminControls:!0}),Object(Ce.jsxs)(h.d,{children:[Object(Ce.jsx)(h.b,{path:"/",element:Object(Ce.jsx)(Wn,{})}),Object(Ce.jsx)(h.b,{path:"/lockups",element:d&&Object(Ce.jsx)(Gn,{children:Object(Ce.jsx)(Fn,{lockups:t,token:Object(r.a)(Object(r.a)({},n),{},{contractId:a}),adminControls:!0})})}),Object(Ce.jsx)(h.b,{path:"/lockups/:userId",element:Object(Ce.jsx)(Gn,{children:Object(Ce.jsx)(Ln,{lockups:t,token:n,adminControls:!0})})}),Object(Ce.jsx)(h.b,{path:"/lockups/:userId/:id",element:Object(Ce.jsx)(Gn,{children:Object(Ce.jsx)(Ln,{lockups:t,token:n,adminControls:!0})})}),Object(Ce.jsx)(h.b,{path:"/draft_groups",element:Object(Ce.jsx)(Gn,{children:Object(Ce.jsx)(dn,{token:n,adminControls:!0})})}),Object(Ce.jsx)(h.b,{path:"/draft_groups/:draftGroupId",element:Object(Ce.jsx)(Gn,{children:Object(Ce.jsx)(on,{token:n,adminControls:!0})})}),Object(Ce.jsx)(h.b,{path:"/drafts/:draftId",element:Object(Ce.jsx)(Gn,{children:Object(Ce.jsx)(Kn,{token:n,adminControls:!0})})}),Object(Ce.jsx)(h.b,{path:"/import_draft_group",element:Object(Ce.jsx)(Gn,{children:Object(Ce.jsx)(Gt,{token:n,adminControls:!0})})})]})]})}function aa(){var e=Object(u.c)().enqueueSnackbar,t=Object(l.useContext)(ge).near,n=Object(l.useState)({}),a=Object(o.a)(n,2),r=a[0],s=a[1],d=Object(l.useState)(null),p=Object(o.a)(d,2),b=p[0],f=p[1],m=Object(l.useState)({decimals:0,icon:null,name:"",reference:null,reference_hash:null,spec:"",symbol:""}),x=Object(o.a)(m,2),O=x[0],g=x[1];Object(l.useEffect)((function(){if(e&&t&&O&&""!==O.spec){var n=function(){var n=Object(c.a)(i.a.mark((function n(){var a,r,c,o,s,l,u,d;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=Qn(window.location.search)){n.next=3;break}return n.abrupt("return");case 3:return n.next=5,ea(t.rpcProvider,t.api.getContract().contractId,a);case 5:if(r=n.sent,console.log("TX STATUS",r),r){n.next=9;break}return n.abrupt("return");case 9:c=r.method,o=c.name,s=c.result,l=s&&JSON.parse(atob(s)),u=c.args,d=u.msg&&JSON.parse(u.msg),n.t0=o,n.next="claim"===n.t0?18:"storage_deposit"===n.t0?20:"ft_transfer_call"===n.t0?22:"terminate"===n.t0?30:32;break;case 18:return Mt(e,l,a,O),n.abrupt("break",34);case 20:return Pt(e,l,a,O,u.account_id),n.abrupt("break",34);case 22:if(!d.schedule){n.next=25;break}return Lt(e,l,a,O,d),n.abrupt("break",34);case 25:if(!Number.isInteger(d.draft_group_id)){n.next=28;break}return Rt(e,l,a,O,d),n.abrupt("break",34);case 28:return pt(e,Zn.body("Transaction performed, TODO ".concat(a,"!")),Zn.header("Warning")),n.abrupt("break",34);case 30:return Bt(e,l,a,O,u.lockup_index),n.abrupt("break",34);case 32:return pt(e,Zn.body('UNHANDLED Transaction "'.concat(o,'" : ').concat(I(a))),Zn.header("Warning")),n.abrupt("break",34);case 34:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();n()}}),[e,t,O]),Object(l.useEffect)((function(){var e=!0;if(t&&t.lockupContractFound){var n=function(){var n=Object(c.a)(i.a.mark((function n(){var a,r;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.api.loadAllLockups();case 2:return a=n.sent,n.next=5,t.tokenApi.ftMetadata();case 5:if(r=n.sent,e){n.next=8;break}return n.abrupt("return");case 8:g(r),s({lockups:a,name:"name"});case 10:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();t.tokenContractId&&n()}return function(){e=!1}}),[t,null===t||void 0===t?void 0:t.lockupContractFound]),Object(l.useEffect)((function(){return t&&t.tokenApi&&f(t.tokenApi.getContract().contractId),function(){}}),[t]);var v=r.lockups;return Object(Ce.jsxs)(j.a,{children:[Object(Ce.jsxs)(h.d,{children:[Object(Ce.jsx)(h.b,{path:"/",element:Object(Ce.jsx)(qn,{})}),Object(Ce.jsx)(h.b,{path:"/terms",element:Object(Ce.jsx)($n,{})}),Object(Ce.jsx)(h.b,{path:"/privacy",element:Object(Ce.jsx)(Xn,{})}),Object(Ce.jsx)(h.b,{path:"/about",element:Object(Ce.jsx)(_e,{})}),Object(Ce.jsx)(h.b,{path:"/new_lockup_contract/",element:Object(Ce.jsx)(mn,{})}),Object(Ce.jsx)(h.b,{path:"/:cid/*",element:b&&t&&(t.lockupContractFound?Object(Ce.jsx)(ta,{lockups:v,token:O,contractId:b,near:t}):t.lockupContractNone?null:Object(Ce.jsx)(Yn,{}))}),Object(Ce.jsx)(h.b,{path:"/:cid/admin/*",element:b&&t&&(t.lockupContractFound?Object(Ce.jsx)(na,{lockups:v,token:O,tokenContractId:b,near:t}):t.lockupContractNone?null:Object(Ce.jsx)(Yn,{}))}),Object(Ce.jsx)(h.b,{path:"*",element:Object(Ce.jsx)(Yn,{})})]}),Object(Ce.jsx)(Jn,{})]})}n(317);function ra(e){var t=e.snackbarKey,n=Object(u.c)().closeSnackbar;return Object(Ce.jsx)(d.a,{onClick:function(){return n(t)},children:Object(Ce.jsx)(b.a,{style:{color:"white"}})})}function ca(){var e=Object(l.useState)(null),t=Object(o.a)(e,2),n=t[0],a=t[1];Object(l.useEffect)((function(){function e(){return(e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ve();case 2:t=e.sent,a(t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}try{!function(){e.apply(this,arguments)}()}catch(t){console.log(t)}}),[]);var s=Object(l.useMemo)((function(){return{near:n,signIn:function(){var e;null===n||void 0===n||null===(e=n.api)||void 0===e||e.signIn()},reSignIn:function(){n&&(n.api.signOut(),n.api.signIn())},signOut:function(){n&&(n.api.signOut(),a(Object(r.a)(Object(r.a)({},n),{},{currentUser:{signedIn:!1,signedAccountId:null,isAdmin:!1,isDraftOperator:!1,isCouncilMember:!1,daos:[]}})))}}}),[n]),d=Object(l.useState)(!0),p=Object(o.a)(d,2),b=p[0],h=p[1],j=Object(l.useMemo)((function(){return{open:b,setOpen:h}}),[b,h]);return Object(Ce.jsx)(l.StrictMode,{children:Object(Ce.jsx)(un.Provider,{value:j,children:Object(Ce.jsx)(ge.Provider,{value:s,children:Object(Ce.jsx)(u.b,{autoHideDuration:null,action:function(e){return Object(Ce.jsx)(ra,{snackbarKey:e})},onClose:function(){var e=new URL(window.location.href),t=new URLSearchParams(e.search);t.delete("transactionHashes"),e.search=t.toString(),window.history.pushState({},null,e.toString())},maxSnack:5,children:Object(Ce.jsx)(aa,{})})})})})}Object(a.render)(Object(Ce.jsx)(ca,{}),document.getElementById("root"))}},[[318,1,2]]]);
//# sourceMappingURL=main.e9a4b335.chunk.js.map