(this["webpackJsonpft-lockup-contract-frontend"]=this["webpackJsonpft-lockup-contract-frontend"]||[]).push([[0],{241:function(e,t){},251:function(e,t){},302:function(e,t,n){},305:function(e,t,n){},306:function(e,t,n){},307:function(e,t,n){"use strict";n.r(t);var r=n(57),a=n(37),c=n(17),o=n(18),s=n(8),i=n.n(s),l=n(2),u=n(50),d=n(389),b=n(194),p=n.n(b),j=n(22),h=n(25),f=n(20),m=n.n(f),x=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_CONTRACT_NAME:"startup0.factory0.ft-lockup.testnet"}).DEFAULT_CONTRACT_NAME||"ft-lockup.demo008.ft-lockup.testnet",O=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_CONTRACT_NAME:"startup0.factory0.ft-lockup.testnet"}).FACTORY_CONTRACT_NAME||"factory008.ft-lockup.testnet",v=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_CONTRACT_NAME:"startup0.factory0.ft-lockup.testnet"}).FACTORY_CONTRACT_HASH||"DPDYZYHjRqLKZLGpvZYTLKudRrKWmN6a43Pc4MD2t9dg",g=function(){var e=window.location.hash.split("/")[1];return"new_lockup_contract"===e?O:e}();console.log(g);var k=function(){var e=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_CONTRACT_NAME:"startup0.factory0.ft-lockup.testnet"}).REACT_APP_ENVIRONMENT||"development";switch(e){case"production":case"mainnet":return{networkId:"mainnet",nodeUrl:"https://rpc.mainnet.near.org",contractName:g,walletUrl:"https://wallet.near.org",helperUrl:"https://helper.mainnet.near.org",explorerUrl:"https://explorer.mainnet.near.org",factoryContractName:O,factoryContractHash:v};case"development":case"testnet":return{networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",contractName:g,walletUrl:"https://wallet.testnet.near.org",helperUrl:"https://helper.testnet.near.org",explorerUrl:"https://explorer.testnet.near.org",factoryContractName:O,factoryContractHash:v};case"betanet":return{networkId:"betanet",nodeUrl:"https://rpc.betanet.near.org",contractName:g,walletUrl:"https://wallet.betanet.near.org",helperUrl:"https://helper.betanet.near.org",explorerUrl:"https://explorer.betanet.near.org",factoryContractName:O,factoryContractHash:v};case"local":return{explorerUrl:"",helperUrl:"",networkId:"local",nodeUrl:"http://localhost:3030",walletUrl:"http://localhost:4000/wallet",contractName:g,factoryContractName:O,factoryContractHash:v};case"test":case"ci":return{explorerUrl:"",helperUrl:"",walletUrl:"",networkId:"shared-test",nodeUrl:"https://rpc.ci-testnet.near.org",contractName:g,factoryContractName:O,factoryContractHash:v};case"ci-betanet":return{explorerUrl:"",helperUrl:"",walletUrl:"",networkId:"shared-test-staging",nodeUrl:"https://rpc.ci-betanet.near.org",contractName:g,factoryContractName:O,factoryContractHash:v};default:throw Error("Unconfigured environment '".concat(e,"'. Can be configured in src/config.js."))}}(),w=3e14;m.a.DP=40,m.a.PE=40;var _=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2?arguments[2]:void 0;return m.a.DP=40,m()(e||"0").div(Math.pow(10,24)).toFixed(0===t?void 0:t,n)},y=function(e){return new Date(1e3*e).toLocaleDateString("en-US")},C=function(e,t){return m()(e||"0").div(Math.pow(10,t)).toFixed(2)},N=function(e,t){return new Date(new Date(e).setFullYear(e.getFullYear()+t)).getTime()/1e3},S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"dump",t=Object.keys(localStorage).map((function(e){return[e,localStorage.getItem(e)]}));localStorage.setItem(e,JSON.stringify(t))},A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"dump",t=localStorage.getItem(e);if(t){var n=JSON.parse(t);localStorage.clear(),n.forEach((function(e){return localStorage.setItem(e[0],e[1])}))}},I=function(e){return"".concat(k.explorerUrl,"/transactions/").concat(e)},E=n(29),T=n(65),D=n(66),U=["get_draft_group","get_draft_groups_paged","get_drafts","get_lockups_paged","get_token_account_id","get_deposit_whitelist"],P=["create_draft","create_drafts","create_draft_group","convert_draft","convert_drafts","terminate"],F=function(){function e(t){Object(T.a)(this,e),this.near=void 0,this.contract=void 0,this.walletConnection=void 0,this.near=t,this.walletConnection=new E.WalletConnection(t,t.config.contractName),this.contract=new E.Contract(this.walletConnection.account(),this.near.config.contractName,{viewMethods:U,changeMethods:P})}return Object(D.a)(e,[{key:"getDraftGroupsAll",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.get_draft_groups_paged();case 2:return t=e.sent,e.abrupt("return",t.map((function(e){var t=Object(o.a)(e,2),n=t[0],r=t[1];return Object.assign(r,{id:n})})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDraftGroup",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.get_draft_group({index:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDrafts",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.get_drafts({indices:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createDraftGroup",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.create_draft_group();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createDraft",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.create_draft({draft:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createDrafts",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.create_drafts({args:{drafts:t},gas:"200000000000000"});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"convertDraft",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.convert_draft({draft_id:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"convertDrafts",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.convert_drafts({args:{draft_ids:t},gas:"200000000000000"});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"terminate",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.contract.terminate({args:{lockup_index:t,termination_timestamp:n},gas:w,amount:1});case 3:return r=e.sent,e.abrupt("return",r);case 7:throw e.prev=7,e.t0=e.catch(0),console.log(e.t0),Error("Cannot terminate lockup");case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNear",value:function(){return this.near}},{key:"getWalletConnection",value:function(){return this.walletConnection}},{key:"getContract",value:function(){return this.contract}},{key:"getTokenAccountId",value:function(){return this.contract.get_token_account_id()}},{key:"getDepositWhitelist",value:function(){return this.contract.get_deposit_whitelist()}},{key:"loadAllLockups",value:function(){return this.contract.get_lockups_paged().then((function(e){return e.map((function(e){var t=Object(o.a)(e,2),n=t[0],r=t[1];return Object.assign(r,{id:n})}))}))}},{key:"signIn",value:function(){var e="".concat(window.location.href);this.walletConnection.requestSignIn(this.near.config.contractName,void 0,e)}},{key:"signOut",value:function(){this.walletConnection.signOut(),this.near.config.keyStore.clear()}},{key:"get_account_id",value:function(){return this.walletConnection.getAccountId()}},{key:"account",value:function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.near.account(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get_balance",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n,r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.account(t);case 2:return n=e.sent,r=null,e.prev=4,e.next=7,n.getAccountBalance();case 7:a=e.sent,c=a.total,r=parseFloat(E.utils.format.formatNearAmount(c||"0")),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),console.error("Account not exist");case 14:return e.abrupt("return",r);case 15:case"end":return e.stop()}var c}),e,this,[[4,11]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),W=F,M=n(75),L=n(67),R=n(68),H=n(28),B=n.n(H),G=function(){var e=Object(M.a)(B.a.mark((function e(t,n){var r,a,c;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.query({request_type:"view_access_key_list",account_id:n,finality:"optimistic"});case 2:if(a=e.sent,null!==(r=a.keys)&&void 0!==r&&r.length){e.next=5;break}throw Error("None of access keys was founded");case 5:if(null!==(c=a.keys.filter((function(e){var t,n;return"string"===typeof(null===e||void 0===e||null===(t=e.access_key)||void 0===t?void 0:t.permission)&&"FullAccess"===(null===e||void 0===e||null===(n=e.access_key)||void 0===n?void 0:n.permission)})))&&void 0!==c&&c.length){e.next=8;break}throw Error("None of full access keys was founded");case 8:return e.abrupt("return",c[0]);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),K=G,J=[""],V=["claim"],Y=function(){function e(t){Object(L.a)(this,e),this.near=void 0,this.near=t}return Object(R.a)(e,[{key:"claim",value:function(){var e=Object(M.a)(B.a.mark((function e(t){return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S(),e.next=3,this.setWalletAndContractWithAuth(t);case 3:return e.next=5,this.buildContract().claim({},w);case 5:this.near.config.keyStore.clean();case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setWalletAndContractWithAuth",value:function(){var e=Object(M.a)(B.a.mark((function e(t){var n,r,a=arguments;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:this.near.config.contractName,e.next=3,K(this.near.connection.provider,t);case 3:r=e.sent,localStorage.setItem("".concat(n,"_wallet_auth_key"),JSON.stringify({accountId:t,allKeys:[r.public_key]}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"buildContract",value:function(){return new E.Contract(new E.WalletConnection(this.near,this.near.config.contractName).account(),this.near.config.contractName,{viewMethods:J,changeMethods:V})}}]),e}(),q=Y,z=[""],Z=["storage_deposit"],$=function(){function e(t){Object(T.a)(this,e),this.near=void 0,this.near=t}return Object(D.a)(e,[{key:"storageDeposit",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S(),e.next=3,this.setWalletAndContractWithAuth(n);case 3:return e.next=5,this.buildContract(t).storage_deposit({args:{account_id:n},gas:w,amount:r});case 5:this.near.config.keyStore.clean();case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"setWalletAndContractWithAuth",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n,r,a=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:this.near.config.contractName,e.next=3,K(this.near.connection.provider,t);case 3:r=e.sent,localStorage.setItem("".concat(n,"_wallet_auth_key"),JSON.stringify({accountId:t,allKeys:[r.public_key]}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"buildContract",value:function(e){return new E.Contract(new E.WalletConnection(this.near,this.near.config.contractName).account(),e,{viewMethods:z,changeMethods:Z})}}]),e}(),Q=$,X=n(199),ee=["msg"],te=3e14,ne=["ft_metadata","storage_balance_of","storage_balance_bounds"],re=["ft_transfer_call","storage_deposit"],ae=function(){function e(t,n){Object(T.a)(this,e),this.contract=void 0,this.contract=new E.Contract(t.account(),n,{viewMethods:ne,changeMethods:re})}return Object(D.a)(e,[{key:"getContract",value:function(){return this.contract}},{key:"createLockup",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n,r,a,c){var o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ftTransferCall({receiver_id:t,amount:n.toString(),msg:{account_id:r,schedule:a,vesting_schedule:c?{Schedule:c}:null}});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,c){return e.apply(this,arguments)}}()},{key:"fundDraftGroup",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n,r){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ftTransferCall({receiver_id:t,amount:r,msg:{draft_group_id:n}});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"ftTransferCall",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n,r,c,o,s=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:te,r=s.length>2&&void 0!==s[2]?s[2]:1,c=t.msg,o=Object(X.a)(t,ee),e.next=5,this.contract.ft_transfer_call(Object(a.a)({msg:JSON.stringify(c)},o),n,r);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"storageDeposit",value:function(e,t){return this.contract.storage_deposit({args:{account_id:e},gas:te,amount:t})}},{key:"ftMetadata",value:function(){return this.contract.ft_metadata({})}},{key:"storageBalanceOf",value:function(e){return this.contract.storage_balance_of({account_id:e})}},{key:"storageBalanceBounds",value:function(){return this.contract.storage_balance_bounds()}}]),e}(),ce=ae,oe=new m.a(4).mul(new m.a(10).pow(24)).toString(),se=["create"],ie=function(){function e(t,n,r){Object(L.a)(this,e),this.contract=void 0,this.hash=void 0,this.contract=new E.Contract(t.account(),n,{viewMethods:[],changeMethods:se}),this.hash=r}return Object(R.a)(e,[{key:"getContract",value:function(){return this.contract}},{key:"create",value:function(){var e=Object(M.a)(B.a.mark((function e(t,n,r,a){var c,o,s;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c={token_account_id:n,deposit_whitelist:r},o=btoa(JSON.stringify(c)),e.next=4,this.contract.create({args:{name:t,hash:this.hash,access_keys:[],method_name:"new",args:o},callbackUrl:a,gas:3e14,amount:oe});case 4:return s=e.sent,console.log(s),e.abrupt("return",s);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()}]),e}(),le=ie,ue=n(30),de=["call:AddProposal","*:AddProposal"],be=["get_policy"],pe=function(){function e(t,n){Object(T.a)(this,e),this.near=void 0,this.contract=void 0,this.near=t,this.contract=new E.Contract(new E.WalletConnection(this.near,n).account(),n,{viewMethods:be,changeMethods:[]})}return Object(D.a)(e,[{key:"getContract",value:function(){return this.contract}},{key:"getCouncilMembers",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.get_policy();case 2:if(t=e.sent,0!==(n=t.roles.filter((function(e){var t,n;return(null===e||void 0===e||null===(t=e.permissions)||void 0===t?void 0:t.includes(de[0]))||(null===e||void 0===e||null===(n=e.permissions)||void 0===n?void 0:n.includes(de[1]))}))).length){e.next=6;break}return e.abrupt("return",[]);case 6:return r=n.map((function(e){var t;return null===e||void 0===e||null===(t=e.kind)||void 0===t?void 0:t.Group})),e.abrupt("return",r.flat().filter((function(e){return e})));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),je=pe,he=function(e,t,n,r,a,c,o,s,i,l){var u={details:r,smartContractAddress:a,methodName:c,json:o,actionsGas:s,gas:l,deposit:i};return"".concat("https://dev.app.astrodao.com","/dao/").concat(e,"/proposals?action=").concat(t,"&variant=").concat(n,"&params=").concat(JSON.stringify(u))},fe=function(e,t,n,r,a,c,o){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"300";return he(e,"create_proposal","ProposeCustomFunctionCall",t,n,r,a,c,o,s)},me=function(){var e=Object(c.a)(i.a.mark((function e(t,n){var r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new je(t,n),e.next=4,r.getCouncilMembers();case 4:return a=e.sent,e.abrupt("return",Object(ue.a)({},n,a));case 8:return e.prev=8,e.t0=e.catch(0),console.log("isDAO ERROR:",e.t0),e.abrupt("return",void 0);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),xe=Object(l.createContext)(null),Oe=function(){var e=Object(c.a)(i.a.mark((function e(){var t,n,r,c,o,s,l,u,d,b,p,j,h,f,m,x,O,v,g,w,_;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.getItem("dump")&&A(),t=new E.keyStores.BrowserLocalStorageKeyStore,e.next=4,E.connect(Object(a.a)({headers:{},keyStore:t},k));case 4:return n=e.sent,r=new W(n),c=new E.keyStores.InMemoryKeyStore,e.next=9,E.connect(Object(a.a)({headers:{},keyStore:c},k));case 9:return o=e.sent,s=new q(o),l=new Q(o),u=new E.WalletConnection(n,k.contractName),d=u.getAccountId(),b="",p=!1,j=[],h=[],e.prev=18,e.next=21,r.getTokenAccountId();case 21:return b=e.sent,e.next=24,r.getDepositWhitelist();case 24:return j=e.sent,console.log("depositWhitelist",j),p=j.includes(d),console.log("isAdmin",p),e.next=30,Promise.all(j.map((function(e){return me(n,e)})));case 30:f=e.sent.filter((function(e){return!!e})),(null===(m=f.filter((function(e){return Object.values(e).pop().includes(d)})))||void 0===m?void 0:m.length)>0&&(h=m.map((function(e){return Object.keys(e).pop()||""}))),console.log("userDaosCouncils",m),console.log("councilMembers",f),console.log("daos",h),e.next=41;break;case 38:e.prev=38,e.t0=e.catch(18),console.log(e.t0);case 41:return x=new ce(u,b),O=!1,v=window.location.hash.split("/")[1],e.prev=44,e.next=47,x.storageBalanceOf(v);case 47:g=e.sent,O=null!==g&&!0,console.log(O),e.next=55;break;case 52:e.prev=52,e.t1=e.catch(44),console.log(e.t1);case 55:return w=new le(u,k.factoryContractName,k.factoryContractHash),_=new E.providers.JsonRpcProvider(k.nodeUrl),e.abrupt("return",{config:k,api:r,tokenContractId:b,noLoginApi:s,tokenApi:x,factoryApi:w,currentUser:{signedIn:!!d,isAdmin:p,isCouncilMember:h.length>0,signedAccountId:d,daos:h},noLoginTokenApi:l,rpcProvider:_,isContractFtStoragePaid:O,lockupContractId:v});case 58:case"end":return e.stop()}}),e,null,[[18,38],[44,52]])})));return function(){return e.apply(this,arguments)}}(),ve=n(1);function ge(e){var t=e.lockups,n=e.token_account_id;return Object(ve.jsxs)("div",{className:"container",children:[Object(ve.jsx)("h1",{children:"About Page"}),Object(ve.jsx)("pre",{children:"\n          This page should render all useful info about contract,\n          at least ft-lockup name, token name, contract ft balance,\n\n          ft-lockup account id: ".concat(k.contractName,"\n          token account id: ").concat(n,"\n\n          Total number of lockups: ").concat(t.length,"\n        ")})]})}var ke=n(362),we=n(373),_e=n(384),ye=n(385),Ce=n(386),Ne=n(387),Se=n(388),Ae=n(379),Ie=n(383),Ee=n(125),Te=n.n(Ee),De=n(126),Ue=n.n(De);function Pe(e){var t=e.url,n=e.size;return Object(ve.jsx)("img",{style:{height:n,width:n,verticalAlign:"middle"},src:t,alt:"Token Icon"})}function Fe(e){var t=e.schedule,n=e.title,r=e.token;return Object(ve.jsxs)("div",{className:"inner-table_wrapper",children:[Object(ve.jsx)("h5",{children:n}),Object(ve.jsxs)(_e.a,{className:"inner-table",size:"small","aria-label":"purchases",children:[Object(ve.jsx)(ye.a,{children:Object(ve.jsxs)(Ce.a,{children:[Object(ve.jsx)(Ne.a,{children:"DATE"}),Object(ve.jsx)(Ne.a,{align:"right",children:"AMOUNT"})]})}),Object(ve.jsx)(Se.a,{children:t.map((function(e){return Object(ve.jsxs)(Ce.a,{children:[Object(ve.jsx)(Ne.a,{component:"th",scope:"row",children:y(e.timestamp)}),Object(ve.jsxs)(Ne.a,{align:"right",children:[C(e.balance,r.decimals),"\xa0",r.symbol,"\xa0",Object(ve.jsx)(Pe,{url:r.icon||"",size:32})]})]},e.timestamp)}))})]})]})}function We(e){var t,n=Object(j.f)(),r=Object(l.useState)(!1),a=Object(o.a)(r,2),c=a[0],s=a[1],i=e.row,u=e.token,b=Object(l.useContext)(xe).near;if(!b)return null;var p=b.currentUser.signedIn,f=null===i||void 0===i||null===(t=i.vesting_schedule)||void 0===t?void 0:t.Schedule,m=n.pathname.split("/")[1];return Object(ve.jsxs)(ve.Fragment,{children:[Object(ve.jsxs)(Ce.a,{className:c?"expanded exp-row":"exp-row",sx:{"& > *":{borderBottom:"unset"}},children:[Object(ve.jsx)(Ne.a,{children:Object(ve.jsx)(d.a,{"aria-label":"expand row",size:"small",onClick:function(){return s(!c)},children:c?Object(ve.jsx)(Te.a,{}):Object(ve.jsx)(Ue.a,{})})}),Object(ve.jsx)(Ne.a,{align:"left",children:i.id}),Object(ve.jsx)(Ne.a,{align:"left",children:Object(ve.jsx)(h.b,{to:p?"".concat(m,"/admin/lockups/").concat(i.account_id):"".concat(m,"/lockups/").concat(i.account_id),children:i.account_id})}),Object(ve.jsx)(Ne.a,{align:"right",children:y(i.schedule[0].timestamp)}),Object(ve.jsx)(Ne.a,{align:"right",children:y(i.schedule[i.schedule.length-1].timestamp)}),Object(ve.jsxs)(Ne.a,{align:"right",children:[C(i.total_balance,u.decimals),"\xa0",u.symbol,"\xa0",Object(ve.jsx)(Pe,{url:u.icon||"",size:32})]}),Object(ve.jsx)(Ne.a,{align:"center",children:Object(ve.jsx)(Ae.a,{title:"Add",arrow:!0,children:Object(ve.jsxs)("div",{className:"progress-bar",children:[Object(ve.jsx)("div",{style:{width:"".concat(i.claimed_balance/i.total_balance*100,"%")},className:"claimed"}),Object(ve.jsx)("div",{style:{width:"".concat(i.unclaimed_balance/i.total_balance*100,"%")},className:"available"}),Object(ve.jsx)("div",{style:{width:"".concat((i.total_balance-i.claimed_balance-i.unclaimed_balance)/i.total_balance*100,"%")},className:"vested"}),Object(ve.jsx)("div",{style:{width:"".concat(100*(i.total_balance-i.total_balance),"%")},className:"unvested",children:"\xa0"})]})})})]}),Object(ve.jsx)(Ce.a,{sx:{background:"#F4FAFF"},children:Object(ve.jsx)(Ne.a,{style:{padding:0},colSpan:8,children:Object(ve.jsx)(Ie.a,{in:c,timeout:"auto",unmountOnExit:!0,children:Object(ve.jsx)("div",{className:"lockup-row",children:Object(ve.jsxs)("div",{style:{display:"flex",gap:20},children:[Object(ve.jsx)(Fe,{schedule:i.schedule,title:"Lockup schedule",token:u}),f&&Object(ve.jsx)(Fe,{schedule:f,title:"Vesting schedule",token:u})]})})})})})]})}function Me(e){var t=e.lockups,n=e.token;return Object(ve.jsxs)(_e.a,{className:"main-table","aria-label":"collapsible table",children:[Object(ve.jsx)(ye.a,{className:"table-head",children:Object(ve.jsxs)(Ce.a,{children:[Object(ve.jsx)(Ne.a,{}),Object(ve.jsx)(Ne.a,{align:"left",children:"ID"}),Object(ve.jsx)(Ne.a,{align:"left",children:"Account ID"}),Object(ve.jsx)(Ne.a,{align:"right",children:"Start\xa0date"}),Object(ve.jsx)(Ne.a,{align:"right",children:"End\xa0date"}),Object(ve.jsx)(Ne.a,{align:"right",children:"Total\xa0amount"}),Object(ve.jsx)(Ne.a,{align:"center",children:"Progress"})]})}),Object(ve.jsx)(Se.a,{children:t.map((function(e){return Object(ve.jsx)(We,{row:e,token:n},e.id)}))})]})}var Le=n(198),Re=n(190),He=n(35),Be=n.n(He);Be.a.prototype.toJSON=function(){return this.toString()};var Ge=function(e){var t=e.trim().split("\n");if(t.length<=1)return[];var n=t.map((function(e){return e.split("\t").map((function(e){return e.trim()}))})),r=Object(Re.a)(n),a=r[0];return r.slice(1).map((function(e){return Object.fromEntries(a.map((function(t,n){return[t,e[n]||""]})))}))},Ke=function(e){var t=Object(Le.a)(/^P(((((\d+)Y)?((\d+)M)?((\d+)D)?)(T((\d+)H)?((\d+)M)?((\d+)S)?)?)|((\d+)W)?)$/,{year:5,month:7,day:9,hour:12,minute:14,second:16,week:18}),n=e.match(t);if(!n)throw new Error("invalid duration");var r=n&&n.groups||{};return{year:parseInt(r.year,10)||0,month:parseInt(r.month,10)||0,week:parseInt(r.week,10)||0,day:parseInt(r.day,10)||0,hour:parseInt(r.hour,10)||0,minute:parseInt(r.minute,10)||0,second:parseInt(r.second,10)||0}},Je=function(e){var t=e.split("|");if(4!==t.length)throw new Error("invalid human friendly schedule, expected 4 parts");var n=Object(o.a)(t,4),r=n[0],a=n[1],c=n[2],s=n[3],i=function(e){if(!e.match(/\d\d\d\d-\d\d-\d\dT\d\d:\d\d:\d\dZ/))throw new Error("invalid timestamp");var t=new Date(e);if(Number.isNaN(t.getTime()))throw new Error("invalid timestamp");return t}(r),l=Ke(a),u=function(e){var t=e.split(":");if(2!==t.length)throw new Error("expected 2 parts");var n=Object(o.a)(t,2),r=n[0],a=n[1],c=Ke(r),s=parseInt(a,10);if(s<0||s>100)throw new Error("invalid cliff percentage");return{duration:c,percentage:s}}(c),d=Ke(s);return{timestampStart:i,durationTotal:l,durationCliff:u.duration,percentageCliff:u.percentage,releaseEvery:d}},Ve=function(e){return{account_id:function(e){var t=!0;if(e.length<2&&(t=!1),e.length>64&&(t=!1),e.match(/^[a-z0-9._-]+$/)||(t=!1),t)return e;throw new Error("invalid near account id")}(e.account_id),amount:function(e){if(e.match(/^[0-9]+(\.[0-9]+)?$/))return e;throw new Error("invalid token amount")}(e.amount),lockup_schedule:Je(e.lockup_schedule),vesting_schedule:""===e.vesting_schedule?null:Je(e.vesting_schedule)}},Ye=function(e,t,n){var r=Math.floor(n);return new Date(Date.UTC(e.getUTCFullYear()+t.year*r,e.getUTCMonth()+t.month*r,e.getUTCDate()+(7*t.week+t.day)*r,e.getUTCHours()+t.hour*r,e.getUTCMinutes()+t.minute*r,e.getUTCSeconds()+t.second*r))},qe=function(e){return Math.floor(new Date(e).getTime()/1e3)},ze=function(e,t,n){if(!(n>=0&&n===Math.floor(n)))throw new Error("invalid token decimals");var r=new m.a(10).pow(n),a=e.timestampStart,c=Ye(a,e.durationCliff,1),o=Ye(c,Ke("PT1S"),-1),s=Ye(a,e.durationTotal,1),i=new Be.a(new m.a(t).mul(r).round(0,m.a.roundDown).toString()),l=new Be.a(i).muln(e.percentageCliff).divn(100).clone();if(l.gt(i))throw new Error("error: cliffAmount > totalAmount");if(c>s)throw new Error("error: timestampCliff > timestampFinish");if(c<a)throw new Error("error: timestampPreCliff < timestampStart");var u=e.releaseEvery,d=c,b=Ye(c,u,1);if(qe(b)<=qe(d))throw new Error("invalid releaseEvery, zero duration");if(qe(b)-qe(d)===1){var p={timestamp:qe(a),balance:new Be.a("0").toString()},j={timestamp:qe(o),balance:new Be.a("0").toString()},h={timestamp:qe(c),balance:l.toString()},f={timestamp:qe(s),balance:i.toString()},x=[];return x.unshift(f),h.timestamp<f.timestamp&&x.unshift(h),x.unshift(j),p.timestamp<j.timestamp&&x.unshift(p),x}for(var O=[],v=c;;){if(v>=s){v=s,O.push(v);break}if(O.push(v),v=Ye(v,u,1),O.length>=100)throw new Error("too many checkpoints for schedule")}var g=i.sub(l).divn(O.length-1),k=O.flatMap((function(e,t){if(1===O.length)return[{timestamp:qe(s),balance:i.toString()}];if(0===t)return[{timestamp:qe(e),balance:l.toString()}];var n=t===O.length-1?i:l.add(g.muln(t)).toString();return[{timestamp:qe(e)-1,balance:l.add(g.muln(t-1)).toString()},{timestamp:qe(e),balance:n.toString()}]})),w=[],_={timestamp:qe(a),balance:new Be.a("0").toString()},y={timestamp:qe(o),balance:new Be.a("0").toString()};return w.unshift(y),_.timestamp<y.timestamp&&w.unshift(_),w.concat(k)},Ze=function(e,t){return Ge(e).map((function(e){return function(e,t){var n=Ve(e),r=null;return n.vesting_schedule&&(r={Schedule:ze(n.vesting_schedule,n.amount,t)}),{account_id:n.account_id,schedule:ze(n.lockup_schedule,n.amount,t),vesting_schedule:r}}(e,t)}))};var $e=function(e){var t=e.token,n=Object(j.f)(),r=Object(l.useContext)(xe).near,a=Object(l.useState)([]),s=Object(o.a)(a,2),d=s[0],b=s[1],p=Object(l.useState)(!1),h=Object(o.a)(p,2),f=h[0],m=h[1],x=Object(j.g)(),O=Object(u.b)().enqueueSnackbar,v=function(){var e=Object(c.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n();case 3:return r=e.sent,e.abrupt("return",r);case 7:throw e.prev=7,e.t0=e.catch(0),O("".concat(t," failed with error: '").concat(e.t0,"'"),{variant:"error"}),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),g=function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.delegateYield(i.a.mark((function e(){var t,a,o,s,l,u,b,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}throw new Error("near is null");case 2:return m(!0),e.next=5,v("Create draft group",Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.api.createDraftGroup();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))));case 5:t=e.sent,a="Created draft group id: ".concat(t),O(a,{variant:"success"}),o=100,s=i.a.mark((function e(n){var a,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=d.slice(n,n+o),s=a.map((function(e){return{draft_group_id:t,lockup_create:e}})),e.next=4,v("Create drafts",Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.api.createDrafts(s);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))));case 4:case"end":return e.stop()}}),e)})),l=0;case 11:if(!(l<d.length)){e.next=16;break}return e.delegateYield(s(l),"t0",13);case 13:l+=o,e.next=11;break;case 16:u="Created ".concat(d.length," draft").concat(d.length>1?"s":"","."),O(u,{variant:"success"}),b=n.pathname.split("/")[1],p="/".concat(b,"/admin/draft_groups/").concat(t),x(p);case 21:case"end":return e.stop()}}),e)}))(),"t0",2);case 2:e.next=7;break;case 4:e.prev=4,e.t1=e.catch(0),m(!1);case 7:case"end":return e.stop()}}),e,null,[[0,4]])})));return function(){return e.apply(this,arguments)}}();return Object(ve.jsxs)("div",{className:"container",children:[Object(ve.jsx)("h3",{children:"Import Draft Group"}),Object(ve.jsxs)("div",{children:["Copy lockups from a spreadsheet editor and paste into the area below. See"," ",Object(ve.jsx)("a",{href:"".concat("","/lockup_import_example.xlsx"),children:"example and format specifications"}),"."]}),Object(ve.jsx)("div",{children:Object(ve.jsx)(ke.a,{style:{width:"100%",marginTop:20},id:"spreadsheet-input",placeholder:"Excel input",maxRows:5,onChange:function(e){try{var n;if(null===r||void 0===r||null===(n=r.currentUser)||void 0===n||!n.signedAccountId)throw new Error("expected present signedAccountId");console.log(t);var a=e.target.value,c=Ze(a,t.decimals);b(c)}catch(o){o instanceof Error&&console.log(o)}}})}),Object(ve.jsx)(Me,{lockups:d,token:t}),Object(ve.jsx)("br",{}),Object(ve.jsx)("div",{children:Object(ve.jsx)(we.a,{disabled:!(d.length>=1&&!f),loading:f,onClick:g,color:"success",type:"button",variant:"contained",children:"Import"})})]})},Qe=n(374);function Xe(e){var t=e.token,n=e.amount;return Object(ve.jsxs)("div",{className:"balance-info-block",style:{display:"flex"},children:[Object(ve.jsxs)("div",{style:{flex:1,alignContent:"center"},className:"amount-info",children:[Object(ve.jsx)("div",{className:"token-symbol",children:t.symbol}),Object(ve.jsx)("div",{className:"token-amount",children:n})]}),Object(ve.jsx)("div",{style:{flex:1},children:Object(ve.jsx)(Pe,{url:t.icon||"",size:64})})]})}var et=function(e){var t=Object(l.useContext)(xe).near,n=e.draftGroupIndex,r=e.amount;if(!t)throw Error("Cannot access lockup api");if(void 0===n)throw Error("Cannot fund draft group without index");if(void 0===r)throw Error("Cannot fund draft group without specified amount");return Object(ve.jsx)("button",{className:"button fullWidth",type:"button",onClick:function(){t.tokenApi.fundDraftGroup(t.api.getContract().contractId,n,r)},children:"Fund"})},tt=n(377),nt=n(376),rt=n(378),at=n(366),ct=n(367),ot=n(393),st=n(394),it=n(372),lt=n(71),ut=n.n(lt);var dt=function(e){var t=Object(l.useContext)(xe).near,n=e.draftGroupIndex,r=e.amount,a="Fund draft group ".concat(n," with amount ").concat(null===r||void 0===r?void 0:r.label,". Draft group link: ").concat(window.location.href),c=Object(l.useState)(a),s=Object(o.a)(c,2),i=s[0],u=s[1],b=Object(l.useState)(!1),p=Object(o.a)(b,2),j=p[0],h=p[1],f=function(){return h(!1)};if(!t)throw Error("Cannot access lockup api");if(void 0===n)throw Error("Cannot fund draft group without index");if(void 0===(null===r||void 0===r?void 0:r.value))throw Error("Cannot fund draft group without specified amount");var m,x=t.currentUser.daos,O=x.length>0&&x[0]||"",v=Object(l.useState)(O),g=Object(o.a)(v,2),k=g[0],w=g[1],_=function(e){w(e.target.value)};return m=x.length>0?Object(ve.jsxs)("div",{children:[Object(ve.jsx)(tt.a,{children:"Select DAO contract address"}),Object(ve.jsx)(it.a,{required:!0,sx:{marginBottom:3,width:1},value:k,onChange:_,children:x.map((function(e){return Object(ve.jsx)(nt.a,{value:e,children:e})}))})]}):Object(ve.jsx)(rt.a,{required:!0,sx:{marginBottom:3,width:1},id:"outlined-helperText",label:"DAO contract address",onChange:_}),Object(ve.jsxs)("div",{children:[Object(ve.jsx)("button",{className:"button fullWidth",type:"button",onClick:function(){return h(!0)},children:"Fund with DAO"}),Object(ve.jsx)(at.a,{open:j,sx:{padding:1,minWidth:1},onClose:f,children:Object(ve.jsxs)("form",{className:"form-submit",onSubmit:function(){var e;null===(e=window.open(function(){var e=encodeURIComponent(i),a=t.tokenApi.getContract().contractId,c={receiver_id:t.api.getContract().contractId,amount:r.value,msg:JSON.stringify({draft_group_id:n})};return fe(k,e,a,"ft_transfer_call",c,"100","0.000000000000000000000001")}(),"_blank"))||void 0===e||e.focus()},children:[Object(ve.jsxs)(ct.a,{children:["Fund with DAO",Object(ve.jsx)(d.a,{"aria-label":"close",onClick:f,sx:{position:"absolute",right:8,top:8},children:Object(ve.jsx)(ut.a,{})})]}),Object(ve.jsxs)(ot.a,{style:{paddingTop:"1.25em"},children:[m,Object(ve.jsx)(rt.a,{sx:{width:1},id:"outlined-multiline-static",label:"Proposal description",multiline:!0,minRows:5,onChange:function(e){u(e.target.value)},defaultValue:i})]}),Object(ve.jsx)(st.a,{sx:{padding:"14px 24px 24px"},children:Object(ve.jsx)("button",{className:"button fullWidth noMargin",type:"submit",children:"Fund"})})]})})]})};function bt(e){var t,n=e.token,r=Object(j.f)(),a=Object(u.b)().enqueueSnackbar,s=parseInt(Object(j.h)().draftGroupId||"",10),d=Object(l.useContext)(xe).near,b=Object(l.useState)(null),p=Object(o.a)(b,2),h=p[0],f=p[1],m=Object(l.useState)([]),x=Object(o.a)(m,2),O=x[0],v=x[1],g=Object(l.useState)(!1),k=Object(o.a)(g,2),w=k[0],_=k[1];console.log(n),console.log(h),console.log(f),Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f(null),console.log("fetchDraftGroup called"),d){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,d.api.getDraftGroup(s);case 6:t=e.sent,console.log(t),f(t);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[d,s]),Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v([]),console.log("fetchDrafts called"),d){e.next=4;break}return e.abrupt("return");case 4:if(h){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,d.api.getDrafts(h.draft_indices);case 8:t=e.sent,console.log(t),v(t.map((function(e){return Object.assign(e[1].lockup_create,{id:e[0]})})));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[d,h]);var y=Object(j.g)(),N=function(){var e=Object(c.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n();case 3:return r=e.sent,e.abrupt("return",r);case 7:throw e.prev=7,e.t0=e.catch(0),a("".concat(t," failed with error: '").concat(e.t0,"'"),{variant:"error"}),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}();if(!h)return null;var S={value:h.total_amount,label:C(h.total_amount,n.decimals)||""};return Object(ve.jsxs)("div",{className:"container",children:[Object(ve.jsxs)("div",{className:"draft-group-preview-wrapper",children:[Object(ve.jsx)("h5",{children:"Draft group ".concat(s)}),Object(ve.jsx)(Xe,{token:n,amount:S.label}),!h.funded&&Object(ve.jsxs)("div",{style:{marginTop:20},children:[(null===d||void 0===d||null===(t=d.currentUser)||void 0===t?void 0:t.isAdmin)&&Object(ve.jsx)(et,{draftGroupIndex:s,amount:S.value}),Object(ve.jsx)(dt,{draftGroupIndex:s,amount:S})]}),h.funded&&h.draft_indices.length>0&&Object(ve.jsx)(we.a,{className:"button fullWidth",type:"button",onClick:function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t,n,o,l,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d){e.next=2;break}throw new Error("near is null");case 2:e.prev=2,_(!0),t=h.draft_indices,n=100,o=i.a.mark((function e(r){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.slice(r,r+n),e.next=3,N("Convert drafts",Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.api.convertDrafts(a);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e)})),l=0;case 8:if(!(l<t.length)){e.next=13;break}return e.delegateYield(o(l),"t0",10);case 10:l+=n,e.next=8;break;case 13:a("Converted drafts for draft group ".concat(s),{variant:"success"}),u=r.pathname.split("/")[1],y("/".concat(u,"/admin/lockups")),window.location.reload(),e.next=22;break;case 19:e.prev=19,e.t1=e.catch(2),console.log("ERROR: ".concat(e.t1));case 22:return e.prev=22,_(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[2,19,22,25]])})));return function(){return e.apply(this,arguments)}}();e()},loading:w,variant:"contained",color:"success",children:"Convert"}),h.funded&&0===h.draft_indices.length&&Object(ve.jsx)("div",{style:{marginTop:20},children:Object(ve.jsx)(Qe.a,{severity:"success",children:"Draft Group converted"})})]}),(!h.funded||h.draft_indices.length>0)&&Object(ve.jsx)(Me,{lockups:O,token:n})]})}function pt(e){var t=e.token,n=Object(j.f)();console.log(n);var r=Object(l.useContext)(xe).near,a=Object(l.useState)([]),s=Object(o.a)(a,2),u=s[0],d=s[1];Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d([]),console.log("fetchDraftGroup called"),r){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,r.api.getDraftGroupsAll();case 6:t=e.sent,console.log(t),d(t);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[r]);var b=n.pathname.split("/")[1],p="/".concat(b,"/admin/import_draft_group");return Object(ve.jsxs)("div",{className:"container",children:[Object(ve.jsx)("h1",{children:"All draft groups"}),Object(ve.jsxs)(_e.a,{className:"main-table","aria-label":"collapsible table",children:[Object(ve.jsx)(ye.a,{className:"table-head",children:Object(ve.jsxs)(Ce.a,{children:[Object(ve.jsx)(Ne.a,{align:"left",children:"ID"}),Object(ve.jsx)(Ne.a,{align:"center",children:"Funded"}),Object(ve.jsx)(Ne.a,{align:"right",children:"Number\xa0of\xa0lockups"}),Object(ve.jsx)(Ne.a,{align:"right",children:"Total\xa0amount"})]})}),Object(ve.jsx)(Se.a,{children:u.map((function(e){return Object(ve.jsxs)(Ce.a,{children:[Object(ve.jsx)(Ne.a,{align:"left",children:Object(ve.jsx)(h.b,{to:"/".concat(b,"/draft_groups/").concat(e.id),children:e.id})}),Object(ve.jsx)(Ne.a,{align:"center",children:e.funded?"Yes":"No"}),Object(ve.jsx)(Ne.a,{align:"right",children:e.draft_indices.length}),Object(ve.jsxs)(Ne.a,{align:"right",children:[C(e.total_amount,t.decimals),"\xa0",t.symbol,"\xa0",Object(ve.jsx)(Pe,{url:t.icon||"",size:32})]})]})}))})]}),Object(ve.jsx)("br",{}),Object(ve.jsx)(h.b,{to:p,children:Object(ve.jsx)("button",{className:"button",type:"button",children:"Import Draft Group"})})]})}var jt=n(395);function ht(){var e=Object(u.b)().enqueueSnackbar,t=Object(l.useContext)(xe),n=t.near,r=t.signIn;return n?Object(ve.jsxs)("div",{children:[Object(ve.jsx)("div",{className:"header",children:Object(ve.jsx)("div",{className:"container",children:Object(ve.jsx)(jt.a,{sx:{display:"flex"},children:Object(ve.jsx)("div",{className:"nav",children:Object(ve.jsx)(h.b,{className:"nav-link",to:"/",children:"Home"})})})})}),Object(ve.jsxs)("div",{className:"container new-lockup-contract",children:[Object(ve.jsx)("h1",{children:"Create Lockup Contract for your Fungible Tokens"}),Object(ve.jsx)("form",{className:"form-submit",onSubmit:function(t){t.preventDefault();var r=function(){var r=Object(c.a)(i.a.mark((function r(){var a,c,o,s,l;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,null!==n&&void 0!==n&&null!==(a=n.currentUser)&&void 0!==a&&a.signedAccountId){r.next=3;break}throw new Error("expected signedAccountId to be present");case 3:if(c=t.target.elements.lockup_operators.value.split(",").map((function(e){return e.trim()})).filter((function(e){return e.length>0})),o=t.target.elements.token_account_id.value,s=t.target.elements.lockup_subaccount_id.value,0!==c.length){r.next=8;break}throw new Error("empty lockup operators");case 8:if(0!==o.length){r.next=10;break}throw new Error("empty tokenAccountId");case 10:if(0!==s.length){r.next=12;break}throw new Error("empty lockupSubaccountId");case 12:return r.next=14,n.factoryApi.create(s,o,c,"".concat(window.location.origin+window.location.pathname,"#/").concat(s,".").concat(O,"/admin/lockups"));case 14:return l=r.sent,console.log(l),r.abrupt("return",l);case 19:return r.prev=19,r.t0=r.catch(0),console.log(r.t0),e(r.t0.toString(),{variant:"error"}),r.abrupt("return",null);case 24:case"end":return r.stop()}}),r,null,[[0,19]])})));return function(){return r.apply(this,arguments)}}();r()},children:Object(ve.jsxs)("div",{className:"form-wrapper",children:[Object(ve.jsxs)("div",{className:"form-row",children:[Object(ve.jsx)("span",{children:"Contract creator: "}),Object(ve.jsx)("strong",{children:n.currentUser.signedAccountId})," ",Object(ve.jsx)("button",{className:"button",type:"button",onClick:r,children:n.currentUser.signedAccountId?"Login as someone else":"Login"})]}),Object(ve.jsxs)("div",{className:"form-row",children:[Object(ve.jsx)("span",{children:"Lockup operators: "}),Object(ve.jsx)("input",{type:"text",id:"lockup_operators"})]}),Object(ve.jsxs)("div",{className:"form-row",children:[Object(ve.jsx)("span",{children:"Fungible token contract address: "}),Object(ve.jsx)("input",{type:"text",id:"token_account_id"})]}),Object(ve.jsxs)("div",{className:"form-row",children:[Object(ve.jsx)("span",{children:"New Lockup Contract Address: "}),Object(ve.jsx)("input",{type:"text",id:"lockup_subaccount_id"})]}),Object(ve.jsx)("button",{className:"button middle",type:"submit",disabled:!n.currentUser.signedAccountId,children:"Deploy Contract"})]})})]})]}):null}var ft=n(51),mt=n(397),xt=n(205),Ot=n(195);n(302);function vt(e){var t=e.data,n={title:{text:""},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{bottom:"3%",selectedMode:!1,icon:"circle"},grid:{top:"10%",left:"2%",right:"3%",bottom:"15%",containLabel:!0},xAxis:[{type:"time",boundaryGap:["1%","1%"],splitNumber:15}],yAxis:[{type:"value"}],series:[{name:"Vested",type:"line",color:"#0069D1",areaStyle:{opacity:1},markLine:{data:[[{xAxis:new Date,yAxis:0},{xAxis:new Date,yAxis:"max"}]],lineStyle:{type:"dashed",color:"#FF594E"},symbol:"none"},data:t.vested},{name:"Unlocked",type:"line",color:"#00B988",areaStyle:{opacity:1},data:t.unlocked}]};return Object(ve.jsx)(Ot.a,{option:n})}var gt=n(396),kt=n(392),wt=n(369),_t=n(191),yt=n(370);function Ct(e){var t=e.token,n=Object(l.useContext)(xe).near,r=Object(l.useState)(!1),s=Object(o.a)(r,2),u=s[0],b=s[1],p=Object(l.useState)(null),j=Object(o.a)(p,2),h=j[0],f=j[1],x=Object(l.useState)("4_year"),O=Object(o.a)(x,2),v=O[0],g=O[1],k=function(){return b(!1)},w=function(){var e=Object(c.a)(i.a.mark((function e(r){var a,c,s,l,u,d,b,p,j,f;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw Error("Cannot access token api");case 2:if(n.currentUser.signedAccountId){e.next=4;break}throw new Error("signedAccountId requred to set lockup terminator");case 4:if(h){e.next=6;break}throw Error("Start date not set");case 6:r.preventDefault(),a=r.target.elements,c=a.account,s=a.amount,console.log(c.value,s.value),l=(null===n||void 0===n?void 0:n.api.getContract().contractId)||"",u=c.value,d=new m.a(s.value).mul(new m.a(10).pow(t.decimals)).round(0,m.a.roundDown).toString(),b=function(e,t,n){var r=new Be.a(t),a={"4y_cliff_1y_25":[{timestamp:N(e,0),balance:"0"},{timestamp:N(e,1)-1,balance:"0"},{timestamp:N(e,1),balance:r.divn(4).toString()},{timestamp:N(e,4),balance:r.toString()}]};return{"4_year":[a["4y_cliff_1y_25"],null],"4_year_vested":[a["4y_cliff_1y_25"],a["4y_cliff_1y_25"]]}[n]}(h,d,v),p=Object(o.a)(b,2),j=p[0],f=p[1],n.tokenApi.createLockup(l,d.toString(),u,j,f);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(ve.jsxs)("div",{children:[Object(ve.jsx)("button",{className:"button",type:"button",onClick:function(){return b(!0)},children:"Create Lockup"}),Object(ve.jsx)(at.a,{open:u,sx:{padding:2},maxWidth:"xs",onClose:k,children:Object(ve.jsxs)("form",{className:"form-submit",onSubmit:w,children:[Object(ve.jsxs)(ct.a,{children:["Create Lockup",Object(ve.jsx)(d.a,{"aria-label":"close",onClick:k,sx:{position:"absolute",right:8,top:8},children:Object(ve.jsx)(ut.a,{})})]}),Object(ve.jsxs)(ot.a,{sx:{maxWidth:"320px"},children:[Object(ve.jsx)(rt.a,{margin:"normal",id:"account",label:"Account Id",type:"text",fullWidth:!0,variant:"standard"}),Object(ve.jsx)(rt.a,{margin:"normal",id:"amount",label:"Amount",type:"number",variant:"standard",InputProps:{endAdornment:Object(ve.jsx)(gt.a,{position:"end",children:t.symbol})},fullWidth:!0}),Object(ve.jsx)("br",{}),Object(ve.jsx)(kt.a,{fullWidth:!0,sx:{marginTop:"20px"},children:Object(ve.jsxs)(it.a,{id:"schedule-select",value:v,label:"Schedule",onChange:function(e){g(e.target.value)},variant:"standard",fullWidth:!0,children:[Object(ve.jsx)(nt.a,{value:"4_year",children:"4 year lockup with 25% cliff in 1 year"}),Object(ve.jsx)(nt.a,{value:"4_year_vested",children:"4 year lockup with 25% cliff in 1 year (VESTED)"})]})}),Object(ve.jsx)(_t.a,{dateAdapter:wt.a,children:Object(ve.jsx)(yt.a,{label:"Start date",value:h,onChange:function(e){f(e)},renderInput:function(e){return Object(ve.jsx)(rt.a,Object(a.a)({margin:"normal",fullWidth:!0,variant:"standard"},e))}})})]}),Object(ve.jsx)(st.a,{sx:{padding:"14px 24px 24px"},children:Object(ve.jsx)("button",{disabled:!h,className:"button fullWidth noMargin",type:"submit",children:"Create"})})]})})]})}var Nt=function(e){var t=Object(l.useContext)(xe).near,n=e.adminControls,r=e.lockupIndex,s=e.config,b=e.token,p=Object(u.b)().enqueueSnackbar,j=Object(l.useState)(!1),h=Object(o.a)(j,2),f=h[0],x=h[1],O=Object(l.useState)(null),v=Object(o.a)(O,2),g=v[0],k=v[1],w=function(){return x(!1)};if(!t)throw Error("Cannot access lockup api");if(void 0===r)throw Error("Cannot terminate lockup without lockupIndex");var _,y,C=function(){var e=Object(c.a)(i.a.mark((function e(){var n,a,c,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p){e.next=2;break}return e.abrupt("return");case 2:return n=g?g.getTime()/1e3:null,e.next=5,t.api.terminate(r,n);case 5:a=e.sent,c=new m.a(a).div(new m.a(10).pow(b.decimals)).round(2,m.a.roundDown),console.log(c),o="Terminated lockup #".concat(r,", refunded ").concat(c," ").concat(b.symbol),p(o,{variant:"success"}),setTimeout((function(){return window.location.reload()}),1e3);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();s?(_="Terminate",y="Unvested amount will return to ".concat(s.beneficiary_id)):(_="No termination config",y="This lockup cannot be terminated");var N=n&&s;return Object(ve.jsxs)("div",{children:[Object(ve.jsx)("button",{className:"button red fullWidth",disabled:!N,type:"button",onClick:function(){return x(!0)},children:_}),Object(ve.jsx)("span",{className:"fine-print",children:y}),Object(ve.jsx)(at.a,{open:f,sx:{padding:2},maxWidth:"xs",onClose:w,children:Object(ve.jsxs)("form",{className:"form-submit",children:[Object(ve.jsxs)(ct.a,{children:["Create Lockup",Object(ve.jsx)(d.a,{"aria-label":"close",onClick:w,sx:{position:"absolute",right:8,top:8},children:Object(ve.jsx)(ut.a,{})})]}),Object(ve.jsxs)(ot.a,{sx:{maxWidth:"320px"},children:[Object(ve.jsx)(_t.a,{dateAdapter:wt.a,children:Object(ve.jsx)(yt.a,{label:"Custom termination date",minDate:new Date,value:g,onChange:function(e){k(e)},renderInput:function(e){return Object(ve.jsx)(rt.a,Object(a.a)({sx:{margin:"20px 0 40px"},margin:"normal",fullWidth:!0,variant:"standard"},e))}})}),Object(ve.jsx)("button",{className:"button red fullWidth",type:"button",onClick:C,children:"Terminate"})]})]})})]})};function St(e){var t,n,r=Object(l.useState)(!1),a=Object(o.a)(r,2),c=a[0],s=a[1],i=e.adminControls,u=e.row,b=e.token;if(!Object(l.useContext)(xe).near)return null;var p=null===u||void 0===u||null===(t=u.termination_config)||void 0===t||null===(n=t.vesting_schedule)||void 0===n?void 0:n.Schedule,j=window.location.href.split("/").pop()===u.account_id,f="".concat(C(u.claimed_balance,b.decimals)),m="".concat(C(u.unclaimed_balance,b.decimals)),x="".concat(C(u.total_balance-u.claimed_balance-u.unclaimed_balance,b.decimals)),O="".concat(C(u.total_balance-u.total_balance,b.decimals));return Object(ve.jsxs)(ve.Fragment,{children:[Object(ve.jsxs)(Ce.a,{className:c?"expanded exp-row":"exp-row",sx:{"& > *":{borderBottom:"unset"}},children:[Object(ve.jsx)(Ne.a,{children:Object(ve.jsx)(d.a,{"aria-label":"expand row",size:"small",onClick:function(){return s(!c)},children:c?Object(ve.jsx)(Te.a,{}):Object(ve.jsx)(Ue.a,{})})}),Object(ve.jsx)(Ne.a,{align:"left",children:u.id}),Object(ve.jsx)(Ne.a,{align:"left",children:Object(ve.jsx)(h.b,{to:"".concat(j?"":u.account_id),children:u.account_id})}),Object(ve.jsx)(Ne.a,{align:"right",children:y(u.schedule[0].timestamp)}),Object(ve.jsx)(Ne.a,{align:"right",children:y(u.schedule[u.schedule.length-1].timestamp)}),Object(ve.jsx)(Ne.a,{align:"center",children:p?"Yes":"No"}),Object(ve.jsxs)(Ne.a,{align:"right",children:[C(u.total_balance,b.decimals),"\xa0",b.symbol,"\xa0",Object(ve.jsx)(Pe,{url:b.icon||"",size:32})]}),Object(ve.jsx)(Ne.a,{align:"center",children:Object(ve.jsx)(Ae.a,{title:Object(ve.jsxs)("div",{className:"progress-bar__tooltip",children:[Object(ve.jsxs)("span",{children:[Object(ve.jsx)("i",{className:"claimed",children:"\xa0"}),Object(ve.jsx)("b",{children:f})," ","Claimed"]}),Object(ve.jsxs)("span",{children:[Object(ve.jsx)("i",{className:"available",children:"\xa0"}),Object(ve.jsx)("b",{children:m})," ","Available"]}),Object(ve.jsxs)("span",{children:[Object(ve.jsx)("i",{className:"vested",children:"\xa0"}),Object(ve.jsx)("b",{children:x})," ","Vested"]}),Object(ve.jsxs)("span",{children:[Object(ve.jsx)("i",{className:"unvested",children:"\xa0"}),Object(ve.jsx)("b",{children:O})," ","Unvested"]})]}),placement:"top",arrow:!0,children:Object(ve.jsxs)("div",{className:"progress-bar",children:[Object(ve.jsx)("div",{style:{width:"".concat(u.claimed_balance/u.total_balance*100,"%")},className:"claimed",children:"\xa0"}),Object(ve.jsx)("div",{style:{width:"".concat(u.unclaimed_balance/u.total_balance*100,"%")},className:"available",children:"\xa0"}),Object(ve.jsx)("div",{style:{width:"".concat((u.total_balance-u.claimed_balance-u.unclaimed_balance)/u.total_balance*100,"%")},className:"vested",children:"\xa0"}),Object(ve.jsx)("div",{style:{width:"".concat(100*(u.total_balance-u.total_balance),"%")},className:"unvested",children:"\xa0"})]})})})]}),Object(ve.jsx)(Ce.a,{sx:{background:"#F4FAFF"},children:Object(ve.jsx)(Ne.a,{style:{padding:0},colSpan:8,children:Object(ve.jsx)(Ie.a,{in:c,timeout:"auto",unmountOnExit:!0,children:Object(ve.jsx)("div",{className:"lockup-row",children:Object(ve.jsxs)("div",{style:{display:"flex",gap:20},children:[Object(ve.jsx)(Fe,{schedule:u.schedule,title:"Lockup schedule",token:b}),p&&Object(ve.jsx)(Fe,{schedule:p,title:"Vesting schedule",token:b}),Object(ve.jsx)("div",{className:"terminate",children:Object(ve.jsx)(Nt,{token:b,adminControls:i,lockupIndex:u.id,config:u.termination_config})})]})})})})})]})}function At(e){var t=e.lockups,n=e.token,r=e.adminControls;return Object(ve.jsxs)(_e.a,{className:"main-table","aria-label":"collapsible table",children:[Object(ve.jsx)(ye.a,{className:"table-head",children:Object(ve.jsxs)(Ce.a,{children:[Object(ve.jsx)(Ne.a,{}),Object(ve.jsx)(Ne.a,{align:"left",children:"ID"}),Object(ve.jsx)(Ne.a,{align:"left",children:"Account ID"}),Object(ve.jsx)(Ne.a,{align:"right",children:"Start\xa0date"}),Object(ve.jsx)(Ne.a,{align:"right",children:"End\xa0date"}),Object(ve.jsx)(Ne.a,{align:"center",children:"Terminatable"}),Object(ve.jsx)(Ne.a,{align:"right",children:"Total\xa0amount"}),Object(ve.jsx)(Ne.a,{align:"center",children:"Progress"})]})}),Object(ve.jsx)(Se.a,{children:t.map((function(e){return Object(ve.jsx)(St,{row:e,token:n,adminControls:r},e.id)}))})]})}function It(e){var t=e.tokenContractId,n=e.favouriteAccounts,r=e.uniqueUsers,a=e.onSave;console.log("unique users",r);var c=Object(l.useRef)(null),o=function(e){return e.replaceAll(" ","").split(",")},s=function(){var e,n=function(e){return JSON.stringify({favouriteAccounts:e})};if(null===c||void 0===c||null===(e=c.current)||void 0===e||!e.value)return localStorage.setItem(t,n([])),void a([]);var r=o(c.current.value);a(r),localStorage.setItem(t,n(r))};return Object(ve.jsx)("div",{style:{display:"flex",marginBottom:"2em"},children:Object(ve.jsx)(rt.a,{inputProps:{sx:{margin:0}},size:"small",sx:{width:1,padding:0,margin:0},id:"outlined-helperText",label:"My accounts",placeholder:"Comma separated list of your near accounts",defaultValue:n.join(", "),inputRef:c,onKeyPress:function(e){return"Enter"===e.key&&s()},onChange:function(e){var t=e.target.value,r=o(t).filter((function(e){return e.match(/.*(\.)(near|testnet)$/)}));n.toString()!==r.toString()&&s()}})})}var Et=function(e,t,n){return{timestamp:n,balance:function(e,t,n,r,a){if(n<=e)throw new Error("invalid range");if(a<e||a>=n)throw new Error("xM out of bound");return t+(r-t)*(a-e)/(n-e)}(e.timestamp,parseFloat(e.balance),t.timestamp,parseFloat(t.balance),n).toString()}},Tt=function(e,t){if(0===e.length)throw new Error("empty schedule");if(t<e[0].timestamp)return{timestamp:t,balance:e[0].balance};if(t>=e[e.length-1].timestamp)return{timestamp:t,balance:e[e.length-1].balance};for(var n=0;n<e.length-1;n++)if(!(e[n+1].timestamp<=t))return Et(e[n],e[n+1],t);throw new Error("unreachable")},Dt=function(e){if(0===e.length)throw new Error("schedules is empty");var t=Array.from(new Set(e.flat().map((function(e){return e.timestamp})).sort((function(e,t){return e-t})))),n=[];return t.forEach((function(t){for(var r=new f.Big(0),a=0;a<e.length;a++){var c=new f.Big(Tt(e[a],t).balance);r=r.plus(c)}n.push({timestamp:t,balance:r.toString()})})),n};function Ut(e){var t,n=e.lockups,r=e.token,a=e.adminControls,c=Array.from(new Set(n.map((function(e){return e.account_id})))),s=Object(l.useContext)(xe).near,i=s.currentUser,u=i.signedIn,d=i.isAdmin,b=localStorage.getItem(r.contractId),p=b?null===(t=JSON.parse(b))||void 0===t?void 0:t.favouriteAccounts:[],j=Object(l.useState)(p),f=Object(o.a)(j,2),m=f[0],x=f[1],O=n.filter((function(e){return m.includes(e.account_id)})),v=function(e){var t,n=Array.from(e.map((function(e){return e.schedule}))),a=Math.round((new Date).getTime()/1e3),c=e.map((function(e){return e.schedule[0].timestamp})),o=e.map((function(e){var t,n;return null===e||void 0===e||null===(t=e.termination_config)||void 0===t||null===(n=t.vesting_schedule[0])||void 0===n?void 0:n.timestamp})).filter((function(e){return e})),s=Math.min.apply(Math,Object(ft.a)(c).concat(Object(ft.a)(o),[a])),i=Array.from(e.map((function(e){var t,n,r,a,c=null===e||void 0===e||null===(t=e.termination_config)||void 0===t||null===(n=t.vesting_schedule)||void 0===n?void 0:n.Schedule;return c||(c||(r=s,a=e.schedule[e.schedule.length-1].balance,[{timestamp:r-1,balance:"0"},{timestamp:r,balance:a}]))}))),l=Dt(i),u=Dt(n);(null===(t=l[l.length-1])||void 0===t?void 0:t.timestamp)!==u[u.length-1].timestamp&&l.push(u[u.length-1]);var d=function(e,t){return e.map((function(e){return[1e3*e.timestamp,C(e.balance,t)]}))};return{unlocked:e.length?d(u,r.decimals):[],vested:e.length?d(l,r.decimals):[]}},g=function(e){return e.length>0?Object(ve.jsxs)("div",{children:[Object(ve.jsx)(vt,{data:v(e)}),Object(ve.jsx)("br",{}),u&&a&&d&&Object(ve.jsx)(Ct,{token:r}),Object(ve.jsx)(mt.a,{sx:{boxShadow:"unset",margin:"0 0 20px"},component:xt.a,children:Object(ve.jsx)(At,{lockups:e,token:r,adminControls:a})})]}):Object(ve.jsxs)("div",{children:["There are no lockups yet.",a&&Object(ve.jsxs)("div",{children:["Create single lockup or create batch of them via"," ",Object(ve.jsx)(h.b,{to:"/".concat(s.lockupContractId,"/admin/draft_groups"),children:"Draft Groups"}),"."]})]})};return console.log("favouriteAccountsLockups",O),a?Object(ve.jsx)("div",{className:"container",children:g(n)}):Object(ve.jsxs)("div",{className:"container",children:[Object(ve.jsx)(It,{tokenContractId:r.contractId,favouriteAccounts:m,uniqueUsers:c,onSave:x}),g(O)]})}var Pt=n(380);function Ft(e){var t=e.message,n=e.isOpen,r=e.closeFn,a=e.callback;return Object(ve.jsxs)(at.a,{open:n,sx:{padding:2},maxWidth:"md",onClose:r,children:[Object(ve.jsxs)(ct.a,{children:["Confirmation",Object(ve.jsx)(d.a,{"aria-label":"close",sx:{position:"absolute",right:8,top:8},onClick:r,children:Object(ve.jsx)(ut.a,{})})]}),Object(ve.jsx)(ot.a,{sx:{minWidth:"320px"},children:Object(ve.jsx)("div",{children:t})}),Object(ve.jsxs)(st.a,{children:[Object(ve.jsx)(Pt.a,{color:"error",onClick:r,children:"Cancel"}),Object(ve.jsx)(Pt.a,{color:"success",variant:"contained",onClick:function(){r(),a()},children:"Confirm"})]})]})}var Wt=function(e){var t=Object(l.useContext)(xe).near,n=e.accountId,r=e.token,a=e.total,s=Object(l.useState)(!1),u=Object(o.a)(s,2),d=u[0],b=u[1],p=Object(l.useState)((function(){return null})),j=Object(o.a)(p,2),h=j[0],f=j[1];if(!t)throw Error("Cannot access lockup api");if(!n)throw Error("Undefined account cannot claim");var m="\n    Your account doesn't have storage deposit on the token contract. You will be redirected to pay for the storage, after that you will be able to claim your tokens.\n  ".trim();return Object(ve.jsxs)("div",{className:"claim-wrapper",children:[Object(ve.jsx)("h5",{children:"Total available"}),Object(ve.jsx)(Xe,{token:r,amount:a}),Object(ve.jsx)("button",{className:"button fullWidth",type:"button",onClick:function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var r,a,c,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(t.tokenApi){e.next=4;break}return e.abrupt("return");case 4:if(t.noLoginTokenApi){e.next=6;break}return e.abrupt("return");case 6:if(t.tokenContractId){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,t.tokenApi.storageBalanceOf(n);case 10:if(r=e.sent,!(null!==r&&!0)){e.next=16;break}t.noLoginApi.claim(n),e.next=23;break;case 16:return e.next=18,t.tokenApi.storageBalanceBounds();case 18:a=e.sent,c=a.max,o=function(){t.noLoginTokenApi.storageDeposit(t.tokenContractId,n,c)},f((function(){return o})),b(!0);case 23:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()},children:"Claim All"}),Object(ve.jsx)(Ft,{message:m,isOpen:d,closeFn:function(){return b(!1)},callback:h})]})};function Mt(e){var t=e.lockups,n=e.token,r=e.adminControls,a=Object(j.h)().userId,c=t.filter((function(e){return e.account_id===a})),o=c.reduce((function(e,t){return e+parseFloat(t.unclaimed_balance)}),0);return console.log("user lockups",a,c),Object(ve.jsxs)("div",{className:"container",children:[!r&&Object(ve.jsx)(Wt,{accountId:a,token:n,total:C(o,n.decimals)}),Object(ve.jsx)(mt.a,{sx:{boxShadow:"unset"},component:xt.a,children:Object(ve.jsxs)(_e.a,{className:"main-table","aria-label":"collapsible table",children:[Object(ve.jsx)(ye.a,{className:"table-head",children:Object(ve.jsxs)(Ce.a,{children:[Object(ve.jsx)(Ne.a,{}),Object(ve.jsx)(Ne.a,{align:"left",children:"ID"}),Object(ve.jsx)(Ne.a,{align:"left",children:"Account ID"}),Object(ve.jsx)(Ne.a,{align:"right",children:"Start\xa0date"}),Object(ve.jsx)(Ne.a,{align:"right",children:"End\xa0date"}),Object(ve.jsx)(Ne.a,{align:"right",children:"Terminatable"}),Object(ve.jsx)(Ne.a,{align:"right",children:"Total\xa0amount"}),Object(ve.jsx)(Ne.a,{align:"center",children:"Progress"})]})}),Object(ve.jsx)(Se.a,{children:c.map((function(e){return Object(ve.jsx)(St,{row:e,token:n,adminControls:r},e.id)}))})]})})]})}function Lt(e){var t=e.adminControls,n=Object(j.f)(),r=n.pathname.split("/")[1],a=Object(l.useContext)(xe),c=a.near,o=a.signOut;if(Object(l.useEffect)((function(){return console.log(n.pathname),function(){}}),[n]),!c)return null;var s=c.currentUser,i=s.signedIn,u=s.signedAccountId,d=s.isAdmin,b=s.isCouncilMember,p=t&&(d||b);return Object(ve.jsx)("div",{className:"header",children:Object(ve.jsx)("div",{className:"container",children:Object(ve.jsxs)(jt.a,{sx:{display:"flex"},children:[Object(ve.jsx)(h.b,{className:"logo",to:"/",children:"LOCKUPS"}),Object(ve.jsxs)("div",{className:"nav",children:[Object(ve.jsx)(h.c,{className:"nav-link",to:"/".concat(r,p?"/admin/lockups":"/lockups"),children:"Lockups"}),Object(ve.jsx)(h.c,{className:"nav-link",to:"/".concat(r,t?"/admin/about":"/about"),children:"About"}),t&&Object(ve.jsx)(h.c,{className:"nav-link",to:"/".concat(r,"/admin/draft_groups"),children:"Drafts"})]}),t&&i&&Object(ve.jsxs)(jt.a,{sx:{marginTop:"23px"},children:[Object(ve.jsxs)("span",{children:[u," "]}),Object(ve.jsx)("button",{className:"button",type:"button",onClick:o,children:"Log out"})]})]})})})}function Rt(e){var t=e.children;return Object(ve.jsx)("div",{className:"container login",children:t})}var Ht=function(){var e=Object(l.useContext)(xe),t=e.near,n=e.signIn;if(!t)return null;var r=t.currentUser,a=r.signedIn,c=r.isAdmin,o=r.isCouncilMember,s=a&&!(c||o),i=a&&(c||o);return Object(ve.jsxs)(Rt,{children:[s&&Object(ve.jsx)(Qe.a,{sx:{margin:2,width:"500px"},severity:"error",children:"You are not admin"}),!a&&Object(ve.jsx)("button",{className:"button",type:"button",onClick:n,children:"Sign In"}),i&&Object(ve.jsx)(j.a,{to:"lockups",replace:!0})]})};function Bt(){var e=Object(l.useContext)(xe).near;return Object(ve.jsx)("div",{children:Object(ve.jsxs)("div",{style:{maxWidth:640,margin:"auto",paddingTop:20},children:[Object(ve.jsx)("p",{children:"Please pay for the account storage in fungible token contract. This is necessary to allow lockup contract to hold locked fungible token funds. This is a one time payment for the lockup contract. Additionally, all users claiming lockups will have to pay for the storage for their account too."}),Object(ve.jsx)("button",{className:"button fullWidth",type:"button",onClick:function(){var t=function(){var t=Object(c.a)(i.a.mark((function t(){var n,r,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(e.tokenApi){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,e.tokenApi.storageBalanceBounds();case 6:return n=t.sent,r=n.max,console.log(r),t.next=11,e.tokenApi.storageDeposit(e.lockupContractId,r);case 11:a=t.sent,console.log(a);case 13:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()},children:"Pay"})]})})}function Gt(e){var t=e.children,n=Object(j.f)(),r=Object(l.useContext)(xe).near;if(!r)return null;var a=r.currentUser,c=a.signedIn,o=a.isAdmin,s=a.isCouncilMember,i=n.pathname.split("/")[1];return c&&(o||s)?r.isContractFtStoragePaid?t:Object(ve.jsx)("div",{className:"container",children:Object(ve.jsx)(Bt,{})}):Object(ve.jsx)(j.a,{to:"/".concat(i,"/admin"),replace:!0})}var Kt,Jt=n(193),Vt=n.n(Jt),Yt=["title","titleId"];function qt(){return qt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},qt.apply(this,arguments)}function zt(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function Zt(e,t){var n=e.title,r=e.titleId,a=zt(e,Yt);return l.createElement("svg",qt({width:25,height:24,viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},a),n?l.createElement("title",{id:r},n):null,Kt||(Kt=l.createElement("path",{d:"M20.0333 1.22667L14.8169 8.66669C14.4561 9.17333 15.1498 9.78667 15.6492 9.36L20.7824 5.06669C20.9212 4.95998 21.1154 5.04 21.1154 5.22667V18.64C21.1154 18.8267 20.8657 18.9067 20.7547 18.7733L5.2164 0.906667C4.71698 0.32 3.99556 0 3.1909 0H2.63596C1.19312 0 0 1.14667 0 2.56V21.44C0 22.8533 1.19312 24 2.6637 24C3.57936 24 4.43951 23.5467 4.93895 22.7733L10.1554 15.3333C10.5161 14.8267 9.82243 14.2133 9.32298 14.64L4.18979 18.9067C4.05105 19.0133 3.85682 18.9333 3.85682 18.7467V5.36002C3.85682 5.17334 4.10654 5.09333 4.21753 5.22667L19.7558 23.0933C20.2553 23.68 21.0044 24 21.7813 24H22.3363C23.8069 24 25 22.8533 25 21.44V2.56C24.9722 1.14667 23.7791 0 22.3085 0C21.3929 0 20.5327 0.453333 20.0333 1.22667Z",fill:"#00B988"})))}var $t=l.forwardRef(Zt);n.p;function Qt(e){var t=e.lockups,n=Object(l.useState)(x),r=Object(o.a)(n,2),a=r[0],c=r[1],s=Object(j.g)();return Object(ve.jsxs)("div",{className:"root",children:[Object(ve.jsx)("div",{className:"header",children:Object(ve.jsx)("div",{className:"container",children:Object(ve.jsx)(jt.a,{sx:{display:"flex"},children:Object(ve.jsx)(h.b,{className:"logo",to:"/",children:"LOCKUPS"})})})}),Object(ve.jsxs)("div",{className:"main",children:[Object(ve.jsxs)("div",{className:"container home",children:[Object(ve.jsxs)("ul",{className:"home-list",children:[Object(ve.jsxs)("li",{children:[Object(ve.jsx)("span",{className:"near-icon-bg",children:Object(ve.jsx)($t,{})}),Object(ve.jsxs)("div",{children:[Object(ve.jsx)("span",{children:"Total contracts"}),Object(ve.jsx)("b",{children:"256"})]})]}),Object(ve.jsxs)("li",{children:[Object(ve.jsx)("span",{className:"near-icon-bg",children:Object(ve.jsx)($t,{})}),Object(ve.jsxs)("div",{children:[Object(ve.jsx)("span",{children:"Total locked"}),Object(ve.jsx)("b",{children:"$5,336,000"})]})]}),Object(ve.jsxs)("li",{children:[Object(ve.jsx)("span",{className:"near-icon-bg",children:Object(ve.jsx)($t,{})}),Object(ve.jsxs)("div",{children:[Object(ve.jsx)("span",{children:"Total lockups"}),Object(ve.jsx)("b",{children:(null===t||void 0===t?void 0:t.length)||42})]})]})]}),Object(ve.jsx)("h2",{children:"The best DApp on NEAR to manage token vesting"}),Object(ve.jsx)("p",{children:"With our lockup contracts you can ...."}),Object(ve.jsx)(h.b,{to:"/new_lockup_contract",className:"button large link-button",children:"Create new Lockup Contract"})]}),Object(ve.jsx)("div",{className:"white-block",children:Object(ve.jsxs)("div",{className:"container home",children:[Object(ve.jsx)("h2",{children:"If you already have a lockup contract, enter its address below"}),Object(ve.jsx)(rt.a,{variant:"outlined",value:a,onChange:function(e){c(e.target.value)},className:"input-large",placeholder:"Lockup contract address"}),Object(ve.jsx)("button",{className:"button link-button icon-button",onClick:function(){var e="/".concat(a,"/lockups");s(e),window.location.reload()},"aria-label":"open",type:"button",style:{height:56,width:56},children:Object(ve.jsx)(Vt.a,{})})]})})]})]})}function Xt(){return Object(ve.jsx)("div",{className:"container",children:"Contract not found"})}n(305);function en(){var e=Object(j.f)(),t=e.pathname,n=e.pathname.includes("admin"),r=t.indexOf("/",1),a="".concat(t.substring(0,r),"/admin").concat(t.substring(r,t.length));return Object(l.useContext)(xe).near?Object(ve.jsx)("div",{className:"footer",children:Object(ve.jsx)("div",{className:"container",children:Object(ve.jsx)(jt.a,{sx:{display:"flex"},children:Object(ve.jsxs)("div",{className:"nav",children:[Object(ve.jsx)(h.b,{className:"nav-link",to:"/terms",children:"Terms"}),Object(ve.jsx)(h.b,{className:"nav-link",to:"/privacy",children:"Privacy"}),n?Object(ve.jsx)(h.b,{className:"nav-link",to:t.replace(/\/admin/,""),children:"User view"}):Object(ve.jsx)(h.b,{className:"nav-link",to:a,children:"Admin view"})]})})})}):null}function tn(e){var t=e.lockups,n=e.token,r=e.contractId,c=e.near;return t?Object(ve.jsxs)(ve.Fragment,{children:[Object(ve.jsx)(Lt,{adminControls:!1}),Object(ve.jsxs)(j.d,{children:[Object(ve.jsx)(j.b,{path:"/",element:Object(ve.jsx)(j.a,{replace:!0,to:"lockups"})}),Object(ve.jsx)(j.b,{path:"/about",element:Object(ve.jsx)(ge,{lockups:t,token_account_id:r})}),Object(ve.jsx)(j.b,{path:"/lockups",element:r&&c&&Object(ve.jsx)(Ut,{lockups:t,token:Object(a.a)(Object(a.a)({},n),{},{contractId:r}),adminControls:!1})}),Object(ve.jsx)(j.b,{path:"/lockups/:userId",element:Object(ve.jsx)(Mt,{lockups:t,token:n,adminControls:!1})}),Object(ve.jsx)(j.b,{path:"/draft_groups",element:Object(ve.jsx)(Gt,{children:Object(ve.jsx)(pt,{token:n})})}),Object(ve.jsx)(j.b,{path:"/draft_groups/:draftGroupId",element:Object(ve.jsx)(Gt,{children:Object(ve.jsx)(bt,{token:n})})})]})]}):null}function nn(e){var t=e.lockups,n=e.token,r=e.tokenContractId,c=e.near;if(!t)return null;var o=r&&c;return Object(ve.jsxs)(ve.Fragment,{children:[Object(ve.jsx)(Lt,{adminControls:!0}),Object(ve.jsxs)(j.d,{children:[Object(ve.jsx)(j.b,{path:"/",element:Object(ve.jsx)(Ht,{})}),Object(ve.jsx)(j.b,{path:"/about",element:Object(ve.jsx)(ge,{lockups:t,token_account_id:r})}),Object(ve.jsx)(j.b,{path:"/lockups",element:o&&Object(ve.jsx)(Gt,{children:Object(ve.jsx)(Ut,{lockups:t,token:Object(a.a)(Object(a.a)({},n),{},{contractId:r}),adminControls:!0})})}),Object(ve.jsx)(j.b,{path:"/lockups/:userId",element:Object(ve.jsx)(Gt,{children:Object(ve.jsx)(Mt,{lockups:t,token:n,adminControls:!0})})}),Object(ve.jsx)(j.b,{path:"/draft_groups",element:Object(ve.jsx)(Gt,{children:Object(ve.jsx)(pt,{token:n})})}),Object(ve.jsx)(j.b,{path:"/draft_groups/:draftGroupId",element:Object(ve.jsx)(Gt,{children:Object(ve.jsx)(bt,{token:n})})}),Object(ve.jsx)(j.b,{path:"/import_draft_group",element:Object(ve.jsx)(Gt,{children:Object(ve.jsx)($e,{token:n})})})]})]})}function rn(){var e=Object(u.b)().enqueueSnackbar,t=Object(l.useContext)(xe).near,n=Object(l.useState)({}),r=Object(o.a)(n,2),a=r[0],s=r[1],d=Object(l.useState)(null),b=Object(o.a)(d,2),p=b[0],f=b[1],x=Object(l.useState)({decimals:0,icon:null,name:"",reference:null,reference_hash:null,spec:"",symbol:""}),O=Object(o.a)(x,2),v=O[0],g=O[1];Object(l.useEffect)((function(){if(e&&t&&v&&""!==v.spec){var n=function(){var n=Object(c.a)(i.a.mark((function n(){var r,a,c,o,s,l,u,d,b,p,j,h,f,x,O,g,k,w,y,C,N,S,A,E,T,D;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=new URLSearchParams(window.location.search),a=r.get("transactionHashes")){n.next=4;break}return n.abrupt("return");case 4:return c=a.split(",")[0],console.log("txHash",c),n.next=8,t.rpcProvider.txStatus(c,"sender.testnet");case 8:if(o=n.sent,console.log(o),s=o.transaction.actions[0].FunctionCall.method_name,l=o.status.SuccessValue,u=JSON.parse(atob(o.transaction.actions[0].FunctionCall.args)),"claim"!==s){n.next=22;break}if(!l){n.next=20;break}if("0"===(d=JSON.parse(atob(l)))){n.next=20;break}return b=new m.a(d).div(new m.a(10).pow(v.decimals)).round(2,m.a.roundDown),e("Claimed ".concat(b," ").concat(v.symbol),{variant:"success"}),n.abrupt("return");case 20:return e("Claim failed: ".concat(I(c)),{variant:"error"}),n.abrupt("return");case 22:if("storage_deposit"!==s){n.next=30;break}return p=JSON.parse(atob(l)),j=parseFloat(_(p.total,9)).toString(),console.log(j),h=u.account_id,f="Successfully paid ".concat(j,"N for FT storage of ").concat(h),e(f,{variant:"success"}),n.abrupt("return");case 30:if("ft_transfer_call"!==s){n.next=58;break}if(x=JSON.parse(u.msg),console.log(x),!x.schedule){n.next=45;break}if(O=JSON.parse(atob(l)),g=new m.a(O).div(new m.a(10).pow(v.decimals)).round(2,m.a.roundDown),console.log(g),x.schedule[x.schedule.length-1].balance!==O){n.next=42;break}return k="Created lockup for ".concat(x.account_id," with amount ").concat(g," ").concat(v.symbol),e(k,{variant:"success"}),n.abrupt("return");case 42:return w="Failed to create lockup for ".concat(x.account_id,": ").concat(I(c)),e(w,{variant:"error"}),n.abrupt("return");case 45:if(null===x.draft_group_id){n.next=56;break}if(y=JSON.parse(atob(l)),C=new m.a(y).div(new m.a(10).pow(v.decimals)).round(2,m.a.roundDown),console.log(C),"0"===y){n.next=53;break}return N="Funded draft group ".concat(x.draft_group_id," with amount ").concat(C," ").concat(v.symbol),e(N,{variant:"success"}),n.abrupt("return");case 53:return S="Failed to fund draft group ".concat(x.draft_group_id,": ").concat(I(c)),e(S,{variant:"error"}),n.abrupt("return");case 56:return e("Transaction performed, TODO ".concat(c,"!"),{variant:"warning"}),n.abrupt("return");case 58:if("terminate"!==s){n.next=68;break}if(!l){n.next=66;break}return A=JSON.parse(atob(l)),console.log(A),E=new m.a(A).div(new m.a(10).pow(v.decimals)).round(2,m.a.roundDown),T="Terminated lockup #".concat(u.lockup_index,", unvested amount: ").concat(E),e(T,{variant:"success"}),n.abrupt("return");case 66:return e("Terminate lockup failed: ".concat(I(c)),{variant:"error"}),n.abrupt("return");case 68:D='UNHANDLED Transaction "'.concat(s,'" : ').concat(I(c)),e(D,{variant:"warning"});case 70:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();n()}}),[e,t,v]),Object(l.useEffect)((function(){var e=!0;if(t){var n=function(){var n=Object(c.a)(i.a.mark((function n(){var r,a;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.api.loadAllLockups();case 2:return r=n.sent,n.next=5,t.tokenApi.ftMetadata();case 5:if(a=n.sent,e){n.next=8;break}return n.abrupt("return");case 8:g(a),s({lockups:r,name:"name"});case 10:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();t.tokenContractId&&n()}return function(){e=!1}}),[t]),Object(l.useEffect)((function(){return t&&t.tokenApi&&f(t.tokenApi.getContract().contractId),function(){}}),[t]);var k=a.lockups;return Object(ve.jsxs)(h.a,{children:[Object(ve.jsxs)(j.d,{children:[Object(ve.jsx)(j.b,{path:"/",element:Object(ve.jsx)(Qt,{lockups:k})}),Object(ve.jsx)(j.b,{path:"/new_lockup_contract/",element:Object(ve.jsx)(ht,{})}),Object(ve.jsx)(j.b,{path:"/:cid/*",element:p&&t&&Object(ve.jsx)(tn,{lockups:k,token:v,contractId:p,near:t})}),Object(ve.jsx)(j.b,{path:"/:cid/admin/*",element:p&&t&&Object(ve.jsx)(nn,{lockups:k,token:v,tokenContractId:p,near:t})}),Object(ve.jsx)(j.b,{path:"/:cid/not_found_contract/",element:Object(ve.jsx)(Xt,{})}),Object(ve.jsx)(j.b,{path:"*",element:Object(ve.jsx)(Xt,{})})]}),Object(ve.jsx)(en,{})]})}n(306);function an(e){var t=e.snackbarKey,n=Object(u.b)().closeSnackbar;return Object(ve.jsx)(d.a,{onClick:function(){return n(t)},children:Object(ve.jsx)(p.a,{style:{color:"white"}})})}function cn(){var e=Object(l.useState)(null),t=Object(o.a)(e,2),n=t[0],r=t[1];Object(l.useEffect)((function(){function e(){return(e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Oe();case 2:t=e.sent,r(t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}try{!function(){e.apply(this,arguments)}()}catch(t){console.log(t)}}),[]);var s=Object(l.useMemo)((function(){return{near:n,signIn:function(){var e;null===n||void 0===n||null===(e=n.api)||void 0===e||e.signIn()},signOut:function(){n&&(n.api.signOut(),r(Object(a.a)(Object(a.a)({},n),{},{currentUser:{signedIn:!1,signedAccountId:null,isAdmin:!1,isCouncilMember:!1,daos:[]}})))}}}),[n]);return Object(ve.jsx)(l.StrictMode,{children:Object(ve.jsx)(xe.Provider,{value:s,children:Object(ve.jsx)(u.a,{autoHideDuration:null,action:function(e){return Object(ve.jsx)(an,{snackbarKey:e})},onClose:function(){var e=new URL(window.location.href),t=new URLSearchParams(e.search);t.delete("transactionHashes"),e.search=t.toString(),console.log(e),window.history.pushState({},null,e.toString())},children:Object(ve.jsx)(rn,{})})})})}Object(r.render)(Object(ve.jsx)(cn,{}),document.getElementById("root"))}},[[307,1,2]]]);
//# sourceMappingURL=main.266aea0c.chunk.js.map