(this["webpackJsonpft-lockup-contract-frontend"]=this["webpackJsonpft-lockup-contract-frontend"]||[]).push([[0],{242:function(e,t){},252:function(e,t){},306:function(e,t,n){},309:function(e,t,n){},310:function(e,t,n){},311:function(e,t,n){"use strict";n.r(t);var r=n(59),a=n(31),c=n(16),o=n(18),s=n(8),i=n.n(s),l=n(2),u=n(38),d=n(394),p=n(196),b=n.n(p),j=n(23),h=n(24),f=n(20),m=n.n(f),x=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_CONTRACT_NAME:"startup0.factory0.ft-lockup.testnet"}).DEFAULT_CONTRACT_NAME||"example.factory010.ft-lockup.testnet",O=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_CONTRACT_NAME:"startup0.factory0.ft-lockup.testnet"}).FACTORY_CONTRACT_NAME||"factory010.ft-lockup.testnet",v=function(){var e=window.location.hash.split("/")[1];return"new_lockup_contract"===e?O:e}();console.log(v);var g=function(){var e=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_CONTRACT_NAME:"startup0.factory0.ft-lockup.testnet"}).REACT_APP_ENVIRONMENT||"development";switch(e){case"production":case"mainnet":return{networkId:"mainnet",nodeUrl:"https://rpc.mainnet.near.org",contractName:v,walletUrl:"https://wallet.near.org",helperUrl:"https://helper.mainnet.near.org",explorerUrl:"https://explorer.mainnet.near.org",factoryContractName:O};case"development":case"testnet":return{networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",contractName:v,walletUrl:"https://wallet.testnet.near.org",helperUrl:"https://helper.testnet.near.org",explorerUrl:"https://explorer.testnet.near.org",factoryContractName:O};case"betanet":return{networkId:"betanet",nodeUrl:"https://rpc.betanet.near.org",contractName:v,walletUrl:"https://wallet.betanet.near.org",helperUrl:"https://helper.betanet.near.org",explorerUrl:"https://explorer.betanet.near.org",factoryContractName:O};case"local":return{explorerUrl:"",helperUrl:"",networkId:"local",nodeUrl:"http://localhost:3030",walletUrl:"http://localhost:4000/wallet",contractName:v,factoryContractName:O};case"test":case"ci":return{explorerUrl:"",helperUrl:"",walletUrl:"",networkId:"shared-test",nodeUrl:"https://rpc.ci-testnet.near.org",contractName:v,factoryContractName:O};case"ci-betanet":return{explorerUrl:"",helperUrl:"",walletUrl:"",networkId:"shared-test-staging",nodeUrl:"https://rpc.ci-betanet.near.org",contractName:v,factoryContractName:O};default:throw Error("Unconfigured environment '".concat(e,"'. Can be configured in src/config.js."))}}(),k=3e14;m.a.DP=40,m.a.PE=40;var w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2?arguments[2]:void 0;return m.a.DP=40,m()(e||"0").div(Math.pow(10,24)).toFixed(0===t?void 0:t,n)},_=function(e){return new Date(1e3*e).toLocaleDateString("en-US")},y=function(e,t){return m()(e||"0").div(Math.pow(10,t)).toFixed(2)},C=function(e,t){return new Date(new Date(e).setFullYear(e.getFullYear()+t)).getTime()/1e3},S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"dump",t=Object.keys(localStorage).map((function(e){return[e,localStorage.getItem(e)]}));localStorage.setItem(e,JSON.stringify(t))},N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"dump",t=localStorage.getItem(e);if(t){var n=JSON.parse(t);localStorage.clear(),n.forEach((function(e){return localStorage.setItem(e[0],e[1])}))}},A=function(e){return"".concat(g.explorerUrl,"/transactions/").concat(e)},I=n(29),E=n(55),D=n(56),T=["get_draft_group","get_draft_groups_paged","get_drafts","get_lockups_paged","get_token_account_id","get_deposit_whitelist"],U=["create_draft","create_drafts","create_draft_group","convert_draft","convert_drafts","terminate","discard_draft_group","delete_drafts"],P=function(){function e(t){Object(E.a)(this,e),this.near=void 0,this.contract=void 0,this.walletConnection=void 0,this.near=t,this.walletConnection=new I.WalletConnection(t,t.config.contractName),this.contract=new I.Contract(this.walletConnection.account(),this.near.config.contractName,{viewMethods:T,changeMethods:U})}return Object(D.a)(e,[{key:"getDraftGroupsAll",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.get_draft_groups_paged();case 2:return t=e.sent,e.abrupt("return",t.map((function(e){var t=Object(o.a)(e,2),n=t[0],r=t[1];return Object.assign(r,{id:n})})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDraftGroup",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.get_draft_group({index:t});case 2:return(n=e.sent)&&(n.id=t),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDrafts",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.get_drafts({indices:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createDraftGroup",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.create_draft_group();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createDraft",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.create_draft({draft:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createDrafts",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.create_drafts({args:{drafts:t},gas:"300000000000000"});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"convertDraft",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.convert_draft({draft_id:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"convertDrafts",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.convert_drafts({args:{draft_ids:t},gas:"200000000000000"});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"discardDraftGroup",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.discard_draft_group({args:{draft_group_id:t}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteDrafts",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.delete_drafts({args:{draft_ids:t}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"terminate",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.contract.terminate({args:{lockup_index:t,termination_timestamp:n},gas:k,amount:1});case 3:return r=e.sent,e.abrupt("return",r);case 7:throw e.prev=7,e.t0=e.catch(0),console.log(e.t0),Error("Cannot terminate lockup");case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNear",value:function(){return this.near}},{key:"getWalletConnection",value:function(){return this.walletConnection}},{key:"getContract",value:function(){return this.contract}},{key:"getTokenAccountId",value:function(){return this.contract.get_token_account_id()}},{key:"getDepositWhitelist",value:function(){return this.contract.get_deposit_whitelist()}},{key:"loadAllLockups",value:function(){return this.contract.get_lockups_paged().then((function(e){return e.map((function(e){var t=Object(o.a)(e,2),n=t[0],r=t[1];return Object.assign(r,{id:n})}))}))}},{key:"signIn",value:function(){var e="".concat(window.location.href);this.walletConnection.requestSignIn(this.near.config.contractName,void 0,e)}},{key:"signOut",value:function(){this.walletConnection.signOut(),this.near.config.keyStore.clear()}},{key:"get_account_id",value:function(){return this.walletConnection.getAccountId()}},{key:"account",value:function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.near.account(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get_balance",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n,r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.account(t);case 2:return n=e.sent,r=null,e.prev=4,e.next=7,n.getAccountBalance();case 7:a=e.sent,c=a.total,r=parseFloat(I.utils.format.formatNearAmount(c||"0")),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),console.error("Account not exist");case 14:return e.abrupt("return",r);case 15:case"end":return e.stop()}var c}),e,this,[[4,11]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),F=P,M=n(104),R=n(86),W=n(87),L=n(30),G=n.n(L),B=function(){var e=Object(M.a)(G.a.mark((function e(t,n){var r,a,c;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.query({request_type:"view_access_key_list",account_id:n,finality:"optimistic"});case 2:if(a=e.sent,null!==(r=a.keys)&&void 0!==r&&r.length){e.next=5;break}throw Error("None of access keys was founded");case 5:if(null!==(c=a.keys.filter((function(e){var t,n;return"string"===typeof(null===e||void 0===e||null===(t=e.access_key)||void 0===t?void 0:t.permission)&&"FullAccess"===(null===e||void 0===e||null===(n=e.access_key)||void 0===n?void 0:n.permission)})))&&void 0!==c&&c.length){e.next=8;break}throw Error("None of full access keys was founded");case 8:return e.abrupt("return",c[0]);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),V=B,J=[""],H=["claim"],K=function(){function e(t){Object(R.a)(this,e),this.near=void 0,this.near=t}return Object(W.a)(e,[{key:"claim",value:function(){var e=Object(M.a)(G.a.mark((function e(t){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S(),e.next=3,this.setWalletAndContractWithAuth(t);case 3:return e.next=5,this.buildContract().claim({},k);case 5:this.near.config.keyStore.clean();case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setWalletAndContractWithAuth",value:function(){var e=Object(M.a)(G.a.mark((function e(t){var n,r,a=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:this.near.config.contractName,e.next=3,V(this.near.connection.provider,t);case 3:r=e.sent,localStorage.setItem("".concat(n,"_wallet_auth_key"),JSON.stringify({accountId:t,allKeys:[r.public_key]}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"buildContract",value:function(){return new I.Contract(new I.WalletConnection(this.near,this.near.config.contractName).account(),this.near.config.contractName,{viewMethods:J,changeMethods:H})}}]),e}(),q=K,Y=[""],z=["storage_deposit"],$=function(){function e(t){Object(E.a)(this,e),this.near=void 0,this.near=t}return Object(D.a)(e,[{key:"storageDeposit",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S(),e.next=3,this.setWalletAndContractWithAuth(n);case 3:return e.next=5,this.buildContract(t).storage_deposit({args:{account_id:n},gas:k,amount:r});case 5:this.near.config.keyStore.clean();case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"setWalletAndContractWithAuth",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n,r,a=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:this.near.config.contractName,e.next=3,V(this.near.connection.provider,t);case 3:r=e.sent,localStorage.setItem("".concat(n,"_wallet_auth_key"),JSON.stringify({accountId:t,allKeys:[r.public_key]}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"buildContract",value:function(e){return new I.Contract(new I.WalletConnection(this.near,this.near.config.contractName).account(),e,{viewMethods:Y,changeMethods:z})}}]),e}(),Z=$,Q=n(201),X=["msg"],ee=3e14,te=["ft_metadata","storage_balance_of","storage_balance_bounds"],ne=["ft_transfer_call","storage_deposit"],re=function(){function e(t,n){Object(E.a)(this,e),this.contract=void 0,this.contract=new I.Contract(t.account(),n,{viewMethods:te,changeMethods:ne})}return Object(D.a)(e,[{key:"getContract",value:function(){return this.contract}},{key:"createLockup",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n,r,a,c){var o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ftTransferCall({receiver_id:t,amount:n.toString(),msg:{account_id:r,schedule:a,vesting_schedule:c?{Schedule:c}:null}});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,c){return e.apply(this,arguments)}}()},{key:"fundDraftGroup",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n,r){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ftTransferCall({receiver_id:t,amount:r,msg:{draft_group_id:n}});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"ftTransferCall",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n,r,c,o,s=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:ee,r=s.length>2&&void 0!==s[2]?s[2]:1,c=t.msg,o=Object(Q.a)(t,X),e.next=5,this.contract.ft_transfer_call(Object(a.a)({msg:JSON.stringify(c)},o),n,r);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"storageDeposit",value:function(e,t){return this.contract.storage_deposit({args:{account_id:e},gas:ee,amount:t})}},{key:"ftMetadata",value:function(){return this.contract.ft_metadata({})}},{key:"storageBalanceOf",value:function(e){return this.contract.storage_balance_of({account_id:e})}},{key:"storageBalanceBounds",value:function(){return this.contract.storage_balance_bounds()}}]),e}(),ae=re,ce=new m.a(4).mul(new m.a(10).pow(24)).toString(),oe=["create"],se=function(){function e(t,n){Object(E.a)(this,e),this.contract=void 0,this.contract=new I.Contract(t.account(),n,{viewMethods:[],changeMethods:oe})}return Object(D.a)(e,[{key:"getContract",value:function(){return this.contract}},{key:"create",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n,r,a){var c,o,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c={token_account_id:n,deposit_whitelist:r},o=JSON.stringify(c),e.next=4,this.contract.create({args:{name:t,init_function:"new",init_args:o},callbackUrl:a,gas:3e14,amount:ce});case 4:return s=e.sent,console.log(s),e.abrupt("return",s);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()}]),e}(),ie=se,le=n(28),ue=["call:AddProposal","*:AddProposal"],de=["get_policy"],pe=function(){function e(t,n){Object(E.a)(this,e),this.contract=void 0,this.contract=new I.Contract(t.account(),n,{viewMethods:de,changeMethods:[]})}return Object(D.a)(e,[{key:"getContract",value:function(){return this.contract}},{key:"getCouncilMembers",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.get_policy();case 2:if(t=e.sent,0!==(n=t.roles.filter((function(e){var t,n;return(null===e||void 0===e||null===(t=e.permissions)||void 0===t?void 0:t.includes(ue[0]))||(null===e||void 0===e||null===(n=e.permissions)||void 0===n?void 0:n.includes(ue[1]))}))).length){e.next=6;break}return e.abrupt("return",[]);case 6:return r=n.map((function(e){var t;return null===e||void 0===e||null===(t=e.kind)||void 0===t?void 0:t.Group})),e.abrupt("return",r.flat().filter((function(e){return e})));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),be=pe,je=function(e,t,n,r,a,c,o,s,i,l){var u={details:r,smartContractAddress:a,methodName:c,json:o,actionsGas:s,gas:l,deposit:i};return"".concat("https://dev.app.astrodao.com","/dao/").concat(e,"/proposals?action=").concat(t,"&variant=").concat(n,"&params=").concat(JSON.stringify(u))},he=function(e,t,n,r,a,c,o){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"300";return je(e,"create_proposal","ProposeCustomFunctionCall",t,n,r,a,c,o,s)},fe=function(){var e=Object(c.a)(i.a.mark((function e(t,n){var r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new be(t,n),e.next=4,r.getCouncilMembers();case 4:return a=e.sent,e.abrupt("return",Object(le.a)({},n,a));case 8:return e.prev=8,e.t0=e.catch(0),console.log("isDAO ERROR:",e.t0),e.abrupt("return",void 0);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),me=function(e,t,n,r,a,c){var o=encodeURIComponent(e),s={receiver_id:t,amount:r,msg:JSON.stringify({draft_group_id:a})};return he(c,o,n,"ft_transfer_call",s,"100","0.000000000000000000000001")},xe=function(e,t,n,r,a){var c=encodeURIComponent(e);return he(a,c,t,"terminate",{lockup_index:n,termination_timestamp:r},"100","0.000000000000000000000001")},Oe=Object(l.createContext)(null),ve=function(){var e=Object(c.a)(i.a.mark((function e(){var t,n,r,c,o,s,l,u,d,p,b,j,h,f,m,x,O,v,k,w,_;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.getItem("dump")&&N(),t=new I.keyStores.BrowserLocalStorageKeyStore,e.next=4,I.connect(Object(a.a)({headers:{},keyStore:t},g));case 4:return n=e.sent,r=new F(n),c=new I.keyStores.InMemoryKeyStore,e.next=9,I.connect(Object(a.a)({headers:{},keyStore:c},g));case 9:return o=e.sent,s=new q(o),l=new Z(o),u=new I.WalletConnection(n,g.contractName),d=u.getAccountId(),p="",b=!1,j=[],h=[],e.prev=18,e.next=21,r.getTokenAccountId();case 21:return p=e.sent,e.next=24,r.getDepositWhitelist();case 24:return j=e.sent,console.log("depositWhitelist",j),b=j.includes(d),console.log("isAdmin",b),e.next=30,Promise.all(j.map((function(e){return fe(u,e)})));case 30:f=e.sent.filter((function(e){return!!e})),(null===(m=f.filter((function(e){return Object.values(e).pop().includes(d)})))||void 0===m?void 0:m.length)>0&&(h=m.map((function(e){return Object.keys(e).pop()||""}))),console.log("userDaosCouncils",m),console.log("councilMembers",f),console.log("daos",h),e.next=41;break;case 38:e.prev=38,e.t0=e.catch(18),console.log(e.t0);case 41:return x=new ae(u,p),O=!1,v=window.location.hash.split("/")[1],e.prev=44,e.next=47,x.storageBalanceOf(v);case 47:k=e.sent,O=null!==k&&!0,console.log(O),e.next=55;break;case 52:e.prev=52,e.t1=e.catch(44),console.log(e.t1);case 55:return w=new ie(u,g.factoryContractName),_=new I.providers.JsonRpcProvider(g.nodeUrl),e.abrupt("return",{config:g,api:r,tokenContractId:p,noLoginApi:s,tokenApi:x,factoryApi:w,currentUser:{signedIn:!!d,isAdmin:b,isCouncilMember:h.length>0,signedAccountId:d,daos:h},noLoginTokenApi:l,rpcProvider:_,isContractFtStoragePaid:O,lockupContractId:v});case 58:case"end":return e.stop()}}),e,null,[[18,38],[44,52]])})));return function(){return e.apply(this,arguments)}}(),ge=n(1);function ke(e){var t=e.lockups,n=e.token_account_id;return Object(ge.jsxs)("div",{className:"container",children:[Object(ge.jsx)("h1",{children:"About Page"}),Object(ge.jsx)("pre",{children:"\n          This page should render all useful info about contract,\n          at least ft-lockup name, token name, contract ft balance,\n\n          ft-lockup account id: ".concat(g.contractName,"\n          token account id: ").concat(n,"\n\n          Total number of lockups: ").concat(t.length,"\n        ")})]})}var we=n(367),_e=n(389),ye=n(390),Ce=n(391),Se=n(392),Ne=n(393),Ae=n(384),Ie=n(388),Ee=n(125),De=n.n(Ee),Te=n(126),Ue=n.n(Te),Pe=n(190),Fe=n.n(Pe),Me=n(186);function Re(e){var t=e.url,n=e.size;return Object(ge.jsx)("img",{style:{height:n,width:n,verticalAlign:"middle"},src:t,alt:"Token Icon"})}function We(e){var t=e.schedule,n=e.title,r=e.token;return Object(ge.jsxs)("div",{className:"inner-table_wrapper",children:[Object(ge.jsx)("h5",{children:n}),Object(ge.jsxs)(_e.a,{className:"inner-table",size:"small","aria-label":"purchases",children:[Object(ge.jsx)(ye.a,{children:Object(ge.jsxs)(Ce.a,{children:[Object(ge.jsx)(Se.a,{children:"DATE"}),Object(ge.jsx)(Se.a,{align:"right",children:"AMOUNT"})]})}),Object(ge.jsx)(Ne.a,{children:t.map((function(e){return Object(ge.jsxs)(Ce.a,{children:[Object(ge.jsx)(Se.a,{component:"th",scope:"row",children:_(e.timestamp)}),Object(ge.jsxs)(Se.a,{align:"right",children:[y(e.balance,r.decimals),"\xa0",r.symbol,"\xa0",Object(ge.jsx)(Re,{url:r.icon||"",size:32})]})]},e.timestamp)}))})]})]})}function Le(e){var t,n=Object(j.f)(),r=Object(l.useState)(!1),a=Object(o.a)(r,2),c=a[0],s=a[1],i=e.row,p=e.token,b=e.adminControls,f=e.progressShow,m=Object(u.b)().enqueueSnackbar;if(!Object(l.useContext)(Oe).near)return null;var x=null===i||void 0===i||null===(t=i.vesting_schedule)||void 0===t?void 0:t.Schedule,O=n.pathname.split("/")[1],v=n.pathname.split("/").pop()===i.id.toString(),g=n.pathname.split("/").includes("drafts"),k="".concat(y(i.claimed_balance,p.decimals)),w="".concat(y(i.unclaimed_balance,p.decimals)),C="".concat(y(i.total_balance-i.claimed_balance-i.unclaimed_balance,p.decimals)),S="".concat(y(i.total_balance-i.total_balance,p.decimals));return Object(ge.jsxs)(ge.Fragment,{children:[Object(ge.jsxs)(Ce.a,{className:c?"expanded exp-row":"exp-row",sx:{"& > *":{borderBottom:"unset"}},children:[Object(ge.jsx)(Se.a,{children:Object(ge.jsx)(d.a,{"aria-label":"expand row",size:"small",onClick:function(){return s(!c)},children:c?Object(ge.jsx)(De.a,{}):Object(ge.jsx)(Ue.a,{})})}),Object(ge.jsxs)(Se.a,{align:"left",children:[v&&g?i.id:Object(ge.jsx)(h.b,{to:b?"/".concat(O,"/admin/drafts/").concat(i.id):"/".concat(O,"/drafts/").concat(i.id),children:i.id}),Object(ge.jsx)(Me.CopyToClipboard,{text:"".concat(window.location.origin,"/#/").concat(O,"/drafts/").concat(i.id),onCopy:function(){return m("Copied",{variant:"success",autoHideDuration:1e3})},children:Object(ge.jsx)(d.a,{"aria-label":"copy link",children:Object(ge.jsx)(Fe.a,{})})})]}),Object(ge.jsx)(Se.a,{align:"left",children:i.account_id}),Object(ge.jsx)(Se.a,{align:"right",children:_(i.schedule[0].timestamp)}),Object(ge.jsx)(Se.a,{align:"right",children:_(i.schedule[i.schedule.length-1].timestamp)}),Object(ge.jsxs)(Se.a,{align:"right",children:[y(i.total_balance,p.decimals),"\xa0",p.symbol,"\xa0",Object(ge.jsx)(Re,{url:p.icon||"",size:32})]}),f&&Object(ge.jsx)(Se.a,{align:"center",children:Object(ge.jsx)(Ae.a,{title:Object(ge.jsxs)("div",{className:"progress-bar__tooltip",children:[Object(ge.jsxs)("span",{children:[Object(ge.jsx)("i",{className:"claimed",children:"\xa0"}),Object(ge.jsx)("b",{children:k})," ","Claimed"]}),Object(ge.jsxs)("span",{children:[Object(ge.jsx)("i",{className:"available",children:"\xa0"}),Object(ge.jsx)("b",{children:w})," ","Available"]}),Object(ge.jsxs)("span",{children:[Object(ge.jsx)("i",{className:"vested",children:"\xa0"}),Object(ge.jsx)("b",{children:C})," ","Vested"]}),Object(ge.jsxs)("span",{children:[Object(ge.jsx)("i",{className:"unvested",children:"\xa0"}),Object(ge.jsx)("b",{children:S})," ","Unvested"]})]}),placement:"top",arrow:!0,children:Object(ge.jsxs)("div",{className:"progress-bar",children:[Object(ge.jsx)("div",{style:{width:"".concat(i.claimed_balance/i.total_balance*100,"%")},className:"claimed",children:"\xa0"}),Object(ge.jsx)("div",{style:{width:"".concat(i.unclaimed_balance/i.total_balance*100,"%")},className:"available",children:"\xa0"}),Object(ge.jsx)("div",{style:{width:"".concat((i.total_balance-i.claimed_balance-i.unclaimed_balance)/i.total_balance*100,"%")},className:"vested",children:"\xa0"}),Object(ge.jsx)("div",{style:{width:"".concat(100*(i.total_balance-i.total_balance),"%")},className:"unvested",children:"\xa0"})]})})})]}),Object(ge.jsx)(Ce.a,{sx:{background:"#F4F7FC"},children:Object(ge.jsx)(Se.a,{style:{padding:0},colSpan:8,children:Object(ge.jsx)(Ie.a,{in:c,timeout:"auto",unmountOnExit:!0,children:Object(ge.jsx)("div",{className:"lockup-row",children:Object(ge.jsxs)("div",{style:{display:"flex",gap:20},children:[Object(ge.jsx)(We,{schedule:i.schedule,title:"Lockup schedule",token:p}),x&&Object(ge.jsx)(We,{schedule:x,title:"Vesting schedule",token:p})]})})})})})]})}function Ge(e){var t=e.lockups,n=e.token,r=e.adminControls,a=e.progressShow;return Object(ge.jsxs)(_e.a,{className:"main-table","aria-label":"collapsible table",children:[Object(ge.jsx)(ye.a,{className:"table-head",children:t.length>0&&Object(ge.jsxs)(Ce.a,{children:[Object(ge.jsx)(Se.a,{}),Object(ge.jsx)(Se.a,{align:"left",children:"ID"}),Object(ge.jsx)(Se.a,{align:"left",children:"Account ID"}),Object(ge.jsx)(Se.a,{align:"right",children:"Start\xa0date"}),Object(ge.jsx)(Se.a,{align:"right",children:"End\xa0date"}),Object(ge.jsx)(Se.a,{align:"right",children:"Total\xa0amount"}),a&&Object(ge.jsx)(Se.a,{align:"center",children:"Progress"})]})}),Object(ge.jsx)(Ne.a,{children:t.map((function(e){return Object(ge.jsx)(Le,{row:e,token:n,adminControls:r,progressShow:a},e.id)}))})]})}var Be=n(200),Ve=n(192),Je=n(36),He=n.n(Je);He.a.prototype.toJSON=function(){return this.toString()};var Ke=function(e){var t=e.trim().split("\n");if(t.length<=1)return[];var n=t.map((function(e){return e.split("\t").map((function(e){return e.trim()}))})),r=Object(Ve.a)(n),a=r[0];return r.slice(1).map((function(e){return Object.fromEntries(a.map((function(t,n){return[t,e[n]||""]})))}))},qe=function(e){var t=Object(Be.a)(/^P(((((\d+)Y)?((\d+)M)?((\d+)D)?)(T((\d+)H)?((\d+)M)?((\d+)S)?)?)|((\d+)W)?)$/,{year:5,month:7,day:9,hour:12,minute:14,second:16,week:18}),n=e.match(t);if(!n)throw new Error("invalid duration");var r=n&&n.groups||{};return{year:parseInt(r.year,10)||0,month:parseInt(r.month,10)||0,week:parseInt(r.week,10)||0,day:parseInt(r.day,10)||0,hour:parseInt(r.hour,10)||0,minute:parseInt(r.minute,10)||0,second:parseInt(r.second,10)||0}},Ye=function(e){var t=e.split("|");if(4!==t.length)throw new Error("invalid human friendly schedule, expected 4 parts");var n=Object(o.a)(t,4),r=n[0],a=n[1],c=n[2],s=n[3],i=function(e){if(!e.match(/\d\d\d\d-\d\d-\d\dT\d\d:\d\d:\d\dZ/))throw new Error("invalid timestamp");var t=new Date(e);if(Number.isNaN(t.getTime()))throw new Error("invalid timestamp");return t}(r),l=qe(a),u=function(e){var t=e.split(":");if(2!==t.length)throw new Error("expected 2 parts");var n=Object(o.a)(t,2),r=n[0],a=n[1],c=qe(r),s=parseInt(a,10);if(s<0||s>100)throw new Error("invalid cliff percentage");return{duration:c,percentage:s}}(c),d=qe(s);return{timestampStart:i,durationTotal:l,durationCliff:u.duration,percentageCliff:u.percentage,releaseEvery:d}},ze=function(e){return{account_id:function(e){var t=!0;if(e.length<2&&(t=!1),e.length>64&&(t=!1),e.match(/^[a-z0-9._-]+$/)||(t=!1),t)return e;throw new Error("invalid near account id")}(e.account_id),amount:function(e){if(e.match(/^[0-9]+(\.[0-9]+)?$/))return e;throw new Error("invalid token amount")}(e.amount),lockup_schedule:Ye(e.lockup_schedule),vesting_schedule:""===e.vesting_schedule?null:Ye(e.vesting_schedule)}},$e=function(e,t,n){var r=Math.floor(n);return new Date(Date.UTC(e.getUTCFullYear()+t.year*r,e.getUTCMonth()+t.month*r,e.getUTCDate()+(7*t.week+t.day)*r,e.getUTCHours()+t.hour*r,e.getUTCMinutes()+t.minute*r,e.getUTCSeconds()+t.second*r))},Ze=function(e){return Math.floor(new Date(e).getTime()/1e3)},Qe=function(e,t,n){if(!(n>=0&&n===Math.floor(n)))throw new Error("invalid token decimals");var r=new m.a(10).pow(n),a=e.timestampStart,c=$e(a,e.durationCliff,1),o=$e(c,qe("PT1S"),-1),s=$e(a,e.durationTotal,1),i=new He.a(new m.a(t).mul(r).round(0,m.a.roundDown).toString()),l=new He.a(i).muln(e.percentageCliff).divn(100).clone();if(l.gt(i))throw new Error("error: cliffAmount > totalAmount");if(c>s)throw new Error("error: timestampCliff > timestampFinish");if(c<a)throw new Error("error: timestampPreCliff < timestampStart");var u=e.releaseEvery,d=c,p=$e(c,u,1);if(Ze(p)<=Ze(d))throw new Error("invalid releaseEvery, zero duration");if(Ze(p)-Ze(d)===1){var b={timestamp:Ze(a),balance:new He.a("0").toString()},j={timestamp:Ze(o),balance:new He.a("0").toString()},h={timestamp:Ze(c),balance:l.toString()},f={timestamp:Ze(s),balance:i.toString()},x=[];return x.unshift(f),h.timestamp<f.timestamp&&x.unshift(h),x.unshift(j),b.timestamp<j.timestamp&&x.unshift(b),x}for(var O=[],v=c;;){if(v>=s){v=s,O.push(v);break}if(O.push(v),v=$e(v,u,1),O.length>=500)throw new Error("too many checkpoints for schedule")}var g=i.sub(l).divn(O.length-1),k=O.flatMap((function(e,t){if(1===O.length)return[{timestamp:Ze(s),balance:i.toString()}];if(0===t)return[{timestamp:Ze(e),balance:l.toString()}];var n=t===O.length-1?i:l.add(g.muln(t)).toString();return[{timestamp:Ze(e)-1,balance:l.add(g.muln(t-1)).toString()},{timestamp:Ze(e),balance:n.toString()}]})),w=[],_={timestamp:Ze(a),balance:new He.a("0").toString()},y={timestamp:Ze(o),balance:new He.a("0").toString()};return w.unshift(y),_.timestamp<y.timestamp&&w.unshift(_),w.concat(k)},Xe=function(e,t){return Ke(e).map((function(e,n){return function(e,t,n){var r=ze(e),a=null;return r.vesting_schedule&&(a={Schedule:Qe(r.vesting_schedule,r.amount,t)}),{id:n,account_id:r.account_id,schedule:Qe(r.lockup_schedule,r.amount,t),vesting_schedule:a}}(e,t,n)}))};var et=function(e){var t=e.token,n=e.adminControls,r=Object(j.f)(),a=Object(l.useContext)(Oe).near,s=Object(l.useState)([]),d=Object(o.a)(s,2),p=d[0],b=d[1],h=Object(l.useState)(!1),f=Object(o.a)(h,2),m=f[0],x=f[1],O=Object(j.g)(),v=Object(u.b)().enqueueSnackbar,g=function(){var e=Object(c.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n();case 3:return r=e.sent,e.abrupt("return",r);case 7:throw e.prev=7,e.t0=e.catch(0),v("".concat(t," failed with error: '").concat(e.t0,"'"),{variant:"error"}),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),k=function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.delegateYield(i.a.mark((function e(){var t,n,o,s,l,u,d,b;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}throw new Error("near is null");case 2:return x(!0),e.next=5,g("Create draft group",Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.api.createDraftGroup();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))));case 5:t=e.sent,n="Created draft group id: ".concat(t),v(n,{variant:"success"}),o=20,s=i.a.mark((function e(n){var r,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=p.slice(n,n+o),s=r.map((function(e){return{draft_group_id:t,lockup_create:e}})),e.next=4,g("Create drafts",Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.api.createDrafts(s);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))));case 4:case"end":return e.stop()}}),e)})),l=0;case 11:if(!(l<p.length)){e.next=16;break}return e.delegateYield(s(l),"t0",13);case 13:l+=o,e.next=11;break;case 16:u="Created ".concat(p.length," draft").concat(p.length>1?"s":"","."),v(u,{variant:"success"}),d=r.pathname.split("/")[1],b="/".concat(d,"/admin/draft_groups/").concat(t),O(b);case 21:case"end":return e.stop()}}),e)}))(),"t0",2);case 2:e.next=7;break;case 4:e.prev=4,e.t1=e.catch(0),x(!1);case 7:case"end":return e.stop()}}),e,null,[[0,4]])})));return function(){return e.apply(this,arguments)}}();return Object(ge.jsx)("div",{className:"main",children:Object(ge.jsxs)("div",{className:"container",children:[Object(ge.jsx)("h2",{children:"Import Draft Group"}),Object(ge.jsxs)("div",{className:"import-draft-group-wrapper",children:[Object(ge.jsxs)("p",{children:["Copy lockups from a spreadsheet editor and paste into the area below. See"," ",Object(ge.jsx)("a",{href:"".concat("","/lockup_import_example.xlsx"),children:"example and format specifications"}),"."]}),Object(ge.jsx)(we.a,{className:"import-draft-group-textarea",id:"spreadsheet-input",placeholder:"Excel input",maxRows:5,onChange:function(e){try{var n;if(null===a||void 0===a||null===(n=a.currentUser)||void 0===n||!n.signedAccountId)throw new Error("expected present signedAccountId");console.log(t);var r=e.target.value,c=Xe(r,t.decimals);b(c)}catch(o){o instanceof Error&&console.log(o)}}})]}),Object(ge.jsx)(Ge,{lockups:p,token:t,adminControls:n,progressShow:!1}),Object(ge.jsx)("button",{disabled:!(p.length>=1&&!m),onClick:k,type:"button",className:"button",children:"Import"})]})})},tt=n(379),nt=n(378);function rt(e){var t=e.token,n=e.amount;return Object(ge.jsxs)("div",{className:"token-info",children:[Object(ge.jsxs)("div",{className:"token-amount",children:[n," ",t.symbol]}),Object(ge.jsx)(Re,{url:t.icon||"",size:32})]})}var at=function(e){var t=Object(l.useContext)(Oe).near,n=e.draftGroupIndex,r=e.amount;if(!t)throw Error("Cannot access lockup api");if(void 0===n)throw Error("Cannot fund draft group without index");if(void 0===r)throw Error("Cannot fund draft group without specified amount");return Object(ge.jsx)("button",{className:"button",type:"button",onClick:function(){t.tokenApi.fundDraftGroup(t.api.getContract().contractId,n,r)},children:"Fund"})},ct=n(371),ot=n(372),st=n(398),it=n(399),lt=n(69),ut=n.n(lt),dt=n(377),pt=n(382),bt=n(381),jt=n(383);var ht=function(e){var t=e.selectedAddress,n=e.setSelectedAddress,r=Object(l.useContext)(Oe).near;if(!r)throw Error("Cannot access lockup api");var a=r.currentUser.daos;a.length>0&&(""===t||!a.includes(t))&&n(a[0]);var c=function(e){n(e.target.value)};return a.length>0?Object(ge.jsxs)("div",{children:[Object(ge.jsx)(pt.a,{children:"Select DAO contract address"}),Object(ge.jsx)(dt.a,{required:!0,sx:{marginBottom:3,width:1},value:t,onChange:c,children:a.map((function(e){return Object(ge.jsx)(bt.a,{value:e,children:e})}))})]}):Object(ge.jsx)(jt.a,{required:!0,sx:{marginBottom:3,width:1},id:"outlined-helperText",label:"DAO contract address",onChange:c})};var ft=function(e){var t=e.proposalDescription,n=e.setProposalDescription;return Object(ge.jsx)(jt.a,{sx:{width:1},id:"outlined-multiline-static",label:"Proposal description",multiline:!0,minRows:5,onChange:function(e){n(e.target.value)},defaultValue:t})};var mt=function(e){var t=Object(l.useContext)(Oe).near,n=e.draftGroupIndex,r=e.amount,a="Fund draft group ".concat(n," with amount ").concat(null===r||void 0===r?void 0:r.label,". Draft group link: ").concat(window.location.href),c=Object(l.useState)(a),s=Object(o.a)(c,2),i=s[0],u=s[1],p=Object(l.useState)(""),b=Object(o.a)(p,2),j=b[0],h=b[1],f=Object(l.useState)(!1),m=Object(o.a)(f,2),x=m[0],O=m[1],v=function(){return O(!1)};if(!t)throw Error("Cannot access lockup api");if(void 0===n)throw Error("Cannot fund draft group without index");if(void 0===(null===r||void 0===r?void 0:r.value))throw Error("Cannot fund draft group without specified amount");return console.log("AMOUNT",r),Object(ge.jsxs)(ge.Fragment,{children:[Object(ge.jsx)("button",{className:"button",type:"button",onClick:function(){return O(!0)},children:"Fund with DAO"}),Object(ge.jsx)(ct.a,{open:x,sx:{padding:1,minWidth:1},onClose:v,children:Object(ge.jsxs)("form",{className:"form-submit",onSubmit:function(){var e,a=me(i,t.api.getContract().contractId,t.tokenApi.getContract().contractId,r.value,n,j);null===(e=window.open(a,"_blank"))||void 0===e||e.focus()},children:[Object(ge.jsxs)(ot.a,{children:["Fund with DAO",Object(ge.jsx)(d.a,{"aria-label":"close",onClick:v,sx:{position:"absolute",right:8,top:8},children:Object(ge.jsx)(ut.a,{})})]}),Object(ge.jsxs)(st.a,{style:{minWidth:"320px",paddingTop:"1.25em"},children:[Object(ge.jsx)(ht,{selectedAddress:j,setSelectedAddress:h}),Object(ge.jsx)(ft,{proposalDescription:i,setProposalDescription:u})]}),Object(ge.jsx)(it.a,{sx:{padding:"14px 24px 24px"},children:Object(ge.jsx)("button",{className:"button fullWidth noMargin",type:"submit",children:"Fund"})})]})})]})};var xt=function(e){var t=e.draftGroupId,n=e.draftIds,r=e.disabled,a=Object(l.useContext)(Oe).near,s=Object(u.b)().enqueueSnackbar,d=Object(j.g)(),p=Object(j.f)(),b=Object(l.useState)(!1),h=Object(o.a)(b,2),f=h[0],m=h[1],x=function(){var e=Object(c.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n();case 3:return r=e.sent,e.abrupt("return",r);case 7:throw e.prev=7,e.t0=e.catch(0),s("".concat(t," failed with error: '").concat(e.t0,"'"),{variant:"error"}),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}();if(!a)throw Error("Cannot access lockup api");return Object(ge.jsx)("button",{className:"button compact red",type:"button",onClick:function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var r,o,l,u,b,j;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}throw new Error("near is null");case 2:return m(!0),e.prev=3,e.next=6,a.api.discardDraftGroup(t);case 6:s("Discarded draft group ".concat(t),{variant:"success"}),e.next=21;break;case 9:if(e.prev=9,e.t0=e.catch(3),!(e.t0 instanceof Error)){e.next=20;break}if(console.log("ERROR: ".concat(e.t0)),(r=e.t0.message).includes("cannot discard, draft group already discarded")){e.next=18;break}return s("Failed to discard draft group ".concat(t,": ").concat(r),{variant:"error"}),m(!1),e.abrupt("return");case 18:e.next=21;break;case 20:throw new Error("unreachable");case 21:e.prev=21,o=100,l=i.a.mark((function e(t){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.slice(t,t+o),e.next=3,x("Delete drafts",Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.api.deleteDrafts(r);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e)})),u=0;case 25:if(!(u<n.length)){e.next=30;break}return e.delegateYield(l(u),"t1",27);case 27:u+=o,e.next=25;break;case 30:s("Deleted draft group ".concat(t),{variant:"success"}),b=p.pathname.split("/")[1],d("/".concat(b,"/admin/draft_groups")),window.location.reload(),e.next=46;break;case 36:if(e.prev=36,e.t2=e.catch(21),!(e.t2 instanceof Error)){e.next=45;break}console.log("ERROR: ".concat(e.t2)),j=e.t2.message,s("Failed to discard draft group ".concat(t,": ").concat(j),{variant:"error"}),m(!1),e.next=46;break;case 45:throw new Error("unreachable");case 46:case"end":return e.stop()}}),e,null,[[3,9],[21,36]])})));return function(){return e.apply(this,arguments)}}();e()},disabled:r||f,children:"Delete"})};function Ot(e){var t=e.token,n=e.adminControls,r=Object(j.f)(),a=Object(u.b)().enqueueSnackbar,s=parseInt(Object(j.h)().draftGroupId||"",10),d=Object(l.useContext)(Oe).near,p=Object(l.useState)(null),b=Object(o.a)(p,2),h=b[0],f=b[1],m=Object(l.useState)([]),x=Object(o.a)(m,2),O=x[0],v=x[1],g=Object(l.useState)(!1),k=Object(o.a)(g,2),w=k[0],_=k[1];Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f(null),console.log("fetchDraftGroup called"),d){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,d.api.getDraftGroup(s);case 6:t=e.sent,console.log(t),f(t);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[d,s]),Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v([]),console.log("fetchDrafts called"),d){e.next=4;break}return e.abrupt("return");case 4:if(h){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,d.api.getDrafts(h.draft_indices);case 8:t=e.sent,console.log(t),v(t.map((function(e){return Object.assign(e[1].lockup_create,{id:e[0]})})));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[d,h]);var C=Object(j.g)(),S=function(){var e=Object(c.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n();case 3:return r=e.sent,e.abrupt("return",r);case 7:throw e.prev=7,e.t0=e.catch(0),a("".concat(t," failed with error: '").concat(e.t0,"'"),{variant:"error"}),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}();if(!h)return null;var N={value:h.total_amount,label:y(h.total_amount,t.decimals)||""};return Object(ge.jsxs)("div",{className:"container",children:[Object(ge.jsxs)("div",{className:"draft-group-preview-wrapper",children:[Object(ge.jsxs)("div",{className:"draft-group-preview-info",style:{display:"flex"},children:[Object(ge.jsxs)("h5",{children:["Draft group ".concat(s)," ",h.discarded&&Object(ge.jsx)("span",{className:"discarded-marker",children:"DISCARDED"})]}),Object(ge.jsx)(rt,{token:t,amount:N.label})]}),!h.funded&&n&&Object(ge.jsxs)("div",{className:"draft-group-fund-button-wrapper",children:[!h.discarded&&Object(ge.jsx)(at,{draftGroupIndex:s,amount:N.value}),!h.discarded&&Object(ge.jsx)(mt,{draftGroupIndex:s,amount:N}),Object(ge.jsx)(xt,{draftGroupId:h.id,draftIds:h.draft_indices,disabled:h.funded})]}),h.funded&&h.draft_indices.length>0&&n&&Object(ge.jsx)("div",{className:"draft-group-fund-button-wrapper",children:Object(ge.jsx)(nt.a,{className:"button",type:"button",onClick:function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t,n,o,l,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d){e.next=2;break}throw new Error("near is null");case 2:e.prev=2,_(!0),t=h.draft_indices,n=100,o=i.a.mark((function e(r){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.slice(r,r+n),e.next=3,S("Convert drafts",Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.api.convertDrafts(a);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e)})),l=0;case 8:if(!(l<t.length)){e.next=13;break}return e.delegateYield(o(l),"t0",10);case 10:l+=n,e.next=8;break;case 13:a("Converted drafts for draft group ".concat(s),{variant:"success"}),u=r.pathname.split("/")[1],C("/".concat(u,"/admin/lockups")),window.location.reload(),e.next=22;break;case 19:e.prev=19,e.t1=e.catch(2),console.log("ERROR: ".concat(e.t1));case 22:return e.prev=22,_(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[2,19,22,25]])})));return function(){return e.apply(this,arguments)}}();e()},loading:w,variant:"contained",color:"success",children:"Convert"})}),h.funded&&0===h.draft_indices.length&&Object(ge.jsx)("div",{style:{marginTop:20},children:Object(ge.jsx)(tt.a,{severity:"success",children:"Draft Group converted"})})]}),(!h.funded||h.draft_indices.length>0)&&Object(ge.jsx)(Ge,{lockups:O,token:t,adminControls:n,progressShow:!0})]})}function vt(e){var t=e.token,n=e.adminControls,r=Object(j.f)();console.log(r);var a=Object(l.useContext)(Oe).near,s=Object(l.useState)([]),u=Object(o.a)(s,2),d=u[0],p=u[1];Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p([]),console.log("fetchDraftGroup called"),a){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,a.api.getDraftGroupsAll();case 6:t=e.sent,console.log(t),p(t);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[a]);var b=r.pathname.split("/")[1],f="/".concat(b,"/admin/import_draft_group");return Object(ge.jsx)("div",{className:"main",children:Object(ge.jsxs)("div",{className:"container",children:[Object(ge.jsx)("h1",{children:"All draft groups"}),Object(ge.jsxs)(_e.a,{className:"main-table","aria-label":"collapsible table",children:[Object(ge.jsx)(ye.a,{className:"table-head",children:Object(ge.jsxs)(Ce.a,{children:[Object(ge.jsx)(Se.a,{align:"center",children:"ID"}),Object(ge.jsx)(Se.a,{align:"center",children:"Funded"}),Object(ge.jsx)(Se.a,{align:"center",children:"Number\xa0of\xa0lockups"}),Object(ge.jsx)(Se.a,{align:"right",children:"Total\xa0amount"}),Object(ge.jsx)(Se.a,{align:"right",width:"0%",children:"Delete"})]})}),Object(ge.jsx)(Ne.a,{children:d.map((function(e){return Object(ge.jsxs)(Ce.a,{children:[Object(ge.jsx)(Se.a,{align:"center",children:Object(ge.jsx)(h.b,{to:"/".concat(b,"/").concat(n?"admin/":"","draft_groups/").concat(e.id),children:e.id})}),Object(ge.jsx)(Se.a,{align:"center",children:e.funded?"Yes":"No"}),Object(ge.jsx)(Se.a,{align:"center",children:e.draft_indices.length}),Object(ge.jsxs)(Se.a,{align:"right",children:[y(e.total_amount,t.decimals),"\xa0",t.symbol,"\xa0",Object(ge.jsx)(Re,{url:t.icon||"",size:32})]}),Object(ge.jsx)(Se.a,{align:"right",children:Object(ge.jsx)(xt,{draftGroupId:e.id,draftIds:e.draft_indices,disabled:e.funded})})]},e.id)}))})]}),Object(ge.jsx)(h.b,{to:f,children:Object(ge.jsx)("button",{className:"button",type:"button",children:"Import Draft Group"})})]})})}var gt=n(400);function kt(){var e=Object(u.b)().enqueueSnackbar,t=Object(l.useContext)(Oe),n=t.near,r=t.signIn;return n?Object(ge.jsxs)("div",{children:[Object(ge.jsx)("div",{className:"header",children:Object(ge.jsx)("div",{className:"container",children:Object(ge.jsxs)(gt.a,{sx:{display:"flex"},children:[Object(ge.jsx)(h.b,{className:"logo",to:"/",children:"LOCKUPS"}),Object(ge.jsx)("div",{className:"nav",children:Object(ge.jsx)(h.b,{className:"nav-link",to:"/",children:"Home"})})]})})}),Object(ge.jsxs)("div",{className:"container new-lockup-contract",children:[Object(ge.jsx)("h2",{children:"Create Lockup Contract for your Fungible Tokens"}),Object(ge.jsx)("form",{className:"form-submit",onSubmit:function(t){t.preventDefault();var r=function(){var r=Object(c.a)(i.a.mark((function r(){var a,c,o,s,l;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,null!==n&&void 0!==n&&null!==(a=n.currentUser)&&void 0!==a&&a.signedAccountId){r.next=3;break}throw new Error("expected signedAccountId to be present");case 3:if(c=t.target.elements.lockup_operators.value.split(",").map((function(e){return e.trim()})).filter((function(e){return e.length>0})),o=t.target.elements.token_account_id.value,s=t.target.elements.lockup_subaccount_id.value,0!==c.length){r.next=8;break}throw new Error("empty lockup operators");case 8:if(0!==o.length){r.next=10;break}throw new Error("empty tokenAccountId");case 10:if(0!==s.length){r.next=12;break}throw new Error("empty lockupSubaccountId");case 12:return r.next=14,n.factoryApi.create(s,o,c,"".concat(window.location.origin+window.location.pathname,"#/").concat(s,".").concat(O,"/admin/lockups"));case 14:return l=r.sent,console.log(l),r.abrupt("return",l);case 19:return r.prev=19,r.t0=r.catch(0),console.log(r.t0),e(r.t0.toString(),{variant:"error"}),r.abrupt("return",null);case 24:case"end":return r.stop()}}),r,null,[[0,19]])})));return function(){return r.apply(this,arguments)}}();r()},children:Object(ge.jsxs)("div",{className:"form-wrapper",children:[Object(ge.jsx)("p",{children:"On this page you can deploy your own copy of lockup contract. Some more elaborative description follows here."}),Object(ge.jsxs)("div",{className:"form-row",children:[Object(ge.jsx)("span",{children:"Contract creator: "}),Object(ge.jsxs)("div",{className:"form-cell",children:[n.currentUser.signedAccountId&&Object(ge.jsx)("strong",{children:n.currentUser.signedAccountId}),Object(ge.jsx)("button",{className:"button",type:"button",onClick:r,children:n.currentUser.signedAccountId?"Login as someone else":"Login"})]})]}),Object(ge.jsxs)("div",{className:"form-row",children:[Object(ge.jsx)("span",{children:"Lockup operators: "}),Object(ge.jsx)("input",{type:"text",id:"lockup_operators"})]}),Object(ge.jsxs)("div",{className:"form-row",children:[Object(ge.jsx)("span",{children:"Fungible token contract address: "}),Object(ge.jsx)("input",{type:"text",id:"token_account_id"})]}),Object(ge.jsxs)("div",{className:"form-row",children:[Object(ge.jsx)("span",{children:"New Lockup Contract Address: "}),Object(ge.jsx)("input",{type:"text",id:"lockup_subaccount_id"})]}),Object(ge.jsx)("button",{className:"button submit",type:"submit",disabled:!n.currentUser.signedAccountId,children:"Deploy Contract"})]})})]})]}):null}var wt=n(51),_t=n(402),yt=n(197);n(306);function Ct(e){var t=e.data,n={title:{text:""},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{bottom:"3%",selectedMode:!1,icon:"circle"},grid:{top:"15%",left:"2%",right:"3%",bottom:"15%",containLabel:!0},xAxis:[{type:"time",boundaryGap:["1%","1%"],splitNumber:15}],yAxis:[{type:"value"}],series:[{name:"Vested",type:"line",color:"#0069D1",areaStyle:{opacity:1},markLine:{data:[[{xAxis:new Date,yAxis:0},{xAxis:new Date,yAxis:"max"}]],lineStyle:{type:"dashed",color:"#FF594E"},symbol:"none"},data:t.vested},{name:"Unlocked",type:"line",color:"#00B988",areaStyle:{opacity:1},data:t.unlocked}]};return Object(ge.jsx)(yt.a,{option:n})}var St=n(401),Nt=n(397),At=n(374),It=n(193),Et=n(375);function Dt(e){var t=e.token,n=Object(l.useContext)(Oe).near,r=Object(l.useState)(!1),s=Object(o.a)(r,2),u=s[0],p=s[1],b=Object(l.useState)(null),j=Object(o.a)(b,2),h=j[0],f=j[1],x=Object(l.useState)("4_year"),O=Object(o.a)(x,2),v=O[0],g=O[1],k=function(){return p(!1)},w=function(){var e=Object(c.a)(i.a.mark((function e(r){var a,c,s,l,u,d,p,b,j,f;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw Error("Cannot access token api");case 2:if(n.currentUser.signedAccountId){e.next=4;break}throw new Error("signedAccountId requred to set lockup terminator");case 4:if(h){e.next=6;break}throw Error("Start date not set");case 6:r.preventDefault(),a=r.target.elements,c=a.account,s=a.amount,console.log(c.value,s.value),l=(null===n||void 0===n?void 0:n.api.getContract().contractId)||"",u=c.value,d=new m.a(s.value).mul(new m.a(10).pow(t.decimals)).round(0,m.a.roundDown).toString(),p=function(e,t,n){var r=new He.a(t),a={"4y_cliff_1y_25":[{timestamp:C(e,0),balance:"0"},{timestamp:C(e,1)-1,balance:"0"},{timestamp:C(e,1),balance:r.divn(4).toString()},{timestamp:C(e,4),balance:r.toString()}]};return{"4_year":[a["4y_cliff_1y_25"],null],"4_year_vested":[a["4y_cliff_1y_25"],a["4y_cliff_1y_25"]]}[n]}(h,d,v),b=Object(o.a)(p,2),j=b[0],f=b[1],n.tokenApi.createLockup(l,d.toString(),u,j,f);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(ge.jsxs)(ge.Fragment,{children:[Object(ge.jsx)("button",{className:"button",type:"button",onClick:function(){return p(!0)},children:"Create Lockup"}),Object(ge.jsx)(ct.a,{open:u,sx:{padding:2},maxWidth:"xs",onClose:k,children:Object(ge.jsxs)("form",{className:"form-submit",onSubmit:w,children:[Object(ge.jsxs)(ot.a,{children:["Create Lockup",Object(ge.jsx)(d.a,{"aria-label":"close",onClick:k,sx:{position:"absolute",right:8,top:8},children:Object(ge.jsx)(ut.a,{})})]}),Object(ge.jsxs)(st.a,{sx:{maxWidth:"320px"},children:[Object(ge.jsx)(jt.a,{margin:"normal",id:"account",label:"Account Id",type:"text",fullWidth:!0,variant:"standard"}),Object(ge.jsx)(jt.a,{margin:"normal",id:"amount",label:"Amount",type:"number",variant:"standard",InputProps:{endAdornment:Object(ge.jsx)(St.a,{position:"end",children:t.symbol})},fullWidth:!0}),Object(ge.jsx)("br",{}),Object(ge.jsx)(Nt.a,{fullWidth:!0,sx:{marginTop:"20px"},children:Object(ge.jsxs)(dt.a,{id:"schedule-select",value:v,label:"Schedule",onChange:function(e){g(e.target.value)},variant:"standard",fullWidth:!0,children:[Object(ge.jsx)(bt.a,{value:"4_year",children:"4 year lockup with 25% cliff in 1 year"}),Object(ge.jsx)(bt.a,{value:"4_year_vested",children:"4 year lockup with 25% cliff in 1 year (VESTED)"})]})}),Object(ge.jsx)(It.a,{dateAdapter:At.a,children:Object(ge.jsx)(Et.a,{label:"Start date",value:h,onChange:function(e){f(e)},renderInput:function(e){return Object(ge.jsx)(jt.a,Object(a.a)({margin:"normal",fullWidth:!0,variant:"standard"},e))}})})]}),Object(ge.jsx)(it.a,{sx:{padding:"14px 24px 24px"},children:Object(ge.jsx)("button",{disabled:!h,className:"button fullWidth noMargin",type:"submit",children:"Create"})})]})})]})}var Tt=function(e){var t=e.currentState,n=e.handlers,r=e.dialog;return Object(ge.jsx)(ct.a,{open:t.value,sx:{padding:2},maxWidth:"xs",onClose:n.onClose,children:Object(ge.jsxs)("form",{className:"form-submit",children:[Object(ge.jsxs)(ot.a,{children:["Terminate Lockup",Object(ge.jsx)(d.a,{"aria-label":"close",onClick:n.onClose,sx:{position:"absolute",right:8,top:8},children:Object(ge.jsx)(ut.a,{})})]}),Object(ge.jsxs)(st.a,{sx:{maxWidth:"320px"},children:[Object(ge.jsxs)(It.a,{dateAdapter:At.a,children:[r.datePicker&&Object(ge.jsx)(Et.a,{label:"Custom termination date",minDate:new Date,value:r.datePicker.currentState.value,onChange:function(e){r.datePicker.currentState.setValue(e)},renderInput:function(e){return Object(ge.jsx)(jt.a,Object(a.a)({sx:{margin:"0px 0 24px"},margin:"normal",fullWidth:!0,variant:"standard"},e))}}),(null===r||void 0===r?void 0:r.daoSelector)&&Object(ge.jsx)(ht,{selectedAddress:r.daoSelector.currentState.value,setSelectedAddress:r.daoSelector.currentState.setValue}),(null===r||void 0===r?void 0:r.daoProposalDescription)&&Object(ge.jsx)(ft,{proposalDescription:r.daoProposalDescription.currentState.value,setProposalDescription:r.daoProposalDescription.currentState.setValue})]}),Object(ge.jsx)("span",{style:{minHeight:"40px"}}),Object(ge.jsx)("button",{className:"button red fullWidth",style:{marginTop:"40px"},type:"button",onClick:n.onSubmit,children:"Terminate"})]})]})})};var Ut=function(e){var t=Object(l.useContext)(Oe).near,n=e.adminControls,r=e.lockupIndex,s=e.config,d=e.token,p=e.buttonText,b=Object(u.b)().enqueueSnackbar,j=Object(l.useState)(null),h=Object(o.a)(j,2),f=h[0],x=h[1],O=Object(l.useState)(!1),v=Object(o.a)(O,2),g=v[0],k=v[1];if(!t)throw Error("Cannot access lockup api");if(void 0===r)throw Error("Cannot terminate lockup without lockupIndex");var w=function(){var e=Object(c.a)(i.a.mark((function e(){var n,a,c,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b){e.next=2;break}return e.abrupt("return");case 2:return n=f?f.getTime()/1e3:null,e.next=5,t.api.terminate(r,n);case 5:a=e.sent,c=new m.a(a).div(new m.a(10).pow(d.decimals)).round(2,m.a.roundDown),console.log(c),o="Terminated lockup #".concat(r,", refunded ").concat(c," ").concat(d.symbol),b(o,{variant:"success"}),setTimeout((function(){return window.location.reload()}),1e3);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=n&&s,y={currentState:{value:g,setValue:k},handlers:{onClose:function(){return k(!1)},onSubmit:w},dialog:{datePicker:{currentState:{value:f,setValue:x}}}};return Object(ge.jsxs)(ge.Fragment,{children:[_&&Object(ge.jsx)("button",{className:"button",type:"button",onClick:function(){return k(!0)},children:p}),g&&Object(ge.jsx)(Tt,Object(a.a)({},y))]})};var Pt=function(e){var t=Object(l.useContext)(Oe).near,n=e.adminControls,r=e.lockupIndex,c=e.config,s=e.buttonText,i=Object(l.useState)(null),u=Object(o.a)(i,2),d=u[0],p=u[1],b=Object(l.useState)(!1),j=Object(o.a)(b,2),h=j[0],f=j[1],m="Terminate lockup ".concat(r,". Lockup link: ").concat(window.location.href),x=Object(l.useState)(m),O=Object(o.a)(x,2),v=O[0],g=O[1],k=Object(l.useState)((null===c||void 0===c?void 0:c.beneficiary_id)||""),w=Object(o.a)(k,2),_=w[0],y=w[1];if(!t)throw Error("Cannot access lockup api");if(void 0===r)throw Error("Cannot terminate lockup without lockupIndex");var C=n&&c,S={currentState:{value:h,setValue:f},handlers:{onClose:function(){return f(!1)},onSubmit:function(){var e,n=xe(v,t.api.getContract().contractId,r,d?d.getTime()/1e3:null,_);null===(e=window.open(n,"_blank"))||void 0===e||e.focus()}},dialog:{datePicker:{currentState:{value:d,setValue:p}},daoSelector:{currentState:{value:_,setValue:y}},daoProposalDescription:{currentState:{value:v,setValue:g}}}};return Object(ge.jsxs)("div",{children:[Object(ge.jsx)("button",{className:"button",disabled:!C,type:"button",onClick:function(){return f(!0)},style:{marginTop:0},children:s}),h&&Object(ge.jsx)(Tt,Object(a.a)({},S))]})};function Ft(e){var t,n,r,a,c=Object(l.useState)(!1),s=Object(o.a)(c,2),i=s[0],u=s[1],p=e.adminControls,b=e.row,j=e.token,f=Object(l.useContext)(Oe).near;if(!f)return null;var m,x,O=null===b||void 0===b||null===(t=b.termination_config)||void 0===t||null===(n=t.vesting_schedule)||void 0===n?void 0:n.Schedule,v=window.location.href.split("/").pop()===b.account_id,g=window.location.href.split("/").pop()===b.id.toString(),k="".concat(y(b.claimed_balance,j.decimals)),w="".concat(y(b.unclaimed_balance,j.decimals)),C="".concat(y(b.total_balance-b.claimed_balance-b.unclaimed_balance,j.decimals)),S="".concat(y(b.total_balance-b.total_balance,j.decimals));null!==(r=b.termination_config)&&void 0!==r&&r.beneficiary_id?m="Unvested amount will return to ".concat(null===(x=b.termination_config)||void 0===x?void 0:x.beneficiary_id):m="This lockup cannot be terminated";var N,A,I,E=null===b||void 0===b||null===(a=b.termination_config)||void 0===a?void 0:a.beneficiary_id;return Object(ge.jsxs)(ge.Fragment,{children:[Object(ge.jsxs)(Ce.a,{className:i?"expanded exp-row":"exp-row",sx:{"& > *":{borderBottom:"unset"}},children:[Object(ge.jsx)(Se.a,{children:Object(ge.jsx)(d.a,{"aria-label":"expand row",size:"small",onClick:function(){return u(!i)},children:i?Object(ge.jsx)(De.a,{}):Object(ge.jsx)(Ue.a,{})})}),Object(ge.jsx)(Se.a,{align:"left",children:g?b.id:Object(ge.jsx)(h.b,{to:"".concat(b.id),children:b.id})}),Object(ge.jsx)(Se.a,{align:"left",children:v||g?b.account_id:Object(ge.jsx)(h.b,{to:b.account_id,children:b.account_id})}),Object(ge.jsx)(Se.a,{align:"right",children:_(b.schedule[0].timestamp)}),Object(ge.jsx)(Se.a,{align:"right",children:_(b.schedule[b.schedule.length-1].timestamp)}),Object(ge.jsx)(Se.a,{align:"center",children:O?"Yes":"No"}),Object(ge.jsxs)(Se.a,{align:"right",children:[y(b.total_balance,j.decimals),"\xa0",j.symbol,"\xa0",Object(ge.jsx)(Re,{url:j.icon||"",size:32})]}),Object(ge.jsx)(Se.a,{align:"center",children:Object(ge.jsx)(Ae.a,{title:Object(ge.jsxs)("div",{className:"progress-bar__tooltip",children:[Object(ge.jsxs)("span",{children:[Object(ge.jsx)("i",{className:"claimed",children:"\xa0"}),Object(ge.jsx)("b",{children:k})," ","Claimed"]}),Object(ge.jsxs)("span",{children:[Object(ge.jsx)("i",{className:"available",children:"\xa0"}),Object(ge.jsx)("b",{children:w})," ","Available"]}),Object(ge.jsxs)("span",{children:[Object(ge.jsx)("i",{className:"vested",children:"\xa0"}),Object(ge.jsx)("b",{children:C})," ","Vested"]}),Object(ge.jsxs)("span",{children:[Object(ge.jsx)("i",{className:"unvested",children:"\xa0"}),Object(ge.jsx)("b",{children:S})," ","Unvested"]})]}),placement:"top",arrow:!0,children:Object(ge.jsxs)("div",{className:"progress-bar",children:[Object(ge.jsx)("div",{style:{width:"".concat(b.claimed_balance/b.total_balance*100,"%")},className:"claimed",children:"\xa0"}),Object(ge.jsx)("div",{style:{width:"".concat(b.unclaimed_balance/b.total_balance*100,"%")},className:"available",children:"\xa0"}),Object(ge.jsx)("div",{style:{width:"".concat((b.total_balance-b.claimed_balance-b.unclaimed_balance)/b.total_balance*100,"%")},className:"vested",children:"\xa0"}),Object(ge.jsx)("div",{style:{width:"".concat(100*(b.total_balance-b.total_balance),"%")},className:"unvested",children:"\xa0"})]})})})]}),Object(ge.jsx)(Ce.a,{sx:{background:"#F4F7FC"},children:Object(ge.jsx)(Se.a,{style:{padding:0},colSpan:8,children:Object(ge.jsx)(Ie.a,{in:i,timeout:"auto",unmountOnExit:!0,children:Object(ge.jsx)("div",{className:"lockup-row",children:Object(ge.jsxs)("div",{style:{display:"flex",gap:20},children:[Object(ge.jsx)(We,{schedule:b.schedule,title:"Lockup schedule",token:j}),O&&Object(ge.jsx)(We,{schedule:O,title:"Vesting schedule",token:j}),Object(ge.jsxs)("div",{className:"terminate",children:[Object(ge.jsx)("span",{className:"fine-print",children:m}),(N=E,A=f.currentUser.signedAccountId,I=f.currentUser.daos,A&&N===A?Object(ge.jsx)(Ut,{token:j,adminControls:p,lockupIndex:b.id,config:b.termination_config,buttonText:N?"Terminate":"No termination config"}):I.includes(N)?Object(ge.jsx)(Pt,{token:j,adminControls:p,lockupIndex:b.id,config:b.termination_config,buttonText:N?"Terminate with Dao":"No termination config"}):null)]})]})})})})})]})}function Mt(e){var t=e.lockups,n=e.token,r=e.adminControls;return Object(ge.jsxs)(_e.a,{className:"main-table","aria-label":"collapsible table",children:[Object(ge.jsx)(ye.a,{className:"table-head",children:Object(ge.jsxs)(Ce.a,{children:[Object(ge.jsx)(Se.a,{}),Object(ge.jsx)(Se.a,{align:"left",children:"ID"}),Object(ge.jsx)(Se.a,{align:"left",children:"Account ID"}),Object(ge.jsx)(Se.a,{align:"right",children:"Start\xa0date"}),Object(ge.jsx)(Se.a,{align:"right",children:"End\xa0date"}),Object(ge.jsx)(Se.a,{align:"center",children:"Terminatable"}),Object(ge.jsx)(Se.a,{align:"right",children:"Total\xa0amount"}),Object(ge.jsx)(Se.a,{align:"center",children:"Progress"})]})}),Object(ge.jsx)(Ne.a,{children:t.map((function(e){return Object(ge.jsx)(Ft,{row:e,token:n,adminControls:r},e.id)}))})]})}function Rt(e){var t=e.tokenContractId,n=e.favouriteAccounts,r=e.uniqueUsers,a=e.onSave;console.log("unique users",r);var c=Object(l.useRef)(null),o=function(e){return e.replaceAll(" ","").split(",")},s=function(){var e,n=function(e){return JSON.stringify({favouriteAccounts:e})};if(null===c||void 0===c||null===(e=c.current)||void 0===e||!e.value)return localStorage.setItem(t,n([])),void a([]);var r=o(c.current.value);a(r),localStorage.setItem(t,n(r))};return Object(ge.jsx)("div",{style:{display:"flex",marginBottom:"2em"},children:Object(ge.jsx)(jt.a,{inputProps:{sx:{margin:0}},size:"small",sx:{width:1,padding:0,margin:0},id:"outlined-helperText",label:"My accounts",placeholder:"Comma separated list of your near accounts",defaultValue:n.join(", "),inputRef:c,onKeyPress:function(e){return"Enter"===e.key&&s()},onChange:function(e){var t=e.target.value,r=o(t).filter((function(e){return e.match(/.*(\.)(near|testnet)$/)}));n.toString()!==r.toString()&&s()}})})}var Wt=function(e,t,n){return{timestamp:n,balance:function(e,t,n,r,a){if(n<=e)throw new Error("invalid range");if(a<e||a>=n)throw new Error("xM out of bound");return t+(r-t)*(a-e)/(n-e)}(e.timestamp,parseFloat(e.balance),t.timestamp,parseFloat(t.balance),n).toString()}},Lt=function(e,t){if(0===e.length)throw new Error("empty schedule");if(t<e[0].timestamp)return{timestamp:t,balance:e[0].balance};if(t>=e[e.length-1].timestamp)return{timestamp:t,balance:e[e.length-1].balance};for(var n=0;n<e.length-1;n++)if(!(e[n+1].timestamp<=t))return Wt(e[n],e[n+1],t);throw new Error("unreachable")},Gt=function(e){if(0===e.length)throw new Error("schedules is empty");var t=Array.from(new Set(e.flat().map((function(e){return e.timestamp})).sort((function(e,t){return e-t})))),n=[];return t.forEach((function(t){for(var r=new f.Big(0),a=0;a<e.length;a++){var c=new f.Big(Lt(e[a],t).balance);r=r.plus(c)}n.push({timestamp:t,balance:r.toString()})})),n};function Bt(e){var t,n=e.lockups,r=e.token,a=e.adminControls,c=Array.from(new Set(n.map((function(e){return e.account_id})))),s=Object(l.useContext)(Oe).near,i=s.currentUser,u=i.signedIn,d=i.isAdmin,p=localStorage.getItem(r.contractId),b=p?null===(t=JSON.parse(p))||void 0===t?void 0:t.favouriteAccounts:[],j=Object(l.useState)(b),f=Object(o.a)(j,2),m=f[0],x=f[1],O=n.filter((function(e){return m.includes(e.account_id)})),v=function(e){var t,n=Array.from(e.map((function(e){return e.schedule}))),a=Math.round((new Date).getTime()/1e3),c=e.map((function(e){return e.schedule[0].timestamp})),o=e.map((function(e){var t,n;return null===e||void 0===e||null===(t=e.termination_config)||void 0===t||null===(n=t.vesting_schedule[0])||void 0===n?void 0:n.timestamp})).filter((function(e){return e})),s=Math.min.apply(Math,Object(wt.a)(c).concat(Object(wt.a)(o),[a])),i=Array.from(e.map((function(e){var t,n,r,a,c=null===e||void 0===e||null===(t=e.termination_config)||void 0===t||null===(n=t.vesting_schedule)||void 0===n?void 0:n.Schedule;return c||(c||(r=s,a=e.schedule[e.schedule.length-1].balance,[{timestamp:r-1,balance:"0"},{timestamp:r,balance:a}]))}))),l=Gt(i),u=Gt(n);(null===(t=l[l.length-1])||void 0===t?void 0:t.timestamp)!==u[u.length-1].timestamp&&l.push(u[u.length-1]);var d=function(e,t){return e.map((function(e){return[1e3*e.timestamp,y(e.balance,t)]}))};return{unlocked:e.length?d(u,r.decimals):[],vested:e.length?d(l,r.decimals):[]}},g=function(e){return e.length>0?Object(ge.jsxs)(ge.Fragment,{children:[Object(ge.jsx)(Ct,{data:v(e)}),u&&a&&d&&Object(ge.jsx)(Dt,{token:r}),Object(ge.jsx)(_t.a,{sx:{boxShadow:"unset",margin:"0 0 20px"},children:Object(ge.jsx)(Mt,{lockups:e,token:r,adminControls:a})})]}):Object(ge.jsxs)("div",{children:["There are no lockups yet.",a&&Object(ge.jsxs)("div",{children:["Create single lockup or create batch of them via"," ",Object(ge.jsx)(h.b,{to:"/".concat(s.lockupContractId,"/admin/import_draft_group"),children:"Draft Groups"}),"."]})]})};return console.log("favouriteAccountsLockups",O),a?Object(ge.jsx)("div",{className:"main",children:Object(ge.jsx)("div",{className:"container",children:g(n)})}):Object(ge.jsx)("div",{className:"main",children:Object(ge.jsxs)("div",{className:"container",children:[Object(ge.jsx)(Rt,{tokenContractId:r.contractId,favouriteAccounts:m,uniqueUsers:c,onSave:x}),g(O)]})})}var Vt=n(386);function Jt(e){var t=e.message,n=e.isOpen,r=e.closeFn,a=e.callback;return Object(ge.jsxs)(ct.a,{open:n,sx:{padding:2},maxWidth:"md",onClose:r,children:[Object(ge.jsxs)(ot.a,{children:["Confirmation",Object(ge.jsx)(d.a,{"aria-label":"close",sx:{position:"absolute",right:8,top:8},onClick:r,children:Object(ge.jsx)(ut.a,{})})]}),Object(ge.jsx)(st.a,{sx:{minWidth:"320px"},children:Object(ge.jsx)("div",{children:t})}),Object(ge.jsxs)(it.a,{children:[Object(ge.jsx)(Vt.a,{color:"error",onClick:r,children:"Cancel"}),Object(ge.jsx)(Vt.a,{color:"success",variant:"contained",onClick:function(){r(),a()},children:"Confirm"})]})]})}var Ht=function(e){var t=Object(l.useContext)(Oe).near,n=e.accountId,r=e.token,a=e.total,s=Object(l.useState)(!1),u=Object(o.a)(s,2),d=u[0],p=u[1],b=Object(l.useState)((function(){return null})),j=Object(o.a)(b,2),h=j[0],f=j[1];if(!t)throw Error("Cannot access lockup api");if(!n)throw Error("Undefined account cannot claim");var m="\n    Your account doesn't have storage deposit on the token contract. You will be redirected to pay for the storage, after that you will be able to claim your tokens.\n  ".trim();return Object(ge.jsxs)("div",{className:"claim-wrapper",children:[Object(ge.jsx)("h5",{children:"Total available"}),Object(ge.jsx)(rt,{token:r,amount:a}),Object(ge.jsx)("button",{className:"button fullWidth",type:"button",onClick:function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var r,a,c,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(t.tokenApi){e.next=4;break}return e.abrupt("return");case 4:if(t.noLoginTokenApi){e.next=6;break}return e.abrupt("return");case 6:if(t.tokenContractId){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,t.tokenApi.storageBalanceOf(n);case 10:if(r=e.sent,!(null!==r&&!0)){e.next=16;break}t.noLoginApi.claim(n),e.next=23;break;case 16:return e.next=18,t.tokenApi.storageBalanceBounds();case 18:a=e.sent,c=a.max,o=function(){t.noLoginTokenApi.storageDeposit(t.tokenContractId,n,c)},f((function(){return o})),p(!0);case 23:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()},children:"Claim All"}),Object(ge.jsx)(Jt,{message:m,isOpen:d,closeFn:function(){return p(!1)},callback:h})]})};function Kt(e){var t=e.lockups,n=e.token,r=e.adminControls,a=Object(j.h)(),c=a.userId,o=a.id,s=t.filter((function(e){return o?e.id.toString()===o:e.account_id===c||e.id.toString()===c})),i=s.reduce((function(e,t){return e+parseFloat(t.unclaimed_balance)}),0);return console.log("user lockups",c,s),Object(ge.jsxs)("div",{className:"container",children:[!r&&Object(ge.jsx)(Ht,{accountId:c,token:n,total:y(i,n.decimals)}),Object(ge.jsx)(_t.a,{sx:{boxShadow:"unset"},children:Object(ge.jsxs)(_e.a,{className:"main-table","aria-label":"collapsible table",children:[Object(ge.jsx)(ye.a,{className:"table-head",children:Object(ge.jsxs)(Ce.a,{children:[Object(ge.jsx)(Se.a,{}),Object(ge.jsx)(Se.a,{align:"left",children:"ID"}),Object(ge.jsx)(Se.a,{align:"left",children:"Account ID"}),Object(ge.jsx)(Se.a,{align:"right",children:"Start\xa0date"}),Object(ge.jsx)(Se.a,{align:"right",children:"End\xa0date"}),Object(ge.jsx)(Se.a,{align:"right",children:"Terminatable"}),Object(ge.jsx)(Se.a,{align:"right",children:"Total\xa0amount"}),Object(ge.jsx)(Se.a,{align:"center",children:"Progress"})]})}),Object(ge.jsx)(Ne.a,{children:s.map((function(e){return Object(ge.jsx)(Ft,{row:e,token:n,adminControls:r},e.id)}))})]})})]})}function qt(e){var t=e.adminControls,n=Object(j.f)(),r=n.pathname.split("/")[1],a=Object(l.useContext)(Oe),c=a.near,o=a.signOut;if(Object(l.useEffect)((function(){return console.log(n.pathname),function(){}}),[n]),!c)return null;var s=c.currentUser,i=s.signedIn,u=s.signedAccountId,d=s.isAdmin,p=s.isCouncilMember,b=t&&(d||p);return Object(ge.jsx)("div",{className:"header",children:Object(ge.jsx)("div",{className:"container",children:Object(ge.jsxs)(gt.a,{sx:{display:"flex"},children:[Object(ge.jsx)(h.b,{className:"logo",to:"/",children:"LOCKUPS"}),Object(ge.jsxs)("div",{className:"nav",children:[Object(ge.jsx)(h.c,{className:"nav-link",to:"/".concat(r,b?"/admin/lockups":"/lockups"),children:"Lockups"}),Object(ge.jsx)(h.c,{className:"nav-link",to:"/".concat(r,t?"/admin/draft_groups":"/draft_groups"),children:"Lockup Drafts"}),Object(ge.jsx)(h.c,{className:"nav-link",to:"/".concat(r,t?"/admin/about":"/about"),children:"About"})]}),t&&i&&Object(ge.jsxs)(gt.a,{sx:{marginTop:"23px"},children:[Object(ge.jsx)("span",{className:"account-name",children:u}),Object(ge.jsx)("button",{className:"button",type:"button",onClick:o,children:"Log out"})]})]})})})}function Yt(e){var t=e.children;return Object(ge.jsx)("div",{className:"container login",children:t})}var zt=function(){var e=Object(l.useContext)(Oe),t=e.near,n=e.signIn;if(!t)return null;var r=t.currentUser,a=r.signedIn,c=r.isAdmin,o=r.isCouncilMember,s=a&&!(c||o),i=a&&(c||o);return Object(ge.jsxs)(Yt,{children:[s&&Object(ge.jsx)(tt.a,{sx:{margin:2,width:"500px"},severity:"error",children:"You are not admin"}),!a&&Object(ge.jsx)("button",{className:"button",type:"button",onClick:n,children:"Sign In"}),i&&Object(ge.jsx)(j.a,{to:"lockups",replace:!0})]})};function $t(){var e=Object(l.useContext)(Oe).near;return Object(ge.jsx)("div",{children:Object(ge.jsxs)("div",{style:{maxWidth:640,margin:"auto",paddingTop:20},children:[Object(ge.jsx)("p",{children:"Please pay for the account storage in fungible token contract. This is necessary to allow lockup contract to hold locked fungible token funds. This is a one time payment for the lockup contract. Additionally, all users claiming lockups will have to pay for the storage for their account too."}),Object(ge.jsx)("button",{className:"button fullWidth",type:"button",onClick:function(){var t=function(){var t=Object(c.a)(i.a.mark((function t(){var n,r,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(e.tokenApi){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,e.tokenApi.storageBalanceBounds();case 6:return n=t.sent,r=n.max,console.log(r),t.next=11,e.tokenApi.storageDeposit(e.lockupContractId,r);case 11:a=t.sent,console.log(a);case 13:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()},children:"Pay"})]})})}function Zt(e){var t=e.children,n=Object(j.f)(),r=Object(l.useContext)(Oe).near;if(!r)return null;var a=r.currentUser,c=a.signedIn,o=a.isAdmin,s=a.isCouncilMember,i=n.pathname.split("/")[1];return c&&(o||s)?r.isContractFtStoragePaid?t:Object(ge.jsx)("div",{className:"container",children:Object(ge.jsx)($t,{})}):Object(ge.jsx)(j.a,{to:"/".concat(i,"/admin"),replace:!0})}var Qt=n(195),Xt=n.n(Qt);function en(e){var t=e.lockups,n=Object(l.useState)(x),r=Object(o.a)(n,2),a=r[0],c=r[1],s=Object(j.g)();return Object(ge.jsxs)("div",{className:"root",children:[Object(ge.jsx)("div",{className:"header",children:Object(ge.jsx)("div",{className:"container",children:Object(ge.jsx)(gt.a,{sx:{display:"flex"},children:Object(ge.jsx)(h.b,{className:"logo",to:"/",children:"LOCKUPS"})})})}),Object(ge.jsx)("div",{className:"main",children:Object(ge.jsxs)("div",{className:"container home",children:[Object(ge.jsxs)("ul",{className:"home-list",children:[Object(ge.jsx)("li",{children:Object(ge.jsxs)("div",{children:[Object(ge.jsx)("span",{children:"Total contracts"}),Object(ge.jsx)("b",{children:"256"})]})}),Object(ge.jsx)("li",{children:Object(ge.jsxs)("div",{children:[Object(ge.jsx)("span",{children:"Total locked"}),Object(ge.jsx)("b",{children:"$5,336,000"})]})}),Object(ge.jsx)("li",{children:Object(ge.jsxs)("div",{children:[Object(ge.jsx)("span",{children:"Total lockups"}),Object(ge.jsx)("b",{children:(null===t||void 0===t?void 0:t.length)||42})]})})]}),Object(ge.jsx)("h2",{children:"Manage token vesting on NEAR"}),Object(ge.jsx)("p",{children:"Create new lockup contract to be used by startup"}),Object(ge.jsx)(h.b,{to:"/new_lockup_contract",className:"button link-button",children:"Create Lockup Contract"}),Object(ge.jsx)("div",{className:"line"}),Object(ge.jsxs)("div",{className:"search-container",children:[Object(ge.jsx)(jt.a,{variant:"outlined",value:a,onChange:function(e){c(e.target.value)},className:"input",placeholder:"Enter existing Lockup contract address",InputProps:{startAdornment:Object(ge.jsx)(St.a,{position:"start",children:Object(ge.jsx)(Xt.a,{})})}}),Object(ge.jsx)("button",{className:"button",onClick:function(){var e="/".concat(a,"/lockups");s(e),window.location.reload()},"aria-label":"open",type:"button",children:"Search"})]})]})})]})}function tn(){return Object(ge.jsx)("div",{className:"container",children:"Contract not found"})}n(309);function nn(){var e=Object(j.f)(),t=e.pathname,n=e.pathname.includes("admin"),r=t.indexOf("/",1),a="".concat(t.substring(0,r),"/admin").concat(t.substring(r,t.length));return Object(l.useContext)(Oe).near?Object(ge.jsx)("div",{className:"footer",children:Object(ge.jsx)("div",{className:"container",children:Object(ge.jsx)(gt.a,{sx:{display:"flex"},children:Object(ge.jsxs)("div",{className:"nav",children:[Object(ge.jsx)(h.b,{className:"nav-link",to:"/terms",children:"Terms"}),Object(ge.jsx)(h.b,{className:"nav-link",to:"/privacy",children:"Privacy"}),n?Object(ge.jsx)(h.b,{className:"nav-link",to:t.replace(/\/admin/,""),children:"User view"}):Object(ge.jsx)(h.b,{className:"nav-link",to:a,children:"Admin view"})]})})})}):null}function rn(e){var t=e.token,n=e.adminControls,r=parseInt(Object(j.h)().draftId||"",10),a=Object(l.useContext)(Oe).near,s=Object(l.useState)(),u=Object(o.a)(s,2),d=u[0],p=u[1];Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("fetchDraft called"),a){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,a.api.getDrafts([r]);case 5:t=e.sent,n=t.map((function(e){return Object.assign(e[1].lockup_create,{id:e[0]})})),p(n[0]);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[a,r]),console.log(d);return Object(ge.jsx)("div",{className:"container",children:d&&Object(ge.jsxs)(_e.a,{className:"main-table","aria-label":"collapsible table",children:[Object(ge.jsx)(ye.a,{className:"table-head",children:Object(ge.jsxs)(Ce.a,{children:[Object(ge.jsx)(Se.a,{}),Object(ge.jsx)(Se.a,{align:"left",children:"ID"}),Object(ge.jsx)(Se.a,{align:"left",children:"Account ID"}),Object(ge.jsx)(Se.a,{align:"right",children:"Start\xa0date"}),Object(ge.jsx)(Se.a,{align:"right",children:"End\xa0date"}),Object(ge.jsx)(Se.a,{align:"right",children:"Total\xa0amount"}),false]})}),Object(ge.jsx)(Ne.a,{children:Object(ge.jsx)(Le,{row:d,token:t,adminControls:n,progressShow:false})})]})})}function an(e){var t=e.lockups,n=e.token,r=e.contractId,c=e.near;return t?Object(ge.jsxs)(ge.Fragment,{children:[Object(ge.jsx)(qt,{adminControls:!1}),Object(ge.jsxs)(j.d,{children:[Object(ge.jsx)(j.b,{path:"/",element:Object(ge.jsx)(j.a,{replace:!0,to:"lockups"})}),Object(ge.jsx)(j.b,{path:"/about",element:Object(ge.jsx)(ke,{lockups:t,token_account_id:r})}),Object(ge.jsx)(j.b,{path:"/lockups",element:r&&c&&Object(ge.jsx)(Bt,{lockups:t,token:Object(a.a)(Object(a.a)({},n),{},{contractId:r}),adminControls:!1})}),Object(ge.jsx)(j.b,{path:"/lockups/:userId",element:Object(ge.jsx)(Kt,{lockups:t,token:n,adminControls:!1})}),Object(ge.jsx)(j.b,{path:"/lockups/:userId/:id",element:Object(ge.jsx)(Kt,{lockups:t,token:n,adminControls:!1})}),Object(ge.jsx)(j.b,{path:"/draft_groups",element:Object(ge.jsx)(vt,{token:n,adminControls:!1})}),Object(ge.jsx)(j.b,{path:"/draft_groups/:draftGroupId",element:Object(ge.jsx)(Ot,{token:n,adminControls:!1})}),Object(ge.jsx)(j.b,{path:"/drafts/:draftId",element:Object(ge.jsx)(rn,{token:n,adminControls:!1})})]})]}):null}function cn(e){var t=e.lockups,n=e.token,r=e.tokenContractId,c=e.near;if(!t)return null;var o=r&&c;return Object(ge.jsxs)(ge.Fragment,{children:[Object(ge.jsx)(qt,{adminControls:!0}),Object(ge.jsxs)(j.d,{children:[Object(ge.jsx)(j.b,{path:"/",element:Object(ge.jsx)(zt,{})}),Object(ge.jsx)(j.b,{path:"/about",element:Object(ge.jsx)(ke,{lockups:t,token_account_id:r})}),Object(ge.jsx)(j.b,{path:"/lockups",element:o&&Object(ge.jsx)(Zt,{children:Object(ge.jsx)(Bt,{lockups:t,token:Object(a.a)(Object(a.a)({},n),{},{contractId:r}),adminControls:!0})})}),Object(ge.jsx)(j.b,{path:"/lockups/:userId",element:Object(ge.jsx)(Zt,{children:Object(ge.jsx)(Kt,{lockups:t,token:n,adminControls:!0})})}),Object(ge.jsx)(j.b,{path:"/lockups/:userId/:id",element:Object(ge.jsx)(Zt,{children:Object(ge.jsx)(Kt,{lockups:t,token:n,adminControls:!0})})}),Object(ge.jsx)(j.b,{path:"/draft_groups",element:Object(ge.jsx)(Zt,{children:Object(ge.jsx)(vt,{token:n,adminControls:!0})})}),Object(ge.jsx)(j.b,{path:"/draft_groups/:draftGroupId",element:Object(ge.jsx)(Zt,{children:Object(ge.jsx)(Ot,{token:n,adminControls:!0})})}),Object(ge.jsx)(j.b,{path:"/drafts/:draftId",element:Object(ge.jsx)(rn,{token:n,adminControls:!0})}),Object(ge.jsx)(j.b,{path:"/import_draft_group",element:Object(ge.jsx)(Zt,{children:Object(ge.jsx)(et,{token:n,adminControls:!0})})})]})]})}function on(){var e=Object(u.b)().enqueueSnackbar,t=Object(l.useContext)(Oe).near,n=Object(l.useState)({}),r=Object(o.a)(n,2),a=r[0],s=r[1],d=Object(l.useState)(null),p=Object(o.a)(d,2),b=p[0],f=p[1],x=Object(l.useState)({decimals:0,icon:null,name:"",reference:null,reference_hash:null,spec:"",symbol:""}),O=Object(o.a)(x,2),v=O[0],g=O[1];Object(l.useEffect)((function(){if(e&&t&&v&&""!==v.spec){var n=function(){var n=Object(c.a)(i.a.mark((function n(){var r,a,c,o,s,l,u,d,p,b,j,h,f,x,O,g,k,_,y,C,S,N,I,E,D,T;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=new URLSearchParams(window.location.search),a=r.get("transactionHashes")){n.next=4;break}return n.abrupt("return");case 4:return c=a.split(",")[0],console.log("txHash",c),n.next=8,t.rpcProvider.txStatus(c,"sender.testnet");case 8:if(o=n.sent,console.log(o),s=o.transaction.actions[0].FunctionCall.method_name,l=o.status.SuccessValue,u=JSON.parse(atob(o.transaction.actions[0].FunctionCall.args)),"claim"!==s){n.next=22;break}if(!l){n.next=20;break}if("0"===(d=JSON.parse(atob(l)))){n.next=20;break}return p=new m.a(d).div(new m.a(10).pow(v.decimals)).round(2,m.a.roundDown),e("Claimed ".concat(p," ").concat(v.symbol),{variant:"success"}),n.abrupt("return");case 20:return e("Claim failed: ".concat(A(c)),{variant:"error"}),n.abrupt("return");case 22:if("storage_deposit"!==s){n.next=30;break}return b=JSON.parse(atob(l)),j=parseFloat(w(b.total,9)).toString(),console.log(j),h=u.account_id,f="Successfully paid ".concat(j,"N for FT storage of ").concat(h),e(f,{variant:"success"}),n.abrupt("return");case 30:if("ft_transfer_call"!==s){n.next=58;break}if(x=JSON.parse(u.msg),console.log(x),!x.schedule){n.next=45;break}if(O=JSON.parse(atob(l)),g=new m.a(O).div(new m.a(10).pow(v.decimals)).round(2,m.a.roundDown),console.log(g),x.schedule[x.schedule.length-1].balance!==O){n.next=42;break}return k="Created lockup for ".concat(x.account_id," with amount ").concat(g," ").concat(v.symbol),e(k,{variant:"success"}),n.abrupt("return");case 42:return _="Failed to create lockup for ".concat(x.account_id,": ").concat(A(c)),e(_,{variant:"error"}),n.abrupt("return");case 45:if(null===x.draft_group_id){n.next=56;break}if(y=JSON.parse(atob(l)),C=new m.a(y).div(new m.a(10).pow(v.decimals)).round(2,m.a.roundDown),console.log(C),"0"===y){n.next=53;break}return S="Funded draft group ".concat(x.draft_group_id," with amount ").concat(C," ").concat(v.symbol),e(S,{variant:"success"}),n.abrupt("return");case 53:return N="Failed to fund draft group ".concat(x.draft_group_id,": ").concat(A(c)),e(N,{variant:"error"}),n.abrupt("return");case 56:return e("Transaction performed, TODO ".concat(c,"!"),{variant:"warning"}),n.abrupt("return");case 58:if("terminate"!==s){n.next=68;break}if(!l){n.next=66;break}return I=JSON.parse(atob(l)),console.log(I),E=new m.a(I).div(new m.a(10).pow(v.decimals)).round(2,m.a.roundDown),D="Terminated lockup #".concat(u.lockup_index,", unvested amount: ").concat(E),e(D,{variant:"success"}),n.abrupt("return");case 66:return e("Terminate lockup failed: ".concat(A(c)),{variant:"error"}),n.abrupt("return");case 68:T='UNHANDLED Transaction "'.concat(s,'" : ').concat(A(c)),e(T,{variant:"warning"});case 70:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();n()}}),[e,t,v]),Object(l.useEffect)((function(){var e=!0;if(t){var n=function(){var n=Object(c.a)(i.a.mark((function n(){var r,a;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.api.loadAllLockups();case 2:return r=n.sent,n.next=5,t.tokenApi.ftMetadata();case 5:if(a=n.sent,e){n.next=8;break}return n.abrupt("return");case 8:g(a),s({lockups:r,name:"name"});case 10:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();t.tokenContractId&&n()}return function(){e=!1}}),[t]),Object(l.useEffect)((function(){return t&&t.tokenApi&&f(t.tokenApi.getContract().contractId),function(){}}),[t]);var k=a.lockups;return Object(ge.jsxs)(h.a,{children:[Object(ge.jsxs)(j.d,{children:[Object(ge.jsx)(j.b,{path:"/",element:Object(ge.jsx)(en,{lockups:k})}),Object(ge.jsx)(j.b,{path:"/new_lockup_contract/",element:Object(ge.jsx)(kt,{})}),Object(ge.jsx)(j.b,{path:"/:cid/*",element:b&&t&&Object(ge.jsx)(an,{lockups:k,token:v,contractId:b,near:t})}),Object(ge.jsx)(j.b,{path:"/:cid/admin/*",element:b&&t&&Object(ge.jsx)(cn,{lockups:k,token:v,tokenContractId:b,near:t})}),Object(ge.jsx)(j.b,{path:"/:cid/not_found_contract/",element:Object(ge.jsx)(tn,{})}),Object(ge.jsx)(j.b,{path:"*",element:Object(ge.jsx)(tn,{})})]}),Object(ge.jsx)(nn,{})]})}n(310);function sn(e){var t=e.snackbarKey,n=Object(u.b)().closeSnackbar;return Object(ge.jsx)(d.a,{onClick:function(){return n(t)},children:Object(ge.jsx)(b.a,{style:{color:"white"}})})}function ln(){var e=Object(l.useState)(null),t=Object(o.a)(e,2),n=t[0],r=t[1];Object(l.useEffect)((function(){function e(){return(e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ve();case 2:t=e.sent,r(t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}try{!function(){e.apply(this,arguments)}()}catch(t){console.log(t)}}),[]);var s=Object(l.useMemo)((function(){return{near:n,signIn:function(){var e;null===n||void 0===n||null===(e=n.api)||void 0===e||e.signIn()},signOut:function(){n&&(n.api.signOut(),r(Object(a.a)(Object(a.a)({},n),{},{currentUser:{signedIn:!1,signedAccountId:null,isAdmin:!1,isCouncilMember:!1,daos:[]}})))}}}),[n]);return Object(ge.jsx)(l.StrictMode,{children:Object(ge.jsx)(Oe.Provider,{value:s,children:Object(ge.jsx)(u.a,{autoHideDuration:null,action:function(e){return Object(ge.jsx)(sn,{snackbarKey:e})},onClose:function(){var e=new URL(window.location.href),t=new URLSearchParams(e.search);t.delete("transactionHashes"),e.search=t.toString(),window.history.pushState({},null,e.toString())},children:Object(ge.jsx)(on,{})})})})}Object(r.render)(Object(ge.jsx)(ln,{}),document.getElementById("root"))}},[[311,1,2]]]);
//# sourceMappingURL=main.8909f774.chunk.js.map