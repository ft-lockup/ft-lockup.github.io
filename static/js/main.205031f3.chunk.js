(this["webpackJsonpft-lockup-contract-frontend"]=this["webpackJsonpft-lockup-contract-frontend"]||[]).push([[0],{242:function(e,t){},252:function(e,t){},305:function(e,t,n){},309:function(e,t,n){},310:function(e,t,n){},311:function(e,t,n){"use strict";n.r(t);var r=n(59),a=n(31),c=n(15),o=n(17),s=n(8),i=n.n(s),l=n(2),u=n(38),d=n(394),p=n(196),b=n.n(p),h=n(23),j=n(24),f=n(19),m=n.n(f),x=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).DEFAULT_CONTRACT_NAME||"example.factory010.ft-lockup.testnet",v=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).FACTORY_CONTRACT_NAME||"factory010.ft-lockup.testnet",O=function(){var e=window.location.hash.split("/")[1];return"new_lockup_contract"===e?v:e}();console.log(O);var g=function(){var e=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_ENVIRONMENT||"development";switch(e){case"production":case"mainnet":return{networkId:"mainnet",nodeUrl:"https://rpc.mainnet.near.org",contractName:O,walletUrl:"https://wallet.near.org",helperUrl:"https://helper.mainnet.near.org",explorerUrl:"https://explorer.mainnet.near.org",factoryContractName:v};case"development":case"testnet":return{networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",contractName:O,walletUrl:"https://wallet.testnet.near.org",helperUrl:"https://helper.testnet.near.org",explorerUrl:"https://explorer.testnet.near.org",factoryContractName:v};case"betanet":return{networkId:"betanet",nodeUrl:"https://rpc.betanet.near.org",contractName:O,walletUrl:"https://wallet.betanet.near.org",helperUrl:"https://helper.betanet.near.org",explorerUrl:"https://explorer.betanet.near.org",factoryContractName:v};case"local":return{explorerUrl:"",helperUrl:"",networkId:"local",nodeUrl:"http://localhost:3030",walletUrl:"http://localhost:4000/wallet",contractName:O,factoryContractName:v};case"test":case"ci":return{explorerUrl:"",helperUrl:"",walletUrl:"",networkId:"shared-test",nodeUrl:"https://rpc.ci-testnet.near.org",contractName:O,factoryContractName:v};case"ci-betanet":return{explorerUrl:"",helperUrl:"",walletUrl:"",networkId:"shared-test-staging",nodeUrl:"https://rpc.ci-betanet.near.org",contractName:O,factoryContractName:v};default:throw Error("Unconfigured environment '".concat(e,"'. Can be configured in src/config.js."))}}(),k=3e14;m.a.DP=40,m.a.PE=40;var w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2?arguments[2]:void 0;return m.a.DP=40,m()(e||"0").div(Math.pow(10,24)).toFixed(0===t?void 0:t,n)},y=function(e){return new Date(1e3*e).toLocaleDateString("en-US")},_=function(e,t){return m()(e||"0").div(Math.pow(10,t)).toFixed(2)},C=function(e,t){return new Date(new Date(e).setFullYear(e.getFullYear()+t)).getTime()/1e3},S=function(e){var t=864e5;return new Date(Math.floor(e.getTime()/t)*t)},N=function(e,t){return new Date(e.getTime()+864e5*t)},I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"dump",t=Object.keys(localStorage).map((function(e){return[e,localStorage.getItem(e)]}));localStorage.setItem(e,JSON.stringify(t))},A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"dump",t=localStorage.getItem(e);if(t){var n=JSON.parse(t);localStorage.clear(),n.forEach((function(e){return localStorage.setItem(e[0],e[1])}))}},E=function(e){return"".concat(g.explorerUrl,"/transactions/").concat(e)},D=n(29),T=n(55),U=n(56),F=["get_draft_group","get_draft_groups_paged","get_drafts","get_lockups_paged","get_token_account_id","get_deposit_whitelist"],P=["create_draft","create_drafts","create_draft_group","convert_draft","convert_drafts","terminate","discard_draft_group","delete_drafts"],L=function(){function e(t){Object(T.a)(this,e),this.near=void 0,this.contract=void 0,this.walletConnection=void 0,this.near=t,this.walletConnection=new D.WalletConnection(t,t.config.contractName),this.contract=new D.Contract(this.walletConnection.account(),this.near.config.contractName,{viewMethods:F,changeMethods:P})}return Object(U.a)(e,[{key:"getDraftGroupsAll",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.get_draft_groups_paged();case 2:return t=e.sent,e.abrupt("return",t.map((function(e){var t=Object(o.a)(e,2),n=t[0],r=t[1];return Object.assign(r,{id:n})})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDraftGroup",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.get_draft_group({index:t});case 2:return(n=e.sent)&&(n.id=t),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDrafts",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.get_drafts({indices:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createDraftGroup",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.create_draft_group();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createDraft",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.create_draft({draft:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createDrafts",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.create_drafts({args:{drafts:t},gas:"300000000000000"});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"convertDraft",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.convert_draft({draft_id:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"convertDrafts",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.convert_drafts({args:{draft_ids:t},gas:"300000000000000"});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"discardDraftGroup",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.discard_draft_group({args:{draft_group_id:t}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteDrafts",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.delete_drafts({args:{draft_ids:t}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"terminate",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.contract.terminate({args:{lockup_index:t,termination_timestamp:n},gas:k,amount:1});case 3:return r=e.sent,e.abrupt("return",r);case 7:throw e.prev=7,e.t0=e.catch(0),console.log(e.t0),Error("Cannot terminate lockup");case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNear",value:function(){return this.near}},{key:"getWalletConnection",value:function(){return this.walletConnection}},{key:"getContract",value:function(){return this.contract}},{key:"getTokenAccountId",value:function(){return this.contract.get_token_account_id()}},{key:"getDepositWhitelist",value:function(){return this.contract.get_deposit_whitelist()}},{key:"loadAllLockups",value:function(){return this.contract.get_lockups_paged().then((function(e){return e.map((function(e){var t=Object(o.a)(e,2),n=t[0],r=t[1];return Object.assign(r,{id:n})}))}))}},{key:"signIn",value:function(){var e="".concat(window.location.href);this.walletConnection.requestSignIn(this.near.config.contractName,void 0,e)}},{key:"signOut",value:function(){this.walletConnection.signOut(),this.near.config.keyStore.clear()}},{key:"get_account_id",value:function(){return this.walletConnection.getAccountId()}},{key:"account",value:function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.near.account(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get_balance",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n,r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.account(t);case 2:return n=e.sent,r=null,e.prev=4,e.next=7,n.getAccountBalance();case 7:a=e.sent,c=a.total,r=parseFloat(D.utils.format.formatNearAmount(c||"0")),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),console.error("Account not exist");case 14:return e.abrupt("return",r);case 15:case"end":return e.stop()}var c}),e,this,[[4,11]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),M=L,W=n(104),R=n(86),B=n(87),G=n(30),V=n.n(G),J=function(){var e=Object(W.a)(V.a.mark((function e(t,n){var r,a,c;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.query({request_type:"view_access_key_list",account_id:n,finality:"optimistic"});case 2:if(a=e.sent,null!==(r=a.keys)&&void 0!==r&&r.length){e.next=5;break}throw Error("None of access keys was founded");case 5:if(null!==(c=a.keys.filter((function(e){var t,n;return"string"===typeof(null===e||void 0===e||null===(t=e.access_key)||void 0===t?void 0:t.permission)&&"FullAccess"===(null===e||void 0===e||null===(n=e.access_key)||void 0===n?void 0:n.permission)})))&&void 0!==c&&c.length){e.next=8;break}throw Error("None of full access keys was founded");case 8:return e.abrupt("return",c[0]);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),H=J,q=[""],K=["claim"],Y=function(){function e(t){Object(R.a)(this,e),this.near=void 0,this.near=t}return Object(B.a)(e,[{key:"claim",value:function(){var e=Object(W.a)(V.a.mark((function e(t){return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I(),e.next=3,this.setWalletAndContractWithAuth(t);case 3:return e.next=5,this.buildContract().claim({},k);case 5:this.near.config.keyStore.clean();case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setWalletAndContractWithAuth",value:function(){var e=Object(W.a)(V.a.mark((function e(t){var n,r,a=arguments;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:this.near.config.contractName,e.next=3,H(this.near.connection.provider,t);case 3:r=e.sent,localStorage.setItem("".concat(n,"_wallet_auth_key"),JSON.stringify({accountId:t,allKeys:[r.public_key]}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"buildContract",value:function(){return new D.Contract(new D.WalletConnection(this.near,this.near.config.contractName).account(),this.near.config.contractName,{viewMethods:q,changeMethods:K})}}]),e}(),z=Y,$=[""],Z=["storage_deposit"],Q=function(){function e(t){Object(T.a)(this,e),this.near=void 0,this.near=t}return Object(U.a)(e,[{key:"storageDeposit",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I(),e.next=3,this.setWalletAndContractWithAuth(n);case 3:return e.next=5,this.buildContract(t).storage_deposit({args:{account_id:n},gas:k,amount:r});case 5:this.near.config.keyStore.clean();case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"setWalletAndContractWithAuth",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n,r,a=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:this.near.config.contractName,e.next=3,H(this.near.connection.provider,t);case 3:r=e.sent,localStorage.setItem("".concat(n,"_wallet_auth_key"),JSON.stringify({accountId:t,allKeys:[r.public_key]}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"buildContract",value:function(e){return new D.Contract(new D.WalletConnection(this.near,this.near.config.contractName).account(),e,{viewMethods:$,changeMethods:Z})}}]),e}(),X=Q,ee=n(201),te=["msg"],ne=3e14,re=["ft_metadata","storage_balance_of","storage_balance_bounds"],ae=["ft_transfer_call","storage_deposit"],ce=function(){function e(t,n){Object(T.a)(this,e),this.contract=void 0,this.contract=new D.Contract(t.account(),n,{viewMethods:re,changeMethods:ae})}return Object(U.a)(e,[{key:"getContract",value:function(){return this.contract}},{key:"createLockup",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n,r,a,c){var o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ftTransferCall({receiver_id:t,amount:n.toString(),msg:{account_id:r,schedule:a,vesting_schedule:c?{Schedule:c}:null}});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,c){return e.apply(this,arguments)}}()},{key:"fundDraftGroup",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n,r){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ftTransferCall({receiver_id:t,amount:r,msg:{draft_group_id:n,try_convert:!0}});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"ftTransferCall",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n,r,c,o,s=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:ne,r=s.length>2&&void 0!==s[2]?s[2]:1,c=t.msg,o=Object(ee.a)(t,te),e.next=5,this.contract.ft_transfer_call(Object(a.a)({msg:JSON.stringify(c)},o),n,r);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"storageDeposit",value:function(e,t){return this.contract.storage_deposit({args:{account_id:e},gas:ne,amount:t})}},{key:"ftMetadata",value:function(){return this.contract.ft_metadata({})}},{key:"storageBalanceOf",value:function(e){return this.contract.storage_balance_of({account_id:e})}},{key:"storageBalanceBounds",value:function(){return this.contract.storage_balance_bounds()}}]),e}(),oe=ce,se=new m.a(4).mul(new m.a(10).pow(24)).toString(),ie=["create"],le=function(){function e(t,n){Object(T.a)(this,e),this.contract=void 0,this.contract=new D.Contract(t.account(),n,{viewMethods:[],changeMethods:ie})}return Object(U.a)(e,[{key:"getContract",value:function(){return this.contract}},{key:"create",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n,r,a){var c,o,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c={token_account_id:n,deposit_whitelist:r},o=JSON.stringify(c),e.next=4,this.contract.create({args:{name:t,init_function:"new",init_args:o},callbackUrl:a,gas:3e14,amount:se});case 4:return s=e.sent,console.log(s),e.abrupt("return",s);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()}]),e}(),ue=le,de=n(28),pe=["call:AddProposal","*:AddProposal"],be=["get_policy"],he=function(){function e(t,n){Object(T.a)(this,e),this.contract=void 0,this.contract=new D.Contract(t.account(),n,{viewMethods:be,changeMethods:[]})}return Object(U.a)(e,[{key:"getContract",value:function(){return this.contract}},{key:"getCouncilMembers",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.get_policy();case 2:if(t=e.sent,0!==(n=t.roles.filter((function(e){var t,n;return(null===e||void 0===e||null===(t=e.permissions)||void 0===t?void 0:t.includes(pe[0]))||(null===e||void 0===e||null===(n=e.permissions)||void 0===n?void 0:n.includes(pe[1]))}))).length){e.next=6;break}return e.abrupt("return",[]);case 6:return r=n.map((function(e){var t;return null===e||void 0===e||null===(t=e.kind)||void 0===t?void 0:t.Group})),e.abrupt("return",r.flat().filter((function(e){return e})));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),je=he,fe=function(e,t,n,r,a,c,o,s,i,l){var u={details:r,smartContractAddress:a,methodName:c,json:o,actionsGas:s,gas:l,deposit:i};return"".concat("https://dev.app.astrodao.com","/dao/").concat(e,"/proposals?action=").concat(t,"&variant=").concat(n,"&params=").concat(JSON.stringify(u))},me=function(e,t,n,r,a,c,o){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"300";return fe(e,"create_proposal","ProposeCustomFunctionCall",t,n,r,a,c,o,s)},xe=function(){var e=Object(c.a)(i.a.mark((function e(t,n){var r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new je(t,n),e.next=4,r.getCouncilMembers();case 4:return a=e.sent,e.abrupt("return",Object(de.a)({},n,a));case 8:return e.prev=8,e.t0=e.catch(0),console.log("isDAO ERROR:",e.t0),e.abrupt("return",void 0);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),ve=function(e,t,n,r,a,c){var o=encodeURIComponent(e),s={receiver_id:t,amount:r,msg:JSON.stringify({draft_group_id:a,try_convert:!0})};return me(c,o,n,"ft_transfer_call",s,"100","0.000000000000000000000001")},Oe=function(e,t,n,r,a){var c=encodeURIComponent(e);return me(a,c,t,"terminate",{lockup_index:n,termination_timestamp:r},"100","0.000000000000000000000001")},ge=Object(l.createContext)(null),ke=function(){var e=Object(c.a)(i.a.mark((function e(){var t,n,r,c,o,s,l,u,d,p,b,h,j,f,m,x,v,O,k,w,y;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.getItem("dump")&&A(),t=new D.keyStores.BrowserLocalStorageKeyStore,e.next=4,D.connect(Object(a.a)({headers:{},keyStore:t},g));case 4:return n=e.sent,r=new M(n),c=new D.keyStores.InMemoryKeyStore,e.next=9,D.connect(Object(a.a)({headers:{},keyStore:c},g));case 9:return o=e.sent,s=new z(o),l=new X(o),u=new D.WalletConnection(n,g.contractName),d=u.getAccountId(),p="",b=!1,h=[],j=[],e.prev=18,e.next=21,r.getTokenAccountId();case 21:return p=e.sent,e.next=24,r.getDepositWhitelist();case 24:return h=e.sent,console.log("depositWhitelist",h),b=h.includes(d),console.log("isAdmin",b),e.next=30,Promise.all(h.map((function(e){return xe(u,e)})));case 30:f=e.sent.filter((function(e){return!!e})),(null===(m=f.filter((function(e){return Object.values(e).pop().includes(d)})))||void 0===m?void 0:m.length)>0&&(j=m.map((function(e){return Object.keys(e).pop()||""}))),console.log("userDaosCouncils",m),console.log("councilMembers",f),console.log("daos",j),e.next=41;break;case 38:e.prev=38,e.t0=e.catch(18),console.log(e.t0);case 41:return x=new oe(u,p),v=!1,O=window.location.hash.split("/")[1],e.prev=44,e.next=47,x.storageBalanceOf(O);case 47:k=e.sent,v=null!==k&&!0,console.log(v),e.next=55;break;case 52:e.prev=52,e.t1=e.catch(44),console.log(e.t1);case 55:return w=new ue(u,g.factoryContractName),y=new D.providers.JsonRpcProvider(g.nodeUrl),e.abrupt("return",{config:g,api:r,tokenContractId:p,noLoginApi:s,tokenApi:x,factoryApi:w,currentUser:{signedIn:!!d,isAdmin:b,isCouncilMember:j.length>0,signedAccountId:d,daos:j},noLoginTokenApi:l,rpcProvider:y,isContractFtStoragePaid:v,lockupContractId:O,near:n});case 58:case"end":return e.stop()}}),e,null,[[18,38],[44,52]])})));return function(){return e.apply(this,arguments)}}(),we=n(1);function ye(e){var t=e.lockups,n=e.token_account_id;return Object(we.jsxs)("div",{className:"container",children:[Object(we.jsx)("h1",{children:"Fungible Token Lockup"}),Object(we.jsx)("h2",{children:"Purpose"}),Object(we.jsxs)("div",{children:["Community Lockup is dApp implementing locking and vesting of any arbitrary fungible token on NEAR in the generally known sense of these words.",Object(we.jsx)("br",{}),"Lockup is a gradual release of tokens according to a specified schedule. After release tokens are in full control of the beneficiary.",Object(we.jsx)("br",{}),"Vesting is a gradual allocation of tokens to the beneficiary according to a specified schedule, provided certain conditions are met (for example, beneficiary keeps working for the payer).",Object(we.jsx)("br",{}),"Vested tokens are NOT immediately available to the beneficiary, however they WILL be available to the beneficiary according to the lockup schedule. Vested tokens are GUARANTEED to be received at some point in the future, while unvested token amount may be withdrawn by the payer if the lockup agreement is terminated."]}),Object(we.jsx)("h2",{children:"Users"}),Object(we.jsxs)("div",{children:["There are two roles in the app: payer (also called admin), most commonly the employer, and beneficiaries, most commonly the employees. There is also an implicit \u201canyone\u201d role.",Object(we.jsxs)("ul",{children:[Object(we.jsx)("li",{children:"All users (\u201canyone\u201d) are able to view ALL lockup information stored in the blockchain for any existing lockup contract. They are also able to create new lockup contract and become admin for that new lockup contract."}),Object(we.jsx)("li",{children:"Beneficiary users have ability to claim unlocked tokens dedicated to them"}),Object(we.jsx)("li",{children:"Admin users can create new lockups (one by one or via excel import) and terminate existing lockups that can be terminated"}),Object(we.jsx)("li",{children:"Draft operators can create draft groups, drafts, delete draft groups, drafts."})]})]}),Object(we.jsx)("h2",{children:"Lockups"}),Object(we.jsxs)("div",{children:["Each lockup has the following fields:",Object(we.jsxs)("ul",{children:[Object(we.jsx)("li",{children:"Account ID: NEAR account id that will receive the tokens"}),Object(we.jsx)("li",{children:"Schedule: the lockup schedule, according to which the tokens are released. Is represented by a monotonous piecewise linear function . Where x is the time axis and y is the amount of unlocked tokens at any specific moment."}),Object(we.jsx)("li",{children:"Vesting schedule: optional. According to this schedule tokens are vested, i. e. allocated to the beneficiary irrevocably. Operator is able to terminate the lockup at any effective moment in the future. If this happens, then the lockup schedule is capped at the total vested amount at the effective moment of termination."}),Object(we.jsx)("li",{children:"Payer id: optional. account id that paid for the specific lockup. Only recorded for terminatable lockups. If the lockup is terminated - unvested tokens will be returned back to the payer upon termination."}),Object(we.jsx)("li",{children:"Claimed balance: already claimed balance for the lockup. Used for tracking claim progress."})]})]}),Object(we.jsx)("h2",{children:"Lockup and vesting logic"}),Object(we.jsxs)("div",{children:[Object(we.jsx)("div",{children:Object(we.jsx)("img",{src:"https://bafkreidqdq6wefcvr436cunap4y5c77nodlgxu6c4qchxkd232g7377cw4.ipfs.nftstorage.link/",alt:"Lockup and vesting schedule"})}),"Consider the following lockup with a four year duration.",Object(we.jsx)("br",{}),"The vesting schedule is red. One year cliff, then 1 / 4 is vested, then vesting is linear till the end (4 years mark).",Object(we.jsx)("br",{}),"The lockup schedule is blue. Two years cliff with zero amount. Then two years of linear lockup till 3 / 4 of the amount, then another cliff up to full amount.",Object(we.jsx)("br",{}),"Consider the termination happening at the 2.5 years mark.",Object(we.jsx)("br",{}),"First, we find the vested amount for this timestamp. It is 5 / 8.",Object(we.jsx)("br",{}),"After that we trim the lockup schedule at that amount.",Object(we.jsx)("br",{}),"In this case, the intersection is at 3y + 1 / 3y.",Object(we.jsx)("br",{}),"The trimmed lockup schedule is the yellow thin line. Note that it perfectly matches the initial lockup schedule up to the new total ( 5 / 8 )."]}),Object(we.jsx)("h2",{children:"Technical Info"}),Object(we.jsxs)("div",{children:["FT lockup account id:"," ",Object(we.jsx)("span",{className:"code",children:g.contractName})]}),Object(we.jsxs)("div",{children:["Token account id:"," ",Object(we.jsx)("span",{className:"code",children:n})]}),Object(we.jsxs)("div",{children:["Total number of lockups:"," ",Object(we.jsx)("span",{className:"code",children:t.length})]})]})}var _e=n(367),Ce=n(389),Se=n(390),Ne=n(391),Ie=n(392),Ae=n(393),Ee=n(384),De=n(388),Te=n(125),Ue=n.n(Te),Fe=n(126),Pe=n.n(Fe),Le=n(192),Me=n.n(Le),We=n(186),Re=n(197);n(305);function Be(e){var t=e.data,n={title:{text:""},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{bottom:"3%",selectedMode:!1,icon:"circle"},grid:{top:"15%",left:"2%",right:"3%",bottom:"15%",containLabel:!0},xAxis:[{type:"time",boundaryGap:["1%","1%"],splitNumber:15}],yAxis:[{type:"value"}],series:[{name:"Vested",type:"line",color:"#0069D1",areaStyle:{opacity:1},markLine:{data:[[{xAxis:new Date,yAxis:0},{xAxis:new Date,yAxis:"max"}]],lineStyle:{type:"dashed",color:"#FF594E"},symbol:"none"},data:t.vested},{name:"Unlocked",type:"line",color:"#00B988",areaStyle:{opacity:1},data:t.unlocked}]};return Object(we.jsx)(Re.a,{option:n})}function Ge(e){var t=e.url,n=e.size;return Object(we.jsx)("img",{style:{height:n,width:n,verticalAlign:"middle"},src:t,alt:"Token Icon"})}function Ve(e){var t=e.schedule,n=e.title,r=e.token;return Object(we.jsxs)("div",{className:"inner-table_wrapper",children:[Object(we.jsx)("h5",{children:n}),Object(we.jsxs)(Ce.a,{className:"inner-table",size:"small","aria-label":"purchases",children:[Object(we.jsx)(Se.a,{children:Object(we.jsxs)(Ne.a,{children:[Object(we.jsx)(Ie.a,{children:"DATE"}),Object(we.jsx)(Ie.a,{align:"right",children:"CUMULATIVE AMOUNT"})]})}),Object(we.jsx)(Ae.a,{children:t.map((function(e){return Object(we.jsxs)(Ne.a,{children:[Object(we.jsx)(Ie.a,{component:"th",scope:"row",children:y(e.timestamp)}),Object(we.jsxs)(Ie.a,{align:"right",children:[_(e.balance,r.decimals),"\xa0",r.symbol,"\xa0",Object(we.jsx)(Ge,{url:r.icon||"",size:32})]})]},e.timestamp)}))})]})]})}var Je=n(51),He=function(e,t,n){var r=function(e,t,n,r,a){if(n<=e)throw new Error("invalid range");if(a<e||a>=n)throw new Error("xM out of bound");return t+(r-t)*(a-e)/(n-e)}(e.timestamp,parseFloat(e.balance),t.timestamp,parseFloat(t.balance),n);return{timestamp:n,balance:new f.Big(r.toString()).toFixed()}},qe=function(e,t){if(0===e.length)throw new Error("empty schedule");if(t<e[0].timestamp)return{timestamp:t,balance:e[0].balance};if(t>=e[e.length-1].timestamp)return{timestamp:t,balance:e[e.length-1].balance};for(var n=0;n<e.length-1;n++)if(!(e[n+1].timestamp<=t))return He(e[n],e[n+1],t);throw new Error("unreachable")},Ke=function(e){if(0===e.length)throw new Error("schedules is empty");var t=Array.from(new Set(e.flat().map((function(e){return e.timestamp})).sort((function(e,t){return e-t})))),n=[];return t.forEach((function(t){for(var r=new f.Big(0),a=0;a<e.length;a++){var c=new f.Big(qe(e[a],t).balance);r=r.plus(c)}n.push({timestamp:t,balance:r.toString()})})),n},Ye=function(e,t){var n,r=Array.from(e.map((function(e){return e.schedule}))),a=Math.round((new Date).getTime()/1e3),c=e.map((function(e){return e.schedule[0].timestamp})),o=e.map((function(e){var t,n;return null===e||void 0===e||null===(t=e.termination_config)||void 0===t||null===(n=t.vesting_schedule[0])||void 0===n?void 0:n.timestamp})).filter((function(e){return e})),s=Math.min.apply(Math,Object(Je.a)(c).concat(Object(Je.a)(o),[a])),i=Array.from(e.map((function(e){var t,n,r,a,c,o=(null===e||void 0===e||null===(t=e.termination_config)||void 0===t||null===(n=t.vesting_schedule)||void 0===n?void 0:n.Schedule)||(null===e||void 0===e||null===(r=e.vesting_schedule)||void 0===r?void 0:r.Schedule);return o||(o||(a=s,c=e.schedule[e.schedule.length-1].balance,[{timestamp:a-1,balance:"0"},{timestamp:a,balance:c}]))}))),l=Ke(i),u=Ke(r);(null===(n=l[l.length-1])||void 0===n?void 0:n.timestamp)!==u[u.length-1].timestamp&&l.push(u[u.length-1]);var d=function(e,t){return e.map((function(e){return[1e3*e.timestamp,_(e.balance,t)]}))};return{unlocked:e.length?d(u,t):[],vested:e.length?d(l,t):[]}},ze=n(200),$e=n(188),Ze=n(36),Qe=n.n(Ze);Qe.a.prototype.toJSON=function(){return this.toString()};var Xe=function(e,t){try{return t()}catch(n){if(!(n instanceof Error))throw new Error("unreachable");throw n.message="".concat(e,": ").concat(n.message),n}},et=function(e){var t=e.trim().split("\n");if(t.length<=1)return[];var n=t.map((function(e){return e.split("\t").map((function(e){return e.trim()}))})),r=Object($e.a)(n),a=r[0];return r.slice(1).map((function(e){return Object.fromEntries(a.map((function(t,n){return[t,e[n]||""]})))}))},tt=function(e){var t=Object(ze.a)(/^P(((((\d+)Y)?((\d+)M)?((\d+)D)?)(T((\d+)H)?((\d+)M)?((\d+)S)?)?)|((\d+)W)?)$/,{year:5,month:7,day:9,hour:12,minute:14,second:16,week:18}),n=e.match(t);if(!n)throw new Error("invalid duration");var r=n&&n.groups||{};return{year:parseInt(r.year,10)||0,month:parseInt(r.month,10)||0,week:parseInt(r.week,10)||0,day:parseInt(r.day,10)||0,hour:parseInt(r.hour,10)||0,minute:parseInt(r.minute,10)||0,second:parseInt(r.second,10)||0}},nt=function(e){var t=e.split(":");if(2!==t.length)throw new Error("expected 2 parts");var n=Object(o.a)(t,2),r=n[0],a=n[1],c=tt(r),s=Xe("percentage",(function(){return function(e){if(!e.match(/^\d+$/))throw new Error("invalid cliff percentage");var t=parseInt(e,10);if(t<0||t>100)throw new Error("invalid cliff percentage");return t}(a)}));return{duration:c,percentage:s}},rt=function(e){var t=e.split("|");if(4!==t.length)throw new Error("invalid human friendly schedule, expected 4 parts");var n=Object(o.a)(t,4),r=n[0],a=n[1],c=n[2],s=n[3],i=Xe("start timestamp",(function(){return function(e){if(!e.match(/\d\d\d\d-\d\d-\d\dT\d\d:\d\d:\d\dZ/))throw new Error("invalid timestamp");var t=new Date(e);if(Number.isNaN(t.getTime()))throw new Error("invalid timestamp");return t}(r)})),l=Xe("duration",(function(){return tt(a)})),u=Xe("cliff",(function(){return nt(c)})),d=Xe("release every",(function(){return tt(s)}));return{timestampStart:i,durationTotal:l,durationCliff:u.duration,percentageCliff:u.percentage,releaseEvery:d}},at=function(e){var t=["account_id","amount","lockup_schedule","vesting_schedule"];if(Object.keys(e).forEach((function(e){if(!t.includes(e))throw new Error("unknown column '".concat(e,"'"))})),!e.account_id)throw new Error("column 'account_id' not found");var n=function(e){var t=!0;if(e.length<2&&(t=!1),e.length>64&&(t=!1),e.match(/^[a-z0-9._-]+$/)||(t=!1),t)return e;throw new Error("invalid near account id")}(e.account_id);if(!e.amount)throw new Error("column 'amount' not found");var r=function(e){if(e.match(/^[0-9]+(\.[0-9]+)?$/))return e;throw new Error("invalid token amount")}(e.amount);if(!e.lockup_schedule)throw new Error("column 'lockup_schedule' not found");var a=Xe("lockup schedule",(function(){return rt(e.lockup_schedule)})),c=null;return e.vesting_schedule&&(c=Xe("vesting schedule",(function(){return rt(e.vesting_schedule)}))),{account_id:n,amount:r,lockup_schedule:a,vesting_schedule:c}},ct=function(e,t,n){var r=Math.floor(n);return new Date(Date.UTC(e.getUTCFullYear()+t.year*r,e.getUTCMonth()+t.month*r,e.getUTCDate()+(7*t.week+t.day)*r,e.getUTCHours()+t.hour*r,e.getUTCMinutes()+t.minute*r,e.getUTCSeconds()+t.second*r))},ot=function(e){return Math.floor(new Date(e).getTime()/1e3)},st=function(e,t,n){if(!(n>=0&&n===Math.floor(n)))throw new Error("invalid token decimals");var r=new m.a(10).pow(n),a=e.timestampStart,c=ct(a,e.durationCliff,1),o=ct(c,tt("PT1S"),-1),s=ct(a,e.durationTotal,1),i=new Qe.a(new m.a(t).mul(r).round(0,m.a.roundDown).toString()),l=new Qe.a(i).muln(e.percentageCliff).divn(100).clone();if(l.gt(i))throw new Error("error: cliffAmount > totalAmount");if(c>s)throw new Error("error: timestampCliff > timestampFinish");if(c<a)throw new Error("error: timestampPreCliff < timestampStart");var u=e.releaseEvery,d=c,p=ct(c,u,1);if(ot(p)<=ot(d))throw new Error("invalid releaseEvery, zero duration");if(ot(p)-ot(d)===1){var b={timestamp:ot(a),balance:new Qe.a("0").toString()},h={timestamp:ot(o),balance:new Qe.a("0").toString()},j={timestamp:ot(c),balance:l.toString()},f={timestamp:ot(s),balance:i.toString()},x=[];return x.unshift(f),j.timestamp<f.timestamp&&x.unshift(j),x.unshift(h),b.timestamp<h.timestamp&&x.unshift(b),x}for(var v=[],O=c;;){if(O>=s){O=s,v.push(O);break}if(v.push(O),O=ct(O,u,1),v.length>=500)throw new Error("too many checkpoints for schedule")}var g=i.sub(l).divn(v.length-1),k=v.flatMap((function(e,t){if(1===v.length)return[{timestamp:ot(s),balance:i.toString()}];if(0===t)return[{timestamp:ot(e),balance:l.toString()}];var n=t===v.length-1?i:l.add(g.muln(t)).toString();return[{timestamp:ot(e)-1,balance:l.add(g.muln(t-1)).toString()},{timestamp:ot(e),balance:n.toString()}]})),w=[],y={timestamp:ot(a),balance:new Qe.a("0").toString()},_={timestamp:ot(o),balance:new Qe.a("0").toString()};return w.unshift(_),y.timestamp<_.timestamp&&w.unshift(y),w.concat(k)},it=function(e,t,n){var r=at(e),a=st(r.lockup_schedule,r.amount,t),c=null;if(r.vesting_schedule){var o=st(r.vesting_schedule,r.amount,t);!function(e,t){e.forEach((function(e){var n=e.timestamp,r=e.balance,a=qe(t,n).balance;if(!new f.Big(r).lte(new f.Big(a)))throw new Error("The lockup schedule is ahead of the termination schedule at timestamp ".concat(n))})),t.forEach((function(t){var n=t.timestamp,r=qe(e,n).balance,a=t.balance;if(!new f.Big(r).lte(new f.Big(a)))throw new Error("The lockup schedule is ahead of the termination schedule at timestamp ".concat(n))}))}(a,o),c={Schedule:o}}return{id:n,account_id:r.account_id,schedule:a,vesting_schedule:c}},lt=function(e){return e.schedule[e.schedule.length-1].balance};function ut(e){var t,n=Object(h.f)(),r=Object(l.useState)(!1),a=Object(o.a)(r,2),c=a[0],s=a[1],i=e.pageIndex,p=e.row,b=e.token,m=e.adminControls,x=e.progressShow,v=Object(u.b)().enqueueSnackbar,O=Object(l.useContext)(ge).near,g=Object(l.useState)(Math.floor((new Date).getTime()/1e3)),k=Object(o.a)(g,2),w=k[0];k[1];if(!O)return null;if(p instanceof Error)return Object(we.jsx)(Ne.a,{children:Object(we.jsx)(Ie.a,{style:{padding:0},colSpan:8,children:Object(we.jsxs)("div",{className:"row-error",children:["row ",i,": ",p.message]})})});var C=null===p||void 0===p||null===(t=p.vesting_schedule)||void 0===t?void 0:t.Schedule,S=n.pathname.split("/")[1],N=n.pathname.split("/").pop()===p.id.toString(),I=n.pathname.split("/").includes("drafts"),A=n.pathname.split("/").includes("import_draft_group"),E=function(e,t){var n,r=e.schedule[e.schedule.length-1].balance,a=qe,c=lt;console.log(a,c);var o=qe(e.schedule,t).balance,s=null,i=null===(n=e.vesting_schedule)||void 0===n?void 0:n.Schedule;s=i?qe(i,t).balance:lt(e);var l=new f.Big(s).sub(new f.Big("0")).sub(new f.Big(o)).toString(),u=new f.Big(r).sub(new f.Big(s)).toString();return console.log(r,"0",o,l,u),{claimed:"0",unclaimed:o,vested:l,unvested:u,total:r}}(p,w);return Object(we.jsxs)(we.Fragment,{children:[Object(we.jsxs)(Ne.a,{className:c?"expanded exp-row":"exp-row",sx:{"& > *":{borderBottom:"unset"}},children:[Object(we.jsx)(Ie.a,{children:Object(we.jsx)(d.a,{"aria-label":"expand row",size:"small",onClick:function(){return s(!c)},children:c?Object(we.jsx)(Ue.a,{}):Object(we.jsx)(Pe.a,{})})}),Object(we.jsxs)(Ie.a,{align:"left",children:[N&&I||A?p.id:Object(we.jsx)(j.b,{to:m?"/".concat(S,"/admin/drafts/").concat(p.id):"/".concat(S,"/drafts/").concat(p.id),children:p.id}),!A&&Object(we.jsx)(We.CopyToClipboard,{text:"".concat(window.location.origin,"/#/").concat(S,"/drafts/").concat(p.id),onCopy:function(){return v("Copied",{variant:"success",autoHideDuration:1e3})},children:Object(we.jsx)(d.a,{"aria-label":"copy link",children:Object(we.jsx)(Me.a,{})})})]}),Object(we.jsx)(Ie.a,{align:"left",children:p.account_id}),Object(we.jsx)(Ie.a,{align:"right",children:y(p.schedule[0].timestamp)}),Object(we.jsx)(Ie.a,{align:"right",children:y(p.schedule[p.schedule.length-1].timestamp)}),Object(we.jsxs)(Ie.a,{align:"right",children:[_(E.total,b.decimals),"\xa0",b.symbol,"\xa0",Object(we.jsx)(Ge,{url:b.icon||"",size:32})]}),x&&Object(we.jsx)(Ie.a,{align:"center",children:Object(we.jsx)(Ee.a,{title:Object(we.jsxs)("div",{className:"progress-bar__tooltip",children:[Object(we.jsxs)("span",{children:[Object(we.jsx)("i",{className:"claimed",children:"\xa0"}),Object(we.jsx)("b",{children:_(E.claimed,b.decimals)})," ","Claimed"]}),Object(we.jsxs)("span",{children:[Object(we.jsx)("i",{className:"available",children:"\xa0"}),Object(we.jsx)("b",{children:_(E.unclaimed,b.decimals)})," ","Available"]}),Object(we.jsxs)("span",{children:[Object(we.jsx)("i",{className:"vested",children:"\xa0"}),Object(we.jsx)("b",{children:_(E.vested,b.decimals)})," ","Vested"]}),Object(we.jsxs)("span",{children:[Object(we.jsx)("i",{className:"unvested",children:"\xa0"}),Object(we.jsx)("b",{children:_(E.unvested,b.decimals)})," ","Unvested"]})]}),placement:"top",arrow:!0,children:Object(we.jsxs)("div",{className:"progress-bar",children:[Object(we.jsx)("div",{style:{width:"".concat(parseFloat(E.claimed)/parseFloat(E.total)*100,"%")},className:"claimed",children:"\xa0"}),Object(we.jsx)("div",{style:{width:"".concat(parseFloat(E.unclaimed)/parseFloat(E.total)*100,"%")},className:"available",children:"\xa0"}),Object(we.jsx)("div",{style:{width:"".concat(parseFloat(E.vested)/parseFloat(E.total)*100,"%")},className:"vested",children:"\xa0"}),Object(we.jsx)("div",{style:{width:"".concat(parseFloat(E.unvested)/parseFloat(E.total)*100,"%")},className:"unvested",children:"\xa0"})]})})})]}),Object(we.jsx)(Ne.a,{sx:{background:"#F4F7FC"},children:Object(we.jsx)(Ie.a,{style:{padding:0},colSpan:8,children:Object(we.jsx)(De.a,{in:c,timeout:"auto",unmountOnExit:!0,children:Object(we.jsx)("div",{className:"lockup-row",children:Object(we.jsxs)("div",{style:{display:"flex",gap:20},children:[Object(we.jsx)(Ve,{schedule:p.schedule,title:"Lockup schedule",token:b}),C&&Object(we.jsx)(Ve,{schedule:C,title:"Vesting schedule",token:b}),Object(we.jsx)("div",{style:{flex:1},children:Object(we.jsx)("div",{style:{height:300},children:Object(we.jsx)(Be,{data:Ye([p],b.decimals)})})})]})})})})})]})}function dt(e){var t=e.lockups,n=e.token,r=e.adminControls,a=e.progressShow;return Object(we.jsxs)(Ce.a,{className:"main-table","aria-label":"collapsible table",children:[Object(we.jsx)(Se.a,{className:"table-head",children:t.length>0&&Object(we.jsxs)(Ne.a,{children:[Object(we.jsx)(Ie.a,{}),Object(we.jsx)(Ie.a,{align:"left",children:"ID"}),Object(we.jsx)(Ie.a,{align:"left",children:"Account ID"}),Object(we.jsx)(Ie.a,{align:"right",children:"Start\xa0date"}),Object(we.jsx)(Ie.a,{align:"right",children:"End\xa0date"}),Object(we.jsx)(Ie.a,{align:"right",children:"Total\xa0amount"}),a&&Object(we.jsx)(Ie.a,{align:"center",children:"Progress"})]})}),Object(we.jsx)(Ae.a,{children:t.map((function(e,t){return Object(we.jsx)(ut,{pageIndex:t+1,row:e,token:n,adminControls:r,progressShow:a},e.id)}))})]})}function pt(e){var t=e.token,n=e.amount;return Object(we.jsxs)("div",{className:"token-info",children:[Object(we.jsxs)("div",{className:"token-amount",children:[n," ",t.symbol]}),Object(we.jsx)(Ge,{url:t.icon||"",size:32})]})}var bt=function(e){var t=e.token,n=e.adminControls,r=Object(h.f)(),a=Object(l.useContext)(ge).near,s=Object(l.useState)([]),d=Object(o.a)(s,2),p=d[0],b=d[1],j=Object(l.useState)([]),f=Object(o.a)(j,2),x=f[0],v=f[1],O=Object(l.useState)(!1),g=Object(o.a)(O,2),k=g[0],w=g[1],y=Object(h.g)(),C=Object(u.b)().enqueueSnackbar,S=function(){var e=Object(c.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n();case 3:return r=e.sent,e.abrupt("return",r);case 7:throw e.prev=7,e.t0=e.catch(0),C("".concat(t," failed with error: '").concat(e.t0,"'"),{variant:"error"}),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),N=function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.delegateYield(i.a.mark((function e(){var t,n,o,s,l,u,d,b;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}throw new Error("near is null");case 2:return w(!0),e.next=5,S("Create draft group",Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.api.createDraftGroup();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))));case 5:t=e.sent,n="Created draft group id: ".concat(t),C(n,{variant:"success"}),o=20,s=i.a.mark((function e(n){var r,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=p.slice(n,n+o),s=r.map((function(e){return{draft_group_id:t,lockup_create:e}})),e.next=4,S("Create drafts",Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.api.createDrafts(s);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))));case 4:case"end":return e.stop()}}),e)})),l=0;case 11:if(!(l<p.length)){e.next=16;break}return e.delegateYield(s(l),"t0",13);case 13:l+=o,e.next=11;break;case 16:u="Created ".concat(p.length," draft").concat(p.length>1?"s":"","."),C(u,{variant:"success"}),d=r.pathname.split("/")[1],b="/".concat(d,"/admin/draft_groups/").concat(t),y(b);case 21:case"end":return e.stop()}}),e)}))(),"t0",2);case 2:e.next=7;break;case 4:e.prev=4,e.t1=e.catch(0),w(!1);case 7:case"end":return e.stop()}}),e,null,[[0,4]])})));return function(){return e.apply(this,arguments)}}(),I=_(function(e){var t=e.filter((function(e){return!(e instanceof Error)})).map((function(e){return e})).map((function(e){return lt(e)})),n=new m.a("0");return t.forEach((function(e){n=n.add(new m.a(e))})),n.toString()}(p),t.decimals);return Object(we.jsx)("div",{className:"main",children:Object(we.jsxs)("div",{className:"container",children:[Object(we.jsx)("h2",{children:"Import Draft Group"}),Object(we.jsxs)("div",{className:"import-draft-group-wrapper",children:[Object(we.jsx)("div",{className:"draft-group-preview-inner",children:Object(we.jsxs)("div",{className:"draft-group-preview-info",style:{display:"flex"},children:[Object(we.jsxs)("h5",{children:[Object(we.jsx)("span",{className:"new-draft-count-text",children:"New draft group with ".concat(p.length," lockup").concat(p.length>1?"s":"")})," ",x.length>0&&Object(we.jsx)("span",{className:"parse-error-label",children:"".concat(x.length," parse error").concat(x.length>1?"s":"")})]}),Object(we.jsx)(pt,{token:t,amount:I})]})}),Object(we.jsxs)("p",{children:["Copy lockups from a spreadsheet editor and paste into the area below. See"," ",Object(we.jsx)("a",{href:"".concat("","/lockup_import_example.xlsx"),children:"example and format specifications"}),"."]}),Object(we.jsx)(_e.a,{className:"import-draft-group-textarea",id:"spreadsheet-input",placeholder:"Excel input",maxRows:5,onChange:function(e){try{var n;if(null===a||void 0===a||null===(n=a.currentUser)||void 0===n||!n.signedAccountId)throw new Error("expected present signedAccountId");console.log(t);var r=e.target.value,c=(s=r,i=t.decimals,et(s).map((function(e,t){try{return it(e,i,t)}catch(n){if(n instanceof Error)return n;throw new Error("unreachable")}}))),o=c.filter((function(e){return e instanceof Error})).map((function(e){return e}));b(c),v(o)}catch(l){l instanceof Error&&(b([]),v([l]),console.log(l))}var s,i}})]}),Object(we.jsx)(dt,{lockups:p,token:t,adminControls:n,progressShow:!0}),Object(we.jsx)("button",{disabled:!(p.length>=1&&0===x.length&&!k),onClick:N,type:"button",className:"button",children:"Import"})]})})},ht=n(379),jt=n(378);var ft=function(e){var t=Object(l.useContext)(ge).near,n=e.draftGroupIndex,r=e.amount;if(!t)throw Error("Cannot access lockup api");if(void 0===n)throw Error("Cannot fund draft group without index");if(void 0===r)throw Error("Cannot fund draft group without specified amount");return Object(we.jsx)("button",{className:"button",type:"button",onClick:function(){t.tokenApi.fundDraftGroup(t.api.getContract().contractId,n,r)},children:"Fund"})},mt=n(371),xt=n(372),vt=n(398),Ot=n(399),gt=n(69),kt=n.n(gt),wt=n(377),yt=n(382),_t=n(381),Ct=n(383);var St=function(e){var t=e.selectedAddress,n=e.setSelectedAddress,r=Object(l.useContext)(ge).near;if(!r)throw Error("Cannot access lockup api");var a=r.currentUser.daos;a.length>0&&(""===t||!a.includes(t))&&n(a[0]);var c=function(e){n(e.target.value)};return a.length>0?Object(we.jsxs)("div",{children:[Object(we.jsx)(yt.a,{children:"Select DAO contract address"}),Object(we.jsx)(wt.a,{required:!0,sx:{marginBottom:3,width:1},value:t,onChange:c,children:a.map((function(e){return Object(we.jsx)(_t.a,{value:e,children:e})}))})]}):Object(we.jsx)(Ct.a,{required:!0,sx:{marginBottom:3,width:1},id:"outlined-helperText",label:"DAO contract address",onChange:c})};var Nt=function(e){var t=e.proposalDescription,n=e.setProposalDescription;return Object(we.jsx)(Ct.a,{sx:{width:1},id:"outlined-multiline-static",label:"Proposal description",multiline:!0,minRows:5,onChange:function(e){n(e.target.value)},defaultValue:t})};var It=function(e){var t=Object(l.useContext)(ge).near,n=e.draftGroupIndex,r=e.amount,a="Fund draft group ".concat(n," with amount ").concat(null===r||void 0===r?void 0:r.label,". Draft group link: ").concat(window.location.href.replace(/\/admin/,"")),c=Object(l.useState)(a),s=Object(o.a)(c,2),i=s[0],u=s[1],p=Object(l.useState)(""),b=Object(o.a)(p,2),h=b[0],j=b[1],f=Object(l.useState)(!1),m=Object(o.a)(f,2),x=m[0],v=m[1],O=function(){return v(!1)};if(!t)throw Error("Cannot access lockup api");if(void 0===n)throw Error("Cannot fund draft group without index");if(void 0===(null===r||void 0===r?void 0:r.value))throw Error("Cannot fund draft group without specified amount");return console.log("AMOUNT",r),Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)("button",{className:"button",type:"button",onClick:function(){return v(!0)},children:"Fund with DAO"}),Object(we.jsx)(mt.a,{open:x,sx:{padding:1,minWidth:1},onClose:O,children:Object(we.jsxs)("form",{className:"form-submit",onSubmit:function(){var e,a=ve(i,t.api.getContract().contractId,t.tokenApi.getContract().contractId,r.value,n,h);null===(e=window.open(a,"_blank"))||void 0===e||e.focus()},children:[Object(we.jsxs)(xt.a,{children:["Fund with DAO",Object(we.jsx)(d.a,{"aria-label":"close",onClick:O,sx:{position:"absolute",right:8,top:8},children:Object(we.jsx)(kt.a,{})})]}),Object(we.jsxs)(vt.a,{style:{minWidth:"320px",paddingTop:"1.25em"},children:[Object(we.jsx)(St,{selectedAddress:h,setSelectedAddress:j}),Object(we.jsx)(Nt,{proposalDescription:i,setProposalDescription:u})]}),Object(we.jsx)(Ot.a,{sx:{padding:"14px 24px 24px"},children:Object(we.jsx)("button",{className:"button fullWidth noMargin",type:"submit",children:"Fund"})})]})})]})};var At=function(e){var t=e.draftGroupId,n=e.draftIds,r=e.disabled,a=Object(l.useContext)(ge).near,s=Object(u.b)().enqueueSnackbar,d=Object(h.g)(),p=Object(h.f)(),b=Object(l.useState)(!1),j=Object(o.a)(b,2),f=j[0],m=j[1],x=function(){var e=Object(c.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n();case 3:return r=e.sent,e.abrupt("return",r);case 7:throw e.prev=7,e.t0=e.catch(0),s("".concat(t," failed with error: '").concat(e.t0,"'"),{variant:"error"}),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}();if(!a)throw Error("Cannot access lockup api");return Object(we.jsx)("button",{className:"button compact red",type:"button",onClick:function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var r,o,l,u,b,h;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}throw new Error("near is null");case 2:return m(!0),e.prev=3,e.next=6,a.api.discardDraftGroup(t);case 6:s("Discarded draft group ".concat(t),{variant:"success"}),e.next=21;break;case 9:if(e.prev=9,e.t0=e.catch(3),!(e.t0 instanceof Error)){e.next=20;break}if(console.log("ERROR: ".concat(e.t0)),(r=e.t0.message).includes("cannot discard, draft group already discarded")){e.next=18;break}return s("Failed to discard draft group ".concat(t,": ").concat(r),{variant:"error"}),m(!1),e.abrupt("return");case 18:e.next=21;break;case 20:throw new Error("unreachable");case 21:e.prev=21,o=100,l=i.a.mark((function e(t){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.slice(t,t+o),e.next=3,x("Delete drafts",Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.api.deleteDrafts(r);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e)})),u=0;case 25:if(!(u<n.length)){e.next=30;break}return e.delegateYield(l(u),"t1",27);case 27:u+=o,e.next=25;break;case 30:s("Deleted draft group ".concat(t),{variant:"success"}),b=p.pathname.split("/")[1],d("/".concat(b,"/admin/draft_groups")),window.location.reload(),e.next=46;break;case 36:if(e.prev=36,e.t2=e.catch(21),!(e.t2 instanceof Error)){e.next=45;break}console.log("ERROR: ".concat(e.t2)),h=e.t2.message,s("Failed to discard draft group ".concat(t,": ").concat(h),{variant:"error"}),m(!1),e.next=46;break;case 45:throw new Error("unreachable");case 46:case"end":return e.stop()}}),e,null,[[3,9],[21,36]])})));return function(){return e.apply(this,arguments)}}();e()},disabled:r||f,children:"Delete"})};function Et(e){var t=e.token,n=e.adminControls,r=Object(h.f)(),a=Object(u.b)().enqueueSnackbar,s=parseInt(Object(h.h)().draftGroupId||"",10),d=Object(l.useContext)(ge).near,p=Object(l.useState)(null),b=Object(o.a)(p,2),f=b[0],m=b[1],x=Object(l.useState)([]),v=Object(o.a)(x,2),O=v[0],g=v[1],k=Object(l.useState)(!1),w=Object(o.a)(k,2),y=w[0],C=w[1],S=Object(l.useState)("pending"),N=Object(o.a)(S,2),I=N[0],A=N[1];Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t,n,r,a,c,o,l,u,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(A("pending"),console.log("fetchIsConverted: ".concat(s," ","pending")),d){e.next=4;break}return e.abrupt("return");case 4:if(t=new URLSearchParams(window.location.search),n=t.get("transactionHashes")){e.next=10;break}return A("unknown"),console.log("fetchIsConverted: ".concat(s," ","unknown")),e.abrupt("return");case 10:return r=n.split(",")[0],console.log("txHash",r),e.next=14,d.rpcProvider.txStatus(r,"sender.testnet");case 14:a=e.sent,console.log(a),c=a.transaction.actions[0].FunctionCall.method_name,o=a.status.SuccessValue,l=JSON.parse(atob(a.transaction.actions[0].FunctionCall.args)),u=l.msg&&JSON.parse(l.msg),p=u&&u.draft_group_id,console.log(c,o,l,u,p),"ft_transfer_call"===c&&p&&p===s?(A("converted"),console.log("fetchIsConverted: ".concat(s," ","converted"))):(A("unknown"),console.log("fetchIsConverted: ".concat(s," ","unknown")));case 24:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[d,s]),Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m(null),console.log("fetchDraftGroup called: ".concat(s," ").concat(I)),d){e.next=4;break}return e.abrupt("return");case 4:if(console.log(I),"pending"!==I){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,d.api.getDraftGroup(s);case 9:t=e.sent,m(t||"not_found");case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[d,s,I]),Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g([]),console.log("fetchDrafts called"),d){e.next=4;break}return e.abrupt("return");case 4:if(f&&"not_found"!==f){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,d.api.getDrafts(f.draft_indices);case 8:t=e.sent,g(t.map((function(e){return Object.assign(e[1].lockup_create,{id:e[0]})})));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[d,f]);var E=Object(h.g)(),D=function(){var e=Object(c.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n();case 3:return r=e.sent,e.abrupt("return",r);case 7:throw e.prev=7,e.t0=e.catch(0),a("".concat(t," failed with error: '").concat(e.t0,"'"),{variant:"error"}),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}();if(!f)return null;if("not_found"===f){var T=r.pathname.split("/")[1];return Object(we.jsxs)("div",{className:"container",children:[Object(we.jsx)("h1",{children:"converted"===I?"Success! Draft group ".concat(s," have been converted!"):"Draft group not found."}),Object(we.jsxs)("div",{children:["converted"===I||"It may have been converted, deleted, or have never existed at all.",Object(we.jsx)("br",{}),"Check"," ",Object(we.jsx)(j.b,{to:"/".concat(T).concat(n?"/admin":"","/lockups"),children:"lockups"})," ","to find converted lockups or"," ",Object(we.jsx)(j.b,{to:"/".concat(T).concat(n?"/admin":"","/draft_groups"),children:"draft groups"})," ","to see all existing draft groups."]})]})}var U={value:f.total_amount,label:_(f.total_amount,t.decimals)||""};return Object(we.jsxs)("div",{className:"container",children:[Object(we.jsxs)("div",{className:"draft-group-preview-wrapper draft-group-preview-inner",children:[Object(we.jsxs)("div",{className:"draft-group-preview-info",style:{display:"flex"},children:[Object(we.jsxs)("h5",{children:["Draft group ".concat(s)," ",f.discarded&&Object(we.jsx)("span",{className:"discarded-marker",children:"DISCARDED"})]}),Object(we.jsx)(pt,{token:t,amount:U.label})]}),!f.funded&&n&&Object(we.jsxs)("div",{className:"draft-group-fund-button-wrapper",children:[!f.discarded&&Object(we.jsx)(ft,{draftGroupIndex:s,amount:U.value}),!f.discarded&&Object(we.jsx)(It,{draftGroupIndex:s,amount:U}),Object(we.jsx)(At,{draftGroupId:f.id,draftIds:f.draft_indices,disabled:f.funded})]}),f.funded&&f.draft_indices.length>0&&n&&Object(we.jsx)("div",{className:"draft-group-fund-button-wrapper",children:Object(we.jsx)(jt.a,{className:"button",type:"button",onClick:function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t,n,o,l,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d){e.next=2;break}throw new Error("near is null");case 2:e.prev=2,C(!0),t=f.draft_indices,n=100,o=i.a.mark((function e(r){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.slice(r,r+n),e.next=3,D("Convert drafts",Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.api.convertDrafts(a);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e)})),l=0;case 8:if(!(l<t.length)){e.next=13;break}return e.delegateYield(o(l),"t0",10);case 10:l+=n,e.next=8;break;case 13:a("Converted drafts for draft group ".concat(s),{variant:"success"}),u=r.pathname.split("/")[1],E("/".concat(u,"/admin/lockups")),window.location.reload(),e.next=22;break;case 19:e.prev=19,e.t1=e.catch(2),console.log("ERROR: ".concat(e.t1));case 22:return e.prev=22,C(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[2,19,22,25]])})));return function(){return e.apply(this,arguments)}}();e()},loading:y,variant:"contained",color:"success",children:"Convert"})}),f.funded&&0===f.draft_indices.length&&Object(we.jsx)("div",{style:{marginTop:20},children:Object(we.jsx)(ht.a,{severity:"success",children:"Draft Group converted"})})]}),(!f.funded||f.draft_indices.length>0)&&Object(we.jsx)(dt,{lockups:O,token:t,adminControls:n,progressShow:!0})]})}function Dt(e){var t=e.token,n=e.adminControls,r=Object(h.f)();console.log(r);var a=Object(l.useContext)(ge).near,s=Object(l.useState)([]),u=Object(o.a)(s,2),d=u[0],p=u[1];Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p([]),console.log("fetchDraftGroup called"),a){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,a.api.getDraftGroupsAll();case 6:t=e.sent,console.log(t),p(t);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[a]);var b=r.pathname.split("/")[1],f="/".concat(b,"/admin/import_draft_group");return Object(we.jsx)("div",{className:"main",children:Object(we.jsxs)("div",{className:"container",children:[Object(we.jsx)("h1",{children:"All draft groups"}),Object(we.jsxs)(Ce.a,{className:"main-table","aria-label":"collapsible table",children:[Object(we.jsx)(Se.a,{className:"table-head",children:Object(we.jsxs)(Ne.a,{children:[Object(we.jsx)(Ie.a,{align:"center",children:"ID"}),Object(we.jsx)(Ie.a,{align:"center",children:"Funded"}),Object(we.jsx)(Ie.a,{align:"center",children:"Number\xa0of\xa0lockups"}),Object(we.jsx)(Ie.a,{align:"right",children:"Total\xa0amount"}),n&&Object(we.jsx)(Ie.a,{align:"right",width:"0%",children:"Delete"})]})}),Object(we.jsx)(Ae.a,{children:d.map((function(e){return Object(we.jsxs)(Ne.a,{children:[Object(we.jsx)(Ie.a,{align:"center",children:Object(we.jsx)(j.b,{to:"/".concat(b,"/").concat(n?"admin/":"","draft_groups/").concat(e.id),children:e.id})}),Object(we.jsx)(Ie.a,{align:"center",children:e.funded?"Yes":"No"}),Object(we.jsx)(Ie.a,{align:"center",children:e.draft_indices.length}),Object(we.jsxs)(Ie.a,{align:"right",children:[_(e.total_amount,t.decimals),"\xa0",t.symbol,"\xa0",Object(we.jsx)(Ge,{url:t.icon||"",size:32})]}),n&&Object(we.jsx)(Ie.a,{align:"right",children:Object(we.jsx)(At,{draftGroupId:e.id,draftIds:e.draft_indices,disabled:e.funded})})]},e.id)}))})]}),n&&Object(we.jsx)(j.b,{to:f,children:Object(we.jsx)("button",{className:"button",type:"button",children:"Import Draft Group"})})]})})}var Tt=n(400);function Ut(){var e=Object(u.b)().enqueueSnackbar,t=Object(l.useContext)(ge),n=t.near,r=t.signIn;return n?Object(we.jsxs)("div",{children:[Object(we.jsx)("div",{className:"header",children:Object(we.jsx)("div",{className:"container",children:Object(we.jsxs)(Tt.a,{sx:{display:"flex"},children:[Object(we.jsx)(j.b,{className:"logo",to:"/",children:"LOCKUPS"}),Object(we.jsx)("div",{className:"nav",children:Object(we.jsx)(j.b,{className:"nav-link",to:"/",children:"Home"})})]})})}),Object(we.jsxs)("div",{className:"container new-lockup-contract",children:[Object(we.jsx)("h2",{children:"Create Lockup Contract for your Fungible Tokens"}),Object(we.jsx)("form",{className:"form-submit",onSubmit:function(t){t.preventDefault();var r=function(){var r=Object(c.a)(i.a.mark((function r(){var a,c,o,s,l;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,null!==n&&void 0!==n&&null!==(a=n.currentUser)&&void 0!==a&&a.signedAccountId){r.next=3;break}throw new Error("expected signedAccountId to be present");case 3:if(c=t.target.elements.lockup_operators.value.split(",").map((function(e){return e.trim()})).filter((function(e){return e.length>0})),o=t.target.elements.token_account_id.value,s=t.target.elements.lockup_subaccount_id.value,0!==c.length){r.next=8;break}throw new Error("empty lockup operators");case 8:if(0!==o.length){r.next=10;break}throw new Error("empty tokenAccountId");case 10:if(0!==s.length){r.next=12;break}throw new Error("empty lockupSubaccountId");case 12:return r.next=14,n.factoryApi.create(s,o,c,"".concat(window.location.origin+window.location.pathname,"#/").concat(s,".").concat(v,"/admin/lockups"));case 14:return l=r.sent,console.log(l),r.abrupt("return",l);case 19:return r.prev=19,r.t0=r.catch(0),console.log(r.t0),e(r.t0.toString(),{variant:"error"}),r.abrupt("return",null);case 24:case"end":return r.stop()}}),r,null,[[0,19]])})));return function(){return r.apply(this,arguments)}}();r()},children:Object(we.jsxs)("div",{className:"form-wrapper",children:[Object(we.jsx)("p",{children:"On this page you can deploy your own copy of lockup contract. Some more elaborative description follows here."}),Object(we.jsxs)("div",{className:"form-row",children:[Object(we.jsx)("span",{children:"Contract creator: "}),Object(we.jsxs)("div",{className:"form-cell",children:[n.currentUser.signedAccountId&&Object(we.jsx)("strong",{children:n.currentUser.signedAccountId}),Object(we.jsx)("button",{className:"button",type:"button",onClick:r,children:n.currentUser.signedAccountId?"Login as someone else":"Login"})]})]}),Object(we.jsxs)("div",{className:"form-row",children:[Object(we.jsx)("span",{children:"Lockup operators: "}),Object(we.jsx)("input",{type:"text",id:"lockup_operators"})]}),Object(we.jsxs)("div",{className:"form-row",children:[Object(we.jsx)("span",{children:"Fungible token contract address: "}),Object(we.jsx)("input",{type:"text",id:"token_account_id"})]}),Object(we.jsxs)("div",{className:"form-row",children:[Object(we.jsx)("span",{children:"New Lockup Contract Address: "}),Object(we.jsx)("input",{type:"text",id:"lockup_subaccount_id"})]}),Object(we.jsx)("button",{className:"button submit",type:"submit",disabled:!n.currentUser.signedAccountId,children:"Deploy Contract"})]})})]})]}):null}var Ft=n(402),Pt=n(401),Lt=n(397),Mt=n(374),Wt=n(193),Rt=n(375);function Bt(e){var t=e.token,n=Object(l.useContext)(ge).near,r=Object(l.useState)(!1),s=Object(o.a)(r,2),u=s[0],p=s[1],b=Object(l.useState)(null),h=Object(o.a)(b,2),j=h[0],f=h[1],x=Object(l.useState)("4_year"),v=Object(o.a)(x,2),O=v[0],g=v[1],k=function(){return p(!1)},w=Object(l.useState)(""),y=Object(o.a)(w,2),_=y[0],I=y[1],A=Object(l.useState)("pending"),E=Object(o.a)(A,2),D=E[0],T=E[1],U=Object(l.useState)(""),F=Object(o.a)(U,2),P=F[0],L=F[1],M=function(){var e=Object(c.a)(i.a.mark((function e(r){var a,c,s,l,u,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw Error("Cannot access token api");case 2:if(n.currentUser.signedAccountId){e.next=4;break}throw new Error("signedAccountId requred to set lockup terminator");case 4:if(j){e.next=6;break}throw Error("Start date not set");case 6:r.preventDefault(),console.log(P),a=(null===n||void 0===n?void 0:n.api.getContract().contractId)||"",c=new m.a(P).mul(new m.a(10).pow(t.decimals)).round(0,m.a.roundDown).toString(),s=function(e,t,n){var r=new Qe.a(t),a={"4y_cliff_1y_25":[{timestamp:C(e,0),balance:"0"},{timestamp:C(e,1)-1,balance:"0"},{timestamp:C(e,1),balance:r.divn(4).toString()},{timestamp:C(e,4),balance:r.toString()}]};return{"4_year":[a["4y_cliff_1y_25"],null],"4_year_vested":[a["4y_cliff_1y_25"],a["4y_cliff_1y_25"]]}[n]}(j,c,O),l=Object(o.a)(s,2),u=l[0],d=l[1],n.tokenApi.createLockup(a,c.toString(),_,u,d);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),W=!Number.isNaN(parseFloat(P));return Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)("button",{className:"button",type:"button",onClick:function(){var e=N(S(new Date),1);console.log("setStartDate",null===e||void 0===e?void 0:e.getTime()),f(e),p(!0)},children:"Create Lockup"}),Object(we.jsx)(mt.a,{open:u,sx:{padding:2},maxWidth:"xs",onClose:k,children:Object(we.jsxs)("form",{className:"form-submit",onSubmit:M,children:[Object(we.jsxs)(xt.a,{children:["Create Lockup",Object(we.jsx)(d.a,{"aria-label":"close",onClick:k,sx:{position:"absolute",right:8,top:8},children:Object(we.jsx)(kt.a,{})})]}),Object(we.jsxs)(vt.a,{sx:{maxWidth:"320px"},children:[Object(we.jsx)(Ct.a,{margin:"normal",id:"account",label:"Account Id",type:"text",fullWidth:!0,variant:"standard",onChange:function(e){var t=function(){var t=Object(c.a)(i.a.mark((function t(){var r,a,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:return r=e.target.value,console.log(D,T),I(r),T("pending"),t.prev=6,t.next=9,n.near.account(r);case 9:return t.next=11,t.sent.getAccountBalance();case 11:a=t.sent,c=a.total,console.log(c),T("success"),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(6),T("error");case 20:case"end":return t.stop()}}),t,null,[[6,17]])})));return function(){return t.apply(this,arguments)}}();t()},color:"success"===D?"success":"error"===D?"error":"primary"}),Object(we.jsx)(Ct.a,{margin:"normal",id:"amount",label:"Amount",type:"number",variant:"standard",InputProps:{endAdornment:Object(we.jsx)(Pt.a,{position:"end",children:t.symbol})},fullWidth:!0,onChange:function(e){var t=function(){var t=Object(c.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:r=e.target.value,L(r);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()}}),Object(we.jsx)("br",{}),Object(we.jsx)(Lt.a,{fullWidth:!0,sx:{marginTop:"20px"},children:Object(we.jsxs)(wt.a,{id:"schedule-select",value:O,label:"Schedule",onChange:function(e){g(e.target.value)},variant:"standard",fullWidth:!0,children:[Object(we.jsx)(_t.a,{value:"4_year",children:"4 year lockup with 25% cliff in 1 year"}),Object(we.jsx)(_t.a,{value:"4_year_vested",children:"4 year lockup with 25% cliff in 1 year (VESTED)"})]})}),Object(we.jsx)(Wt.a,{dateAdapter:Mt.a,children:Object(we.jsx)(Rt.a,{label:"Start date",value:j,onChange:function(e){console.log("setStartDate",null===e||void 0===e?void 0:e.getTime()),f(e)},renderInput:function(e){return Object(we.jsx)(Ct.a,Object(a.a)({margin:"normal",fullWidth:!0,variant:"standard"},e))}})})]}),Object(we.jsx)(Ot.a,{sx:{padding:"14px 24px 24px"},children:Object(we.jsx)("button",{disabled:!j||"error"===D||!W,className:"button fullWidth noMargin",type:"submit",children:"Create"})})]})})]})}var Gt=function(e){var t=e.currentState,n=e.handlers,r=e.dialog;return Object(we.jsx)(mt.a,{open:t.value,sx:{padding:2},maxWidth:"xs",onClose:n.onClose,children:Object(we.jsxs)("form",{className:"form-submit",children:[Object(we.jsxs)(xt.a,{children:["Terminate Lockup",Object(we.jsx)(d.a,{"aria-label":"close",onClick:n.onClose,sx:{position:"absolute",right:8,top:8},children:Object(we.jsx)(kt.a,{})})]}),Object(we.jsxs)(vt.a,{sx:{maxWidth:"320px"},children:[Object(we.jsxs)(Wt.a,{dateAdapter:Mt.a,children:[r.datePicker&&Object(we.jsx)(Rt.a,{label:"Custom termination date",minDate:new Date,value:r.datePicker.currentState.value,onChange:function(e){r.datePicker.currentState.setValue(e)},renderInput:function(e){return Object(we.jsx)(Ct.a,Object(a.a)({sx:{margin:"0px 0 24px"},margin:"normal",fullWidth:!0,variant:"standard"},e))}}),(null===r||void 0===r?void 0:r.daoSelector)&&Object(we.jsx)(St,{selectedAddress:r.daoSelector.currentState.value,setSelectedAddress:r.daoSelector.currentState.setValue}),(null===r||void 0===r?void 0:r.daoProposalDescription)&&Object(we.jsx)(Nt,{proposalDescription:r.daoProposalDescription.currentState.value,setProposalDescription:r.daoProposalDescription.currentState.setValue})]}),Object(we.jsx)("span",{style:{minHeight:"40px"}}),Object(we.jsx)("button",{className:"button red fullWidth",style:{marginTop:"40px"},type:"button",onClick:n.onSubmit,children:"Terminate"})]})]})})};var Vt=function(e){var t=Object(l.useContext)(ge).near,n=e.adminControls,r=e.lockupIndex,s=e.config,d=e.token,p=e.buttonText,b=Object(u.b)().enqueueSnackbar,h=Object(l.useState)(null),j=Object(o.a)(h,2),f=j[0],x=j[1],v=Object(l.useState)(!1),O=Object(o.a)(v,2),g=O[0],k=O[1];if(!t)throw Error("Cannot access lockup api");if(void 0===r)throw Error("Cannot terminate lockup without lockupIndex");var w=function(){var e=Object(c.a)(i.a.mark((function e(){var n,a,c,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b){e.next=2;break}return e.abrupt("return");case 2:return n=f?f.getTime()/1e3:null,e.next=5,t.api.terminate(r,n);case 5:a=e.sent,c=new m.a(a).div(new m.a(10).pow(d.decimals)).round(2,m.a.roundDown),console.log(c),o="Terminated lockup #".concat(r,", refunded ").concat(c," ").concat(d.symbol),b(o,{variant:"success"}),setTimeout((function(){return window.location.reload()}),1e3);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),y=n&&s,_={currentState:{value:g,setValue:k},handlers:{onClose:function(){return k(!1)},onSubmit:w},dialog:{datePicker:{currentState:{value:f,setValue:function(e){console.log("setDate",null===e||void 0===e?void 0:e.getTime()),x(e)}}}}};return Object(we.jsxs)(we.Fragment,{children:[y&&Object(we.jsx)("button",{className:"button",type:"button",onClick:function(){var e=N(S(new Date),1);return console.log("setDate",null===e||void 0===e?void 0:e.getTime()),x(e),k(!0)},children:p}),g&&Object(we.jsx)(Gt,Object(a.a)({},_))]})};var Jt=function(e){var t=Object(l.useContext)(ge).near,n=e.accountId,r=e.adminControls,c=e.lockupIndex,s=e.config,i=e.buttonText,u=Object(l.useState)(null),d=Object(o.a)(u,2),p=d[0],b=d[1],j=Object(l.useState)(!1),f=Object(o.a)(j,2),m=f[0],x=f[1],v=Object(h.f)().pathname.split("/")[1],O="/".concat(v,"/lockups/").concat(n,"/").concat(c),g=new URL(window.location.href);g.hash="#".concat(O);var k="Terminate lockup ".concat(c,". Lockup link: ").concat(g.toString()),w=Object(l.useState)(k),y=Object(o.a)(w,2),_=y[0],C=y[1],S=Object(l.useState)((null===s||void 0===s?void 0:s.beneficiary_id)||""),N=Object(o.a)(S,2),I=N[0],A=N[1];if(!t)throw Error("Cannot access lockup api");if(void 0===c)throw Error("Cannot terminate lockup without lockupIndex");var E=r&&s,D={currentState:{value:m,setValue:x},handlers:{onClose:function(){return x(!1)},onSubmit:function(){var e,n=Oe(_,t.api.getContract().contractId,c,p?p.getTime()/1e3:null,I);null===(e=window.open(n,"_blank"))||void 0===e||e.focus()}},dialog:{datePicker:{currentState:{value:p,setValue:b}},daoSelector:{currentState:{value:I,setValue:A}},daoProposalDescription:{currentState:{value:_,setValue:C}}}};return Object(we.jsxs)("div",{children:[Object(we.jsx)("button",{className:"button",disabled:!E,type:"button",onClick:function(){return x(!0)},style:{marginTop:0},children:i}),m&&Object(we.jsx)(Gt,Object(a.a)({},D))]})};function Ht(e){var t,n,r,a,c=Object(l.useState)(!1),s=Object(o.a)(c,2),i=s[0],u=s[1],p=e.adminControls,b=e.row,h=e.token;if(!Object(l.useContext)(ge).near)return null;var f,m,x=null===b||void 0===b||null===(t=b.termination_config)||void 0===t||null===(n=t.vesting_schedule)||void 0===n?void 0:n.Schedule,v=window.location.href.split("/").pop()===b.account_id,O=window.location.href.split("/").pop()===b.id.toString(),g="".concat(_(b.claimed_balance,h.decimals)),k="".concat(_(b.unclaimed_balance,h.decimals)),w="".concat(_(b.total_balance-b.claimed_balance-b.unclaimed_balance,h.decimals)),C="".concat(_(b.total_balance-b.total_balance,h.decimals));null!==(r=b.termination_config)&&void 0!==r&&r.beneficiary_id?f="Unvested amount will return to ".concat(null===(m=b.termination_config)||void 0===m?void 0:m.beneficiary_id):f="This lockup cannot be terminated";var S,N=null===b||void 0===b||null===(a=b.termination_config)||void 0===a?void 0:a.beneficiary_id;return Object(we.jsxs)(we.Fragment,{children:[Object(we.jsxs)(Ne.a,{className:i?"expanded exp-row":"exp-row",sx:{"& > *":{borderBottom:"unset"}},children:[Object(we.jsx)(Ie.a,{children:Object(we.jsx)(d.a,{"aria-label":"expand row",size:"small",onClick:function(){return u(!i)},children:i?Object(we.jsx)(Ue.a,{}):Object(we.jsx)(Pe.a,{})})}),Object(we.jsx)(Ie.a,{align:"left",children:O?b.id:Object(we.jsx)(j.b,{to:"".concat(b.id),children:b.id})}),Object(we.jsx)(Ie.a,{align:"left",children:v||O?b.account_id:Object(we.jsx)(j.b,{to:b.account_id,children:b.account_id})}),Object(we.jsx)(Ie.a,{align:"right",children:y(b.schedule[0].timestamp)}),Object(we.jsx)(Ie.a,{align:"right",children:y(b.schedule[b.schedule.length-1].timestamp)}),Object(we.jsx)(Ie.a,{align:"center",children:x?"Yes":"No"}),Object(we.jsxs)(Ie.a,{align:"right",children:[_(b.total_balance,h.decimals),"\xa0",h.symbol,"\xa0",Object(we.jsx)(Ge,{url:h.icon||"",size:32})]}),Object(we.jsx)(Ie.a,{align:"center",children:Object(we.jsx)(Ee.a,{title:Object(we.jsxs)("div",{className:"progress-bar__tooltip",children:[Object(we.jsxs)("span",{children:[Object(we.jsx)("i",{className:"claimed",children:"\xa0"}),Object(we.jsx)("b",{children:g})," ","Claimed"]}),Object(we.jsxs)("span",{children:[Object(we.jsx)("i",{className:"available",children:"\xa0"}),Object(we.jsx)("b",{children:k})," ","Available"]}),Object(we.jsxs)("span",{children:[Object(we.jsx)("i",{className:"vested",children:"\xa0"}),Object(we.jsx)("b",{children:w})," ","Vested"]}),Object(we.jsxs)("span",{children:[Object(we.jsx)("i",{className:"unvested",children:"\xa0"}),Object(we.jsx)("b",{children:C})," ","Unvested"]})]}),placement:"top",arrow:!0,children:Object(we.jsxs)("div",{className:"progress-bar",children:[Object(we.jsx)("div",{style:{width:"".concat(b.claimed_balance/b.total_balance*100,"%")},className:"claimed",children:"\xa0"}),Object(we.jsx)("div",{style:{width:"".concat(b.unclaimed_balance/b.total_balance*100,"%")},className:"available",children:"\xa0"}),Object(we.jsx)("div",{style:{width:"".concat((b.total_balance-b.claimed_balance-b.unclaimed_balance)/b.total_balance*100,"%")},className:"vested",children:"\xa0"}),Object(we.jsx)("div",{style:{width:"".concat(100*(b.total_balance-b.total_balance),"%")},className:"unvested",children:"\xa0"})]})})})]}),Object(we.jsx)(Ne.a,{sx:{background:"#F4F7FC"},children:Object(we.jsx)(Ie.a,{style:{padding:0},colSpan:8,children:Object(we.jsx)(De.a,{in:i,timeout:"auto",unmountOnExit:!0,children:Object(we.jsxs)("div",{className:"lockup-row",children:[Object(we.jsx)(Ve,{schedule:b.schedule,title:"Lockup schedule",token:h}),x&&Object(we.jsx)(Ve,{schedule:x,title:"Vesting schedule",token:h}),Object(we.jsxs)("div",{className:"lockup-row-column chart",children:[Object(we.jsx)("div",{style:{height:300},children:Object(we.jsx)(Be,{data:Ye([b],h.decimals)})}),Object(we.jsxs)("div",{className:"terminate",children:[Object(we.jsx)("span",{className:"fine-print",children:f}),N&&(S=N,p?Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)("div",{children:Object(we.jsx)(Vt,{token:h,adminControls:p,lockupIndex:b.id,config:b.termination_config,buttonText:S?"Terminate":"No termination config"})}),Object(we.jsx)("div",{children:Object(we.jsx)(Jt,{accountId:b.account_id,token:h,adminControls:p,lockupIndex:b.id,config:b.termination_config,buttonText:S?"Terminate with Dao":"No termination config"})})]}):null)]})]})]})})})})]})}function qt(e){var t=e.lockups,n=e.token,r=e.adminControls;return Object(we.jsxs)(Ce.a,{className:"main-table","aria-label":"collapsible table",children:[Object(we.jsx)(Se.a,{className:"table-head",children:Object(we.jsxs)(Ne.a,{children:[Object(we.jsx)(Ie.a,{}),Object(we.jsx)(Ie.a,{align:"left",children:"ID"}),Object(we.jsx)(Ie.a,{align:"left",children:"Account ID"}),Object(we.jsx)(Ie.a,{align:"right",children:"Start\xa0date"}),Object(we.jsx)(Ie.a,{align:"right",children:"End\xa0date"}),Object(we.jsx)(Ie.a,{align:"center",children:"Terminatable"}),Object(we.jsx)(Ie.a,{align:"right",children:"Total\xa0amount"}),Object(we.jsx)(Ie.a,{align:"center",children:"Progress"})]})}),Object(we.jsx)(Ae.a,{children:t.map((function(e){return Object(we.jsx)(Ht,{row:e,token:n,adminControls:r},e.id)}))})]})}function Kt(e){var t=e.tokenContractId,n=e.favouriteAccounts,r=e.uniqueUsers,a=e.onSave;console.log("unique users",r);var c=Object(l.useRef)(null),o=function(e){return e.replaceAll(" ","").split(",")},s=function(){var e,n=function(e){return JSON.stringify({favouriteAccounts:e})};if(null===c||void 0===c||null===(e=c.current)||void 0===e||!e.value)return localStorage.setItem(t,n([])),void a([]);var r=o(c.current.value);a(r),localStorage.setItem(t,n(r))};return Object(we.jsx)("div",{style:{display:"flex",marginBottom:"2em"},children:Object(we.jsx)(Ct.a,{inputProps:{sx:{margin:0}},size:"small",sx:{width:1,padding:0,margin:0},id:"outlined-helperText",label:"My accounts",placeholder:"Comma separated list of your near accounts",defaultValue:n.join(", "),inputRef:c,onKeyPress:function(e){return"Enter"===e.key&&s()},onChange:function(e){var t=e.target.value,r=o(t).filter((function(e){return e.match(/.*(\.)(near|testnet)$/)}));n.toString()!==r.toString()&&s()}})})}function Yt(e){var t,n=e.lockups,r=e.token,a=e.adminControls,c=Array.from(new Set(n.map((function(e){return e.account_id})))),s=Object(l.useContext)(ge).near,i=s.currentUser,u=i.signedIn,d=i.isAdmin,p=localStorage.getItem(r.contractId),b=p?null===(t=JSON.parse(p))||void 0===t?void 0:t.favouriteAccounts:[],h=Object(l.useState)(b),f=Object(o.a)(h,2),m=f[0],x=f[1],v=n.filter((function(e){return m.includes(e.account_id)})),O=function(e){return e.length>0?Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(Be,{data:Ye(e,r.decimals)}),u&&a&&d&&Object(we.jsx)(Bt,{token:r}),Object(we.jsx)(Ft.a,{sx:{boxShadow:"unset",margin:"0 0 20px"},children:Object(we.jsx)(qt,{lockups:e,token:r,adminControls:a})})]}):Object(we.jsxs)("div",{children:["There are no lockups yet.",a&&Object(we.jsxs)("div",{children:["Create single lockup or create batch of them via"," ",Object(we.jsx)(j.b,{to:"/".concat(s.lockupContractId,"/admin/import_draft_group"),children:"Draft Groups"}),"."]})]})};return console.log("favouriteAccountsLockups",v),a?Object(we.jsx)("div",{className:"main",children:Object(we.jsx)("div",{className:"container",children:O(n)})}):Object(we.jsx)("div",{className:"main",children:Object(we.jsxs)("div",{className:"container",children:[Object(we.jsx)(Kt,{tokenContractId:r.contractId,favouriteAccounts:m,uniqueUsers:c,onSave:x}),O(v)]})})}var zt=n(386);function $t(e){var t=e.message,n=e.isOpen,r=e.closeFn,a=e.callback;return Object(we.jsxs)(mt.a,{open:n,sx:{padding:2},maxWidth:"md",onClose:r,children:[Object(we.jsxs)(xt.a,{children:["Confirmation",Object(we.jsx)(d.a,{"aria-label":"close",sx:{position:"absolute",right:8,top:8},onClick:r,children:Object(we.jsx)(kt.a,{})})]}),Object(we.jsx)(vt.a,{sx:{minWidth:"320px"},children:Object(we.jsx)("div",{children:t})}),Object(we.jsxs)(Ot.a,{children:[Object(we.jsx)(zt.a,{color:"error",onClick:r,children:"Cancel"}),Object(we.jsx)(zt.a,{color:"success",variant:"contained",onClick:function(){r(),a()},children:"Confirm"})]})]})}var Zt=function(e){var t=Object(l.useContext)(ge).near,n=e.accountId,r=e.token,a=e.total,s=Object(l.useState)(!1),u=Object(o.a)(s,2),d=u[0],p=u[1],b=Object(l.useState)((function(){return null})),h=Object(o.a)(b,2),j=h[0],f=h[1];if(!t)throw Error("Cannot access lockup api");if(!n)throw Error("Undefined account cannot claim");var m="\n    Your account doesn't have storage deposit on the token contract. You will be redirected to pay for the storage, after that you will be able to claim your tokens.\n  ".trim();return Object(we.jsxs)("div",{className:"claim-wrapper",children:[Object(we.jsx)("h5",{children:"Total available"}),Object(we.jsx)(pt,{token:r,amount:a}),Object(we.jsx)("button",{className:"button fullWidth",type:"button",onClick:function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var r,a,c,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(t.tokenApi){e.next=4;break}return e.abrupt("return");case 4:if(t.noLoginTokenApi){e.next=6;break}return e.abrupt("return");case 6:if(t.tokenContractId){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,t.tokenApi.storageBalanceOf(n);case 10:if(r=e.sent,!(null!==r&&!0)){e.next=16;break}t.noLoginApi.claim(n),e.next=23;break;case 16:return e.next=18,t.tokenApi.storageBalanceBounds();case 18:a=e.sent,c=a.max,o=function(){t.noLoginTokenApi.storageDeposit(t.tokenContractId,n,c)},f((function(){return o})),p(!0);case 23:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()},children:"Claim All"}),Object(we.jsx)($t,{message:m,isOpen:d,closeFn:function(){return p(!1)},callback:j})]})};function Qt(e){var t=e.lockups,n=e.token,r=e.adminControls,a=Object(h.h)(),c=a.userId,o=a.id,s=t.filter((function(e){return o?e.id.toString()===o:e.account_id===c||e.id.toString()===c})),i=s.reduce((function(e,t){return e+parseFloat(t.unclaimed_balance)}),0);return console.log("user lockups",c,s),Object(we.jsx)("div",{className:"main",children:Object(we.jsxs)("div",{className:"container",children:[!r&&Object(we.jsx)(Zt,{accountId:c,token:n,total:_(i,n.decimals)}),Object(we.jsx)(Ft.a,{sx:{boxShadow:"unset"},children:Object(we.jsxs)(Ce.a,{className:"main-table","aria-label":"collapsible table",children:[Object(we.jsx)(Se.a,{className:"table-head",children:Object(we.jsxs)(Ne.a,{children:[Object(we.jsx)(Ie.a,{}),Object(we.jsx)(Ie.a,{align:"left",children:"ID"}),Object(we.jsx)(Ie.a,{align:"left",children:"Account ID"}),Object(we.jsx)(Ie.a,{align:"right",children:"Start\xa0date"}),Object(we.jsx)(Ie.a,{align:"right",children:"End\xa0date"}),Object(we.jsx)(Ie.a,{align:"right",children:"Terminatable"}),Object(we.jsx)(Ie.a,{align:"right",children:"Total\xa0amount"}),Object(we.jsx)(Ie.a,{align:"center",children:"Progress"})]})}),Object(we.jsx)(Ae.a,{children:s.map((function(e){return Object(we.jsx)(Ht,{row:e,token:n,adminControls:r},e.id)}))})]})})]})})}function Xt(e){var t=e.adminControls,n=Object(h.f)(),r=n.pathname.split("/")[1],a=Object(l.useContext)(ge),c=a.near,o=a.signOut;if(Object(l.useEffect)((function(){return console.log(n.pathname),function(){}}),[n]),!c)return null;var s=c.currentUser,i=s.signedIn,u=s.signedAccountId,d=s.isAdmin,p=s.isCouncilMember,b=t&&(d||p);return Object(we.jsx)("div",{className:"header",children:Object(we.jsx)("div",{className:"container",children:Object(we.jsxs)(Tt.a,{sx:{display:"flex"},children:[Object(we.jsx)(j.b,{className:"logo",to:"/",children:"LOCKUPS"}),Object(we.jsxs)("div",{className:"nav",children:[Object(we.jsx)(j.c,{className:"nav-link",to:"/".concat(r,b?"/admin/lockups":"/lockups"),children:"Lockups"}),Object(we.jsx)(j.c,{className:"nav-link",to:"/".concat(r,b?"/admin/draft_groups":"/draft_groups"),children:"Lockup Drafts"}),Object(we.jsx)(j.c,{className:"nav-link",to:"/".concat(r,b?"/admin/about":"/about"),children:"About"})]}),t&&i&&Object(we.jsxs)(Tt.a,{sx:{marginTop:"23px"},children:[Object(we.jsx)("span",{className:"account-name",children:u}),Object(we.jsx)("button",{className:"button",type:"button",onClick:o,children:"Log out"})]})]})})})}function en(e){var t=e.children;return Object(we.jsx)("div",{className:"container login",children:t})}var tn=function(){var e=Object(l.useContext)(ge),t=e.near,n=e.signIn;if(!t)return null;var r=t.currentUser,a=r.signedIn,c=r.isAdmin,o=r.isCouncilMember,s=a&&!(c||o),i=a&&(c||o);return Object(we.jsxs)(en,{children:[s&&Object(we.jsx)(ht.a,{sx:{margin:2,width:"500px"},severity:"error",children:"You are not admin"}),!a&&Object(we.jsx)("button",{className:"button",type:"button",onClick:n,children:"Sign In"}),i&&Object(we.jsx)(h.a,{to:"lockups",replace:!0})]})};function nn(){var e=Object(l.useContext)(ge).near;return Object(we.jsx)("div",{children:Object(we.jsxs)("div",{style:{maxWidth:640,margin:"auto",paddingTop:20},children:[Object(we.jsx)("p",{children:"Please pay for the account storage in fungible token contract. This is necessary to allow lockup contract to hold locked fungible token funds. This is a one time payment for the lockup contract. Additionally, all users claiming lockups will have to pay for the storage for their account too."}),Object(we.jsx)("button",{className:"button fullWidth",type:"button",onClick:function(){var t=function(){var t=Object(c.a)(i.a.mark((function t(){var n,r,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(e.tokenApi){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,e.tokenApi.storageBalanceBounds();case 6:return n=t.sent,r=n.max,console.log(r),t.next=11,e.tokenApi.storageDeposit(e.lockupContractId,r);case 11:a=t.sent,console.log(a);case 13:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()},children:"Pay"})]})})}function rn(e){var t=e.children,n=Object(h.f)(),r=n.pathname,a=n.pathname.includes("draft"),c=Object(l.useContext)(ge).near;if(!c)return null;var o=c.currentUser,s=o.signedIn,i=o.isAdmin,u=o.isCouncilMember,d=n.pathname.split("/")[1];return s&&(i||u)?c.isContractFtStoragePaid?t:Object(we.jsx)("div",{className:"container",children:Object(we.jsx)(nn,{})}):a?Object(we.jsx)(h.a,{to:r.replace(/\/admin/,""),replace:!0}):Object(we.jsx)(h.a,{to:"/".concat(d,"/admin"),replace:!0})}var an=n(195),cn=n.n(an);function on(e){var t=e.lockups,n=Object(l.useState)(x),r=Object(o.a)(n,2),a=r[0],c=r[1],s=Object(h.g)();return Object(we.jsxs)("div",{className:"root",children:[Object(we.jsx)("div",{className:"header",children:Object(we.jsx)("div",{className:"container",children:Object(we.jsx)(Tt.a,{sx:{display:"flex"},children:Object(we.jsx)(j.b,{className:"logo",to:"/",children:"LOCKUPS"})})})}),Object(we.jsx)("div",{className:"main",children:Object(we.jsxs)("div",{className:"container home",children:[Object(we.jsxs)("ul",{className:"home-list",children:[Object(we.jsx)("li",{children:Object(we.jsxs)("div",{children:[Object(we.jsx)("span",{children:"Total contracts"}),Object(we.jsx)("b",{children:"256"})]})}),Object(we.jsx)("li",{children:Object(we.jsxs)("div",{children:[Object(we.jsx)("span",{children:"Total locked"}),Object(we.jsx)("b",{children:"$5,336,000"})]})}),Object(we.jsx)("li",{children:Object(we.jsxs)("div",{children:[Object(we.jsx)("span",{children:"Total lockups"}),Object(we.jsx)("b",{children:(null===t||void 0===t?void 0:t.length)||42})]})})]}),Object(we.jsx)("h2",{children:"Manage token vesting on NEAR"}),Object(we.jsx)("p",{children:"Create new lockup contract to be used by startup"}),Object(we.jsx)(j.b,{to:"/new_lockup_contract",className:"button link-button",children:"Create Lockup Contract"}),Object(we.jsx)("div",{className:"line"}),Object(we.jsxs)("div",{className:"search-container",children:[Object(we.jsx)(Ct.a,{variant:"outlined",value:a,onChange:function(e){c(e.target.value)},className:"input",placeholder:"Enter existing Lockup contract address",InputProps:{startAdornment:Object(we.jsx)(Pt.a,{position:"start",children:Object(we.jsx)(cn.a,{})})}}),Object(we.jsx)("button",{className:"button",onClick:function(){var e="/".concat(a,"/lockups");s(e),window.location.reload()},"aria-label":"open",type:"button",children:"Search"})]})]})})]})}function sn(){return Object(we.jsx)("div",{className:"container",children:"Contract not found"})}n(309);function ln(){var e=Object(h.f)(),t=e.pathname,n=e.pathname.includes("admin"),r=t.indexOf("/",1),a="".concat(t.substring(0,r),"/admin").concat(t.substring(r,t.length));return Object(l.useContext)(ge).near?Object(we.jsx)("div",{className:"footer",children:Object(we.jsx)("div",{className:"container",children:Object(we.jsx)(Tt.a,{sx:{display:"flex"},children:Object(we.jsxs)("div",{className:"nav",children:[Object(we.jsx)(j.b,{className:"nav-link",to:"/terms",children:"Terms"}),Object(we.jsx)(j.b,{className:"nav-link",to:"/privacy",children:"Privacy"}),n?Object(we.jsx)(j.b,{className:"nav-link",to:t.replace(/\/admin/,""),children:"User view"}):Object(we.jsx)(j.b,{className:"nav-link",to:a,children:"Admin view"})]})})})}):null}function un(e){var t=e.token,n=e.adminControls,r=parseInt(Object(h.h)().draftId||"",10),a=Object(l.useContext)(ge).near,s=Object(l.useState)(),u=Object(o.a)(s,2),d=u[0],p=u[1];Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("fetchDraft called"),a){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,a.api.getDrafts([r]);case 5:t=e.sent,n=t.map((function(e){return Object.assign(e[1].lockup_create,{id:e[0]})})),p(n[0]);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[a,r]),console.log(d);return Object(we.jsx)("div",{className:"container",children:d&&Object(we.jsxs)(Ce.a,{className:"main-table","aria-label":"collapsible table",children:[Object(we.jsx)(Se.a,{className:"table-head",children:Object(we.jsxs)(Ne.a,{children:[Object(we.jsx)(Ie.a,{}),Object(we.jsx)(Ie.a,{align:"left",children:"ID"}),Object(we.jsx)(Ie.a,{align:"left",children:"Account ID"}),Object(we.jsx)(Ie.a,{align:"right",children:"Start\xa0date"}),Object(we.jsx)(Ie.a,{align:"right",children:"End\xa0date"}),Object(we.jsx)(Ie.a,{align:"right",children:"Total\xa0amount"}),Object(we.jsx)(Ie.a,{align:"center",children:"Progress"})]})}),Object(we.jsx)(Ae.a,{children:Object(we.jsx)(ut,{pageIndex:-1,row:d,token:t,adminControls:n,progressShow:true})})]})})}function dn(e){var t=e.lockups,n=e.token,r=e.contractId,c=e.near;return t?Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(Xt,{adminControls:!1}),Object(we.jsxs)(h.d,{children:[Object(we.jsx)(h.b,{path:"/",element:Object(we.jsx)(h.a,{replace:!0,to:"lockups"})}),Object(we.jsx)(h.b,{path:"/about",element:Object(we.jsx)(ye,{lockups:t,token_account_id:r})}),Object(we.jsx)(h.b,{path:"/lockups",element:r&&c&&Object(we.jsx)(Yt,{lockups:t,token:Object(a.a)(Object(a.a)({},n),{},{contractId:r}),adminControls:!1})}),Object(we.jsx)(h.b,{path:"/lockups/:userId",element:Object(we.jsx)(Qt,{lockups:t,token:n,adminControls:!1})}),Object(we.jsx)(h.b,{path:"/lockups/:userId/:id",element:Object(we.jsx)(Qt,{lockups:t,token:n,adminControls:!1})}),Object(we.jsx)(h.b,{path:"/draft_groups",element:Object(we.jsx)(Dt,{token:n,adminControls:!1})}),Object(we.jsx)(h.b,{path:"/draft_groups/:draftGroupId",element:Object(we.jsx)(Et,{token:n,adminControls:!1})}),Object(we.jsx)(h.b,{path:"/drafts/:draftId",element:Object(we.jsx)(un,{token:n,adminControls:!1})})]})]}):null}function pn(e){var t=e.lockups,n=e.token,r=e.tokenContractId,c=e.near;if(!t)return null;var o=r&&c;return Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(Xt,{adminControls:!0}),Object(we.jsxs)(h.d,{children:[Object(we.jsx)(h.b,{path:"/",element:Object(we.jsx)(tn,{})}),Object(we.jsx)(h.b,{path:"/about",element:Object(we.jsx)(ye,{lockups:t,token_account_id:r})}),Object(we.jsx)(h.b,{path:"/lockups",element:o&&Object(we.jsx)(rn,{children:Object(we.jsx)(Yt,{lockups:t,token:Object(a.a)(Object(a.a)({},n),{},{contractId:r}),adminControls:!0})})}),Object(we.jsx)(h.b,{path:"/lockups/:userId",element:Object(we.jsx)(rn,{children:Object(we.jsx)(Qt,{lockups:t,token:n,adminControls:!0})})}),Object(we.jsx)(h.b,{path:"/lockups/:userId/:id",element:Object(we.jsx)(rn,{children:Object(we.jsx)(Qt,{lockups:t,token:n,adminControls:!0})})}),Object(we.jsx)(h.b,{path:"/draft_groups",element:Object(we.jsx)(rn,{children:Object(we.jsx)(Dt,{token:n,adminControls:!0})})}),Object(we.jsx)(h.b,{path:"/draft_groups/:draftGroupId",element:Object(we.jsx)(rn,{children:Object(we.jsx)(Et,{token:n,adminControls:!0})})}),Object(we.jsx)(h.b,{path:"/drafts/:draftId",element:Object(we.jsx)(rn,{children:Object(we.jsx)(un,{token:n,adminControls:!0})})}),Object(we.jsx)(h.b,{path:"/import_draft_group",element:Object(we.jsx)(rn,{children:Object(we.jsx)(bt,{token:n,adminControls:!0})})})]})]})}function bn(){var e=Object(u.b)().enqueueSnackbar,t=Object(l.useContext)(ge).near,n=Object(l.useState)({}),r=Object(o.a)(n,2),a=r[0],s=r[1],d=Object(l.useState)(null),p=Object(o.a)(d,2),b=p[0],f=p[1],x=Object(l.useState)({decimals:0,icon:null,name:"",reference:null,reference_hash:null,spec:"",symbol:""}),v=Object(o.a)(x,2),O=v[0],g=v[1];Object(l.useEffect)((function(){if(e&&t&&O&&""!==O.spec){var n=function(){var n=Object(c.a)(i.a.mark((function n(){var r,a,c,o,s,l,u,d,p,b,h,j,f,x,v,g,k,y,_,C,S,N,I,A,D,T;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=new URLSearchParams(window.location.search),a=r.get("transactionHashes")){n.next=4;break}return n.abrupt("return");case 4:return c=a.split(",")[0],console.log("txHash",c),n.next=8,t.rpcProvider.txStatus(c,"sender.testnet");case 8:if(o=n.sent,console.log(o),s=o.transaction.actions[0].FunctionCall.method_name,l=o.status.SuccessValue,u=JSON.parse(atob(o.transaction.actions[0].FunctionCall.args)),"claim"!==s){n.next=22;break}if(!l){n.next=20;break}if("0"===(d=JSON.parse(atob(l)))){n.next=20;break}return p=new m.a(d).div(new m.a(10).pow(O.decimals)).round(2,m.a.roundDown),e("Claimed ".concat(p," ").concat(O.symbol),{variant:"success"}),n.abrupt("return");case 20:return e("Claim failed: ".concat(E(c)),{variant:"error"}),n.abrupt("return");case 22:if("storage_deposit"!==s){n.next=30;break}return b=JSON.parse(atob(l)),h=parseFloat(w(b.total,9)).toString(),console.log(h),j=u.account_id,f="Successfully paid ".concat(h,"N for FT storage of ").concat(j),e(f,{variant:"success"}),n.abrupt("return");case 30:if("ft_transfer_call"!==s){n.next=58;break}if(x=JSON.parse(u.msg),console.log(x),!x.schedule){n.next=45;break}if(v=JSON.parse(atob(l)),g=new m.a(v).div(new m.a(10).pow(O.decimals)).round(2,m.a.roundDown),console.log(g),x.schedule[x.schedule.length-1].balance!==v){n.next=42;break}return k="Created lockup for ".concat(x.account_id," with amount ").concat(g," ").concat(O.symbol),e(k,{variant:"success"}),n.abrupt("return");case 42:return y="Failed to create lockup for ".concat(x.account_id,": ").concat(E(c)),e(y,{variant:"error"}),n.abrupt("return");case 45:if(null===x.draft_group_id){n.next=56;break}if(_=JSON.parse(atob(l)),C=new m.a(_).div(new m.a(10).pow(O.decimals)).round(2,m.a.roundDown),console.log(C),"0"===_){n.next=53;break}return S="Funded draft group ".concat(x.draft_group_id," with amount ").concat(C," ").concat(O.symbol),e(S,{variant:"success"}),n.abrupt("return");case 53:return N="Failed to fund draft group ".concat(x.draft_group_id,": ").concat(E(c)),e(N,{variant:"error"}),n.abrupt("return");case 56:return e("Transaction performed, TODO ".concat(c,"!"),{variant:"warning"}),n.abrupt("return");case 58:if("terminate"!==s){n.next=68;break}if(!l){n.next=66;break}return I=JSON.parse(atob(l)),console.log(I),A=new m.a(I).div(new m.a(10).pow(O.decimals)).round(2,m.a.roundDown),D="Terminated lockup #".concat(u.lockup_index,", unvested amount: ").concat(A),e(D,{variant:"success"}),n.abrupt("return");case 66:return e("Terminate lockup failed: ".concat(E(c)),{variant:"error"}),n.abrupt("return");case 68:T='UNHANDLED Transaction "'.concat(s,'" : ').concat(E(c)),e(T,{variant:"warning"});case 70:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();n()}}),[e,t,O]),Object(l.useEffect)((function(){var e=!0;if(t){var n=function(){var n=Object(c.a)(i.a.mark((function n(){var r,a;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.api.loadAllLockups();case 2:return r=n.sent,n.next=5,t.tokenApi.ftMetadata();case 5:if(a=n.sent,e){n.next=8;break}return n.abrupt("return");case 8:g(a),s({lockups:r,name:"name"});case 10:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();t.tokenContractId&&n()}return function(){e=!1}}),[t]),Object(l.useEffect)((function(){return t&&t.tokenApi&&f(t.tokenApi.getContract().contractId),function(){}}),[t]);var k=a.lockups;return Object(we.jsxs)(j.a,{children:[Object(we.jsxs)(h.d,{children:[Object(we.jsx)(h.b,{path:"/",element:Object(we.jsx)(on,{lockups:k})}),Object(we.jsx)(h.b,{path:"/new_lockup_contract/",element:Object(we.jsx)(Ut,{})}),Object(we.jsx)(h.b,{path:"/:cid/*",element:b&&t&&Object(we.jsx)(dn,{lockups:k,token:O,contractId:b,near:t})}),Object(we.jsx)(h.b,{path:"/:cid/admin/*",element:b&&t&&Object(we.jsx)(pn,{lockups:k,token:O,tokenContractId:b,near:t})}),Object(we.jsx)(h.b,{path:"/:cid/not_found_contract/",element:Object(we.jsx)(sn,{})}),Object(we.jsx)(h.b,{path:"*",element:Object(we.jsx)(sn,{})})]}),Object(we.jsx)(ln,{})]})}n(310);function hn(e){var t=e.snackbarKey,n=Object(u.b)().closeSnackbar;return Object(we.jsx)(d.a,{onClick:function(){return n(t)},children:Object(we.jsx)(b.a,{style:{color:"white"}})})}function jn(){var e=Object(l.useState)(null),t=Object(o.a)(e,2),n=t[0],r=t[1];Object(l.useEffect)((function(){function e(){return(e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ke();case 2:t=e.sent,r(t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}try{!function(){e.apply(this,arguments)}()}catch(t){console.log(t)}}),[]);var s=Object(l.useMemo)((function(){return{near:n,signIn:function(){var e;null===n||void 0===n||null===(e=n.api)||void 0===e||e.signIn()},signOut:function(){n&&(n.api.signOut(),r(Object(a.a)(Object(a.a)({},n),{},{currentUser:{signedIn:!1,signedAccountId:null,isAdmin:!1,isCouncilMember:!1,daos:[]}})))}}}),[n]);return Object(we.jsx)(l.StrictMode,{children:Object(we.jsx)(ge.Provider,{value:s,children:Object(we.jsx)(u.a,{autoHideDuration:null,action:function(e){return Object(we.jsx)(hn,{snackbarKey:e})},onClose:function(){var e=new URL(window.location.href),t=new URLSearchParams(e.search);t.delete("transactionHashes"),e.search=t.toString(),window.history.pushState({},null,e.toString())},children:Object(we.jsx)(bn,{})})})})}Object(r.render)(Object(we.jsx)(jn,{}),document.getElementById("root"))}},[[311,1,2]]]);
//# sourceMappingURL=main.205031f3.chunk.js.map